(window["webpackJsonp_AppSp"]=window["webpackJsonp_AppSp"]||[]).push([["chunk-322e2c95"],{1296:function(t,e,s){"use strict";var a=s("81a9"),i=s("bff7");e["a"]={get_event_list(t){return Object(a["a"])(Object(i["b"])("POST","/event/get_event_list/",t))},get_filter_list(t){return Object(a["a"])(Object(i["b"])("POST","/event/get_filter_item/",t))},get_filter_item(t){return Object(a["a"])(Object(i["b"])("POST","/event/get_filter_item/",t))},retry_task(t){return Object(a["a"])(Object(i["b"])("POST","/event/retry_task/",t))},get_error_task_list(t){return Object(a["a"])(Object(i["b"])("POST","/event/get_error_task_list/",t))},ignore(t){return Object(a["a"])(Object(i["b"])("POST","/event/task_status/",t))},get_repair_event_list(t){return Object(a["a"])(Object(i["b"])("POST","/event/get_error_task_list/",t))},getUnderlyingTasks(t){return Object(a["a"])(Object(i["b"])("GET","/event/get_maintask_detail/",t))},getTasksStatus(t){return Object(a["a"])(Object(i["b"])("GET","/event/check_task_resource/",t))},setTasksStatus(t){return Object(a["a"])(Object(i["b"])("POST","/event/repair_task_resource/",t))},setReTasks(t){return Object(a["a"])(Object(i["b"])("POST","/event/repair_task/",t))},getResourceStatus(){return Object(a["a"])(Object(i["b"])("GET","/event/resource_status/"))},task_flow_check(t){return Object(a["a"])(Object(i["b"])("GET","/event/task_flow_check/",t))}}},"26f3":function(t,e,s){"use strict";s("4f3f")},4774:function(t,e,s){"use strict";s("835c")},"4f3f":function(t,e,s){},6437:function(t,e,s){"use strict";s("87d1")},"835c":function(t,e,s){},"87d1":function(t,e,s){},9064:function(t,e,s){"use strict";var a=s("81a9"),i=s("bff7");e["a"]={get_task_list(t){return Object(a["a"])(Object(i["b"])("POST","/event/get_task_list/",t))},reTry(t){return Object(a["a"])(Object(i["b"])("POST","/task/task_retry/",t))},get_customer_list(t){return Object(a["a"])(Object(i["b"])("GET","/event/get_customer_list/",t))}}},"9a8d":function(t,e,s){"use strict";var a=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("el-date-picker",{attrs:{type:t.time_option.type,editable:!1,"range-separator":"至","picker-options":{disabledDate:t.dis_date,onPick:t.onPicker},clearable:t.time_option.clearable,"start-placeholder":t.time_option.placeholder[0],"end-placeholder":t.time_option.placeholder[1]},on:{change:t.FnEmit},model:{value:t.time,callback:function(e){t.time=e},expression:"time"}})},i=[],r=s("9ab4"),l=s("1b40");let n=class extends l["e"]{constructor(){super(...arguments),this.time=[],this.min_date="",this.day=0}dis_date(t){const{day:e}=this;if(0===e)return;let s=864e5,a=(new Date).getTime(),i=(new Date).getTime(),r=(new Date).getTime();return this.time_option.min_date?(i=new Date(this.time_option.min_date).getTime(),t.getTime()>r||t.getTime()<i-s):t.getTime()>r||t.getTime()>(this.min_date||a)+s*e||this.min_date&&t.getTime()<this.min_date-s*e}onPicker({maxDate:t,minDate:e}){this.min_date=e.getTime()}created(){this.day=this.time_option.dis_day-1||0,this.FnChangeDefaultTime(this.time_option.defaultTime)}FnClear(){this.FnChangeDefaultTime(this.time_option.defaultTime)}FnChangeDefaultTime(t){console.log("clear",t),t.length,this.time=t,this.FnEmit()}FnEmit(){return this.min_date="",this.time}};Object(r["a"])([Object(l["c"])({default:()=>({placeholder:["开始时间","结束时间"],type:"daterange",width:"360",clearable:!1,dis_day:31,min_date:"",defaultTime:[new Date,new Date]})})],n.prototype,"time_option",void 0),Object(r["a"])([Object(l["c"])({default:!1})],n.prototype,"clear",void 0),Object(r["a"])([Object(l["f"])("time_option.defaultTime")],n.prototype,"FnChangeDefaultTime",null),Object(r["a"])([Object(l["b"])("fn-emit")],n.prototype,"FnEmit",null),n=Object(r["a"])([l["a"]],n);var o=n,c=o,u=s("2877"),_=Object(u["a"])(c,a,i,!1,null,null,null);e["a"]=_.exports},a58a:function(t,e,s){"use strict";s("e410")},c507:function(t,e,s){"use strict";s.r(e);var a=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",[e("div",{staticClass:"head-box"},[t._v(" "+t._s(t.event_name)+" "),e("el-button",{staticStyle:{float:"right","margin-top":"7px"},attrs:{type:"primary",plain:""},on:{click:t.FnReturn}},[t._v("返回")])],1),e("div",{staticClass:"content m-top20"},[e("div",{staticClass:"event-content"},[e("div",{staticClass:"event-search"},[e("el-input",{attrs:{placeholder:"请输入资源ID或资源名称查询",clearable:""},model:{value:t.cloud_id,callback:function(e){t.cloud_id=e},expression:"cloud_id"}}),e("el-button",{attrs:{type:"primary"},on:{click:t.getTaskList}},[t._v("搜索")])],1),e("div",{staticClass:"event-detail"},[e("div",[t._v("任务总数:"+t._s(t.task_num))]),e("div",{staticClass:"destroy"},[t._v("已完成任务数:"+t._s(t.finish_num))]),e("div",[t._v("完成率："+t._s(t.finished_percent))]),e("div",[t._v("成功任务数:"+t._s(t.success_num))]),e("div",{staticClass:"error"},[t._v("失败任务数:"+t._s(t.fail_num))]),e("div",{staticClass:"nonExecution"},[t._v("不执行:"+t._s(t.none_exec_num))])])]),e("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"event-table",attrs:{data:t.task_list,border:""},on:{"sort-change":t.FnSortChange,"filter-change":t.filterAttribute}},[e("el-table-column",{attrs:{prop:"task_id",label:"任务ID"},scopedSlots:t._u([{key:"default",fn:function(s){return[e("span",[t._v(t._s(s.row.task_id?s.row.task_id:"-"))])]}}])}),e("el-table-column",{attrs:{prop:"customer_id",lable:"客户ID","filter-multiple":!1,"column-key":"customer_id",filters:t.customer_id_list}}),e("el-table-column",{attrs:{prop:"customer_name",label:"客户名称","filter-multiple":!1,"column-key":"customer_name",filters:t.customer_name_list},scopedSlots:t._u([{key:"default",fn:function(s){return[e("span",[t._v(t._s(s.row.customer_name?s.row.customer_name:"-"))])]}}])}),e("el-table-column",{attrs:{prop:"resource_name",label:"资源名称"},scopedSlots:t._u([{key:"default",fn:function(s){return[""!=s.row.resource_name?e("el-button",{attrs:{type:"text"},on:{click:t.toPhysical}},[t._v(t._s(s.row.resource_name))]):e("span",[t._v("-")])]}}])}),e("el-table-column",{attrs:{prop:"cloud_id",label:"资源ID"}}),e("el-table-column",{attrs:{prop:"",label:"资源配置"},scopedSlots:t._u([{key:"default",fn:function(s){return[s.row.resource_name.length>0?e("div",{staticClass:"resource_name"},[e("el-popover",{attrs:{title:"",placement:"top-start",width:"200",trigger:"hover",content:t.getResourceConfig(s.row)}},[e("span",{staticClass:"isButton",attrs:{slot:"reference"},slot:"reference"},[t._v(t._s(s.row.spec_family_name))])])],1):e("div",[t._v(" - ")])]}}])}),e("el-table-column",{attrs:{prop:"task_type",label:"任务名称"}}),e("el-table-column",{attrs:{prop:"task_state",label:"任务状态","filter-multiple":!1,"column-key":"status",filters:t.status_list},scopedSlots:t._u([{key:"default",fn:function(s){return[e("div",{staticClass:"taskStatus"},["init"===s.row.status?e("div",{staticClass:"tip-icon status-init"}):"doing"===s.row.status?e("div",{staticClass:"tip-icon status-doing"}):"success"===s.row.status?e("div",{staticClass:"tip-icon status-success"}):(s.row.status,e("div",{staticClass:"tip-icon status-failed"})),e("span",[t._v(t._s(s.row.task_state))])])]}}])}),e("el-table-column",{attrs:{prop:"detail",label:"执行结果"},scopedSlots:t._u([{key:"default",fn:function(s){return[s.row.detail?e("span",[t._v(t._s(s.row.detail))]):e("span",[t._v("--")])]}}])}),e("el-table-column",{attrs:{prop:"error_type",label:"失败类型","filter-multiple":!1,"column-key":"error_type",filters:t.fail_type_list},scopedSlots:t._u([{key:"default",fn:function(s){return[e("span",[t._v(t._s(s.row.error_type?s.row.error_type:"-"))])]}}])}),e("el-table-column",{attrs:{prop:"create_time",label:"创建时间",sortable:"custom"},scopedSlots:t._u([{key:"default",fn:function(s){return[e("span",[t._v(t._s(s.row.create_time?t.moment(s.row.create_time).format("YYYY-MM-DD HH:mm:ss"):"--"))])]}}])}),e("el-table-column",{attrs:{prop:"update_time",label:"更新时间",sortable:"custom"},scopedSlots:t._u([{key:"default",fn:function(s){return[e("span",[t._v(t._s(s.row.update_time?t.moment(s.row.update_time).format("YYYY-MM-DD HH:mm:ss"):"--"))])]}}])}),e("el-table-column",{attrs:{prop:"end_time",label:"完成时间",sortable:"custom"},scopedSlots:t._u([{key:"default",fn:function(s){return[e("span",[t._v(t._s(s.row.end_time?t.moment(s.row.end_time).format("YYYY-MM-DD HH:mm:ss"):"--"))])]}}])})],1),e("el-pagination",{attrs:{"current-page":t.current,"page-sizes":[20,50,100],"page-size":t.size,layout:"total, sizes, prev, pager, next, jumper",total:t.total},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}})],1),e("div",{staticClass:"err-record"},[e("el-dialog",{attrs:{title:"错误记录",visible:t.visible,width:"40%"},on:{"update:visible":function(e){t.visible=e}}},[e("div",{staticClass:"err_record"},[t._v(t._s(t.err_record))])])],1)])},i=[],r=(s("14d9"),s("9ab4")),l=s("1b40"),n=s("c811"),o=s("9064"),c=s("1296"),u=s("ed46"),_=s("c1df"),p=s.n(_);let d=class extends l["e"]{constructor(){super(...arguments),this.stateList=[{type:"",label:"全部"},{type:"doing",label:"执行中"},{type:"success",label:"成功"},{type:"failed",label:"失败"}],this.search={},this.task_num=0,this.finish_num=0,this.finished_percent="0.00%",this.fail_num=0,this.success_num=0,this.none_exec_num=0,this.err="err",this.loading=!1,this.visible=!1,this.err_record="",this.moment=p.a,this.event_name="",this.task_list=[],this.current=1,this.size=20,this.total=0,this.search_data={},this.status_list=[],this.fail_type_list=[],this.sort_prop_name="",this.sort_value="",this.filter_obj={},this.cloud_id="",this.customer_id_list=[],this.customer_name_list=[]}created(){this.getFilterList(),this.getTaskList(),this.getCurCustomer()}mounted(){this.event_name=this.$route.query.name}FnReturn(){this.$router.go(-1)}watch_pod(t){t&&(this.current=1,this.getTaskList())}fn_search(t={}){this.current=1,this.search_data={...t,...this.filter_obj},this.getTaskList()}async getFilterList(){let t=await c["a"].get_filter_list({filed_names:["status","error_type"]});if("Success"===t.code){for(let e in t.data.status)this.status_list.push({text:t.data.status[e],value:e});for(let e in t.data.error_type)this.fail_type_list.push({text:t.data.error_type[e],value:e})}}async getTaskList(){const{filter_obj:t}=this,e=this.$route.params.task_id;let s={az_id:this.$store.state.az_id,status:t.status&&t.status.length>0?t.status[0]:"",event_id:e,page_index:this.current,page_size:this.size,[this.sort_prop_name]:this.sort_value,error_type:t.error_type?t.error_type[0]:void 0,cloud_id:this.cloud_id?this.cloud_id:""};console.log("params",s);let a=await o["a"].get_task_list(s);var i,r,l,n,c,u,_,p;"Success"===a.code?(this.task_list=null===(i=a.data)||void 0===i?void 0:i.event_list,this.total=(null===(r=a.data)||void 0===r||null===(l=r.page_info)||void 0===l?void 0:l.count)||0,this.task_num=null===(n=a.data)||void 0===n?void 0:n.task_num,this.finish_num=null===(c=a.data)||void 0===c?void 0:c.finish_num,this.fail_num=null===(u=a.data)||void 0===u?void 0:u.fail_num,this.success_num=null===(_=a.data)||void 0===_?void 0:_.success_num,this.finished_percent=this.task_num?(this.finish_num/this.task_num*100).toFixed(2)+"%":"0.00%",this.none_exec_num=null===(p=a.data)||void 0===p?void 0:p.none_exec_num):this.$message.error(a.msg)}handleSizeChange(t){this.size=t,this.getTaskList()}handleCurrentChange(t){this.current=t,this.getTaskList()}FnSortChange(t){this.sort_prop_name="sort_"+t.prop,this.sort_value="descending"===t.order?"0":"ascending"===t.order?"1":void 0,this.getTaskList()}filterAttribute(t){this.filter_obj={...this.filter_obj,...t},this.fn_search(this.search_data)}view(t){this.err_record=t,this.visible=!0}async reTry(t){let e=await o["a"].reTry({task_id:t});"Success"===e.code?(this.$message.success(e.msg),this.getTaskList()):this.$message.error(e.msg||"操作错误")}back(){this.$router.go(-1)}getCurCustomer(){let t={event_id:this.$route.params.id};o["a"].get_customer_list(t).then(t=>{if("Success"===t.code&&t.data.customer_list.length>0)for(let e in t.data.customer_list)this.customer_id_list.push({text:t.data.customer_list[e].id,value:e}),this.customer_name_list.push({text:t.data.customer_list[e].name,value:e})})}getResourceConfig(t){let e="";return e=t.gpu_type.length>0?t.cpu_size+"C | "+t.ram_size+"G | "+t.gpu_type+" | "+t.system_disk_size+"G "+t.system_disk_type:t.cpu_size+"C | "+t.ram_size+"G | -- | "+t.system_disk_size+"G "+t.system_disk_type,e}toPhysical(){this.$router.push({path:"/physical"})}};Object(r["a"])([Object(l["f"])("$store.state.az_id")],d.prototype,"watch_pod",null),d=Object(r["a"])([Object(l["a"])({components:{ActionBlock:n["a"],backHeader:u["a"]}})],d);var h=d,m=h,b=(s("f4b8"),s("6437"),s("2877")),f=Object(b["a"])(m,a,i,!1,null,"e225c086",null);e["default"]=f.exports},c811:function(t,e,s){"use strict";s("e9f5"),s("910d");var a=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",{staticClass:"action-box",style:t.isShowBg?{}:{background:"#fff",padding:0,margin:0,border:"none"}},[e("div",{ref:"search",staticClass:"search-box",class:{fold:!t.isOpen}},[t._l(t.search_option,(function(s,a){return e("div",{key:a,staticClass:"search-input",style:s.width?{width:s.width+"px"}:{}},[s.list&&!s.type?e("el-select",{attrs:{placeholder:s.placeholder,multiple:s.multiple,filterable:s.filter,clearable:""},model:{value:t.search_value[a],callback:function(e){t.$set(t.search_value,a,e)},expression:"search_value[key]"}},t._l(s.list,(function(t,a){return e("el-option",{key:Array.isArray(s.list)?t.type:a,attrs:{label:Array.isArray(s.list)?t.label:t,value:Array.isArray(s.list)?t.type:a}})})),1):t._e(),(s.list||s.type||s.multi)&&"composite"!==s.type?t._e():e("el-input",{staticClass:"composite",style:s.width?{width:s.width+"px"}:{},attrs:{placeholder:s.placeholder,clearable:""},model:{value:t.search_value[a],callback:function(e){t.$set(t.search_value,a,e)},expression:"search_value[key]"}},["composite"===s.type?e("el-select",{attrs:{slot:"prepend",placeholder:"请选择"},slot:"prepend",model:{value:t.search_value[a+"sub"],callback:function(e){t.$set(t.search_value,a+"sub",e)},expression:"search_value[key + 'sub']"}},t._l(s.list,(function(t){return e("el-option",{key:t.type,attrs:{label:t.label,value:t.type}})})),1):t._e()],1),s.multi?e("el-popover",{attrs:{placement:"bottom",width:"250",trigger:"click"}},[e("el-input",{attrs:{type:"textarea",rows:4,placeholder:s.placeholder+"（使用回车或英文逗号隔开）"},model:{value:t.search_value[a],callback:function(e){t.$set(t.search_value,a,e)},expression:"search_value[key]"}}),!s.list&&!s.type||s.multi?e("el-input",{staticClass:"multi_input",style:s.width?{width:s.width+"px"}:{},attrs:{slot:"reference",placeholder:s.placeholder,clearable:""},slot:"reference",model:{value:t.search_value[a],callback:function(e){t.$set(t.search_value,a,e)},expression:"search_value[key]"}}):t._e()],1):t._e(),"datetimerange"===s.type||"daterange"===s.type?[e("date-picker",{ref:"datepicker",refInFor:!0,attrs:{time_option:t.search_option[a]},on:{"fn-emit":function(e){return t.FnGetTime(e,a)}}})]:t._e()],2)})),t.type?t._e():e("div",{staticClass:"m-bottom20"},[e("el-button",{attrs:{type:"primary"},on:{click:t.FnSearch}},[t._v("查 询")]),e("el-button",{attrs:{type:"default"},on:{click:t.FnClear}},[t._v("清 空")])],1)],2),t.type?e("div",{staticClass:"m-bottom5"},[e("el-button",{attrs:{type:"primary"},on:{click:t.FnSearch}},[t._v("查 询")]),"physical"===t.type?e("el-button",{attrs:{type:"primary"},on:{click:t.FnMultiSearch}},[t._v("批量查询")]):t._e(),e("el-button",{attrs:{type:"default"},on:{click:t.FnClear}},[t._v("清 空")]),e("el-button",{staticClass:"m-bottom10",attrs:{type:"text"},on:{click:t.operate}},[t._v(t._s(t.isOpen?"折叠":"展开"))])],1):t._e(),t._t("default",(function(){return[t.create_btn?e("el-button",{attrs:{type:"primary",disabled:t.disabled},on:{click:t.FnShowCreate}},[t._v(t._s(t.create_btn))]):t._e()]})),e("el-dialog",{attrs:{title:"批量查询",visible:t.syncVisible,width:"400px","destroy-on-close":!0,"close-on-click-modal":!1}},[e("el-input",{attrs:{type:"textarea",rows:13,placeholder:"请输入主机ID/名称,格式如下：\nPOD01-CLU01-H001\nPOD01-CLU01-H002\nPOD01-CLU01-H003\n..."},model:{value:t.search_value["host_info"],callback:function(e){t.$set(t.search_value,"host_info",e)},expression:"search_value['host_info']"}}),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{attrs:{type:"primary"},on:{click:t.FnSearch}},[t._v("确认")]),e("el-button",{on:{click:function(e){t.syncVisible=!1}}},[t._v("取消")])],1)],1)],2)},i=[],r=s("9ab4"),l=s("1b40"),n=s("9a8d");let o=class extends l["e"]{constructor(){super(...arguments),this.search_value={},this.time=null,this.date_key="",this.syncVisible=!1,this.isOpen=!0}FnGetTime(t,e){this.time=t,this.date_key=e}FnSearch(){return this.syncVisible=!1,this.search_value[this.date_key]=this.time,this.search_value}watch_search_option(){this.type&&this.$nextTick(()=>{let t=this.$refs.search,e=window.getComputedStyle(t).height.replace("px","");parseInt(e)>52&&this.isOpen&&(this.isOpen=!1),this.FnOperate()})}FnMultiSearch(){this.syncVisible=!0}operate(){this.isOpen=!this.isOpen,this.FnOperate()}FnOperate(){}FnShowCreate(){}watch_search_value(t,e){}FnClear(){for(let t in this.search_option)["datetimerange","daterange"].includes(this.search_option[t].type)?this.$refs.datepicker[0].FnClear():this.search_value={};this.FnSearch()}mounted(){let t=0;for(let e in this.search_option)this.search_option[e].default_value&&(this.$set(this.search_value,e,this.search_option[e].default_value),t++),"composite"===this.search_option[e].type&&this.$set(this.search_value,e+"sub",this.search_option[e].list[0].type);(t>0||"physical"===this.type)&&setTimeout(()=>{this.FnSearch()},500)}};Object(r["a"])([Object(l["c"])({default:{}})],o.prototype,"search_option",void 0),Object(r["a"])([Object(l["c"])({default:""})],o.prototype,"create_btn",void 0),Object(r["a"])([Object(l["c"])({default:!0})],o.prototype,"disabled",void 0),Object(r["a"])([Object(l["c"])({default:!1})],o.prototype,"type",void 0),Object(r["a"])([Object(l["c"])({default:!0})],o.prototype,"isShowBg",void 0),Object(r["a"])([Object(l["b"])("fn-search")],o.prototype,"FnSearch",null),Object(r["a"])([Object(l["f"])("search_option",{immediate:!0,deep:!0})],o.prototype,"watch_search_option",null),Object(r["a"])([Object(l["b"])("fn-operate")],o.prototype,"FnOperate",null),Object(r["a"])([Object(l["b"])("fn-create")],o.prototype,"FnShowCreate",null),Object(r["a"])([Object(l["f"])("search_value",{immediate:!0,deep:!0})],o.prototype,"watch_search_value",null),o=Object(r["a"])([Object(l["a"])({components:{DatePicker:n["a"]}})],o);var c=o,u=c,_=(s("4774"),s("26f3"),s("2877")),p=Object(_["a"])(u,a,i,!1,null,"20a86f62",null);e["a"]=p.exports},e410:function(t,e,s){},ed46:function(t,e,s){"use strict";var a=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",[e("div",{staticClass:"box"},[e("div",[e("span",[t._v(t._s(t.title))]),t._t("left")],2),e("div",[t._t("default"),t.no_back?t._e():e("el-button",{attrs:{type:"primary",plain:""},on:{click:t.FnBack}},[t._v("返回")])],2)]),e("div",{staticClass:"perch"})])},i=[],r=(s("14d9"),s("9ab4")),l=s("1b40");let n=class extends l["e"]{FnBack(){this.back_url?this.$router.push(this.back_url):this.$router.go(-1)}};Object(r["a"])([Object(l["c"])({default:""})],n.prototype,"title",void 0),Object(r["a"])([Object(l["c"])({default:""})],n.prototype,"back_url",void 0),Object(r["a"])([Object(l["c"])({default:!1})],n.prototype,"no_back",void 0),n=Object(r["a"])([l["a"]],n);var o=n,c=o,u=(s("a58a"),s("2877")),_=Object(u["a"])(c,a,i,!1,null,"bdf5ebe2",null);e["a"]=_.exports},f4b8:function(t,e,s){"use strict";s("fae5")},fae5:function(t,e,s){}}]);
//# sourceMappingURL=chunk-322e2c95.1764156034953.js.map