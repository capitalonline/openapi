(window["webpackJsonp_AppSp"]=window["webpackJsonp_AppSp"]||[]).push([["chunk-45345322"],{"3ad7":function(t,e,s){"use strict";s.r(e);var i=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",[e("action-block",{attrs:{search_option:t.search_dom},on:{"fn-search":t.search}}),e("el-table",{ref:"disk_table",attrs:{data:t.disk_list,border:"","row-class-name":t.rowStyle},on:{"selection-change":t.handleSelectionChange,"filter-change":t.filterAttribute,"row-click":t.FnOperRow,"row-contextmenu":t.FnRightClick}},[e("el-table-column",{attrs:{type:"selection"}}),e("el-table-column",{attrs:{prop:"customer_id",label:"客户ID"}}),e("el-table-column",{attrs:{prop:"customer_name",label:"客户名称"}}),e("el-table-column",{attrs:{prop:"disk_id",label:"云盘ID"}}),e("el-table-column",{attrs:{prop:"disk_name",label:"云盘名称"}}),e("el-table-column",{attrs:{prop:"customer_id",label:"云盘状态","filter-multiple":!1,filters:t.disk_state,"column-key":"status"},scopedSlots:t._u([{key:"default",fn:function(s){return[e("span",{class:s.row.status},[t._v(t._s(s.row.status_name))])]}}])}),e("el-table-column",{attrs:{prop:"customer_id",label:"IOPS及吞吐","min-width":"110px"},scopedSlots:t._u([{key:"default",fn:function(s){return[e("div",[t._v("IOPS："+t._s(s.row.disk_iops?`${s.row.disk_iops}${s.row.iops_unit}`:""))]),e("div",[t._v("吞吐量："+t._s(s.row.band_mbps?`${s.row.band_mbps}${s.row.mbps_unit}`:""))])]}}])}),e("el-table-column",{attrs:{prop:"customer_id",label:"地域-可用区","min-width":"110ox"},scopedSlots:t._u([{key:"default",fn:function(s){return[e("span",[t._v(t._s(s.row.region_name)+"  "+t._s(s.row.az_name))])]}}])}),e("el-table-column",{attrs:{prop:"customer_id",label:"属性"},scopedSlots:t._u([{key:"default",fn:function(s){return[e("span",[t._v(t._s("data"===s.row.disk_type?"数据盘":"系统盘"))])]}}])}),e("el-table-column",{attrs:{prop:"customer_id",label:"实例ID"},scopedSlots:t._u([{key:"default",fn:function(s){return[e("pre",[t._v(t._s(s.row.ecs_id?s.row.ecs_id:""))])]}}])}),e("el-table-column",{attrs:{prop:"dev_id",label:"dev_id"}}),e("el-table-column",{attrs:{prop:"dev_name",label:"dev_name"}}),e("el-table-column",{attrs:{prop:"cluster_name",label:"集群名称","min-width":"95px"}}),e("el-table-column",{attrs:{prop:"pool_name",label:"存储池名称"}})],1),e("el-pagination",{attrs:{"current-page":t.current,"page-sizes":[20,50,100],"page-size":t.size,layout:"total, sizes, prev, pager, next, jumper",total:t.total},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}}),t.visible?[e("Iops",{attrs:{visible:t.visible,title:t.oper_label,oper_type:t.oper_type,mount_id:t.mount_id},on:{close:t.close_disk}})]:t._e(),e("right-click",{attrs:{multi_rows:t.mount_id,menus:t.operate_btns,name:t.mount_id.length>0?t.mount_id[0].ecs_name:""},on:{"fn-click":t.infoClick}})],2)},n=[],a=(s("e9f5"),s("d866"),s("a732"),s("9ab4")),o=s("1b40"),l=s("c811"),r=s("a03d"),c=s("f33c"),d=s("8ce4"),u=s("bd4d"),_=s("e8c0");let h=class extends o["e"]{constructor(){super(...arguments),this.disk_list=[],this.current=1,this.size=20,this.total=0,this.filter_obj=null,this.visible=!1,this.oper_type="",this.oper_label="",this.disk_state=[],this.mount_id=[],this.req_data={},this.auth_list=[],this.search_dom={customer_id:{placeholder:"请输入客户ID"},disk_id:{placeholder:"请输入云盘ID"},ecs_id:{placeholder:"请输入实例ID"}},this.operate_btns=[{label:"设置IOPS",value:"iops",disabled:!1},{label:"设置吞吐量",value:"mbps",disabled:!1}],this.menuConditions={iops:()=>!this.hasPermission("iops"),mbps:()=>!this.hasPermission("mbps")}}watch_multi(){this.handleMenus()}hasPermission(t){return this.auth_list.includes(t)}handleMenus(){for(const t of this.operate_btns)t.disabled=!!this.menuConditions[t.value]&&this.menuConditions[t.value]()}infoClick(t){if(t.disabled)return;if(!this.judge_disk("customer_id",this.mount_id[0].customer_id))return void this.$message.warning("只允许对同一客户的云盘进行批量操作！");if(!this.judge_disk("az_name",this.mount_id[0].az_name))return void this.$message.warning("只允许对同一可用区的云盘进行批量操作！");const e=this.mount_id.every((t,e,s)=>"running"===t.ecs_status&&"running"===t.status||"running"===t.disk_status&&"shutdown"===t.ecs_status&&t.no_charge_shutdown_ecs||"waiting"===t.status);if(!e)return void this.$message.warning("仅支持对实例状态为运行中且云盘状态为使用中，或云盘状态为待挂载的云盘进行批量操作！");let s="iops"===t.value?"IOPS":"吞吐量";this.operate(t.value,s,this.mount_id)}FnRightClick(t,e,s){const i=this.mount_id.some(e=>e.ecs_id===t.ecs_id);i||this.$refs.disk_table.toggleRowSelection(t),Object(_["a"])(t,e,s)}FnOperRow(t){this.$refs.disk_table.toggleRowSelection(t)}rowStyle({row:t}){const e=this.mount_id.some(e=>e.disk_id===t.disk_id);if(e)return"rowStyle"}search(t={}){this.current=1,this.req_data={...t,...this.filter_obj},this.getDataList()}created(){this.auth_list=this.$store.state.auth_info["disk_volume"],this.get_disk_state(),this.search()}async get_disk_state(){let t=await c["a"].get_disk_state({});"Success"===t.code&&(this.disk_state=Object(d["e"])(t.data,"status_name","status","text","value"))}judge_disk(t,e){return this.mount_id.every((s,i,n)=>s[t]===e)}operate(t,e,s){this.mount_id=s,this.oper_type=t,this.oper_label=e,this.visible=!0}close_disk(t="1"){this.visible=!1,this.mount_id=[],this.oper_type="",this.toggleSelection(),"1"===t&&(this.current=1),this.getDataList()}toggleSelection(){const t=this.$refs.disk_table;t.clearSelection()}handleSelectionChange(t){this.mount_id=t}filterAttribute(t){this.filter_obj={...this.filter_obj,...t},this.search(this.req_data)}handleSizeChange(t){this.size=t,this.getDataList()}handleCurrentChange(t){this.current=t,this.getDataList()}async getDataList(){const{req_data:t}=this;let e=await c["a"].get_disk_list({az_id:this.$store.state.az_id,disk_id:t.disk_id||"",ecs_id:t.ecs_id||"",status:t.status?t.status[0]:"",customer_id:t.customer_id||"",page_index:this.current,page_size:this.size});"Success"===e.code&&(this.disk_list=e.data.result||[],this.total=e.data.page_info.count||0)}};Object(a["a"])([Object(o["f"])("mount_id",{immediate:!0,deep:!0})],h.prototype,"watch_multi",null),h=Object(a["a"])([Object(o["a"])({components:{ActionBlock:l["a"],Iops:r["a"],RightClick:u["a"]}})],h);var p=h,m=p,b=s("2877"),f=Object(b["a"])(m,i,n,!1,null,"6c71c064",null);e["default"]=f.exports},a732:function(t,e,s){"use strict";var i=s("23e7"),n=s("c65b"),a=s("2266"),o=s("59ed"),l=s("825a"),r=s("46c4"),c=s("2a62"),d=s("f99f"),u=d("some",TypeError);i({target:"Iterator",proto:!0,real:!0,forced:u},{some:function(t){l(this);try{o(t)}catch(i){c(this,"throw",i)}if(u)return n(u,this,t);var e=r(this),s=0;return a(e,(function(e,i){if(t(e,s++))return i()}),{IS_RECORD:!0,INTERRUPTED:!0}).stopped}})},e8c0:function(t,e,s){"use strict";s.d(e,"a",(function(){return n}));var i=s("cf88");function n(t,e,s){s.preventDefault(),document.addEventListener("contextmenu",t=>{const e=t.target;if(e.closest(".el-table")){let e=document.querySelector("#menu");if(e){e.style.display="block";let s=e.offsetHeight,n=e.offsetWidth;console.log("menuHeight",s);let a=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,o=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,l=t.clientX,r=t.clientY,c=l,d=r;o<l+n&&(c=l-n),a<r+s&&(d=a-s),e.style.left=c-250+"px",e.style.top=d-50+"px",e.style.display="block",e.style.zIndex="1000",document.addEventListener("click",i["a"])}}}),document.addEventListener("contextmenu",i["a"])}}}]);
//# sourceMappingURL=chunk-45345322.1764224471686.js.map