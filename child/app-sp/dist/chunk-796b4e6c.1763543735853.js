(window["webpackJsonp_AppSp"]=window["webpackJsonp_AppSp"]||[]).push([["chunk-796b4e6c"],{"03f5":function(e,t,r){"use strict";r("1821")},"0dd0":function(e,t,r){},1821:function(e,t,r){},"1e5a":function(e,t,r){"use strict";var a=r("23e7"),i=r("9961"),n=r("5320"),s=r("dad2"),l=!s("symmetricDifference")||!n("symmetricDifference");a({target:"Set",proto:!0,real:!0,forced:l},{symmetricDifference:i})},"1e70":function(e,t,r){"use strict";var a=r("23e7"),i=r("a5f7"),n=r("d039"),s=r("dad2"),l=!s("difference",(function(e){return 0===e.size})),c=l||n((function(){var e={size:1,has:function(){return!0},keys:function(){var e=0;return{next:function(){var r=e++>1;return t.has(1)&&t.clear(),{done:r,value:2}}}}},t=new Set([1,2,3,4]);return 3!==t.difference(e).size}));a({target:"Set",proto:!0,real:!0,forced:c},{difference:i})},"1ee0":function(e,t,r){"use strict";r("0dd0")},"278d":function(e,t,r){},2966:function(e,t,r){"use strict";var a=r("81a9"),i=r("bff7");t["a"]={get_alarm_list(e){return Object(a["a"])(Object(i["a"])("GET","/record/list",e))},get_strategy_list(e){return Object(a["a"])(Object(i["a"])("GET","/strategy/list",e))},get_strategy_detail(e){return Object(a["a"])(Object(i["a"])("GET","/strategy",e))},get_index_list(e){return Object(a["a"])(Object(i["a"])("GET","/metrics/info",e))},add_strategy(e){return Object(a["a"])(Object(i["a"])("POST","/strategy",e))},update_strategy(e){return Object(a["a"])(Object(i["a"])("PUT","/strategy",e))},apply_strategy(e){return Object(a["a"])(Object(i["a"])("PUT","/strategy/apply",e))},delete_strategy(e){return Object(a["a"])({method:"DELETE",url:"/alarm/api/v1/strategy",data:e})},get_contact_list(e){return Object(a["a"])(Object(i["a"])("GET","/contact/list",e))},add_contact(e){return Object(a["a"])(Object(i["a"])("POST","/contact",e))},get_contact_detail(e){return Object(a["a"])(Object(i["a"])("GET","/contact",e))},update_contact(e){return Object(a["a"])(Object(i["a"])("PUT","/contact",e))},delete_contact(e){return Object(a["a"])({method:"DELETE",url:"/alarm/api/v1/contact",data:e})},add_contact_to_group(e){return Object(a["a"])(Object(i["a"])("PUT","/contact_group/relation",e))},get_contact_group_list(e){return Object(a["a"])(Object(i["a"])("GET","/contact_group/list",e))},get_contact_group_detail(e){return Object(a["a"])(Object(i["a"])("GET","/contact_group",e))},add_contact_group(e){return Object(a["a"])(Object(i["a"])("POST","/contact_group",e))},update_contact_group(e){return Object(a["a"])(Object(i["a"])("PUT","/contact_group",e))},delete_contact_group(e){return Object(a["a"])({method:"DELETE",url:"/alarm/api/v1/contact_group",data:e})},get_event_list(e){return Object(a["a"])(Object(i["a"])("GET","/strategy/event/list",e))},get_product_list(e){return Object(a["a"])(Object(i["a"])("GET","/strategy/product/list",e))},get_shield_list(e){return Object(a["a"])(Object(i["a"])("GET","/shield/list",e))},get_create_info(e){return Object(a["a"])(Object(i["a"])("GET","/shield/info",e))},get_strategy_info(e){return Object(a["a"])(Object(i["a"])("GET","/shield/condition/strategy",e))},get_rule_info(e){return Object(a["a"])(Object(i["a"])("GET","/shield/condition/rule",e))},create_shield(e){return Object(a["a"])(Object(i["a"])("POST","/shield",e))},edit_shield(e){return Object(a["a"])(Object(i["a"])("PUT","/shield",e))},shield_detail(e){return Object(a["a"])(Object(i["a"])("GET","/shield",e))},shield_apply(e){return Object(a["a"])(Object(i["a"])("PUT","/shield/apply",e))},shield_del(e){return Object(a["a"])(Object(i["a"])("POST","/shield/delete",e))}}},"384f":function(e,t,r){"use strict";var a=r("e330"),i=r("5388"),n=r("cb27"),s=n.Set,l=n.proto,c=a(l.forEach),o=a(l.keys),u=o(new s).next;e.exports=function(e,t,r){return r?i({iterator:o(e),next:u},t):c(e,t)}},"395e":function(e,t,r){"use strict";var a=r("dc19"),i=r("cb27").has,n=r("8e16"),s=r("7f65"),l=r("5388"),c=r("2a62");e.exports=function(e){var t=a(this),r=s(e);if(n(t)<r.size)return!1;var o=r.getIterator();return!1!==l(o,(function(e){if(!i(t,e))return c(o,"normal",!1)}))}},4780:function(e,t,r){"use strict";r.d(t,"g",(function(){return a})),r.d(t,"d",(function(){return i})),r.d(t,"b",(function(){return n})),r.d(t,"a",(function(){return s})),r.d(t,"f",(function(){return l})),r.d(t,"e",(function(){return c})),r.d(t,"c",(function(){return o}));Math.floor(1e6*(9*Math.random()+1)),Math.floor(1e6*(9*Math.random()+1)),Math.floor(1e6*(9*Math.random()+1)),Math.floor(1e6*(9*Math.random()+1)),Math.floor(1e6*(9*Math.random()+1)),Math.floor(1e6*(9*Math.random()+1)),Math.floor(1e6*(9*Math.random()+1)),Math.floor(1e6*(9*Math.random()+1)),Math.floor(1e6*(9*Math.random()+1));const a=[{id:">=",title:">="},{id:"<=",title:"<="},{id:">",title:">"},{id:"<",title:"<"}],i=[{id:"1",title:"1分钟一个周期"},{id:"15",title:"15分钟一个周期"},{id:"30",title:"30分钟一个周期"},{id:"60",title:"60分钟一个周期"}],n=[{id:"1",title:"持续1个周期"},{id:"3",title:"持续3个周期"},{id:"5",title:"持续5个周期"},{id:"10",title:"持续10个周期"},{id:"15",title:"持续15个周期"},{id:"30",title:"持续30个周期"}],s=[{id:"2",title:"严重"},{id:"1",title:"告警"},{id:"0",title:"普通"}],l=[{id:"email",name:"邮箱"},{id:"phone",name:"短信"}],c=[{id:"abnormal_event",title:"异常事件"}],o=[{id:"900",title:"15分钟"},{id:"1800",title:"30分钟"},{id:"3600",title:"60分钟"},{id:"10800",title:"3小时"},{id:"21600",title:"6小时"},{id:"43200",title:"12小时"},{id:"86400",title:"24小时"}]},5320:function(e,t,r){"use strict";e.exports=function(e){try{var t=new Set,r={size:0,has:function(){return!0},keys:function(){return Object.defineProperty({},"next",{get:function(){return t.clear(),t.add(4),function(){return{done:!0}}}})}},a=t[e](r);return 1===a.size&&4===a.values().next().value}catch(i){return!1}}},5388:function(e,t,r){"use strict";var a=r("c65b");e.exports=function(e,t,r){var i,n,s=r?e:e.iterator,l=e.next;while(!(i=a(l,s)).done)if(n=t(i.value),void 0!==n)return n}},"68df":function(e,t,r){"use strict";var a=r("dc19"),i=r("8e16"),n=r("384f"),s=r("7f65");e.exports=function(e){var t=a(this),r=s(e);return!(i(t)>r.size)&&!1!==n(t,(function(e){if(!r.includes(e))return!1}),!0)}},7282:function(e,t,r){"use strict";var a=r("e330"),i=r("59ed");e.exports=function(e,t,r){try{return a(i(Object.getOwnPropertyDescriptor(e,t)[r]))}catch(n){}}},"72c3":function(e,t,r){"use strict";var a=r("23e7"),i=r("e9bc"),n=r("5320"),s=r("dad2"),l=!s("union")||!n("union");a({target:"Set",proto:!0,real:!0,forced:l},{union:i})},"79a4":function(e,t,r){"use strict";var a=r("23e7"),i=r("d039"),n=r("953b"),s=r("dad2"),l=!s("intersection",(function(e){return 2===e.size&&e.has(1)&&e.has(2)}))||i((function(){return"3,2"!==String(Array.from(new Set([1,2,3]).intersection(new Set([3,2]))))}));a({target:"Set",proto:!0,real:!0,forced:l},{intersection:n})},"7f65":function(e,t,r){"use strict";var a=r("59ed"),i=r("825a"),n=r("c65b"),s=r("5926"),l=r("46c4"),c="Invalid size",o=RangeError,u=TypeError,d=Math.max,_=function(e,t){this.set=e,this.size=d(t,0),this.has=a(e.has),this.keys=a(e.keys)};_.prototype={getIterator:function(){return l(i(n(this.keys,this.set)))},includes:function(e){return n(this.has,this.set,e)}},e.exports=function(e){i(e);var t=+e.size;if(t!==t)throw new u(c);var r=s(t);if(r<0)throw new o(c);return new _(e,r)}},"83b9e":function(e,t,r){"use strict";var a=r("cb27"),i=r("384f"),n=a.Set,s=a.add;e.exports=function(e){var t=new n;return i(e,(function(e){s(t,e)})),t}},"8b00":function(e,t,r){"use strict";var a=r("23e7"),i=r("68df"),n=r("dad2"),s=!n("isSubsetOf",(function(e){return e}));a({target:"Set",proto:!0,real:!0,forced:s},{isSubsetOf:i})},"8ce4":function(e,t,r){"use strict";r.d(t,"e",(function(){return a})),r.d(t,"b",(function(){return i})),r.d(t,"a",(function(){return n})),r.d(t,"c",(function(){return s})),r.d(t,"d",(function(){return l}));r("14d9"),r("e9f5"),r("ab43");function a(e,t,r,a,i){let n=[];return e.map(e=>{n.push({[a]:e[t],[i]:e[r]})}),n}function i(e,t,r,a={}){let i=[];return e.map(e=>{let n={};t.map((t,a)=>{n[t]=e[r[a]]}),i.push({...n,...a})}),i}function n(e,t=!1){let r={};for(let a in e){const{billing_scheme_id:i,billing_cycle_id:n,billing_items:s,gic_goods_id:l}=e[a];let c={};for(let e in s){let r={attr_id:s[e].attr_id,name:s[e].name},a={id:s[e].id,key:e};c[e]=t?{...r,...a}:a}r[a]={billing_scheme_id:i,billing_cycle_id:n,billing_items:c,gic_goods_id:t?l:void 0}}return r}function s(e,t){return e.map(e=>e[t])}function l(e){let t="";for(let r in e)e[r]&&(t+=`${r}=${e[r]}&`);return""===t?"":"?"+t.slice(0,t.length-1)}},"8e16":function(e,t,r){"use strict";var a=r("7282"),i=r("cb27");e.exports=a(i.proto,"size","get")||function(e){return e.size}},"953b":function(e,t,r){"use strict";var a=r("dc19"),i=r("cb27"),n=r("8e16"),s=r("7f65"),l=r("384f"),c=r("5388"),o=i.Set,u=i.add,d=i.has;e.exports=function(e){var t=a(this),r=s(e),i=new o;return n(t)>r.size?c(r.getIterator(),(function(e){d(t,e)&&u(i,e)})):l(t,(function(e){r.includes(e)&&u(i,e)})),i}},9961:function(e,t,r){"use strict";var a=r("dc19"),i=r("cb27"),n=r("83b9e"),s=r("7f65"),l=r("5388"),c=i.add,o=i.has,u=i.remove;e.exports=function(e){var t=a(this),r=s(e).getIterator(),i=n(t);return l(r,(function(e){o(t,e)?u(i,e):c(i,e)})),i}},a4e7:function(e,t,r){"use strict";var a=r("23e7"),i=r("395e"),n=r("dad2"),s=!n("isSupersetOf",(function(e){return!e}));a({target:"Set",proto:!0,real:!0,forced:s},{isSupersetOf:i})},a58a:function(e,t,r){"use strict";r("e410")},a5f7:function(e,t,r){"use strict";var a=r("dc19"),i=r("cb27"),n=r("83b9e"),s=r("8e16"),l=r("7f65"),c=r("384f"),o=r("5388"),u=i.has,d=i.remove;e.exports=function(e){var t=a(this),r=l(e),i=n(t);return s(t)<=r.size?c(t,(function(e){r.includes(e)&&d(i,e)})):o(r.getIterator(),(function(e){u(i,e)&&d(i,e)})),i}},a732:function(e,t,r){"use strict";var a=r("23e7"),i=r("c65b"),n=r("2266"),s=r("59ed"),l=r("825a"),c=r("46c4"),o=r("2a62"),u=r("f99f"),d=u("some",TypeError);a({target:"Iterator",proto:!0,real:!0,forced:d},{some:function(e){l(this);try{s(e)}catch(a){o(this,"throw",a)}if(d)return i(d,this,e);var t=c(this),r=0;return n(t,(function(t,a){if(e(t,r++))return a()}),{IS_RECORD:!0,INTERRUPTED:!0}).stopped}})},ab43:function(e,t,r){"use strict";var a=r("23e7"),i=r("c65b"),n=r("59ed"),s=r("825a"),l=r("46c4"),c=r("c5cc"),o=r("9bdd"),u=r("2a62"),d=r("2baa"),_=r("f99f"),m=r("c430"),p=!m&&!d("map",(function(){})),f=!m&&!p&&_("map",TypeError),h=m||p||f,v=c((function(){var e=this.iterator,t=s(i(this.next,e)),r=this.done=!!t.done;if(!r)return o(e,this.mapper,[t.value,this.counter++],!0)}));a({target:"Iterator",proto:!0,real:!0,forced:h},{map:function(e){s(this);try{n(e)}catch(t){u(this,"throw",t)}return f?i(f,this,e):new v(l(this),{mapper:e})}})},b4bc:function(e,t,r){"use strict";var a=r("dc19"),i=r("cb27").has,n=r("8e16"),s=r("7f65"),l=r("384f"),c=r("5388"),o=r("2a62");e.exports=function(e){var t=a(this),r=s(e);if(n(t)<=r.size)return!1!==l(t,(function(e){if(r.includes(e))return!1}),!0);var u=r.getIterator();return!1!==c(u,(function(e){if(i(t,e))return o(u,"normal",!1)}))}},bfa1:function(e,t,r){"use strict";r("278d")},c1a1:function(e,t,r){"use strict";var a=r("23e7"),i=r("b4bc"),n=r("dad2"),s=!n("isDisjointFrom",(function(e){return!e}));a({target:"Set",proto:!0,real:!0,forced:s},{isDisjointFrom:i})},cb27:function(e,t,r){"use strict";var a=r("e330"),i=Set.prototype;e.exports={Set:Set,add:a(i.add),has:a(i.has),remove:a(i["delete"]),proto:i}},dad2:function(e,t,r){"use strict";var a=r("d066"),i=function(e){return{size:e,has:function(){return!1},keys:function(){return{next:function(){return{done:!0}}}}}},n=function(e){return{size:e,has:function(){return!0},keys:function(){throw new Error("e")}}};e.exports=function(e,t){var r=a("Set");try{(new r)[e](i(0));try{return(new r)[e](i(-1)),!1}catch(l){if(!t)return!0;try{return(new r)[e](n(-1/0)),!1}catch(c){var s=new r;return s.add(1),s.add(2),t(s[e](n(1/0)))}}}catch(c){return!1}}},dc19:function(e,t,r){"use strict";var a=r("cb27").has;e.exports=function(e){return a(e),e}},e410:function(e,t,r){},e633:function(e,t,r){"use strict";r.r(t);var a=function(){var e=this,t=e._self._c;e._self._setupProxy;return t("div",{staticClass:"create-stategy"},[t("el-card",{staticClass:"main_box"},[t("back-header",{attrs:{title:(""===e.edit_id?"创建":"编辑")+"报警策略",back_url:"/alarmStrategy",no_back:"true"}}),t("el-divider"),t("el-form",{ref:"form",staticClass:"demo-dynamic",attrs:{model:e.form_data,"label-width":"100px","label-position":"left",rules:e.rules}},[t("el-form-item",{attrs:{prop:"name",label:"策略名称"}},[t("el-input",{attrs:{minlength:"2",maxlength:"60",placeholder:"2-60个字符","show-word-limit":""},model:{value:e.form_data.name,callback:function(t){e.$set(e.form_data,"name",t)},expression:"form_data.name"}}),t("div",{staticClass:"prompt_message"},[e._v("可包含大小写字母,中文,数字,点号,下划线,半角冒号,连字符,英文括号")])],1),""===e.edit_id?t("el-form-item",{attrs:{prop:"stategy",label:"选择已有策略"}},[t("el-select",{attrs:{placeholder:"请选择已有策略",filterable:"","filter-method":e.getStrategyList},on:{"visible-change":e.change_strategy},model:{value:e.form_data.stategy,callback:function(t){e.$set(e.form_data,"stategy",t)},expression:"form_data.stategy"}},e._l(e.strategy_list,(function(r){return t("el-option",{key:r.id,attrs:{label:r.name,value:r.id,disabled:""!==e.edit_id}})})),1)],1):e._e()],1),t("RuleConfig",{ref:"rule_config",attrs:{strategy_data:e.strategy_data}})],1),t("div",{staticClass:"button_box"},[t("el-button",{attrs:{type:"primary"},on:{click:e.create}},[e._v(e._s(""===e.edit_id?"创建":"确定"))]),t("el-button",{staticClass:"confirm",staticStyle:{"margin-left":"5px"},on:{click:function(t){return e.$router.go(-1)}}},[e._v("返回")])],1)],1)},i=[],n=(r("14d9"),r("e9f5"),r("7d54"),r("ab43"),r("9ab4")),s=r("1b40"),l=function(){var e=this,t=e._self._c;e._self._setupProxy;return t("div",[e._l(e.selected_products,(function(r){return t("div",{key:r.id,staticClass:"product_box"},[t("div",{staticClass:"title"},[t("span",[e._v(e._s(r.name))]),e.selected_products.length>1?t("el-button",{attrs:{type:"text"},on:{click:function(t){return e.del_product(r.id)}}},[e._v("删除")]):e._e()],1),t("el-table",{staticClass:"event-table",attrs:{data:r.rule_list}},[t("el-table-column",{attrs:{prop:"name",label:"规则名称"}}),t("el-table-column",{attrs:{prop:"desc",label:"规则描述"},scopedSlots:e._u([{key:"default",fn:function(r){return["1"===e.tab_key?t("span",[e._v(e._s(r.row.desc.join(",")))]):t("div",e._l(r.row.desc,(function(r){return t("div",{key:r},[e._v(e._s(r))])})),0)]}}],null,!0)}),t("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{staticStyle:{margin:"0 10px 0 0"},attrs:{type:"text"},on:{click:function(t){return e.edit_rules(r.id,a.row.id,a.row.tab_key)}}},[e._v("编辑")]),1!==e.selected_products.length||1!==e.selected_products[0].rule_list.length?t("el-button",{attrs:{type:"text"},on:{click:function(t){return e.del_rule(r.id,a.row.id)}}},[e._v("删除")]):e._e()]}}],null,!0)})],1),t("div",{staticClass:"rule-box"},[t("el-button",{attrs:{type:"text"},on:{click:function(t){return e.show_rule_box(r.id,"add")}}},[t("i",{staticClass:"el-icon-circle-plus"}),e._v(" 添加规则")]),r.visible?t("div",{staticClass:"add-rule"},[t("el-tabs",{attrs:{type:"card"},on:{"tab-click":e.changeTab},model:{value:e.tab_key,callback:function(t){e.tab_key=t},expression:"tab_key"}},[t("el-tab-pane",{attrs:{label:"阈值报警",title:"0",disabled:"1"===e.edit_key}},[t("div",{staticClass:"rule-warn"},[t("el-form",{key:"rules_form",ref:"rules_form",refInFor:!0,staticClass:"demo-dynamic",attrs:{model:e.rule_data,"label-width":"150px"}},[t("el-form-item",{attrs:{prop:"name",label:"规则名称",rules:[{required:!0,message:"请输入规则名称",trigger:"blur"},{pattern:/^[\u4e00-\u9fa5_a-zA-Z0-9-_:()\u002E]{2,60}$/,message:"名称长度应为2-60个字符",trigger:"blur"}]}},[t("el-input",{attrs:{placeholder:"请输入规则名称,2-60个字符",minlength:"2",maxlength:"60","show-word-limit":""},model:{value:e.rule_data.name,callback:function(t){e.$set(e.rule_data,"name",t)},expression:"rule_data.name"}}),t("div",{staticClass:"prompt_message"},[e._v("可包含大小写字母,中文,数字,点号,下划线,半角冒号,连字符,英文括号")])],1),t("el-form-item",{attrs:{prop:"metricID",label:"指标名称",rules:[{required:!0,message:"请选择指标名称",trigger:"blur"}]}},[t("el-cascader",{attrs:{options:r.index_list,"show-all-levels":!1,props:{expandTrigger:"hover"}},on:{change:function(t){return e.watch_metricID(t,r.index_list)}},scopedSlots:e._u([{key:"default",fn:function({node:r,data:a}){return[t("span",[e._v(e._s(a.label))])]}}],null,!0),model:{value:e.rule_data.metricID,callback:function(t){e.$set(e.rule_data,"metricID",t)},expression:"rule_data.metricID"}})],1),t("el-form-item",{attrs:{prop:"level",label:"阈值及报警级别",rules:[{required:!0,message:"请选择阈值及报警级别"}]}},e._l(e.rule_data.level,(function(r,a){return t("div",{key:r.id,staticClass:"rule-level"},[t("el-select",{attrs:{size:"small"},model:{value:r.range,callback:function(t){e.$set(r,"range",t)},expression:"inn.range"}},e._l(e.static_list.range_list,(function(e){return t("el-option",{key:e.id,attrs:{label:e.title,value:e.id}})})),1),t("el-input",{attrs:{size:"small",oninput:"value= value.match(/\\d+(\\.\\d{0,9})?/) ? value.match(/\\d+(\\.\\d{0,9})?/)[0] : ''"},model:{value:r.num,callback:function(t){e.$set(r,"num",t)},expression:"inn.num"}},[t("span",{attrs:{slot:"suffix"},slot:"suffix"},[e._v(e._s(r.metricUnit))])]),""===r.num?t("span",{staticClass:"error_message remark"},[e._v(e._s("请输入指标项值"))]):e._e(),t("el-select",{attrs:{size:"small"},model:{value:r.cycle_time,callback:function(t){e.$set(r,"cycle_time",t)},expression:"inn.cycle_time"}},e._l(e.static_list.cycle_time,(function(e){return t("el-option",{key:e.id,attrs:{label:e.title,value:e.id}})})),1),t("el-select",{attrs:{size:"small"},model:{value:r.cycle_num,callback:function(t){e.$set(r,"cycle_num",t)},expression:"inn.cycle_num"}},e._l(e.static_list.cycle_num,(function(e){return t("el-option",{key:e.id,attrs:{label:e.title,value:e.id}})})),1),t("el-select",{attrs:{size:"small"},model:{value:r.alram_type,callback:function(t){e.$set(r,"alram_type",t)},expression:"inn.alram_type"}},e._l(e.static_list.alarm_type,(function(e){return t("el-option",{key:e.id,attrs:{label:e.title,value:e.id}})})),1),t("div",{staticClass:"notice"},[t("div",{staticClass:"check"},[t("span",[e._v("通知：")]),t("el-checkbox-group",{model:{value:r.notice,callback:function(t){e.$set(r,"notice",t)},expression:"inn.notice"}},e._l(e.static_list.notice_list,(function(r){return t("el-checkbox",{key:r.id,attrs:{label:r.id}},[e._v(e._s(r.name))])})),1)],1),a===e.rule_data.level.length-1?t("div",{staticClass:"level-btn"},[t("i",{staticClass:"el-icon-circle-plus",attrs:{type:"primary"},on:{click:e.add_level}}),e.rule_data.level.length>1?t("i",{staticClass:"el-icon-remove",on:{click:e.del_level}}):e._e()]):e._e()])],1)})),0)],1)],1)]),t("el-tab-pane",{attrs:{label:"事件报警",title:"1",disabled:"0"===e.edit_key}},[t("div",{staticClass:"rule-warn"},[t("el-form",{key:"event_form",ref:"event_form",refInFor:!0,staticClass:"demo-dynamic",attrs:{model:e.rule_data,"label-width":"150px"}},[t("el-form-item",{attrs:{prop:"name",label:"规则名称",rules:[{required:!0,message:"请输入规则名称",trigger:"blur"},{pattern:/^[\u4e00-\u9fa5_a-zA-Z0-9-_:()\u002E]{2,60}$/,message:"名称长度应为2-60个字符",trigger:"blur"}]}},[t("el-input",{attrs:{placeholder:"请输入规则名称,2-60个字符",minlength:"2",maxlength:"60","show-word-limit":""},model:{value:e.rule_data.name,callback:function(t){e.$set(e.rule_data,"name",t)},expression:"rule_data.name"}}),t("div",{staticClass:"prompt_message"},[e._v("可包含大小写字母,中文,数字,点号,下划线,半角冒号,连字符,英文括号")])],1),t("el-form-item",{attrs:{prop:"event_type",label:"事件类型",rules:[{required:!0,message:"请选择事件类型",trigger:"blur"}]}},[t("el-select",{attrs:{placeholder:"请选择事件类型"},on:{change:function(t){return e.watch_event_type(t,r.event_type,r.id)}},model:{value:e.rule_data.event_type,callback:function(t){e.$set(e.rule_data,"event_type",t)},expression:"rule_data.event_type"}},e._l(r.event_type,(function(e){return t("el-option",{key:e.event_type,attrs:{label:e.type_name,value:e.event_type}})})),1)],1),t("el-form-item",{attrs:{prop:"event_name",label:"事件名称",rules:[{required:!0,message:"请选择事件名称",trigger:"blur"}]}},[t("el-select",{attrs:{placeholder:"请选择事件名称"},model:{value:e.rule_data.event_name,callback:function(t){e.$set(e.rule_data,"event_name",t)},expression:"rule_data.event_name"}},e._l(r.event_name,(function(e){return t("el-option",{key:e.id,attrs:{label:e.title,value:e.id}})})),1)],1),t("el-form-item",{attrs:{prop:"alram_type",label:"事件等级及报警",rules:[{required:!0,message:"请选择事件等级及报警",trigger:"blur"}]}},[t("el-select",{attrs:{placeholder:"请选择事件等级及报警"},model:{value:e.rule_data.alram_type,callback:function(t){e.$set(e.rule_data,"alram_type",t)},expression:"rule_data.alram_type"}},e._l(e.static_list.alarm_type,(function(e){return t("el-option",{key:e.id,attrs:{label:e.title,value:e.id}})})),1)],1),t("el-form-item",{attrs:{prop:"notice",label:"",rules:[{required:!0,message:"请选择通知方式",trigger:"blur"}]}},[t("div",{staticClass:"check"},[t("span",[e._v("通知：")]),t("el-checkbox-group",{model:{value:e.rule_data.notice,callback:function(t){e.$set(e.rule_data,"notice",t)},expression:"rule_data.notice"}},e._l(e.static_list.notice_list,(function(r){return t("el-checkbox",{key:r.id,attrs:{label:r.id}},[e._v(e._s(r.name))])})),1)],1)])],1)],1)])],1),t("div",{staticClass:"btn"},[t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.add_rule()}}},[e._v("确定")]),t("el-button",{attrs:{type:"cancel"},on:{click:e.cancel}},[e._v("取消")])],1)],1):e._e()],1)],1)})),t("el-dropdown",{staticClass:"m-top10",on:{command:e.handle}},[t("el-button",{attrs:{type:"primary"}},[e._v(" 添加产品"),t("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),t("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},e._l(e.product_list,(function(r){return t("el-dropdown-item",{key:r.id,attrs:{command:r.id}},[e._v(e._s(r.name))])})),1)],1)],2)},c=[],o=(r("910d"),r("a732"),r("1e70"),r("79a4"),r("c1a1"),r("8b00"),r("a4e7"),r("1e5a"),r("72c3"),r("4780")),u=r("2966"),d=r("8ce4");let _=class extends s["e"]{constructor(){super(...arguments),this.tab_key="0",this.edit_key="",this.selected_product_id="",this.edit_rule_id="",this.index_list=[],this.rule_data={name:"",metricID:[],event_type:"",event_name:"",alram_type:"",notice:[],level:[{range:">=",num:"",cycle_time:"1",cycle_num:"1",alram_type:"2",notice:["email"],metricUnit:""}]},this.static_list={range_list:o["g"],notice_list:o["f"],alarm_type:o["a"],cycle_num:o["b"],cycle_time:o["d"],event_type:o["e"],event_name:[]},this.product_list=[],this.selected_products=[]}created(){this.getProductList()}valid(e){this.$nextTick(()=>{const t=this.$refs[e];t&&t[0].validate(async e=>{})})}get event(){const{event_type:e,event_name:t,alram_type:r,notice:a}=this.rule_data;return{event_type:e,event_name:t,alram_type:r,notice:a}}watch_event(e){this.valid("event_form")}async getProductList(){let e=await u["a"].get_product_list({});"Success"===e.code&&e.data.forEach(e=>{this.product_list.push({...e,visible:!1,rule_list:[]})})}watch_metricID(e,t){this.valid("rules_form");let r="";t.forEach(t=>{t.children.forEach(t=>{t.value===e[1]&&(r=t.unit)})}),this.rule_data.level.map(e=>e.metricUnit=r)}watch_event_type(e,t,r){let a=["event_name_zh","event_id"],i=["title","id"],n=t.filter(t=>t.event_type===e);this.selected_products.map(e=>{if(e.id===r){e.event_name=n.length>0?Object(d["b"])(n[0].list,i,a):[];const t=e.event_name.map(e=>e.id);new Set([...t,this.rule_data.event_name]).size>t.length&&(this.rule_data.event_name="")}})}setEventList(e){let t=["event_name_zh","event_id"],r=["title","id"],a=e,i=[];return e.map(e=>{i=[...i,...e.list]}),i=Object(d["b"])(i,r,t),[a,i]}get_index_list_by_value(e,t){let r=[];return t.forEach(t=>{t.children.forEach(a=>{a.value===e&&(r=[t.value,e])})}),r}setIndexList(e){let t=[];return e&&e.forEach(e=>{let r=[];e.metric_infos.forEach(e=>{r.push({value:e.metric,label:e.description,unit:e.unit,description:e.description})}),t.push({value:e.name,label:e.name,children:r})}),t}setRules(e,t,r,a){const i={id:e.id,tab_key:"event"===e.ruleRecords[0].alarmType?"1":"0",name:e.name,metricID:"event"===e.ruleRecords[0].alarmType?[]:this.get_index_list_by_value(e.ruleRecords[0].metricID,r),event_type:e.ruleRecords[0].eventType,event_name:e.ruleRecords[0].eventId&&e.ruleRecords[0].eventId.length>0?e.ruleRecords[0].eventId[0]:"",metricUnit:"event"===e.ruleRecords[0].alarmType?"":e.ruleRecords[0].metricUnit,alram_type:"event"===e.ruleRecords[0].alarmType?e.ruleRecords[0].level.toString():"",notice:"event"===e.ruleRecords[0].alarmType?e.ruleRecords[0].alarmMethod:[],level:t,desc:"event"===e.ruleRecords[0].alarmType?[`${this.trans_arr(e.ruleRecords[0].level.toString(),this.static_list.alarm_type)} | ${this.trans_arr(e.ruleRecords[0].eventId,a[1])}`]:t.map(t=>`${this.getDescription(e.ruleRecords[0].metricID,r)} ${t.range} ${t.num}${t.metricUnit} ${this.trans_arr(t.alram_type,this.static_list.alarm_type)} 持续${t.cycle_num}次就报警`)},n=this.selected_products.filter(t=>t.id===e.productType);n.length>0?this.selected_products.map(t=>(t.id===e.productType&&(t.rule_list=[...t.rule_list,i],t.index_list=r,t.event_type=a[0],t.event_name=a[1]),t)):this.selected_products.push({id:e.productType,name:e.productName,visible:!1,rule_list:[i],index_list:r,event_type:a[0],event_name:a[1]})}watch_strategy_data(e,t){0!==Object.keys(e).length&&(this.selected_products=[],e.rules.forEach(async e=>{const t=[];e.ruleRecords.forEach(e=>{t.push({range:e.metricCondition,num:e.metricValue,cycle_time:e.metricPeriod.toString(),cycle_num:e.metricPeriodNum.toString(),alram_type:"event"===e.alarmType?"":e.level.toString(),notice:"event"===e.alarmType?[]:e.alarmMethod,metricUnit:e.metricUnit})}),Promise.all([u["a"].get_index_list({type:e.productType}),u["a"].get_event_list({type:e.productType})]).then(r=>{this.setRules(e,t,this.setIndexList(r[0].data),this.setEventList(r[1].data))})}))}getDescription(e,t){let r="";return t.forEach(t=>{t.children.forEach(t=>{t.value===e&&(r=t.description)})}),r}handle(e){this.add_product(e)}add_product(e){this.selected_products.filter(t=>t.id===e).length>0||Promise.all([u["a"].get_index_list({type:e}),u["a"].get_event_list({type:e})]).then(t=>{const r=this.product_list.filter(t=>t.id===e);r[0].rule_list=[],r[0].index_list=this.setIndexList(t[0].data),r[0].event_type=this.setEventList(t[1].data)[0],r[0].event_name=this.setEventList(t[1].data)[1],this.selected_products=[...this.selected_products,...r]})}del_product(e){this.selected_products=this.selected_products.filter(t=>t.id!==e),0===this.selected_products.length&&(this.selected_product_id="")}show_rule_box(e="",t="add"){this.selected_products.map(r=>(r.id===e?(r.visible=!r.visible,""===this.edit_key&&r.visible&&this.clear(),"edit"!==t||r.visible||(this.edit_key="")):r.visible=!1,r))}add_level(){this.rule_data.level.length;const e={range:">=",num:"",cycle_time:"1",cycle_num:"1",alram_type:"2",notice:["email"],metricUnit:this.rule_data.level[0].metricUnit};this.rule_data={...this.rule_data,level:[...this.rule_data.level,e]}}del_level(){const{level:e}=this.rule_data;this.rule_data={...this.rule_data,level:e.filter((t,r)=>r<e.length-1)}}add_rule(){const e="0"===this.tab_key?this.$refs.rules_form[0]:this.$refs.event_form[0];e.validate(async e=>{if(e){if("0"===this.tab_key&&this.rule_data.level.some(e=>""===e.num))return;const{selected_products:e,tab_key:t,edit_key:r,edit_rule_id:a}=this;e.map(e=>{if(e.visible)if(""===r){const r={...this.rule_data,tab_key:t,id:e.id+Math.floor(1e6*(9*Math.random()+1))};e.rule_list="0"===t?[...e.rule_list,{...r,desc:this.rule_data.level.map(t=>`${this.getDescription(this.rule_data.metricID[1],e.index_list)} ${t.range} ${t.num}${t.metricUnit} ${this.trans_arr(t.alram_type,this.static_list.alarm_type)} 持续${t.cycle_num}次就报警`)}]:[...e.rule_list,{...r,desc:[`${this.trans_arr(this.rule_data.alram_type,this.static_list.alarm_type)} | ${this.trans_arr(this.rule_data.event_name,e.event_name)}`]}]}else e.rule_list=e.rule_list.map(t=>(t.id===a&&(t={...t,...this.rule_data},t.desc="0"===t.tab_key?t.level.map(t=>`${this.getDescription(this.rule_data.metricID[1],e.index_list)} ${t.range} ${t.num}${t.metricUnit}${this.trans_arr(t.alram_type,this.static_list.alarm_type)} 持续${t.cycle_num}次就报警`):[`${this.trans_arr(t.alram_type,this.static_list.alarm_type)} | ${this.trans_arr(t.event_name,e.event_name)}`]),t));return e}),this.edit_key="",this.edit_rule_id="",this.show_rule_box()}})}cancel(){this.edit_key="",this.show_rule_box()}del_rule(e,t){this.selected_products.map(r=>(r.id===e&&(r.rule_list=r.rule_list.filter(e=>e.id!==t)),r))}clear(){this.tab_key="0",this.$nextTick(()=>{const e=this.$refs.rules_form[0],t=this.$refs.event_form[0];e.resetFields(),t.resetFields(),this.valid("rules_form"),this.valid("event_form"),this.rule_data={name:"",metricID:[],event_type:"",event_name:"",alram_type:"",notice:[],level:[{range:">=",num:"",cycle_time:"1",cycle_num:"1",alram_type:"2",notice:["email"],metricUnit:""}]}})}edit_rules(e,t,r){this.tab_key=r,this.edit_key=r,this.edit_rule_id=t,this.show_rule_box(e,"edit");const a=this.selected_products.filter(t=>t.id===e),i=a[0].rule_list.filter(e=>e.id===t);this.rule_data=JSON.parse(JSON.stringify(i[0])),"1"===i[0].tab_key&&this.watch_event_type(i[0].event_type,a[0].event_type,a[0].id)}change_rule_notice(e){}changeTab(e){}trans_arr(e,t){if("string"===typeof e){const r=t.filter(t=>t.id===e);return r[0].title}{let r=[];return t.map(t=>{e.indexOf(t.id)>-1&&r.push(t.title)}),r}}};Object(n["a"])([Object(s["c"])({default:()=>[]})],_.prototype,"strategy_data",void 0),Object(n["a"])([Object(s["f"])("event",{immediate:!0,deep:!0})],_.prototype,"watch_event",null),Object(n["a"])([Object(s["f"])("strategy_data",{immediate:!0,deep:!0})],_.prototype,"watch_strategy_data",null),_=Object(n["a"])([Object(s["a"])({})],_);var m=_,p=m,f=(r("bfa1"),r("1ee0"),r("2877")),h=Object(f["a"])(p,l,c,!1,null,"1ca42563",null),v=h.exports,b=r("ed46");let y=class extends s["e"]{constructor(){super(...arguments),this.form_data={name:"",stategy:""},this.edit_id="",this.strategy_list=[],this.strategy_data={},this.rules={name:[{required:!0,message:"请输入策略名称",trigger:"blur"},{pattern:/^[\u4e00-\u9fa5_a-zA-Z0-9-_:()\u002E]{2,60}$/,message:"名称长度应为2-60个字符",trigger:"blur"}]}}created(){this.edit_id=this.$route.query.id?this.$route.query.id:"",this.getStrategyList()}change_strategy(e){e||this.getStrategyList()}async getStrategyList(e=""){let t=await u["a"].get_strategy_list({name:e,page:1,pageSize:20});"Success"===t.code&&(this.strategy_list=t.data.datas||[],""!==this.edit_id&&(this.form_data.stategy=this.edit_id))}async change_stategy(e){const t=await u["a"].get_strategy_detail({id:e});"Success"===t.code&&(this.strategy_data=t.data,""!==this.edit_id&&(this.form_data.name=t.data.name))}create(){const e=this.$refs.form,t=this.$refs.rule_config;e.validate(async e=>{if(e){const e=t.selected_products;if(0===e.length)return void this.$message.warning("请添加产品！");if(0===e[0].rule_list.length)return void this.$message.warning("请添加规则！");const r=[];if(e.forEach(e=>{e.rule_list.forEach(t=>{const a=[];t.level.map(e=>{const r={metricID:t.metricID[1],metricCondition:e.range,metricValue:Number(e.num),metricPeriod:parseInt(e.cycle_time),metricPeriodNum:parseInt(e.cycle_num),level:parseInt(e.alram_type),alarmType:"0"===t.tab_key?"metric":"event",alarmMethod:e.notice?e.notice:[],metricUnit:e.metricUnit};a.push(r)});const i={name:t.name,productType:e.id,ruleRecords:"0"===t.tab_key?a:[{metricID:"",alarmType:"0"===t.tab_key?"metric":"event",alarmMethod:t.notice?t.notice:[],eventId:[t.event_name],eventType:t.event_type,level:parseInt(t.alram_type)}]};r.push(i)})}),""===this.edit_id){let e=await u["a"].add_strategy({name:this.form_data.name,rules:r});"Success"===e.code&&(this.$message.success("创建策略任务下发成功"),this.$router.go(-1))}else{const{az:e,callbackURL:t,effectEndTime:a,effectStartTime:i,enable:n,id:s,regions:l,contactGroupIDs:c}=this.strategy_data;let o=await u["a"].update_strategy({name:this.form_data.name,rules:r.map(e=>(e=Object.assign({},e,{strategyID:this.edit_id}),e)),az:e,callbackURL:t,contactGroupID:c,effectEndTime:a,effectStartTime:i,enable:n,id:s,regions:l});"Success"===o.code&&(this.$message.success("编辑策略任务下发成功"),this.$router.go(-1))}}})}};Object(n["a"])([Object(s["f"])("form_data.stategy")],y.prototype,"change_stategy",null),y=Object(n["a"])([Object(s["a"])({components:{RuleConfig:v,BackHeader:b["a"]}})],y);var g=y,k=g,x=(r("03f5"),Object(f["a"])(k,a,i,!1,null,"c63c38c0",null));t["default"]=x.exports},e9bc:function(e,t,r){"use strict";var a=r("dc19"),i=r("cb27").add,n=r("83b9e"),s=r("7f65"),l=r("5388");e.exports=function(e){var t=a(this),r=s(e).getIterator(),c=n(t);return l(r,(function(e){i(c,e)})),c}},ed46:function(e,t,r){"use strict";var a=function(){var e=this,t=e._self._c;e._self._setupProxy;return t("div",[t("div",{staticClass:"box"},[t("div",[t("span",[e._v(e._s(e.title))]),e._t("left")],2),t("div",[e._t("default"),e.no_back?e._e():t("el-button",{attrs:{type:"primary",plain:""},on:{click:e.FnBack}},[e._v("返回")])],2)]),t("div",{staticClass:"perch"})])},i=[],n=(r("14d9"),r("9ab4")),s=r("1b40");let l=class extends s["e"]{FnBack(){this.back_url?this.$router.push(this.back_url):this.$router.go(-1)}};Object(n["a"])([Object(s["c"])({default:""})],l.prototype,"title",void 0),Object(n["a"])([Object(s["c"])({default:""})],l.prototype,"back_url",void 0),Object(n["a"])([Object(s["c"])({default:!1})],l.prototype,"no_back",void 0),l=Object(n["a"])([s["a"]],l);var c=l,o=c,u=(r("a58a"),r("2877")),d=Object(u["a"])(o,a,i,!1,null,"bdf5ebe2",null);t["a"]=d.exports}}]);