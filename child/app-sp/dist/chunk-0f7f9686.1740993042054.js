(window["webpackJsonp_AppSp"]=window["webpackJsonp_AppSp"]||[]).push([["chunk-0f7f9686"],{"080a":function(e,t,a){"use strict";a("44e64")},"1c38":function(e,t,a){"use strict";a("cd7b")},"44e64":function(e,t,a){},"6d07":function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-tabs",{model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[a("el-tab-pane",{attrs:{label:"报警信息",name:"1"}},["1"===e.activeName?[a("info")]:e._e()],2),a("el-tab-pane",{attrs:{label:"屏蔽管理",name:"2"}},["2"===e.activeName?[a("shield")]:e._e()],2)],1)},i=[],s=a("bee2"),l=a("d4ec"),r=a("262e"),c=a("2caf"),o=a("9ab4"),u=a("1b40"),p=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("action-block",{attrs:{search_option:e.search},on:{"fn-search":e.fn_search}}),a("time-group",{on:{"fn-emit":e.getTabTime}}),a("el-table",{staticClass:"event-table",attrs:{data:e.list,border:""},on:{"filter-change":e.fil_info}},[a("el-table-column",{attrs:{prop:"productType",label:"产品类型"}}),a("el-table-column",{attrs:{prop:"instanceID",label:"故障资源ID"}}),a("el-table-column",{attrs:{prop:"createTime",label:"发生时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.createTime?e.moment(t.row.createTime).format("YYYY-MM-DD HH:mm:ss"):"--"))])]}}])}),a("el-table-column",{attrs:{prop:"durationTime",label:"持续时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",{staticClass:"m-right10"},[e._v(e._s(t.row.metricPeriodNum?t.row.metricPeriodNum+"个周期":"-"))]),a("span",[e._v(e._s(t.row.metricPeriod?60===t.row.metricPeriod?"1小时1周期":t.row.metricPeriod+"分钟1周期":"-"))])]}}])}),a("el-table-column",{attrs:{prop:"strategyName",label:"策略名称"}}),a("el-table-column",{attrs:{prop:"ruleName",label:"规则名称"}}),a("el-table-column",{attrs:{prop:"alarmType",label:"报警类型"},scopedSlots:e._u([{key:"default",fn:function(t){return[""!==t.row.alarmType?a("span",[e._v(e._s("metric"===t.row.alarmType?"指标报警":"事件报警"))]):a("span",[e._v("--")])]}}])}),a("el-table-column",{attrs:{prop:"contactGroup",label:"通知对象"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.contactGroup.join(",")))]),a("i",{staticClass:"el-icon-document",on:{click:function(a){return e.view_contact(t.row.notyfyList)}}})]}}])}),a("el-table-column",{attrs:{prop:"alarmMethod",label:"通知方式"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(2===t.row.alarmMethod.length?"邮箱+短信":e.notice[t.row.alarmMethod[0]]))])]}}])}),a("el-table-column",{attrs:{prop:"dealStatus",label:"处理结果",filters:e.fil_list,"filter-multiple":!1,"filter-placement":"bottom-end","column-key":"dealStatus"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.dealStatus?"已处理":"未处理"))])]}}])}),a("el-table-column",{attrs:{prop:"action",label:"操作栏"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text",disabled:!e.authList.includes("infoDetail")},on:{click:function(a){return e.detail(t.row)}}},[e._v("详情")]),a("el-button",{attrs:{type:"text",disabled:1===t.row.enable||!(e.authList.includes("alarm_create")&&e.authList.includes("edit"))},on:{click:function(a){return e.shield(t.row)}}},[e._v("屏蔽")]),a("el-button",{attrs:{type:"text",disabled:!t.row.shieldID||0===t.row.enable||!e.authList.includes("stop")},on:{click:function(a){return e.stopShield(t.row)}}},[e._v("停止屏蔽")])]}}])})],1),a("el-pagination",{attrs:{"current-page":e.current,"page-sizes":[20,50,100],"page-size":e.size,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}}),e.visible?[a("notice-contact",{attrs:{visible:e.visible,list:e.notice_list},on:{"update:visible":function(t){e.visible=t}}})]:e._e(),e.operateVisible&&"detail"===e.operateType?[a("info-detail",{attrs:{visible:e.operateVisible,info:e.info},on:{"update:visible":function(t){e.operateVisible=t}}})]:e._e(),e.operateVisible&&"shield"===e.operateType?[a("info-shield",{attrs:{visible:e.operateVisible,info:e.info},on:{"update:visible":function(t){e.operateVisible=t}}})]:e._e()],2)},d=[],h=a("5530"),m=a("1da1"),f=(a("96cf"),a("ac1f"),a("841c"),a("b0c0"),a("c811")),b=a("1f82"),v=a("c1df"),_=a.n(v),y=a("2966"),g=a("8ce4"),k=a("5cb2"),w=a("18c0"),S=a("b520"),j=function(e){Object(r["a"])(a,e);var t=Object(c["a"])(a);function a(){var e;return Object(l["a"])(this,a),e=t.apply(this,arguments),e.notice={email:"邮箱",phone:"短信"},e.type_list=[{type:"metric",label:"指标报警"},{type:"event",label:"事件报警"}],e.search={ruleName:{placeholder:"请输入规则名称"},instanceID:{placeholder:"请输入资源ID"},type:{placeholder:"报警类型",list:e.type_list},contact:{placeholder:"报警联系人组",list:[]},strategyName:{placeholder:"请输入策略名称"}},e.authList=[],e.fil_list=[{text:"已处理",value:"1"},{text:"未处理",value:"0"}],e.list=[],e.current=1,e.size=20,e.total=0,e.moment=_.a,e.search_data={},e.dealStatus=[],e.visible=!1,e.operateVisible=!1,e.operateType="",e.notice_list=[],e.info={},e}return Object(s["a"])(a,[{key:"created",value:function(){this.getContactGroupList(),this.authList=this.$store.state.auth_info[this.$route.name]}},{key:"getContactGroupList",value:function(){var e=Object(m["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,y["a"].get_contact_group_list({});case 2:t=e.sent,"Success"===t.code&&(this.search.contact.list=Object(g["e"])(t.data.datas,"name","id","label","type"));case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"getAlarmList",value:function(){var e=Object(m["a"])(regeneratorRuntime.mark((function e(){var t,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=this.search_data,e.next=3,y["a"].get_alarm_list({ruleName:t.ruleName,instanceID:t.instanceID,alarmType:t.type,contactGroupName:t.contact,strategyName:t.strategyName,startTime:t.time?_()(t.time[0]).format("YYYY-MM-DD HH:mm:ss"):_()(new Date).format("YYYY-MM-DD 00:00:00"),endTime:t.time?_()(t.time[1]).format("YYYY-MM-DD HH:mm:ss"):_()(new Date).format("YYYY-MM-DD HH:mm:ss"),dealStatus:0===this.dealStatus.length?"":this.dealStatus[0],page:this.current,pageSize:this.size});case 3:a=e.sent,"Success"===a.code&&(this.list=a.data.datas||[],this.total=a.data.total||0);case 5:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"view_contact",value:function(e){this.visible=!0,this.notice_list=e}},{key:"fn_search",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.current=1,this.search_data=Object(h["a"])(Object(h["a"])({},this.search_data),e),this.getAlarmList()}},{key:"handleSizeChange",value:function(e){this.size=e,this.getAlarmList()}},{key:"handleCurrentChange",value:function(e){this.current=e,this.getAlarmList()}},{key:"getTabTime",value:function(e){this.search_data.time=e,this.getAlarmList()}},{key:"fil_info",value:function(e){this.dealStatus=e.dealStatus,this.current=1,this.getAlarmList()}},{key:"detail",value:function(e){this.info=e,this.operateType="detail",this.operateVisible=!0}},{key:"shield",value:function(e){this.info=e,this.operateType="shield",this.operateVisible=!0}},{key:"stopShield",value:function(e){var t=this,a=this.$createElement;this.$msgbox({title:"提示",message:a("p",null,[a("span",null,"确定停止 "),a("i",{style:"color: #455cc6"},"".concat(e.shieldName," ")),a("span",null," 屏蔽策略吗? ")]),showCancelButton:!0,confirmButtonText:"确定",cancelButtonText:"取消"}).then(function(){var a=Object(m["a"])(regeneratorRuntime.mark((function a(n){var i;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,y["a"].shield_apply({ids:[e.shieldID],enable:0});case 2:i=a.sent,"Success"===i.code&&(t.$message.success(i.message),t.getAlarmList());case 4:case"end":return a.stop()}}),a)})));return function(e){return a.apply(this,arguments)}}())}},{key:"watchOperateVisible",value:function(e){e||this.getAlarmList()}}]),a}(u["e"]);Object(o["a"])([Object(u["f"])("operateVisible")],j.prototype,"watchOperateVisible",null),j=Object(o["a"])([Object(u["a"])({components:{ActionBlock:f["a"],TimeGroup:b["a"],NoticeContact:k["a"],InfoDetail:w["a"],InfoShield:S["a"]}})],j);var O=j,x=O,T=(a("080a"),a("2877")),D=Object(T["a"])(x,p,d,!1,null,"0aba31bc",null),C=D.exports,L=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("action-block",{attrs:{search_option:e.search},on:{"fn-search":e.fn_search}},e._l(e.headerOperateBtns,(function(t,n){return a("el-button",{key:n,attrs:{type:"primary",disabled:!e.authList.includes(n)},on:{click:function(t){return e.handle(n)}}},[e._v(e._s(t))])})),1),a("el-table",{staticClass:"event-table",attrs:{data:e.list,border:""},on:{"selection-change":e.handleSelectionChange}},[a("el-table-column",{attrs:{type:"selection"}}),a("el-table-column",{attrs:{prop:"shield_name",label:"屏蔽名称"}}),a("el-table-column",{attrs:{prop:"createTime",label:"屏蔽状态"},scopedSlots:e._u([{key:"default",fn:function(t){return[1===t.row.enable?a("span",{staticClass:"running"},[e._v("屏蔽中")]):a("span",{staticClass:"build_fail"},[e._v("已停用")])]}}])}),a("el-table-column",{attrs:{prop:"created_time",label:"创建时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(e.moment(t.row.created_time).format("YYYY-MM-DD HH:mm:ss")))])]}}])}),a("el-table-column",{attrs:{prop:"updated_time",label:"修改时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(e.moment(t.row.updated_time).format("YYYY-MM-DD HH:mm:ss")))])]}}])}),a("el-table-column",{attrs:{prop:"operation",label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return e._l(e.operateBtns,(function(n,i){return a("el-button",{key:n,attrs:{type:"text",disabled:!e.FnDisable(i,t.row)||!e.authList.includes(i)},on:{click:function(a){return e.handle(i,t.row)}}},[e._v(e._s(n))])}))}}])})],1),a("el-pagination",{attrs:{"current-page":e.current,"page-sizes":[20,50,100],"page-size":e.size,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}}),e.visible?[a("shield-detail",{attrs:{detaiId:e.multipleSelection[0].id,visible:e.visible},on:{"update:visible":function(t){e.visible=t}}})]:e._e()],2)},Y=[],z=(a("a9e3"),a("b64b"),a("caad"),a("d3b7"),a("d81d"),a("a15b"),a("c8d7")),$=function(e){Object(r["a"])(a,e);var t=Object(c["a"])(a);function a(){var e;return Object(l["a"])(this,a),e=t.apply(this,arguments),e.search={name:{placeholder:"请输入屏蔽名称"},enable:{placeholder:"请选择屏蔽状态",list:[{type:"1",label:"屏蔽中"},{type:"2",label:"已停用"}]}},e.list=[{productType:"1"}],e.current=1,e.size=20,e.total=0,e.search_data={},e.multipleSelection=[],e.operateType="",e.moment=_.a,e.visible=!1,e.authList=[],e.headerOperateBtns={alarm_create:"创建屏蔽",del:"删除",apply:"应用",stop:"停用"},e.operateBtns={detail:"详情",edit:"修改",apply:"应用",stop:"停用",del:"删除"},e}return Object(s["a"])(a,[{key:"created",value:function(){this.getShieldList(),this.authList=this.$store.state.auth_info[this.$route.name]}},{key:"getShieldList",value:function(){var e=Object(m["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,y["a"].get_shield_list({page:this.current,pageSize:this.size,name:this.search_data.name,enable:this.search_data.enable?Number(this.search_data.enable):void 0});case 2:t=e.sent,"Success"===t.code&&(this.list=t.data.datas,this.total=t.data.total);case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"fn_search",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.current=1,this.search_data=Object(h["a"])({},e),this.getShieldList()}},{key:"handleSizeChange",value:function(e){this.size=e,this.getShieldList()}},{key:"handleCurrentChange",value:function(e){this.current=e,this.getShieldList()}},{key:"handleSelectionChange",value:function(e){this.multipleSelection=e}},{key:"handle",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object.keys(t).length>0&&(this.multipleSelection=[t]),this.operateType=e,"alarm_create"===e?this.$router.push("/alarmInfo/create"):"edit"===e?this.$router.push({path:"/alarmInfo/create",query:{id:t.id}}):"detail"===e?this.visible=!0:["apply","stop"].includes(e)?this.apply():"del"===e&&this.del()}},{key:"judgeDeadTime",value:function(e){return!!e&&_()(new Date).diff(_()(e),"seconds")>0}},{key:"judgeOperate",value:function(){return this.judge(this.operateType,this.multipleSelection)}},{key:"judge",value:function(e,t){var a=this,n=!0;if("apply"===e){var i=t.some((function(e){return 1===e.enable||a.judgeDeadTime(e.shield_end_time)}));n=!i}else["stop"].includes(e)?n=!t.some((function(e){return 0===e.enable})):["edit","del"].includes(e)&&(n=!t.some((function(e){return 1===e.enable})));return n}},{key:"FnDisable",value:function(e,t){return this.judge(e,[t])}},{key:"apply",value:function(){var e=this;if(this.judgeOperate()){var t=this.$createElement,a="apply"===this.operateType?"应用":"停用",n=this.multipleSelection.map((function(e){return e.shield_name}));this.$msgbox({title:"提示",message:t("p",null,[t("span",null,"确定".concat(a," ")),t("i",{style:"color: #455cc6"},n.join(",")),t("span",null," 这些屏蔽策略吗? ")]),showCancelButton:!0,confirmButtonText:"确定",cancelButtonText:"取消"}).then(function(){var t=Object(m["a"])(regeneratorRuntime.mark((function t(a){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,y["a"].shield_apply({ids:e.multipleSelection.map((function(e){return e.id})),enable:"apply"===e.operateType?1:0});case 2:n=t.sent,"Success"===n.code&&(e.$message.success(n.message),e.getShieldList());case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}else"apply"===this.operateType?this.$message.warning("只能对已停用且静默时间未到期的策略进行应用"):this.$message.warning("只能对屏蔽中的策略进行停用")}},{key:"del",value:function(){var e=this;if(this.judgeOperate()){var t=this.$createElement,a=this.multipleSelection.map((function(e){return e.shield_name}));this.$msgbox({title:"提示",message:t("p",null,[t("span",null,"确定删除 "),t("i",{style:"color: #455cc6"},"".concat(a.join(",")," ")),t("span",null,"吗？ "),t("div",null," 删除该屏蔽策略后，所有产品无法使用该屏蔽策略，且删除后无法恢复? ")]),showCancelButton:!0,confirmButtonText:"确定",cancelButtonText:"取消"}).then(function(){var t=Object(m["a"])(regeneratorRuntime.mark((function t(a){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,y["a"].shield_del({ids:e.multipleSelection.map((function(e){return e.id}))});case 2:n=t.sent,"Success"===n.code&&(e.$message.success(n.message),e.getShieldList());case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}else this.$message.warning("只能对已停用的策略进行删除")}}]),a}(u["e"]);$=Object(o["a"])([Object(u["a"])({components:{ActionBlock:f["a"],ShieldDetail:z["a"]}})],$);var N=$,M=N,I=(a("1c38"),Object(T["a"])(M,L,Y,!1,null,"18e5dd0d",null)),B=I.exports,R=function(e){Object(r["a"])(a,e);var t=Object(c["a"])(a);function a(){var e;return Object(l["a"])(this,a),e=t.apply(this,arguments),e.activeName="1",e}return Object(s["a"])(a)}(u["e"]);R=Object(o["a"])([Object(u["a"])({components:{Info:C,Shield:B}})],R);var A=R,H=A,V=Object(T["a"])(H,n,i,!1,null,null,null);t["default"]=V.exports},"6d39":function(e,t,a){"use strict";a("b848")},b848:function(e,t,a){},c8d7:function(e,t,a){"use strict";var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{attrs:{title:"屏蔽详情",visible:e.visibleSync,width:"800px","destroy-on-close":!0,"close-on-click-modal":!1},on:{"update:visible":function(t){e.visibleSync=t}}},[a("div",{staticClass:"box"},[a("el-descriptions",{attrs:{title:"",column:1,labelClassName:"label"}},e._l(e.info,(function(t,n){return a("el-descriptions-item",{key:n,attrs:{label:t.label}},[a("span",{domProps:{innerHTML:e._s(t.value)}})])})),1),a("el-table",{staticClass:"m-top10",attrs:{data:e.conditions,border:""}},[a("el-table-column",{attrs:{prop:"condition_object_ch",label:"条件对象",align:"center"}}),a("el-table-column",{attrs:{prop:"condition_value",label:"取值",align:"center"}})],1)],1)])},i=[],s=a("1da1"),l=a("d4ec"),r=a("bee2"),c=a("262e"),o=a("2caf"),u=(a("96cf"),a("9ab4")),p=a("1b40"),d=a("2966"),h=function(e){Object(c["a"])(a,e);var t=Object(o["a"])(a);function a(){var e;return Object(l["a"])(this,a),e=t.apply(this,arguments),e.info={shield_name:{label:"屏蔽名称",value:""},shield_mechanism_ch:{label:"告警机制",value:""},effective_scope_ch:{label:"抑制范围",value:""},shield_time_ch:{label:"静默时间",value:""}},e.conditions=[],e.id=e.detaiId,e}return Object(r["a"])(a,[{key:"created",value:function(){this.detail()}},{key:"detail",value:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(){var t,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,d["a"].shield_detail({id:this.id});case 2:t=e.sent,"Success"===t.code&&(this.info.shield_name.value=t.data.shield_name,this.info.shield_mechanism_ch.value=t.data.shield_mechanism_ch,this.info.effective_scope_ch.value=t.data.effective_scope_ch,this.conditions=t.data.conditions,a={0:'<div class="m-top10">'+t.data.shield_start_time+" —— "+t.data.shield_end_time+"</div>",1:'<div class="m-top10">'+t.data.shield_end_time+"</div>",2:""},this.info.shield_time_ch.value=t.data.shield_time_ch+"<br>"+a[t.data.shield_time]);case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()}]),a}(p["e"]);Object(u["a"])([Object(p["c"])()],h.prototype,"detaiId",void 0),Object(u["a"])([Object(p["d"])("visible")],h.prototype,"visibleSync",void 0),h=Object(u["a"])([Object(p["a"])({components:{}})],h);var m=h,f=m,b=(a("6d39"),a("2877")),v=Object(b["a"])(f,n,i,!1,null,null,null);t["a"]=v.exports},cd7b:function(e,t,a){},d81d:function(e,t,a){"use strict";var n=a("23e7"),i=a("b727").map,s=a("1dde"),l=s("map");n({target:"Array",proto:!0,forced:!l},{map:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}})}}]);
//# sourceMappingURL=chunk-0f7f9686.1740993042054.js.map