(window["webpackJsonp_AppSp"]=window["webpackJsonp_AppSp"]||[]).push([["chunk-307262ca"],{"13f1":function(e,t,a){"use strict";var s=a("81a9"),r=a("bff7");function i(e){let t=r["f"];return"gpu"===e&&(t=r["c"]),t}t["a"]={get_cpu(e,t){return Object(s["a"])(i(e)("GET","/cpu_info",t))},get_disk(e,t){return Object(s["a"])(i(e)("GET","/disk_info",t))},get_load(e,t){return Object(s["a"])(i(e)("GET","/load_info",t))},get_memory(e,t){return Object(s["a"])(i(e)("GET","/memory_info",t))},get_network(e,t){return Object(s["a"])(i(e)("GET","/network_info",t))},get_gpu(e,t){return Object(s["a"])(i(e)("GET","/gpu_info",t))},get_disk_info(e,t){return Object(s["a"])(i(e)("GET","/disk_info",t))},get_eip_info(e){return Object(s["a"])(Object(r["b"])("POST","/ecs/eip_monitor_info/",e))}}},1477:function(e,t,a){"use strict";var s=a("81a9"),r=a("bff7");t["a"]={get_host_list(e){return Object(s["a"])(Object(r["d"])("POST","/host/get_host_list/",e))},get_room_list(e){return Object(s["a"])(Object(r["d"])("GET","/host/machine_room_list/",e))},get_status_list(e){return Object(s["a"])(Object(r["d"])("GET","/host/host_status_list/",e))},external_management(e){return Object(s["a"])(Object(r["d"])("GET","/host/external_management/",e))},migrate(e){return Object(s["a"])(Object(r["d"])("POST","/host/migration_operation/",e))},disperse(e){return Object(s["a"])(Object(r["d"])("POST","/host/disperse_operation/",e))},record(e){return Object(s["a"])(Object(r["d"])("POST","/host/host_operation_record/",e))},recommended_host(e){return Object(s["a"])(Object(r["d"])("POST","/host/recommended_host/",e))},host_maintenance(e){return Object(s["a"])(Object(r["d"])("POST","/host/host_maintenance/",e))},finish_maintenance(e){return Object(s["a"])(Object(r["d"])("POST","/host/host_finish_maintenance/",e))},shelves(e){return Object(s["a"])(Object(r["d"])("POST","/host/host_off_shelves/",e))},get_detail_overview(e){return Object(s["a"])(Object(r["d"])("GET","/host/host_main_details/",e))},get_detail_storage(e){return Object(s["a"])(Object(r["d"])("GET","/host/host_disk/",e))},down(e){return Object(s["a"])(Object(r["d"])("GET","/host/host_list_download/",e))},host_operate(e){return Object(s["a"])(Object(r["d"])("POST","/host/operate/",e))},host_import(e){return Object(s["a"])(Object(r["d"])("POST","/host/import/",e))},get_host_attribution(e){return Object(s["a"])(Object(r["d"])("GET","/host/get_host_attribution/",e))},set_host_attribution(e){return Object(s["a"])(Object(r["d"])("POST","/host/set_host_attribution/",e))},get_host_type(e){return Object(s["a"])(Object(r["d"])("GET","/host/get_host_config/",e))},update_attribute(e){return Object(s["a"])(Object(r["d"])("POST","/host/set_host_config/",e))},getCustomerList(e){return Object(s["a"])(Object(r["d"])("POST","/host/get_customer_list/",e))},getFamilyList(e){return Object(s["a"])(Object(r["d"])("POST","/host/get_family_list/",e))},finish_validate(e){return Object(s["a"])(Object(r["d"])("POST","/host/verification_finish/",e))},get_host_recycle_department(e){return Object(s["a"])(Object(r["d"])("GET","/host/get_host_recycle_department/",e))},get_host_list_field(e){return Object(s["a"])(Object(r["d"])("GET","/host/get_host_list_field/",e))},get_task_list(e){return Object(s["a"])(Object(r["d"])("GET","/host/business_test_task/",e))},create_test_task(e){return Object(s["a"])(Object(r["d"])("POST","/host/create_test_task/",e))},get_host_filter_item(e){return Object(s["a"])(Object(r["d"])("POST","/host/get_host_filter_item/",e))},set_remark(e){return Object(s["a"])(Object(r["d"])("POST","/host/set_host_remark/",e))},set_flag(e){return Object(s["a"])(Object(r["d"])("POST","/host/set_host_tag/",e))},update_ecs_info(e){return Object(s["a"])(Object(r["d"])("POST","/ecs/update_ecs_info/",e))},crash_clear(e){return Object(s["a"])(Object(r["b"])("POST","/host/crash_clear/",e))},crash_recover(e){return Object(s["a"])(Object(r["b"])("POST","/host/crash_recover/",e))},set_lock(e){return Object(s["a"])(Object(r["d"])("POST","/host/host_lock/",e))},set_unlock(e){return Object(s["a"])(Object(r["d"])("POST","/host/host_unlock/",e))},set_maintenance(e){return Object(s["a"])(Object(r["d"])("POST","/host/host_maintenance/",e))},get_maintenance_record(e){return Object(s["a"])(Object(r["d"])("GET","/host/host_maintenance_record/",e))},get_lock_record(e){return Object(s["a"])(Object(r["d"])("GET","/host/host_lock_record/",e))},recover_storage_error(e){return Object(s["a"])(Object(r["d"])("POST","/host/recover_storage_error/",e))},agent_update(e){return Object(s["a"])(Object(r["d"])("POST","/host/handle_host_agent_update/",e))},agent_rollback(e){return Object(s["a"])(Object(r["d"])("POST","/host/handle_host_agent_rollback/",e))},set_prepare_host(e){return Object(s["a"])(Object(r["d"])("POST","/host/set_prepare_host/",e))},get_ovs_version(e){return Object(s["a"])(Object(r["d"])("GET","/host/ovs_version_list/",e))}}},"4d7b":function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e._self._c;e._self._setupProxy;return t("el-card",[t("div",{staticClass:"monitor gpuBox"},[t("div",{staticClass:"tab-card"},[t("el-tabs",{attrs:{type:"border-card"},model:{value:e.default_tab,callback:function(t){e.default_tab=t},expression:"default_tab"}},e._l(e.tab_list,(function(e,a){return t("el-tab-pane",{key:a,attrs:{label:e,name:a}})})),1),t("time-group",{on:{"fn-emit":e.FnGetTimer}}),"instance"===e.default_tab?t("div",{staticClass:"chart-box"},[t("line-echart",{staticClass:"item",attrs:{chart_id:"cpu_chart",data:e.cpu_used}}),t("line-echart",{staticClass:"item",attrs:{chart_id:"ram_chart",data:e.memory_used}})],1):e._e(),"net"===e.default_tab?t("div",{staticClass:"chart-box"},[t("line-echart",{staticClass:"item",attrs:{chart_id:"net_rate_chart",data:e.net_rate}})],1):e._e(),"disk"===e.default_tab?t("div",{staticClass:"chart-box"},[t("line-echart",{staticClass:"item",attrs:{chart_id:"disk_chart",data:e.disk_used}}),t("line-echart",{staticClass:"item",attrs:{chart_id:"disk_through_chart",data:e.disk_bytes}}),t("line-echart",{staticClass:"item",attrs:{chart_id:"disk_iops_chart",data:e.disk_iops}})],1):e._e(),"gpu"===e.default_tab?t("div",{staticClass:"chart-box"},[t("line-echart",{staticClass:"item",attrs:{chart_id:"gpu_chart",data:e.gpu_used}}),t("line-echart",{staticClass:"item",attrs:{chart_id:"gpu_memory_chart",data:e.gpu_memory_used}}),t("line-echart",{staticClass:"item",attrs:{chart_id:"gpu_temperature",data:e.gpu_temperature}}),t("line-echart",{staticClass:"item",attrs:{chart_id:"gpu_frequency",data:e.gpu_frequency}})],1):e._e()],1)])])},r=[],i=(a("14d9"),a("e9f5"),a("910d"),a("7d54"),a("ab43"),a("9ab4")),n=a("1b40"),c=a("ed46"),_=a("1f82"),u=a("ff48"),o=a("1477"),d=a("13f1"),l=a("e527"),h=a("c1df"),b=a.n(h),p=a("6285");let m=class extends n["e"]{constructor(){super(...arguments),this.host_info={region_id:"",az_id:"",host_ip:"",host_purpose:""},this.cpu_used={title:"CPU使用率",unit:"",xTime:[],yValue:[],resize:0},this.memory_used={title:"内存使用率",unit:"",xTime:[],yValue:[],resize:0},this.system_load={title:"系统平均负载",unit:"",xTime:[],yValue:[],resize:0,legend:["1m","5m","15m"]},this.net_in_out={title:"网络流量",unit:"",xTime:[],yValue:[],resize:0,legend:[],line_name:["出网流量","入网流量"],type:"double_line"},this.net_rate={title:"网络吞吐量",unit:"",xTime:[],yValue:[],resize:0,legend:[],line_name:["出网流量速率","入网流量速率"],type:"double_line"},this.disk_used={title:"磁盘使用率",unit:"",xTime:[],yValue:[],resize:0,legend:[]},this.disk_iops={title:"磁盘IOPS",unit:"",xTime:[],yValue:[],resize:0,legend:[],line_name:["读","写"],type:"double_line"},this.disk_bytes={title:"磁盘吞吐量",unit:"",xTime:[],yValue:[],resize:0,legend:[],line_name:["读","写"],type:"double_line"},this.default_tab="",this.tab_list={instance:"主机",net:"网络",disk:"磁盘"},this.gpu_used={title:"GPU使用率",unit:"",xTime:[],yValue:[],resize:0,legend:[]},this.gpu_memory_used={title:"显存使用率",unit:"",xTime:[],yValue:[],resize:0,legend:[]},this.gpu_temperature={title:"GPU温度",unit:"",xTime:[],yValue:[],resize:0,legend:[]},this.gpu_frequency={title:"GPU主频",unit:"",xTime:[],yValue:[],resize:0,legend:[],line_name:["GPU核心频率","显存频率"],type:"double_line"},this.default_date_timer=[]}FnGetTimer(e){this.default_date_timer=e,this.host_info.host_ip&&this.FnGetChartData()}FnGetChartData(){let e="kvm";if(!this.$store.state.display)return;let t={hostId:this.$store.state.display,region:this.host_info.region_id,replica:this.host_info.az_id,ip:this.host_info.host_ip,instanceType:"host",start:b.a.utc(this.default_date_timer[0]).format("YYYY-MM-DD HH:mm:ss"),end:b.a.utc(this.default_date_timer[1]).format("YYYY-MM-DD HH:mm:ss")};console.log("====",this.default_tab),"instance"===this.default_tab?(this.FnGetCpu(e,t),this.FnGetMemory(e,t)):"disk"===this.default_tab?this.FnGetDiskInfo(e,t):"net"===this.default_tab?this.FnGetNetInfo(e,t):"gpu"===this.default_tab&&this.FnGetGpuInfo(e,t)}async FnGetDetail(){const e=await o["a"].get_detail_overview({host_id:this.$route.params.id});"Success"===e.code&&(this.host_info=e.data,"CPU"===this.host_info.host_purpose&&n["e"].delete(this.tab_list,"gpu"),this.FnGetChartData())}async FnGetCpu(e,t){const a=await d["a"].get_cpu(e,{queryType:"use_total",...t});this.FnHandleSingleData("cpu_used",a)}async FnGetMemory(e,t){const a=await d["a"].get_memory(e,{queryType:"used",...t});this.FnHandleSingleData("memory_used",a)}FnHandleSingleData(e,t){"Success"===t.code&&(this[e].xTime=t.data.xTime,this[e].yValue=t.data.yValues,this[e].unit=t.data.unit),this[e].resize++}FnHandleMoreData(e,t){this[e].yValue=[],t.forEach(t=>{"Success"===t.code&&(t.data.xTime&&(this[e].xTime=t.data.xTime,this[e].unit=t.data.unit),this[e].yValue.push(t.data.yValues))}),this[e].resize++}FnGetDiskInfo(e,t){d["a"].get_disk(e,{queryType:"use",...t}).then(e=>{"Success"===e.code&&(this.disk_used.xTime=e.data.xTime,this.disk_used.yValue=e.data.yValues,this.disk_used.legend=e.data.metricInfo,this.disk_used.unit=e.data.unit);this.disk_used.resize++}),this.disk_bytes.yValue=[],Promise.all([d["a"].get_disk(e,{queryType:"readbytes",...t}),d["a"].get_disk(e,{queryType:"writebytes",...t})]).then(e=>{this.FnHandleDubleData("disk_bytes",e)}),this.disk_iops.yValue=[],Promise.all([d["a"].get_disk(e,{queryType:"readiops",...t}),d["a"].get_disk(e,{queryType:"writeiops",...t})]).then(e=>{this.FnHandleDubleData("disk_iops",e)})}FnHandleMoreGpuNameData(e,t){let a=[],s=[],r=[];e.map((e,t)=>{e.data.xTime&&(s.push(e),r.push(t))});let i=t.filter((e,t)=>r.includes(t));if(0===s.length)return{data:{}};let n=s[0],c=0;return s.map((e,t)=>{e.data.xTime.length>s[c].data.xTime.length&&(c=t),e.data.gpuName.map(e=>{a.push(i[t])}),0!==t&&(n.data.gpuName=[...n.data.gpuName,...e.data.gpuName],n.data.yValues=[...n.data.yValues,...e.data.yValues])}),n.data.gpuName=n.data.gpuName.map((e,t)=>{let s=a[t].ecs_name.length>20?a[t].ecs_name.slice(0,20)+"...":a[t].ecs_name;return a[t].customer_name+"-"+s+"-"+e}),n.data.xTime=s[c].data.xTime,n}FnHandleDubleData(e,t){let a=0,s=0;t.forEach(t=>{"Success"===t.code&&(t.data.metricInfo=t.data.metricInfo||t.data.device||t.data.gpuName,0===a?(s=0,this[e].xTime=t.data.xTime,this[e].legend=t.data.metricInfo,this[e].unit=t.data.unit):t.data.metricInfo&&t.data.metricInfo.forEach(t=>{this[e].legend.push(t+this.disk_iops.type)}),t.data.yValues&&this[e].yValue.push(...t.data.yValues)),a++}),this[e].resize++}FnGetNetInfo(e,t){this.net_in_out.yValue=[],this.net_rate.yValue=[],Promise.all([d["a"].get_network(e,{queryType:"networkout_rate",...t}),d["a"].get_network(e,{queryType:"networkin_rate",...t})]).then(e=>{this.FnHandleDubleData("net_rate",e)})}async FnGetGpuInfo(e,t){let a="";a="host_monitor"===this.$route.name?Object(p["b"])(this.$route.params.id):this.$store.state.pod_id;const s=await l["a"].get_instance_list({billing_method:"all",host_id:this.$route.params.id,pod_id:a});let r=[];this.gpu_used.legend=[],this.gpu_memory_used.legend=[],this.gpu_temperature.legend=[],this.gpu_frequency.legend=[],"Success"===s.code&&(r=s.data.ecs_list.filter(e=>"destroy"!==e.status&&("GPU"===this.host_info.host_purpose||e.is_gpu))),this.gpu_used.yValue=[],Promise.all(r.map(a=>d["a"].get_gpu(e,{queryType:"gpu_usage",hostId:a.ecs_id,region:t.region,replica:t.replica,ip:a.private_net,instanceType:"vm",start:t.start,end:t.end}))).then(e=>{this.FnHandleDubleData("gpu_used",[this.FnHandleMoreGpuNameData(e,r)])}),this.gpu_memory_used.yValue=[],Promise.all(r.map(a=>(this.gpu_memory_used.legend.push(a.ecs_name),d["a"].get_gpu(e,{queryType:"memory_usage",hostId:a.ecs_id,region:t.region,replica:t.replica,ip:a.private_net,instanceType:"vm",start:t.start,end:t.end})))).then(e=>{this.FnHandleDubleData("gpu_memory_used",[this.FnHandleMoreGpuNameData(e,r)])}),this.gpu_temperature.yValue=[],Promise.all(r.map(a=>(this.gpu_temperature.legend.push(a.ecs_name),d["a"].get_gpu(e,{queryType:"temperature",hostId:a.ecs_id,region:t.region,replica:t.replica,ip:a.private_net,instanceType:"vm",start:t.start,end:t.end})))).then(e=>{this.FnHandleDubleData("gpu_temperature",[this.FnHandleMoreGpuNameData(e,r)])});let i=[],n=[];r.forEach(a=>{let s={hostId:a.ecs_id,region:t.region,replica:t.replica,ip:a.private_net,instanceType:"vm",start:t.start,end:t.end};i.push(d["a"].get_gpu(e,{queryType:"gpu_clocks_graphics",...s})),n.push(d["a"].get_gpu(e,{queryType:"gpu_clocks_memory",...s}))}),this.gpu_frequency.yValue=[],Promise.all(i).then(e=>{Promise.all(n).then(t=>{this.FnHandleDubleData("gpu_frequency",[this.FnHandleMoreGpuNameData(e,r),this.FnHandleMoreGpuNameData(t,r)])})})}created(){this.default_tab=this.$route.params.gpuTab?this.$route.params.gpuTab:Object.keys(this.tab_list)[0],console.log("this.default_tab",this.default_tab),this.FnGetDetail()}FnChangeTab(e,t){t&&this.FnGetChartData()}};Object(i["a"])([Object(n["f"])("default_tab")],m.prototype,"FnChangeTab",null),m=Object(i["a"])([Object(n["a"])({components:{BackHeader:c["a"],TimeGroup:_["a"],LineEchart:u["a"]}})],m);var O=m,g=O,j=(a("abac"),a("2877")),f=Object(j["a"])(g,s,r,!1,null,"e7fc811a",null);t["default"]=f.exports},6285:function(e,t,a){"use strict";a.d(t,"a",(function(){return r})),a.d(t,"b",(function(){return i}));var s=a("0613");function r(e){for(let t of s["a"].state.tree_list)for(let a of t.children)if(a.cluster_id===e)return t.pod_id;return null}function i(e){for(let t of s["a"].state.tree_list)for(let a of t.children||[])for(let s of a.children||[])if(s.host_id===e)return t.pod_id;return null}},a58a:function(e,t,a){"use strict";a("e410")},abac:function(e,t,a){"use strict";a("b994")},b994:function(e,t,a){},e410:function(e,t,a){},e527:function(e,t,a){"use strict";var s=a("81a9"),r=a("bff7"),i=a("4328"),n=a.n(i);t["a"]={get_instance_list(e){return Object(s["a"])(Object(r["b"])("POST","/ecs/ecs_list/",e))},operate_instance(e){return Object(s["a"])(Object(r["b"])("POST","/ecs/operate/",e))},delete_instance(e){return Object(s["a"])(Object(r["b"])("POST","/ecs/delete/",e))},recover_instance(e){return Object(s["a"])(Object(r["b"])("POST","/ecs/recover/",e))},destroy_instance(e){return Object(s["a"])(Object(r["b"])("POST","/ecs/destroy/",e))},get_status_list(){return Object(s["a"])(Object(r["b"])("GET","/ecs/ecs_status_list/"))},get_family_data(){return Object(s["a"])(Object(r["b"])("GET","/ecs/get_family_data/"))},reset_password(e){return Object(s["a"])(Object(r["b"])("POST","/ecs/ecs_reset_password/",e))},update_spec(e){return Object(s["a"])(Object(r["b"])("POST","/ecs/ecs_change_configure/",e))},update_system(e){return Object(s["a"])(Object(r["b"])("POST","/ecs/ecs_change_system/",e))},get_usage_ip(e){return Object(s["a"])(Object(r["b"])("GET","/ecs/get_deleted_ecs_ip/",e))},get_vnc_url(e){return Object(s["a"])(Object(r["b"])("GET","/ecs/vnc_info/",e))},start_charge(e){return Object(s["a"])(Object(r["b"])("POST","/resource/start_charge/",e))},change_config_price(e){return Object(s["a"])(Object(r["b"])("POST","/ecs/change_config_price/",e))},change_system_price(e){return Object(s["a"])(Object(r["b"])("POST","/ecs/change_system_price/",e))},each_resource_price(e){return Object(s["a"])(Object(r["b"])("POST","/ecs/each_resource_price/",e))},add_common_mirror(e){return Object(s["a"])(Object(r["b"])("POST","/img/create_pub_image_by_ecs/",e))},set_net(e){return Object(s["a"])(Object(r["b"])("POST","/ecs/ecs_set_base_nic/",e))},get_default_dns(e){return Object(s["a"])(Object(r["b"])("POST","/ecs/az_default_dns/",e))},mount_gpu_card(e){return Object(s["a"])(Object(r["b"])("POST","/ecs/instance_gpu_card/",e))},update_gpu_status(e){return Object(s["a"])(Object(r["b"])("POST","/ecs/update_gpu_status/",e))},export_list(e){return Object(s["a"])({method:"GET",url:"/ecs_business/v1/ecs/ecs_list_download/",params:e,paramsSerializer:e=>n.a.stringify(e),responseType:"blob"})},get_tag_list(){return Object(s["a"])(Object(r["b"])("GET","/ecs/get_tag_list/"))},get_rescue_image_list(e){return Object(s["a"])(Object(r["b"])("GET","/ecs/get_rescue_image_list/",e))},enter_rescue(e){return Object(s["a"])(Object(r["b"])("POST","/ecs/enter_rescue/",e))},exit_rescue(e){return Object(s["a"])(Object(r["b"])("POST","/ecs/exit_rescue/",e))}}},ed46:function(e,t,a){"use strict";var s=function(){var e=this,t=e._self._c;e._self._setupProxy;return t("div",[t("div",{staticClass:"box"},[t("div",[t("span",[e._v(e._s(e.title))]),e._t("left")],2),t("div",[e._t("default"),e.no_back?e._e():t("el-button",{attrs:{type:"primary",plain:""},on:{click:e.FnBack}},[e._v("返回")])],2)]),t("div",{staticClass:"perch"})])},r=[],i=(a("14d9"),a("9ab4")),n=a("1b40");let c=class extends n["e"]{FnBack(){this.back_url?this.$router.push(this.back_url):this.$router.go(-1)}};Object(i["a"])([Object(n["c"])({default:""})],c.prototype,"title",void 0),Object(i["a"])([Object(n["c"])({default:""})],c.prototype,"back_url",void 0),Object(i["a"])([Object(n["c"])({default:!1})],c.prototype,"no_back",void 0),c=Object(i["a"])([n["a"]],c);var _=c,u=_,o=(a("a58a"),a("2877")),d=Object(o["a"])(u,s,r,!1,null,"bdf5ebe2",null);t["a"]=d.exports}}]);
//# sourceMappingURL=chunk-307262ca.1764214676553.js.map