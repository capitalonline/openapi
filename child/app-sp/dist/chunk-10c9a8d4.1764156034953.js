(window["webpackJsonp_AppSp"]=window["webpackJsonp_AppSp"]||[]).push([["chunk-10c9a8d4"],{"0245":function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e._self._c;e._self._setupProxy;return t("div",[t("action-block",{attrs:{search_option:e.search_option},on:{"fn-search":e.search}}),t("el-table",{staticClass:"event-table",attrs:{data:e.list,border:""}},[t("el-table-column",{attrs:{prop:"operation_type",label:"操作类型"},scopedSlots:e._u([{key:"default",fn:function(a){return e._l(e.operation_type,(function(i){return t("span",[i.type===a.row.operation_type?t("span",[e._v(" "+e._s(i.label)+" ")]):e._e()])}))}}])}),t("el-table-column",{attrs:{prop:"cloud_type_display",label:"操作对象类型"}}),t("el-table-column",{attrs:{prop:"cloud_name",label:"对象名称"}}),t("el-table-column",{attrs:{prop:"cloud_id",label:"对象ID"}}),t("el-table-column",{attrs:{prop:"content",label:"操作内容"}}),t("el-table-column",{attrs:{prop:"status",label:"操作结果"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("span",{class:a.row.status},["failed"===a.row.status?t("span",[e._v("失败")]):e._e(),"success"===a.row.status||"finish"===a.row.status?t("span",[e._v("成功")]):e._e()])]}}])}),t("el-table-column",{attrs:{prop:"response",label:"失败原因"},scopedSlots:e._u([{key:"default",fn:function(a){return[a.row.response?t("span",[e._v(e._s(a.row.response))]):t("span",[e._v("--")])]}}])}),t("el-table-column",{attrs:{prop:"create_time",label:"操作时间"}}),t("el-table-column",{attrs:{prop:"op_user",label:"操作人"}})],1),t("el-pagination",{attrs:{"current-page":e.page_info.page_index,"page-sizes":e.page_info.page_sizes,"page-size":e.page_info.page_size,layout:"total, sizes, prev, pager, next, jumper",total:e.page_info.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange,"update:currentPage":function(t){return e.$set(e.page_info,"page_index",t)},"update:current-page":function(t){return e.$set(e.page_info,"page_index",t)}}})],1)},s=[],r=(a("e9f5"),a("7d54"),a("9ab4")),l=a("1b40"),n=a("c811"),c=a("a1b1"),o=a("c1df"),p=a.n(o),_=a("9074"),u=a("8ce4");let h=class extends l["e"]{constructor(){super(...arguments),this.operation_type=[{type:"create",label:"创建"},{type:"change",label:"变更"},{type:"delete",label:"删除"}],this.cloud_type=[{type:"host",label:"宿主机"},{type:"ecs",label:"云主机"},{type:"image",label:"镜像"},{type:"disk",label:"云盘"},{type:"pool",label:"块存储"},{type:"troubleshoot",label:"故障处理任务"}],this.search_option={operation_type:{placeholder:"请选择操作类型",list:this.operation_type},cloud_type:{placeholder:"请选择操作对象",list:this.cloud_type},az_id:{placeholder:"请选择可用区",list:[]},cloud_id:{placeholder:"请输入操作对象ID"},op_user:{placeholder:"请输入操作人"},create_time:{placeholder:["开始时间","结束时间"],type:"daterange",width:"360",clearable:!0,dis_day:1,defaultTime:[]}},this.page_info={page_sizes:[20,50,100],page_size:20,page_index:1,total:0},this.list=[],this.search_data={},this.current=1}created(){this.getLogList(),this.get_az_list()}async get_az_list(){this.search_option.az_id.list=[];let e=await _["a"].get_region_az_list({});"Success"===e.code&&e.data.forEach(e=>{e.region_list.forEach(e=>{this.search_option.az_id.list=[...this.search_option.az_id.list,...Object(u["e"])(e.az_list,"az_name","az_id","label","type")]})})}handleSizeChange(e){this.page_info.page_size=e,this.page_info.page_index=1,this.getLogList()}handleCurrentChange(e){this.page_info.page_index=e,this.getLogList()}search(e={}){this.search_data={operation_type:e.operation_type,cloud_type:e.cloud_type,cloud_id:e.cloud_id,op_user:e.op_user,az_id:e.az_id,create_time_start:e.create_time&&e.create_time[0]?p()(e.create_time[0]).local().format("YYYY-MM-DDTHH:mm:ss[Z]"):void 0,create_time_end:e.create_time&&e.create_time[1]?p()(e.create_time[1]).local().format("YYYY-MM-DDTHH:mm:ss[Z]"):void 0},this.current=1,this.getLogList()}async getLogList(){let e=await c["a"].get_log_list({page_index:this.page_info.page_index,page_size:this.page_info.page_size,...this.search_data});"Success"===e.code?(this.list=e.data.operation_log_list,this.page_info.total=e.data.page_info.count):this.$message.error(e.message)}};h=Object(r["a"])([Object(l["a"])({components:{ActionBlock:n["a"]}})],h);var d=h,b=d,f=a("2877"),m=Object(f["a"])(b,i,s,!1,null,"010d642e",null);t["default"]=m.exports},"26f3":function(e,t,a){"use strict";a("4f3f")},4774:function(e,t,a){"use strict";a("835c")},"4f3f":function(e,t,a){},"835c":function(e,t,a){},"8ce4":function(e,t,a){"use strict";a.d(t,"e",(function(){return i})),a.d(t,"b",(function(){return s})),a.d(t,"a",(function(){return r})),a.d(t,"c",(function(){return l})),a.d(t,"d",(function(){return n}));a("14d9"),a("e9f5"),a("ab43");function i(e,t,a,i,s){let r=[];return e.map(e=>{r.push({[i]:e[t],[s]:e[a]})}),r}function s(e,t,a,i={}){let s=[];return e.map(e=>{let r={};t.map((t,i)=>{r[t]=e[a[i]]}),s.push({...r,...i})}),s}function r(e,t=!1){let a={};for(let i in e){const{billing_scheme_id:s,billing_cycle_id:r,billing_items:l,gic_goods_id:n}=e[i];let c={};for(let e in l){let a={attr_id:l[e].attr_id,name:l[e].name},i={id:l[e].id,key:e};c[e]=t?{...a,...i}:i}a[i]={billing_scheme_id:s,billing_cycle_id:r,billing_items:c,gic_goods_id:t?n:void 0}}return a}function l(e,t){return e.map(e=>e[t])}function n(e){let t="";for(let a in e)e[a]&&(t+=`${a}=${e[a]}&`);return""===t?"":"?"+t.slice(0,t.length-1)}},9074:function(e,t,a){"use strict";var i=a("81a9"),s=a("bff7");t["a"]={get_customer_name(e){return Object(i["a"])(Object(s["b"])("POST","/ecs/get_customer_name/",e))},get_region_az_list(e){return Object(i["a"])(Object(s["b"])("POST","/ecs/region_az_info/",e))},get_net_list(e){return Object(i["a"])(Object(s["b"])("POST","/ecs/net_info/",e))},get_all_cpu_ram(){return Object(i["a"])(Object(s["b"])("GET","/ecs/ram_cpu_list/"))},get_category_list(e){return Object(i["a"])(Object(s["b"])("GET","/ecs/ecs_category_list/",e))},ecs_family_info(e){return Object(i["a"])(Object(s["b"])("GET","/ecs/ecs_family_info/",e))},get_os_list(e){return Object(i["a"])(Object(s["b"])("POST","/img/image_info/",e))},get_price(e){return Object(i["a"])(Object(s["b"])("POST","/ecs/get_price/",e))},create_instance(e){return Object(i["a"])(Object(s["b"])("POST","/ecs/create_ecs/",e))},get_ecs_limit(e){return Object(i["a"])(Object(s["b"])("POST","/ecs/get_ecs_limit/",e))},get_ram_cpu_price_list(e){return Object(i["a"])(Object(s["b"])("POST","/ecs/ecs_spec_attach_price/",e))},difference_price(e){return Object(i["a"])(Object(s["b"])("POST","/ecs/ecs_difference_price/",e))},change_configure_limit(e){return Object(i["a"])(Object(s["b"])("POST","/ecs/change_configure_limit/",e))}}},"9a8d":function(e,t,a){"use strict";var i=function(){var e=this,t=e._self._c;e._self._setupProxy;return t("el-date-picker",{attrs:{type:e.time_option.type,editable:!1,"range-separator":"至","picker-options":{disabledDate:e.dis_date,onPick:e.onPicker},clearable:e.time_option.clearable,"start-placeholder":e.time_option.placeholder[0],"end-placeholder":e.time_option.placeholder[1]},on:{change:e.FnEmit},model:{value:e.time,callback:function(t){e.time=t},expression:"time"}})},s=[],r=a("9ab4"),l=a("1b40");let n=class extends l["e"]{constructor(){super(...arguments),this.time=[],this.min_date="",this.day=0}dis_date(e){const{day:t}=this;if(0===t)return;let a=864e5,i=(new Date).getTime(),s=(new Date).getTime(),r=(new Date).getTime();return this.time_option.min_date?(s=new Date(this.time_option.min_date).getTime(),e.getTime()>r||e.getTime()<s-a):e.getTime()>r||e.getTime()>(this.min_date||i)+a*t||this.min_date&&e.getTime()<this.min_date-a*t}onPicker({maxDate:e,minDate:t}){this.min_date=t.getTime()}created(){this.day=this.time_option.dis_day-1||0,this.FnChangeDefaultTime(this.time_option.defaultTime)}FnClear(){this.FnChangeDefaultTime(this.time_option.defaultTime)}FnChangeDefaultTime(e){console.log("clear",e),e.length,this.time=e,this.FnEmit()}FnEmit(){return this.min_date="",this.time}};Object(r["a"])([Object(l["c"])({default:()=>({placeholder:["开始时间","结束时间"],type:"daterange",width:"360",clearable:!1,dis_day:31,min_date:"",defaultTime:[new Date,new Date]})})],n.prototype,"time_option",void 0),Object(r["a"])([Object(l["c"])({default:!1})],n.prototype,"clear",void 0),Object(r["a"])([Object(l["f"])("time_option.defaultTime")],n.prototype,"FnChangeDefaultTime",null),Object(r["a"])([Object(l["b"])("fn-emit")],n.prototype,"FnEmit",null),n=Object(r["a"])([l["a"]],n);var c=n,o=c,p=a("2877"),_=Object(p["a"])(o,i,s,!1,null,null,null);t["a"]=_.exports},a1b1:function(e,t,a){"use strict";var i=a("81a9"),s=a("bff7");t["a"]={get_log_list(e){return Object(i["a"])(Object(s["b"])("POST","/audit/get_operation_log_list/",e))}}},ab43:function(e,t,a){"use strict";var i=a("23e7"),s=a("c65b"),r=a("59ed"),l=a("825a"),n=a("46c4"),c=a("c5cc"),o=a("9bdd"),p=a("2a62"),_=a("2baa"),u=a("f99f"),h=a("c430"),d=!h&&!_("map",(function(){})),b=!h&&!d&&u("map",TypeError),f=h||d||b,m=c((function(){var e=this.iterator,t=l(s(this.next,e)),a=this.done=!!t.done;if(!a)return o(e,this.mapper,[t.value,this.counter++],!0)}));i({target:"Iterator",proto:!0,real:!0,forced:f},{map:function(e){l(this);try{r(e)}catch(t){p(this,"throw",t)}return b?s(b,this,e):new m(n(this),{mapper:e})}})},c811:function(e,t,a){"use strict";a("e9f5"),a("910d");var i=function(){var e=this,t=e._self._c;e._self._setupProxy;return t("div",{staticClass:"action-box",style:e.isShowBg?{}:{background:"#fff",padding:0,margin:0,border:"none"}},[t("div",{ref:"search",staticClass:"search-box",class:{fold:!e.isOpen}},[e._l(e.search_option,(function(a,i){return t("div",{key:i,staticClass:"search-input",style:a.width?{width:a.width+"px"}:{}},[a.list&&!a.type?t("el-select",{attrs:{placeholder:a.placeholder,multiple:a.multiple,filterable:a.filter,clearable:""},model:{value:e.search_value[i],callback:function(t){e.$set(e.search_value,i,t)},expression:"search_value[key]"}},e._l(a.list,(function(e,i){return t("el-option",{key:Array.isArray(a.list)?e.type:i,attrs:{label:Array.isArray(a.list)?e.label:e,value:Array.isArray(a.list)?e.type:i}})})),1):e._e(),(a.list||a.type||a.multi)&&"composite"!==a.type?e._e():t("el-input",{staticClass:"composite",style:a.width?{width:a.width+"px"}:{},attrs:{placeholder:a.placeholder,clearable:""},model:{value:e.search_value[i],callback:function(t){e.$set(e.search_value,i,t)},expression:"search_value[key]"}},["composite"===a.type?t("el-select",{attrs:{slot:"prepend",placeholder:"请选择"},slot:"prepend",model:{value:e.search_value[i+"sub"],callback:function(t){e.$set(e.search_value,i+"sub",t)},expression:"search_value[key + 'sub']"}},e._l(a.list,(function(e){return t("el-option",{key:e.type,attrs:{label:e.label,value:e.type}})})),1):e._e()],1),a.multi?t("el-popover",{attrs:{placement:"bottom",width:"250",trigger:"click"}},[t("el-input",{attrs:{type:"textarea",rows:4,placeholder:a.placeholder+"（使用回车或英文逗号隔开）"},model:{value:e.search_value[i],callback:function(t){e.$set(e.search_value,i,t)},expression:"search_value[key]"}}),!a.list&&!a.type||a.multi?t("el-input",{staticClass:"multi_input",style:a.width?{width:a.width+"px"}:{},attrs:{slot:"reference",placeholder:a.placeholder,clearable:""},slot:"reference",model:{value:e.search_value[i],callback:function(t){e.$set(e.search_value,i,t)},expression:"search_value[key]"}}):e._e()],1):e._e(),"datetimerange"===a.type||"daterange"===a.type?[t("date-picker",{ref:"datepicker",refInFor:!0,attrs:{time_option:e.search_option[i]},on:{"fn-emit":function(t){return e.FnGetTime(t,i)}}})]:e._e()],2)})),e.type?e._e():t("div",{staticClass:"m-bottom20"},[t("el-button",{attrs:{type:"primary"},on:{click:e.FnSearch}},[e._v("查 询")]),t("el-button",{attrs:{type:"default"},on:{click:e.FnClear}},[e._v("清 空")])],1)],2),e.type?t("div",{staticClass:"m-bottom5"},[t("el-button",{attrs:{type:"primary"},on:{click:e.FnSearch}},[e._v("查 询")]),"physical"===e.type?t("el-button",{attrs:{type:"primary"},on:{click:e.FnMultiSearch}},[e._v("批量查询")]):e._e(),t("el-button",{attrs:{type:"default"},on:{click:e.FnClear}},[e._v("清 空")]),t("el-button",{staticClass:"m-bottom10",attrs:{type:"text"},on:{click:e.operate}},[e._v(e._s(e.isOpen?"折叠":"展开"))])],1):e._e(),e._t("default",(function(){return[e.create_btn?t("el-button",{attrs:{type:"primary",disabled:e.disabled},on:{click:e.FnShowCreate}},[e._v(e._s(e.create_btn))]):e._e()]})),t("el-dialog",{attrs:{title:"批量查询",visible:e.syncVisible,width:"400px","destroy-on-close":!0,"close-on-click-modal":!1}},[t("el-input",{attrs:{type:"textarea",rows:13,placeholder:"请输入主机ID/名称,格式如下：\nPOD01-CLU01-H001\nPOD01-CLU01-H002\nPOD01-CLU01-H003\n..."},model:{value:e.search_value["host_info"],callback:function(t){e.$set(e.search_value,"host_info",t)},expression:"search_value['host_info']"}}),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"primary"},on:{click:e.FnSearch}},[e._v("确认")]),t("el-button",{on:{click:function(t){e.syncVisible=!1}}},[e._v("取消")])],1)],1)],2)},s=[],r=a("9ab4"),l=a("1b40"),n=a("9a8d");let c=class extends l["e"]{constructor(){super(...arguments),this.search_value={},this.time=null,this.date_key="",this.syncVisible=!1,this.isOpen=!0}FnGetTime(e,t){this.time=e,this.date_key=t}FnSearch(){return this.syncVisible=!1,this.search_value[this.date_key]=this.time,this.search_value}watch_search_option(){this.type&&this.$nextTick(()=>{let e=this.$refs.search,t=window.getComputedStyle(e).height.replace("px","");parseInt(t)>52&&this.isOpen&&(this.isOpen=!1),this.FnOperate()})}FnMultiSearch(){this.syncVisible=!0}operate(){this.isOpen=!this.isOpen,this.FnOperate()}FnOperate(){}FnShowCreate(){}watch_search_value(e,t){}FnClear(){for(let e in this.search_option)["datetimerange","daterange"].includes(this.search_option[e].type)?this.$refs.datepicker[0].FnClear():this.search_value={};this.FnSearch()}mounted(){let e=0;for(let t in this.search_option)this.search_option[t].default_value&&(this.$set(this.search_value,t,this.search_option[t].default_value),e++),"composite"===this.search_option[t].type&&this.$set(this.search_value,t+"sub",this.search_option[t].list[0].type);(e>0||"physical"===this.type)&&setTimeout(()=>{this.FnSearch()},500)}};Object(r["a"])([Object(l["c"])({default:{}})],c.prototype,"search_option",void 0),Object(r["a"])([Object(l["c"])({default:""})],c.prototype,"create_btn",void 0),Object(r["a"])([Object(l["c"])({default:!0})],c.prototype,"disabled",void 0),Object(r["a"])([Object(l["c"])({default:!1})],c.prototype,"type",void 0),Object(r["a"])([Object(l["c"])({default:!0})],c.prototype,"isShowBg",void 0),Object(r["a"])([Object(l["b"])("fn-search")],c.prototype,"FnSearch",null),Object(r["a"])([Object(l["f"])("search_option",{immediate:!0,deep:!0})],c.prototype,"watch_search_option",null),Object(r["a"])([Object(l["b"])("fn-operate")],c.prototype,"FnOperate",null),Object(r["a"])([Object(l["b"])("fn-create")],c.prototype,"FnShowCreate",null),Object(r["a"])([Object(l["f"])("search_value",{immediate:!0,deep:!0})],c.prototype,"watch_search_value",null),c=Object(r["a"])([Object(l["a"])({components:{DatePicker:n["a"]}})],c);var o=c,p=o,_=(a("4774"),a("26f3"),a("2877")),u=Object(_["a"])(p,i,s,!1,null,"20a86f62",null);t["a"]=u.exports}}]);
//# sourceMappingURL=chunk-10c9a8d4.1764156034953.js.map