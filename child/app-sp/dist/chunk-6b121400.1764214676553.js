(window["webpackJsonp_AppSp"]=window["webpackJsonp_AppSp"]||[]).push([["chunk-6b121400"],{"13f1":function(e,t,a){"use strict";var i=a("81a9"),s=a("bff7");function n(e){let t=s["f"];return"gpu"===e&&(t=s["c"]),t}t["a"]={get_cpu(e,t){return Object(i["a"])(n(e)("GET","/cpu_info",t))},get_disk(e,t){return Object(i["a"])(n(e)("GET","/disk_info",t))},get_load(e,t){return Object(i["a"])(n(e)("GET","/load_info",t))},get_memory(e,t){return Object(i["a"])(n(e)("GET","/memory_info",t))},get_network(e,t){return Object(i["a"])(n(e)("GET","/network_info",t))},get_gpu(e,t){return Object(i["a"])(n(e)("GET","/gpu_info",t))},get_disk_info(e,t){return Object(i["a"])(n(e)("GET","/disk_info",t))},get_eip_info(e){return Object(i["a"])(Object(s["b"])("POST","/ecs/eip_monitor_info/",e))}}},a58a:function(e,t,a){"use strict";a("e410")},ac39:function(e,t,a){},cae8:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e._self._c;e._self._setupProxy;return t("div",{staticClass:"monitor"},["monitor"===e.source_name?t("div",[e.$route.path.includes("vm_monitor")?e._e():t("back-header",{attrs:{title:"云服务器监控",back_url:"/instance"}}),t("el-card",{staticClass:"m-bottom20 m-top20",scopedSlots:e._u([{key:"header",fn:function(){return[t("span",[e._v("云服务器详情")])]},proxy:!0}],null,!1,1403309807)},[t("div",{staticClass:"detail-box"},e._l(e.detail_info,(function(a,i){return t("div",{key:i,staticClass:"row"},[t("span",{staticClass:"left-title"},[e._v(e._s(a.label)+":")]),t("span",{domProps:{innerHTML:e._s(a.value)}})])})),0)])],1):e._e(),t("el-card",{staticClass:"tab-card"},[t("el-tabs",{attrs:{type:"card"},model:{value:e.default_tab,callback:function(t){e.default_tab=t},expression:"default_tab"}},e._l(e.tab_list,(function(a,i){return t("el-tab-pane",{key:i,attrs:{label:a,name:i,disabled:"eip"===i&&!e.detail_info.public_net.value}})})),1),e.ecs_info.create_finish_time||e.session.getItem("vm_monitor")?t("time-group",{key:"eip"!==e.default_tab?e.ecs_info.create_finish_time:e.start_time,attrs:{start_time:"eip"!==e.default_tab?e.ecs_info.create_finish_time:e.start_time},on:{"fn-emit":e.FnGetTimer}}):e._e(),"instance"===e.default_tab?t("div",{staticClass:"chart-box"},[t("line-echart",{staticClass:"item",attrs:{chart_id:"cpu_chart",data:e.cpu_used}}),t("line-echart",{staticClass:"item",attrs:{chart_id:"ram_chart",data:e.memory_used}}),"windows"!==e.ecs_info.os_system.toLocaleLowerCase()?t("line-echart",{staticClass:"item",attrs:{chart_id:"system_chart",data:e.system_load}}):e._e()],1):e._e(),"net"===e.default_tab?t("div",{staticClass:"chart-box"},[t("line-echart",{staticClass:"item",attrs:{chart_id:"net_rate_chart",data:e.net_rate}})],1):e._e(),"disk"===e.default_tab?t("div",{staticClass:"chart-box"},[t("line-echart",{staticClass:"item",attrs:{chart_id:"disk_chart",data:e.disk_used}}),t("line-echart",{staticClass:"item",attrs:{chart_id:"disk_through_chart",data:e.disk_bytes}}),t("line-echart",{staticClass:"item",attrs:{chart_id:"disk_iops_chart",data:e.disk_iops}})],1):e._e(),"gpu"===e.default_tab?t("div",{staticClass:"chart-box"},[t("line-echart",{staticClass:"item",attrs:{chart_id:"gpu_chart",data:e.gpu_used}}),t("line-echart",{staticClass:"item",attrs:{chart_id:"gpu_memory_chart",data:e.gpu_memory_used}}),t("line-echart",{staticClass:"item",attrs:{chart_id:"gpu_temperature",data:e.gpu_temperature}}),t("line-echart",{staticClass:"item",attrs:{chart_id:"gpu_frequency",data:e.gpu_frequency}})],1):e._e(),"eip"===e.default_tab?t("div",{staticClass:"chart-box"},[t("line-echart",{staticClass:"item",attrs:{chart_id:"eip_chart",data:e.net_throughput}})],1):e._e()],1)],1)},s=[],n=(a("14d9"),a("e9f5"),a("7d54"),a("ab43"),a("9ab4")),_=a("1b40"),r=a("ed46"),u=a("1f82"),l=a("ff48"),o=a("d772"),c=a("13f1"),d=a("c1df"),h=a.n(d);let m=class extends _["e"]{constructor(){super(...arguments),this.session=sessionStorage,this.source_name="",this.ecs_info={region_id:"",az_id:"",private_net:"",create_finish_time:"",os_system:""},this.detail_info={ecs_name:{label:"实例名称",value:""},ecs_id:{label:"实例ID",value:""},ecs_rule:{label:"云服务器规格",value:""},az_name:{label:"地域及可用区",value:""},system_disk_conf:{label:"系统盘",value:""},os_info:{label:"镜像",value:""},public_net:{label:"公网IP",value:""},private_net:{label:"私网IP",value:""},status:{label:"运行状态",value:""}},this.cpu_used={title:"CPU使用率",unit:"",xTime:[],yValue:[],resize:0},this.memory_used={title:"内存使用率",unit:"",xTime:[],yValue:[],resize:0},this.system_load={title:"系统平均负载",unit:"",xTime:[],yValue:[],resize:0,legend:["1m","5m","15m"]},this.net_in_out={title:"网络流量",unit:"",xTime:[],yValue:[],resize:0,legend:[],line_name:["出网流量","入网流量"],type:"double_line"},this.net_rate={title:"网络吞吐量",unit:"",xTime:[],yValue:[],resize:0,legend:[],line_name:["出网流量速率","入网流量速率"],type:"double_line"},this.disk_used={title:"磁盘使用率",unit:"",xTime:[],yValue:[],resize:0,legend:[]},this.disk_iops={title:"磁盘IOPS",unit:"",xTime:[],yValue:[],resize:0,legend:[],line_name:["读","写"],type:"double_line"},this.disk_bytes={title:"磁盘吞吐量",unit:"",xTime:[],yValue:[],resize:0,legend:[],line_name:["读","写"],type:"double_line"},this.default_tab="",this.tab_list={instance:"主机",net:"网络",disk:"磁盘",gpu:"GPU",eip:"EIP"},this.gpu_used={title:"GPU使用率",unit:"",xTime:[],yValue:[],resize:0},this.gpu_memory_used={title:"显存使用率",unit:"",xTime:[],yValue:[],resize:0},this.gpu_temperature={title:"GPU温度",unit:"",xTime:[],yValue:[],resize:0},this.gpu_frequency={title:"GPU主频",unit:"",xTime:[],yValue:[],resize:0,line_name:["GPU核心频率","显存频率"],type:"double_line"},this.net_throughput={title:"网络吞吐量",unit:"",xTime:[],yValue:[],resize:0,legend:["入网流量速率","出网流量速率"],is_special:!0,qos:""},this.default_date_timer=[],this.eip="",this.start_time=new Date((new Date).setDate((new Date).getDate()-60)).toISOString()}FnGetTimer(e){this.default_date_timer=e,this.FnGetChartData()}FnGetChartData(){let e="",t="",a="",i="",s="",n="kvm";if("monitor"===this.source_name)e=sessionStorage.getItem("vm_monitor")?JSON.parse(sessionStorage.getItem("vm_monitor")).id:this.detail_info.ecs_id.value,t=this.ecs_info.region_id,a=this.ecs_info.az_id,i=this.ecs_info.private_net,s="vm";else{let _=this.$route.query;e=_.id,t=_.region,a=_.az,i=_.ip,s=_.type,n="gpu"}if(!e)return;let _=sessionStorage.getItem("vm_monitor")?JSON.parse(sessionStorage.getItem("vm_monitor")):"",r={hostId:Object.keys(_).length>0?_.hostId:e,region:Object.keys(_).length>0?_.region_id:t,replica:Object.keys(_).length>0?_.replica:a,ip:Object.keys(_).length>0?_.ip:i,instanceType:Object.keys(_).length>0?_.instanceType:s,os:Object.keys(_).length>0?_.os:this.ecs_info.os_system.toLocaleLowerCase(),start:h.a.utc(this.default_date_timer[0]).format("YYYY-MM-DD HH:mm:ss"),end:h.a.utc(this.default_date_timer[1]).format("YYYY-MM-DD HH:mm:ss")},u={eip:this.eip,ecs_id:this.$route.params.id,start_time:h()(this.default_date_timer[0]).format("YYYY-MM-DD HH:mm:ss"),end_time:h()(this.default_date_timer[1]).format("YYYY-MM-DD HH:mm:ss")};"instance"===this.default_tab?(this.FnGetCpu(n,r),this.FnGetMemory(n,r),"windows"!==this.ecs_info.os_system.toLocaleLowerCase()&&this.FnGetLoad(n,r)):"disk"===this.default_tab?this.FnGetDiskInfo(n,r):"net"===this.default_tab?this.FnGetNetInfo(n,r):"gpu"===this.default_tab?this.FnGetGpuInfo(n,r):"eip"===this.default_tab&&this.FnGetEipInfo(u)}async FnGetDetail(){const e=await o["a"].get_detail({ecs_id:this.$route.params.id});if("Success"===e.code){let t=e.data;this.ecs_info={region_id:t.region_id,az_id:t.az_id,private_net:t.pipe.private_net,os_system:t.os_info.system,create_finish_time:h()(new Date(t.create_finish_time)).format()},this.detail_info.ecs_name.value=t.ecs_name,this.detail_info.ecs_id.value=t.ecs_id,this.detail_info.ecs_rule.value=`${t.ecs_rule.name} ${t.ecs_rule.cpu_num}vCPU ${t.ecs_rule.ram}GiB`+(t.is_gpu?`${t.ecs_rule.gpu}*${t.card_name}`:""),this.detail_info.az_name.value=t.az_name,this.detail_info.system_disk_conf.value=`${t.disk.system_disk_conf.disk_name} ${t.disk.system_disk_conf.size}${t.disk.system_disk_conf.unit}`,this.detail_info.os_info.value=`${t.os_info.system} ${t.os_info.version} ${t.os_info.bite}${t.os_info.unit}`;let a=t.pipe;if(this.detail_info.private_net.value=a.private_net+"（主）<br> ",this.detail_info.public_net.value="",a.pub_net){let e=a.eip_info[a.pub_net];this.detail_info.private_net.value+=a.pub_net+(e.conf_name?"（"+e.conf_name+"）":" ")+"默认出网网卡<br>",e.eip_ip&&(this.detail_info.public_net.value=`${e.eip_ip}（${e.conf_name}）<br>`,this.eip=e.eip_ip)}for(let e of a.virtual_net){let t=a.eip_info[e];this.detail_info.private_net.value+=e+(t.conf_name?"（"+t.conf_name+"）":"")+"<br>",t.eip_ip&&(this.detail_info.public_net.value+=`${t.eip_ip}（${t.conf_name}）<br>`),this.eip=t.eip_ip}this.detail_info.status.value=t.status_display,t.is_gpu||_["e"].delete(this.tab_list,"gpu")}}async FnGetCpu(e,t){let a=await c["a"].get_cpu(e,Object.assign({queryType:"use_total"},t));this.FnHandleSingleData("cpu_used",a)}async FnGetMemory(e,t){let a=await c["a"].get_memory(e,Object.assign({queryType:"used"},t));this.FnHandleSingleData("memory_used",a)}FnHandleSingleData(e,t){"Success"===t.code&&(this[e].xTime=t.data.xTime,this[e].yValue=t.data.yValues,this[e].unit=t.data.unit),this[e].resize++}async FnGetLoad(e,t){this.system_load.yValue=[];let a=this.system_load.legend;Promise.all([c["a"].get_load(e,Object.assign({queryType:a[0]},t)),c["a"].get_load(e,Object.assign({queryType:a[1]},t)),c["a"].get_load(e,Object.assign({queryType:a[2]},t))]).then(e=>{this.FnHandleMoreData("system_load",e)})}FnHandleMoreData(e,t){let a=0;t.forEach(t=>{"Success"===t.code&&(0===a&&(this[e].xTime=t.data.xTime,this[e].unit=t.data.unit),this[e].yValue.push(t.data.yValues)),a++}),this[e].resize++}FnGetDiskInfo(e,t){c["a"].get_disk(e,Object.assign({queryType:"use"},t)).then(e=>{"Success"===e.code&&(this.disk_used.xTime=e.data.xTime,this.disk_used.yValue=e.data.yValues,this.disk_used.legend=e.data.metricInfo,this.disk_used.unit=e.data.unit);this.disk_used.resize++}),this.disk_bytes.yValue=[],Promise.all([c["a"].get_disk(e,Object.assign({queryType:"readbytes"},t)),c["a"].get_disk(e,Object.assign({queryType:"writebytes"},t))]).then(e=>{this.FnHandleDubleData("disk_bytes",e)}),this.disk_iops.yValue=[],Promise.all([c["a"].get_disk(e,Object.assign({queryType:"readiops"},t)),c["a"].get_disk(e,Object.assign({queryType:"writeiops"},t))]).then(e=>{this.FnHandleDubleData("disk_iops",e)})}FnHandleDubleData(e,t){let a=0;t.forEach(t=>{"Success"===t.code&&(t.data.metricInfo=t.data.metricInfo||t.data.device||t.data.gpuName,0===a?(this[e].xTime=t.data.xTime,this[e].legend=t.data.metricInfo,this[e].unit=t.data.unit):t.data.metricInfo&&t.data.metricInfo.forEach(t=>{this[e].legend.push(t+this.disk_iops.type)}),t.data.yValues&&(console.log("1",this[e].yValue),this[e].yValue.push(...t.data.yValues),console.log("2",this[e].yValue))),a++}),this[e].resize++,console.log("####",this[e])}FnGetNetInfo(e,t){this.net_in_out.yValue=[],this.net_rate.yValue=[],Promise.all([c["a"].get_network(e,Object.assign({queryType:"networkout_rate"},t)),c["a"].get_network(e,Object.assign({queryType:"networkin_rate"},t))]).then(e=>{this.FnHandleDubleData("net_rate",e)})}FnGetGpuInfo(e,t){this.gpu_used.yValue=[],c["a"].get_gpu(e,Object.assign({queryType:"gpu_usage"},t)).then(e=>{this.FnHandleDubleData("gpu_used",[e])}),this.gpu_memory_used.yValue=[],c["a"].get_gpu(e,Object.assign({queryType:"memory_usage"},t)).then(e=>{this.FnHandleDubleData("gpu_memory_used",[e])}),this.gpu_temperature.yValue=[],c["a"].get_gpu(e,Object.assign({queryType:"temperature"},t)).then(e=>{this.FnHandleDubleData("gpu_temperature",[e])}),this.gpu_frequency.yValue=[],Promise.all([c["a"].get_gpu(e,Object.assign({queryType:"gpu_clocks_graphics"},t)),c["a"].get_gpu(e,Object.assign({queryType:"gpu_clocks_memory"},t))]).then(e=>{this.FnHandleDubleData("gpu_frequency",e)}),this.gpu_frequency.yValue=[],Promise.all([c["a"].get_gpu(e,Object.assign({queryType:"gpu_clocks_graphics"},t)),c["a"].get_gpu(e,Object.assign({queryType:"gpu_clocks_memory"},t))]).then(e=>{console.log("resData",e),e.map(e=>(e.data.yValues&&e.data.yValues.length>0&&(e.data.yValues=[e.data.yValues]),e)),this.FnHandleDubleData("gpu_frequency",e)})}FnGetEipInfo(e){this.net_throughput.yValue=[],c["a"].get_eip_info(e).then(e=>{this.net_throughput.unit=e.data.unit,this.net_throughput.xTime=e.data.time,this.net_throughput.yValue=[e.data.in_bps,e.data.out_bps],this.net_throughput.qos=e.data.qos,this.net_throughput.resize++})}created(){if(this.default_tab=Object.keys(this.tab_list)[0],this.source_name=this.$route.name,sessionStorage.getItem("vm_monitor")){_["e"].delete(this.tab_list,"gpu");let e=JSON.parse(sessionStorage.getItem("vm_monitor"));this.detail_info.ecs_name.value=e.transfer_vm_name,this.detail_info.ecs_id.value=e.transfer_vm_id,this.detail_info.az_name.value=e.region_name+"-"+e.az_name,this.detail_info.system_disk_conf.value=e.transfer_vm_conf_system_disk_type?`${e.transfer_vm_conf_system_disk_type}  ${e.transfer_vm_conf_system_disk_size}${e.transfer_vm_conf_system_disk_unit}`:"",this.detail_info.os_info.value=e.transfer_vm_image,this.detail_info.private_net.value=`${e.transfer_vm_vpc_ip}（vpc ip）<br> ${e.transfer_vm_storage_ip}（存储网 ip）`,this.detail_info.status.value=e.status_cn}"monitor"!==this.source_name||sessionStorage.getItem("vm_monitor")||this.FnGetDetail()}destroyed(){sessionStorage.removeItem("vm_monitor")}FnChangeTab(e,t){t&&this.FnGetChartData()}};Object(n["a"])([Object(_["f"])("default_tab")],m.prototype,"FnChangeTab",null),m=Object(n["a"])([Object(_["a"])({components:{BackHeader:r["a"],TimeGroup:u["a"],LineEchart:l["a"]}})],m);var p=m,f=p,y=(a("e0e4"),a("fd10"),a("2877")),g=Object(y["a"])(f,i,s,!1,null,"c92f689c",null);t["default"]=g.exports},d447:function(e,t,a){},d772:function(e,t,a){"use strict";var i=a("81a9"),s=a("bff7");t["a"]={get_operate_record_list(e){return Object(i["a"])(Object(s["b"])("GET","/ecs/history_record/",e))},get_detail(e){return Object(i["a"])(Object(s["b"])("GET","/ecs/get_ecs_detail/",e))}}},e0e4:function(e,t,a){"use strict";a("ac39")},e410:function(e,t,a){},ed46:function(e,t,a){"use strict";var i=function(){var e=this,t=e._self._c;e._self._setupProxy;return t("div",[t("div",{staticClass:"box"},[t("div",[t("span",[e._v(e._s(e.title))]),e._t("left")],2),t("div",[e._t("default"),e.no_back?e._e():t("el-button",{attrs:{type:"primary",plain:""},on:{click:e.FnBack}},[e._v("返回")])],2)]),t("div",{staticClass:"perch"})])},s=[],n=(a("14d9"),a("9ab4")),_=a("1b40");let r=class extends _["e"]{FnBack(){this.back_url?this.$router.push(this.back_url):this.$router.go(-1)}};Object(n["a"])([Object(_["c"])({default:""})],r.prototype,"title",void 0),Object(n["a"])([Object(_["c"])({default:""})],r.prototype,"back_url",void 0),Object(n["a"])([Object(_["c"])({default:!1})],r.prototype,"no_back",void 0),r=Object(n["a"])([_["a"]],r);var u=r,l=u,o=(a("a58a"),a("2877")),c=Object(o["a"])(l,i,s,!1,null,"bdf5ebe2",null);t["a"]=c.exports},fd10:function(e,t,a){"use strict";a("d447")}}]);
//# sourceMappingURL=chunk-6b121400.1764214676553.js.map