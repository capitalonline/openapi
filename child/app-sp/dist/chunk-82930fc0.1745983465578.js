(window["webpackJsonp_AppSp"]=window["webpackJsonp_AppSp"]||[]).push([["chunk-82930fc0"],{"380c":function(e,t,r){"use strict";r("fa25")},"3fa7":function(e,t,r){"use strict";var a=r("2b0e");t["a"]=new a["default"]},"58d1":function(e,t,r){"use strict";var a=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("el-dialog",{staticClass:"clusterBox",attrs:{title:e.isCreate?"新建集群":"编辑集群",visible:e.visible_sync,"destroy-on-close":!0,"close-on-click-modal":!1,width:"800px","append-to-body":""},on:{"update:visible":function(t){e.visible_sync=t},close:e.cancel}},[r("el-form",{ref:"createForm",staticClass:"demo-ruleForm",attrs:{model:e.form_data,rules:e.rules,"label-width":"170px","label-position":"left","label-suffix":":"}},[r("el-form-item",{attrs:{label:"集群名称",prop:"cluster_name"}},[r("el-input",{attrs:{type:"textarea",autosize:"",resize:"none",maxlength:100,"show-word-limit":""},model:{value:e.form_data.cluster_name,callback:function(t){e.$set(e.form_data,"cluster_name",t)},expression:"form_data.cluster_name"}})],1),r("el-form-item",{attrs:{label:"所属POD"}},[r("el-select",{attrs:{filterable:"",disabled:!e.isCreate&&e.oper_info&&e.oper_info.length>0&&0!==e.oper_info[0].host_count},model:{value:e.form_data.father_pod,callback:function(t){e.$set(e.form_data,"father_pod",t)},expression:"form_data.father_pod"}},e._l(e.pod_list,(function(e){return r("el-option",{key:e.pod_id,attrs:{label:e.pod_name,value:e.pod_id}})})),1)],1),r("el-form-item",{attrs:{label:"CPU品牌"}},[r("el-select",{attrs:{disabled:!e.isCreate&&e.oper_info&&e.oper_info.length>0&&0!==e.oper_info[0].host_count},on:{change:e.changeCpuBrand},model:{value:e.form_data.cpu_brand,callback:function(t){e.$set(e.form_data,"cpu_brand",t)},expression:"form_data.cpu_brand"}},e._l(e.cpu_brand_list,(function(e){return r("el-option",{key:e,attrs:{label:e,value:e}})})),1)],1),r("el-form-item",{attrs:{label:"CPU型号",prop:"cpu_model"}},[r("el-select",{staticClass:"noInput",attrs:{filterable:"",multiple:""},model:{value:e.form_data.cpu_model,callback:function(t){e.$set(e.form_data,"cpu_model",t)},expression:"form_data.cpu_model"}},e._l(e.cpu_model_list,(function(t){return r("el-option",{key:t.id,attrs:{label:t.real_name,value:t.id,disabled:e.FnSelectedCpus(t)}})})),1)],1),r("el-form-item",{attrs:{label:"GPU型号"}},[r("el-select",{attrs:{filterable:"",disabled:!e.isCreate&&e.oper_info&&e.oper_info.length>0&&0!==e.oper_info[0].host_count,clearable:""},model:{value:e.form_data.gpu_model,callback:function(t){e.$set(e.form_data,"gpu_model",t)},expression:"form_data.gpu_model"}},e._l(e.gpu_model_list,(function(e,t){return r("el-option",{key:t,attrs:{label:e.real_name,value:e.id}})})),1)],1),r("el-form-item",{attrs:{label:"虚拟机存储类型"}},[r("el-select",{attrs:{disabled:!e.isCreate&&e.oper_info&&e.oper_info.length>0&&0!==e.oper_info[0].host_count},model:{value:e.form_data.storage_type,callback:function(t){e.$set(e.form_data,"storage_type",t)},expression:"form_data.storage_type"}},e._l(e.storage_type_list,(function(e){return r("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1),"block"===e.form_data.storage_type?r("el-form-item",{attrs:{label:"块存储集群",prop:"block_storage_cluster"}},[r("el-select",{attrs:{"value-key":"id",disabled:!e.isCreate&&e.oper_info&&e.oper_info.length>0&&0!==e.oper_info[0].host_count,clearable:""},model:{value:e.form_data.block_storage_cluster,callback:function(t){e.$set(e.form_data,"block_storage_cluster",t)},expression:"form_data.block_storage_cluster"}},e._l(e.storage_cluster_list,(function(e){return r("el-option",{key:e.id,attrs:{label:e.name,value:e}})})),1)],1):e._e(),r("el-form-item",{attrs:{label:"最大物理机数",prop:"max_host_number"}},[r("el-input-number",{attrs:{"controls-position":"right",min:!e.isCreate&&e.oper_info&&e.oper_info.length>0?e.oper_info[0].host_count:1,max:100},model:{value:e.form_data.max_host_number,callback:function(t){e.$set(e.form_data,"max_host_number",t)},expression:"form_data.max_host_number"}})],1)],1),r("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{attrs:{type:"primary"},on:{click:e.confirm}},[e._v("确 定")]),r("el-button",{on:{click:e.cancel}},[e._v("取 消")])],1)],1)},o=[],n=r("1da1"),s=r("5530"),i=r("d4ec"),l=r("bee2"),c=r("262e"),_=r("2caf"),u=(r("96cf"),r("d9e2"),r("caad"),r("2532"),r("b0c0"),r("9ab4")),d=r("1b40"),p=r("da8b"),f=r("3fa7"),m=function(e){Object(c["a"])(r,e);var t=Object(_["a"])(r);function r(){var e;return Object(i["a"])(this,r),e=t.apply(this,arguments),e.pod_list=[],e.cpu_brand_list=["Intel","AMD"],e.cpu_model_list=[],e.gpu_model_list=[],e.storage_cluster_list=[],e.storage_type_list=[{id:"local",name:"本地盘"},{id:"block",name:"云盘"}],e.form_data={cluster_name:"",father_pod:"",cpu_brand:e.cpu_brand_list[0],cpu_model:"",gpu_model:"",block_storage_cluster:{id:"",name:""},max_host_number:"50",storage_type:"block"},e.rules={cluster_name:[{required:!0,message:"请输入集群名称",trigger:"change"}],cpu_model:[{required:!0,message:"请选择CPU品牌",trigger:"change"}],max_host_number:[{required:!0,message:"请输入最大物理机数",trigger:"change"}],block_storage_cluster:[{required:!0,validator:e.validate_name,trigger:"blur"}]},e}return Object(l["a"])(r,[{key:"validate_name",value:function(e,t,r){if(!t&&"block"===this.form_data.storage_type)return r(new Error("请选择块存储集群"));r()}},{key:"FnGetInfo",value:function(e){var t={cluster_name:"",father_pod:"",cpu_brand:this.cpu_brand_list[0],cpu_model:"",gpu_model:"",block_storage_cluster:{id:"",name:""},max_host_number:"50",storage_type:"block"};e&&!this.isCreate&&(this.form_data=Object(s["a"])(Object(s["a"])({},t),{},{cluster_name:this.oper_info[0].cluster_name,block_storage_cluster:{id:this.oper_info[0].storage_cluster_id,name:this.oper_info[0].storage_cluster_name},max_host_number:this.oper_info[0].max_host_count,cpu_brand:this.oper_info[0].cpu_brand,storage_type:this.oper_info[0].backend_type})),e?(this.get_pod_list(),this.get_storage_cluster_info(),this.getModelInfoList("cpu",!1),this.getModelInfoList("gpu",!1)):this.form_data=Object(s["a"])({},t)}},{key:"FnSelectedCpus",value:function(e){var t=!1;if(this.oper_info&&this.oper_info[0]){var r=this.oper_info[0].cpu_type_id;t=Array.isArray(r)&&r.includes(String(e.id))}var a=this.oper_info&&this.oper_info.length>0&&0!==this.oper_info[0].host_count;return!(!t||!a)}},{key:"get_pod_list",value:function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,p["a"].get_pod_list({az_name:this.$store.state.az_list.az_name});case 2:t=e.sent,"Success"===t.code&&(this.pod_list=t.data.pod_list,this.form_data.father_pod=this.isCreate&&this.pod_list[0]?this.pod_list[0].pod_id:this.oper_info[0].pod_id);case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"get_storage_cluster_info",value:function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,p["a"].get_storage_cluster_info({az_id:this.$store.state.az_id,az_code:this.$store.state.az_list.az_code});case 2:t=e.sent,"Success"===t.code&&(this.storage_cluster_list=t.data.clusters,this.isCreate?this.form_data.block_storage_cluster="":(this.form_data.block_storage_cluster.name=this.oper_info[0].storage_cluster_name,this.form_data.block_storage_cluster.id=this.oper_info[0].storage_cluster_id));case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"getModelInfoList",value:function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(t,r){var a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,p["a"].get_model_info_list({handle_type:t,cpu_brand:this.form_data.cpu_brand});case 2:a=e.sent,"Success"===a.code&&("cpu"===t?(this.cpu_model_list=a.data.model_info_list,this.isCreate||r?this.cpu_model_list.length>0?this.form_data.cpu_model=[this.cpu_model_list[0].id]:this.form_data.cpu_model="":this.form_data.cpu_model=this.oper_info[0].cpu_type_id):"gpu"===t&&(this.gpu_model_list=a.data.model_info_list,this.form_data.gpu_model=(this.isCreate,this.oper_info[0].gpu_type_id)));case 4:case"end":return e.stop()}}),e,this)})));function t(t,r){return e.apply(this,arguments)}return t}()},{key:"changeCpuBrand",value:function(){this.getModelInfoList("cpu",!0)}},{key:"confirm",value:function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(){var t,r=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:t=this.$refs.createForm,t.validate(function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(t){var a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(console.log("===="),!t){e.next=6;break}return e.next=4,(r.isCreate?p["a"].create_cluster:p["a"].update_cluster)({az_id:r.$store.state.az_id,cluster_id:r.oper_info[0]?r.oper_info[0].cluster_id:void 0,cluster_name:r.form_data.cluster_name,father_pod_id:r.form_data.father_pod,cpu_brand:r.form_data.cpu_brand,cpu_type_id:r.form_data.cpu_model,gpu_type_id:r.form_data.gpu_model,storage_cluster_id:"block"===r.form_data.storage_type?r.form_data.block_storage_cluster.id:void 0,storage_cluster_name:"block"===r.form_data.storage_type?r.form_data.block_storage_cluster.name:void 0,max_host_count:r.form_data.max_host_number,backend_type:r.form_data.storage_type});case 4:a=e.sent,"Success"===a.code&&(r.$message.success(a.message),r.cancel(),f["a"].$emit("getTreeData",!1));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 2:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"cancel",value:function(){this.visible_sync=!1}}]),r}(d["e"]);Object(u["a"])([Object(d["d"])("visible")],m.prototype,"visible_sync",void 0),Object(u["a"])([Object(d["c"])({default:function(){return[]}})],m.prototype,"oper_info",void 0),Object(u["a"])([Object(d["c"])({default:!1})],m.prototype,"isCreate",void 0),Object(u["a"])([Object(d["f"])("visible")],m.prototype,"FnGetInfo",null),m=Object(u["a"])([Object(d["a"])({})],m);var b=m,h=b,g=(r("380c"),r("2877")),v=Object(g["a"])(h,a,o,!1,null,null,null);t["a"]=v.exports},a3ec:function(e,t,r){},a864:function(e,t,r){"use strict";r("a3ec")},bd4d:function(e,t,r){"use strict";var a=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{attrs:{id:"menu"}},[r("ul",[r("div",{staticClass:"tip"},[e._v(" 操作-"+e._s(e.tipText))]),e._l(e.filteredMenus,(function(t,a){return e.multi_rows.length>1&&!t.single||1===e.multi_rows.length?r("li",{key:a,on:{click:function(r){return r.stopPropagation(),e.FnClick(t)}}},[t.disabled?r("el-tooltip",{attrs:{effect:"light",placement:"left",content:e.disabledTooltipContent(t)}},[r("span",{staticClass:"disabled"},[e._v(" "+e._s(t.label)+" ")])]):r("span",[e._v(" "+e._s(t.label)+" ")]),t.list?r("span",[r("i",{staticClass:"el-icon-arrow-right",staticStyle:{float:"right","margin-top":"7px","font-size":"15px"}}),r("ul",e._l(t.list,(function(t){return r("li",{key:t.value,on:{click:function(r){return r.stopPropagation(),e.FnClick(t)}}},[t.disabled?r("el-tooltip",{attrs:{effect:"light",placement:"left",content:e.disabledTooltipContent(t)}},[r("span",{staticClass:"disabled"},[e._v(" "+e._s(t.label)+" ")])]):r("span",[e._v(" "+e._s(t.label)+" ")])],1)})),0)]):e._e()],1):e._e()}))],2)])},o=[],n=r("d4ec"),s=r("bee2"),i=r("262e"),l=r("2caf"),c=(r("b0c0"),r("4de4"),r("d3b7"),r("9ab4")),_=r("1b40"),u=r("58d1"),d=function(e){Object(i["a"])(r,e);var t=Object(l["a"])(r);function r(){var e;return Object(n["a"])(this,r),e=t.apply(this,arguments),e.operate_auth=[],e.msg={},e.visibleSubMenus={},e}return Object(s["a"])(r,[{key:"watch_error_msg",value:function(e){this.msg=e}},{key:"tipText",get:function(){return this.multi_rows.length>1?"".concat(this.multi_rows.length,"个对象"):this.name}},{key:"filteredMenus",get:function(){var e=this;return 0===this.multi_rows.length?[]:this.menus.filter((function(t){return e.multi_rows.length>1&&!t.single||1===e.multi_rows.length}))}},{key:"created",value:function(){this.msg=this.error_msg}},{key:"disabledTooltipContent",value:function(e){return this.msg&&this.msg[e.value]?this.msg[e.value]:"此状态无法操作或无操作权限"}},{key:"FnClick",value:function(e){return e}}]),r}(_["e"]);Object(c["a"])([Object(_["c"])({default:function(){return[]}})],d.prototype,"multi_rows",void 0),Object(c["a"])([Object(_["c"])({default:function(){return[]}})],d.prototype,"menus",void 0),Object(c["a"])([Object(_["c"])({default:function(){}})],d.prototype,"error_msg",void 0),Object(c["a"])([Object(_["c"])({default:""})],d.prototype,"name",void 0),Object(c["a"])([Object(_["f"])("error_msg")],d.prototype,"watch_error_msg",null),Object(c["a"])([Object(_["b"])("fn-click")],d.prototype,"FnClick",null),d=Object(c["a"])([Object(_["a"])({components:{CreateCluster:u["a"]}})],d);var p=d,f=p,m=(r("a864"),r("2877")),b=Object(m["a"])(f,a,o,!1,null,"4f5ac217",null);t["a"]=b.exports},cf88:function(e,t,r){"use strict";function a(){console.log("----######");var e=document.querySelector("#menu");e&&(e.style.display="none",document.removeEventListener("click",a))}r.d(t,"a",(function(){return a}))},d81d:function(e,t,r){"use strict";var a=r("23e7"),o=r("b727").map,n=r("1dde"),s=n("map");a({target:"Array",proto:!0,forced:!s},{map:function(e){return o(this,e,arguments.length>1?arguments[1]:void 0)}})},da8b:function(e,t,r){"use strict";var a=r("81a9"),o=r("bff7");t["a"]={get_pod_outline:function(e){return Object(a["a"])(Object(o["b"])("GET","/pod/get_pod_outline/",e))},get_pod_cluster_list:function(e){return Object(a["a"])(Object(o["b"])("GET","/pod/get_pod_cluster_list/",e))},get_cluster_field:function(){return Object(a["a"])(Object(o["b"])("GET","/pod/get_cluster_field/"))},get_pod_host_field:function(){return Object(a["a"])(Object(o["b"])("GET","/pod/get_pod_host_field/"))},get_pod_host_list:function(e){return Object(a["a"])(Object(o["b"])("POST","/pod/get_pod_host_list/",e))},create_cluster:function(e){return Object(a["a"])(Object(o["b"])("POST","/cluster/create_cluster/",e))},update_cluster:function(e){return Object(a["a"])(Object(o["b"])("POST","/cluster/update_cluster/",e))},delete_cluster:function(e){return Object(a["a"])(Object(o["b"])("POST","/cluster/delete_cluster/",e))},get_pod_list:function(e){return Object(a["a"])(Object(o["b"])("GET","/pod/get_pod_list/",e))},get_model_info_list:function(e){return Object(a["a"])(Object(o["b"])("GET","/cluster/get_model_info_list/",e))},get_storage_cluster_info:function(e){return Object(a["a"])(Object(o["b"])("GET","/cluster/get_storage_cluster_info/",e))},get_status_list:function(e){return Object(a["a"])(Object(o["d"])("GET","/host/host_status_list/",e))},recommend_cluster:function(e){return Object(a["a"])(Object(o["d"])("POST","/host/recommend_cluster/",e))},add_cluster:function(e){return Object(a["a"])(Object(o["d"])("POST","/host/host_add_cluster/",e))},set_cluster_prepare_host:function(e){return Object(a["a"])(Object(o["d"])("POST","/cluster/set_cluster_prepare_host_count/",e))},add_host_label:function(e){return Object(a["a"])(Object(o["d"])("POST","/host/add_host_label/",e))},get_label_list:function(e){return Object(a["a"])(Object(o["d"])("GET","/host/get_label_list/",e))},get_all_host_label:function(e){return Object(a["a"])(Object(o["d"])("GET","/host/get_all_host_label/",e))}}},fa25:function(e,t,r){}}]);
//# sourceMappingURL=chunk-82930fc0.1745983465578.js.map