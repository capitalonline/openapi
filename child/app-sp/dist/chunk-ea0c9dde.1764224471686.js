(window["webpackJsonp_AppSp"]=window["webpackJsonp_AppSp"]||[]).push([["chunk-ea0c9dde"],{"6d32":function(t,e,i){"use strict";i("f40a")},"9d75":function(t,e,i){"use strict";i.r(e);var a=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",[e("action-block",{attrs:{search_option:t.search},on:{"fn-search":t.fn_search}}),e("time-group",{on:{"fn-emit":t.getTabTime}}),e("el-table",{ref:"table",staticClass:"event-table",attrs:{data:t.list,border:""},on:{"filter-change":t.fil_info,"selection-change":t.handleSelectionChange}},[e("el-table-column",{attrs:{type:"selection"}}),e("el-table-column",{attrs:{prop:"productType",label:"产品类型"}}),e("el-table-column",{attrs:{prop:"instanceID",label:"故障资源ID"}}),e("el-table-column",{attrs:{prop:"createTime",label:"发生时间"},scopedSlots:t._u([{key:"default",fn:function(i){return[e("span",[t._v(t._s(i.row.createTime?t.moment(i.row.createTime).format("YYYY-MM-DD HH:mm:ss"):"--"))])]}}])}),e("el-table-column",{attrs:{prop:"durationTime",label:"持续时间"},scopedSlots:t._u([{key:"default",fn:function(i){return[e("span",{staticClass:"m-right10"},[t._v(t._s(i.row.metricPeriodNum?i.row.metricPeriodNum+"个周期":"-"))]),e("span",[t._v(t._s(i.row.metricPeriod?60===i.row.metricPeriod?"1小时1周期":i.row.metricPeriod+"分钟1周期":"-"))])]}}])}),e("el-table-column",{attrs:{prop:"strategyName",label:"策略名称"}}),e("el-table-column",{attrs:{prop:"ruleName",label:"规则名称"}}),e("el-table-column",{attrs:{prop:"alarmType",label:"报警类型"},scopedSlots:t._u([{key:"default",fn:function(i){return[""!==i.row.alarmType?e("span",[t._v(t._s("metric"===i.row.alarmType?"指标报警":"事件报警"))]):e("span",[t._v("--")])]}}])}),e("el-table-column",{attrs:{prop:"contactGroup",label:"通知对象"},scopedSlots:t._u([{key:"default",fn:function(i){return[e("span",[t._v(t._s(i.row.contactGroup.join(",")))]),e("i",{staticClass:"el-icon-document",on:{click:function(e){return t.view_contact(i.row.notyfyList)}}})]}}])}),e("el-table-column",{attrs:{prop:"alarmMethod",label:"通知方式"},scopedSlots:t._u([{key:"default",fn:function(i){return[e("span",[t._v(t._s(2===i.row.alarmMethod.length?"邮箱+短信":t.notice[i.row.alarmMethod[0]]))])]}}])}),e("el-table-column",{attrs:{prop:"dealStatus",label:"处理结果",filters:t.fil_list,"filter-multiple":!1,"filter-placement":"bottom-end","column-key":"dealStatus"},scopedSlots:t._u([{key:"default",fn:function(i){return[e("span",[t._v(t._s(i.row.dealStatus?"已处理":"未处理"))])]}}])}),e("el-table-column",{attrs:{prop:"action",label:"操作栏"},scopedSlots:t._u([{key:"default",fn:function(i){return[e("el-button",{attrs:{type:"text"},on:{click:function(e){return t.detail(i.row)}}},[t._v("详情")]),e("el-button",{attrs:{type:"text",disabled:1===i.row.enable},on:{click:function(e){return t.shield(i.row)}}},[t._v("屏蔽")]),e("el-button",{attrs:{type:"text",disabled:!i.row.shieldID||0===i.row.enable},on:{click:function(e){return t.stopShield(i.row)}}},[t._v("停止屏蔽")])]}}])})],1),e("el-pagination",{attrs:{"current-page":t.current,"page-sizes":[20,50,100],"page-size":t.size,layout:"total, sizes, prev, pager, next, jumper",total:t.total},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}}),t.visible?[e("notice-contact",{attrs:{visible:t.visible,list:t.notice_list},on:{"update:visible":function(e){t.visible=e}}})]:t._e(),t.operateVisible&&"detail"===t.operateType?[e("info-detail",{attrs:{visible:t.operateVisible,info:t.info},on:{"update:visible":function(e){t.operateVisible=e}}})]:t._e(),t.operateVisible&&"shield"===t.operateType?[e("info-shield",{attrs:{visible:t.operateVisible,info:t.info},on:{"update:visible":function(e){t.operateVisible=e}}})]:t._e(),e("right-click",{attrs:{multi_rows:t.multi_rows,menus:t.menus,name:t.multi_rows.length>0?t.multi_rows[0].instanceID:""},on:{"fn-click":t.infoClick}})],2)},s=[],l=(i("e9f5"),i("a732"),i("9ab4")),n=i("1b40"),o=i("c811"),r=i("1f82"),c=i("c1df"),u=i.n(c),h=i("2966"),d=i("8ce4"),p=i("5cb2"),m=i("18c0"),f=i("b520"),b=i("e8c0"),_=i("bd4d"),g=i("cf88");let w=class extends n["e"]{constructor(){super(...arguments),this.notice={email:"邮箱",phone:"短信"},this.type_list=[{type:"metric",label:"指标报警"},{type:"event",label:"事件报警"}],this.search={ruleName:{placeholder:"请输入规则名称"},instanceID:{placeholder:"请输入资源ID"},type:{placeholder:"报警类型",list:this.type_list},contact:{placeholder:"报警联系人组",list:[]},strategyName:{placeholder:"请输入策略名称"}},this.authList=[],this.fil_list=[{text:"已处理",value:"1"},{text:"未处理",value:"0"}],this.list=[],this.current=1,this.size=20,this.total=0,this.moment=u.a,this.search_data={},this.dealStatus=[],this.visible=!1,this.operateVisible=!1,this.operateType="",this.notice_list=[],this.info={},this.multi_rows=[],this.menus=[{label:"详情",value:"infoDetail",single:!0,disabled:!1},{label:"屏蔽",value:"alarm_create",single:!0,disabled:!1},{label:"停止屏蔽",value:"stop",single:!0,disabled:!1}]}created(){this.getContactGroupList(),this.authList=this.$store.state.auth_info[this.$route.name]}FnOperRow(t){this.$refs.table.toggleRowSelection(t)}rowStyle({row:t}){const e=this.multi_rows.some(e=>e.id===t.id);if(e)return"rowStyle"}FnRightClick(t,e,i){const a=this.multi_rows.some(e=>e.id===t.id);a||this.$refs.table.toggleRowSelection(t),Object(b["a"])(t,e,i)}infoClick(t){const{label:e,value:i}=t;"infoDetail"===i?this.detail(this.multi_rows[0]):"alarm_create"===i?this.shield(this.multi_rows[0]):this.stopShield(this.multi_rows[0]),Object(g["a"])()}async getContactGroupList(){let t=await h["a"].get_contact_group_list({});"Success"===t.code&&(this.search.contact.list=Object(d["e"])(t.data.datas,"name","id","label","type"))}handleSelectionChange(t){this.multi_rows=t}async getAlarmList(){const{search_data:t}=this;let e=await h["a"].get_alarm_list({ruleName:t.ruleName,instanceID:t.instanceID,alarmType:t.type,contactGroupName:t.contact,strategyName:t.strategyName,startTime:t.time?u()(t.time[0]).format("YYYY-MM-DD HH:mm:ss"):u()(new Date).format("YYYY-MM-DD 00:00:00"),endTime:t.time?u()(t.time[1]).format("YYYY-MM-DD HH:mm:ss"):u()(new Date).format("YYYY-MM-DD HH:mm:ss"),dealStatus:0===this.dealStatus.length?"":this.dealStatus[0],page:this.current,pageSize:this.size,clusterID:this.$route.params.id});"Success"===e.code&&(this.list=e.data.datas||[],this.total=e.data.total||0)}view_contact(t){this.visible=!0,this.notice_list=t}fn_search(t={}){this.current=1,this.search_data={...this.search_data,...t},this.getAlarmList()}handleSizeChange(t){this.size=t,this.getAlarmList()}handleCurrentChange(t){this.current=t,this.getAlarmList()}getTabTime(t){this.search_data.time=t,this.getAlarmList()}fil_info(t){this.dealStatus=t.dealStatus,this.current=1,this.getAlarmList()}detail(t){this.info=t,this.operateType="detail",this.operateVisible=!0}shield(t){this.info=t,this.operateType="shield",this.operateVisible=!0}stopShield(t){const e=this.$createElement;this.$msgbox({title:"提示",message:e("p",null,[e("span",null,"确定停止 "),e("i",{style:"color: #455cc6"},t.shieldName+" "),e("span",null," 屏蔽策略吗? ")]),showCancelButton:!0,confirmButtonText:"确定",cancelButtonText:"取消"}).then(async e=>{let i=await h["a"].shield_apply({ids:[t.shieldID],enable:0});"Success"===i.code&&(this.$message.success(i.message),this.getAlarmList())})}watchOperateVisible(t){t||this.getAlarmList()}};Object(l["a"])([Object(n["f"])("operateVisible")],w.prototype,"watchOperateVisible",null),w=Object(l["a"])([Object(n["a"])({components:{RightClick:_["a"],ActionBlock:o["a"],TimeGroup:r["a"],NoticeContact:p["a"],InfoDetail:m["a"],InfoShield:f["a"]}})],w);var y=w,v=y,S=(i("6d32"),i("2877")),k=Object(S["a"])(v,a,s,!1,null,"3974f308",null);e["default"]=k.exports},e8c0:function(t,e,i){"use strict";i.d(e,"a",(function(){return s}));var a=i("cf88");function s(t,e,i){i.preventDefault(),document.addEventListener("contextmenu",t=>{const e=t.target;if(e.closest(".el-table")){let e=document.querySelector("#menu");if(e){e.style.display="block";let i=e.offsetHeight,s=e.offsetWidth;console.log("menuHeight",i);let l=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,n=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,o=t.clientX,r=t.clientY,c=o,u=r;n<o+s&&(c=o-s),l<r+i&&(u=l-i),e.style.left=c-250+"px",e.style.top=u-50+"px",e.style.display="block",e.style.zIndex="1000",document.addEventListener("click",a["a"])}}}),document.addEventListener("contextmenu",a["a"])}},f40a:function(t,e,i){}}]);
//# sourceMappingURL=chunk-ea0c9dde.1764224471686.js.map