(window["webpackJsonp_AppSp"]=window["webpackJsonp_AppSp"]||[]).push([["chunk-124d6606"],{"23e6":function(e,t,a){},"56e0":function(e,t,a){},"5d74":function(e,t,a){"use strict";a("23e6")},6253:function(e,t,a){},"6d07":function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e._self._c;e._self._setupProxy;return t("el-tabs",{model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[t("el-tab-pane",{attrs:{label:"报警信息",name:"1"}},["1"===e.activeName?[t("info")]:e._e()],2),t("el-tab-pane",{attrs:{label:"屏蔽管理",name:"2"}},["2"===e.activeName?[t("shield")]:e._e()],2)],1)},s=[],l=a("9ab4"),n=a("1b40"),o=function(){var e=this,t=e._self._c;e._self._setupProxy;return t("div",[t("action-block",{attrs:{search_option:e.search},on:{"fn-search":e.fn_search}}),t("time-group",{on:{"fn-emit":e.getTabTime}}),t("el-table",{staticClass:"event-table",attrs:{data:e.list,border:""},on:{"filter-change":e.fil_info}},[t("el-table-column",{attrs:{prop:"productType",label:"产品类型"}}),t("el-table-column",{attrs:{prop:"instanceID",label:"故障资源ID"}}),t("el-table-column",{attrs:{prop:"createTime",label:"发生时间"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("span",[e._v(e._s(a.row.createTime?e.moment(a.row.createTime).format("YYYY-MM-DD HH:mm:ss"):"--"))])]}}])}),t("el-table-column",{attrs:{prop:"durationTime",label:"持续时间"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("span",{staticClass:"m-right10"},[e._v(e._s(a.row.metricPeriodNum?a.row.metricPeriodNum+"个周期":"-"))]),t("span",[e._v(e._s(a.row.metricPeriod?60===a.row.metricPeriod?"1小时1周期":a.row.metricPeriod+"分钟1周期":"-"))])]}}])}),t("el-table-column",{attrs:{prop:"strategyName",label:"策略名称"}}),t("el-table-column",{attrs:{prop:"ruleName",label:"规则名称"}}),t("el-table-column",{attrs:{prop:"alarmType",label:"报警类型"},scopedSlots:e._u([{key:"default",fn:function(a){return[""!==a.row.alarmType?t("span",[e._v(e._s("metric"===a.row.alarmType?"指标报警":"事件报警"))]):t("span",[e._v("--")])]}}])}),t("el-table-column",{attrs:{prop:"contactGroup",label:"通知对象"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("span",[e._v(e._s(a.row.contactGroup.join(",")))]),t("i",{staticClass:"el-icon-document",on:{click:function(t){return e.view_contact(a.row.notyfyList)}}})]}}])}),t("el-table-column",{attrs:{prop:"alarmMethod",label:"通知方式"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("span",[e._v(e._s(2===a.row.alarmMethod.length?"邮箱+短信":e.notice[a.row.alarmMethod[0]]))])]}}])}),t("el-table-column",{attrs:{prop:"dealStatus",label:"处理结果",filters:e.fil_list,"filter-multiple":!1,"filter-placement":"bottom-end","column-key":"dealStatus"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("span",[e._v(e._s(a.row.dealStatus?"已处理":"未处理"))])]}}])}),t("el-table-column",{attrs:{prop:"action",label:"操作栏"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{type:"text",disabled:!e.authList.includes("infoDetail")},on:{click:function(t){return e.detail(a.row)}}},[e._v("详情")]),t("el-button",{attrs:{type:"text",disabled:1===a.row.enable||!(e.authList.includes("alarm_create")&&e.authList.includes("edit"))},on:{click:function(t){return e.shield(a.row)}}},[e._v("屏蔽")]),t("el-button",{attrs:{type:"text",disabled:!a.row.shieldID||0===a.row.enable||!e.authList.includes("stop")},on:{click:function(t){return e.stopShield(a.row)}}},[e._v("停止屏蔽")])]}}])})],1),t("el-pagination",{attrs:{"current-page":e.current,"page-sizes":[20,50,100],"page-size":e.size,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}}),e.visible?[t("notice-contact",{attrs:{visible:e.visible,list:e.notice_list},on:{"update:visible":function(t){e.visible=t}}})]:e._e(),e.operateVisible&&"detail"===e.operateType?[t("info-detail",{attrs:{visible:e.operateVisible,info:e.info},on:{"update:visible":function(t){e.operateVisible=t}}})]:e._e(),e.operateVisible&&"shield"===e.operateType?[t("info-shield",{attrs:{visible:e.operateVisible,info:e.info},on:{"update:visible":function(t){e.operateVisible=t}}})]:e._e()],2)},r=[],c=a("c811"),u=a("1f82"),h=a("c1df"),d=a.n(h),p=a("2966"),m=a("8ce4"),b=a("5cb2"),_=a("18c0"),f=a("b520");let v=class extends n["e"]{constructor(){super(...arguments),this.notice={email:"邮箱",phone:"短信"},this.type_list=[{type:"metric",label:"指标报警"},{type:"event",label:"事件报警"}],this.search={ruleName:{placeholder:"请输入规则名称"},instanceID:{placeholder:"请输入资源ID"},type:{placeholder:"报警类型",list:this.type_list},contact:{placeholder:"报警联系人组",list:[]},strategyName:{placeholder:"请输入策略名称"}},this.authList=[],this.fil_list=[{text:"已处理",value:"1"},{text:"未处理",value:"0"}],this.list=[],this.current=1,this.size=20,this.total=0,this.moment=d.a,this.search_data={},this.dealStatus=[],this.visible=!1,this.operateVisible=!1,this.operateType="",this.notice_list=[],this.info={}}created(){this.getContactGroupList(),this.authList=this.$store.state.auth_info[this.$route.name]}async getContactGroupList(){let e=await p["a"].get_contact_group_list({});"Success"===e.code&&(this.search.contact.list=Object(m["e"])(e.data.datas,"name","id","label","type"))}async getAlarmList(){const{search_data:e}=this;let t=await p["a"].get_alarm_list({ruleName:e.ruleName,instanceID:e.instanceID,alarmType:e.type,contactGroupName:e.contact,strategyName:e.strategyName,startTime:e.time?d()(e.time[0]).format("YYYY-MM-DD HH:mm:ss"):d()(new Date).format("YYYY-MM-DD 00:00:00"),endTime:e.time?d()(e.time[1]).format("YYYY-MM-DD HH:mm:ss"):d()(new Date).format("YYYY-MM-DD HH:mm:ss"),dealStatus:0===this.dealStatus.length?"":this.dealStatus[0],page:this.current,pageSize:this.size});"Success"===t.code&&(this.list=t.data.datas||[],this.total=t.data.total||0)}view_contact(e){this.visible=!0,this.notice_list=e}fn_search(e={}){this.current=1,this.search_data={...this.search_data,...e},this.getAlarmList()}handleSizeChange(e){this.size=e,this.getAlarmList()}handleCurrentChange(e){this.current=e,this.getAlarmList()}getTabTime(e){this.search_data.time=e,this.getAlarmList()}fil_info(e){this.dealStatus=e.dealStatus,this.current=1,this.getAlarmList()}detail(e){this.info=e,this.operateType="detail",this.operateVisible=!0}shield(e){this.info=e,this.operateType="shield",this.operateVisible=!0}stopShield(e){const t=this.$createElement;this.$msgbox({title:"提示",message:t("p",null,[t("span",null,"确定停止 "),t("i",{style:"color: #455cc6"},e.shieldName+" "),t("span",null," 屏蔽策略吗? ")]),showCancelButton:!0,confirmButtonText:"确定",cancelButtonText:"取消"}).then(async t=>{let a=await p["a"].shield_apply({ids:[e.shieldID],enable:0});"Success"===a.code&&(this.$message.success(a.message),this.getAlarmList())})}watchOperateVisible(e){e||this.getAlarmList()}};Object(l["a"])([Object(n["f"])("operateVisible")],v.prototype,"watchOperateVisible",null),v=Object(l["a"])([Object(n["a"])({components:{ActionBlock:c["a"],TimeGroup:u["a"],NoticeContact:b["a"],InfoDetail:_["a"],InfoShield:f["a"]}})],v);var g=v,y=g,S=(a("c2c3"),a("2877")),w=Object(S["a"])(y,o,r,!1,null,"0aba31bc",null),T=w.exports,j=function(){var e=this,t=e._self._c;e._self._setupProxy;return t("div",[t("action-block",{attrs:{search_option:e.search},on:{"fn-search":e.fn_search}},e._l(e.headerOperateBtns,(function(a,i){return t("el-button",{key:i,attrs:{type:"primary",disabled:!e.authList.includes(i)},on:{click:function(t){return e.handle(i)}}},[e._v(e._s(a))])})),1),t("el-table",{staticClass:"event-table",attrs:{data:e.list,border:""},on:{"selection-change":e.handleSelectionChange}},[t("el-table-column",{attrs:{type:"selection"}}),t("el-table-column",{attrs:{prop:"shield_name",label:"屏蔽名称"}}),t("el-table-column",{attrs:{prop:"createTime",label:"屏蔽状态"},scopedSlots:e._u([{key:"default",fn:function(a){return[1===a.row.enable?t("span",{staticClass:"running"},[e._v("屏蔽中")]):t("span",{staticClass:"build_fail"},[e._v("已停用")])]}}])}),t("el-table-column",{attrs:{prop:"created_time",label:"创建时间"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("span",[e._v(e._s(e.moment(a.row.created_time).format("YYYY-MM-DD HH:mm:ss")))])]}}])}),t("el-table-column",{attrs:{prop:"updated_time",label:"修改时间"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("span",[e._v(e._s(e.moment(a.row.updated_time).format("YYYY-MM-DD HH:mm:ss")))])]}}])}),t("el-table-column",{attrs:{prop:"operation",label:"操作"},scopedSlots:e._u([{key:"default",fn:function(a){return e._l(e.operateBtns,(function(i,s){return t("el-button",{key:i,attrs:{type:"text",disabled:!e.FnDisable(s,a.row)||!e.authList.includes(s)},on:{click:function(t){return e.handle(s,a.row)}}},[e._v(e._s(i))])}))}}])})],1),t("el-pagination",{attrs:{"current-page":e.current,"page-sizes":[20,50,100],"page-size":e.size,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}}),e.visible?[t("shield-detail",{attrs:{detaiId:e.multipleSelection[0].id,visible:e.visible},on:{"update:visible":function(t){e.visible=t}}})]:e._e()],2)},x=[],D=(a("14d9"),a("e9f5"),a("ab43"),a("a732"),a("c8d7"));let k=class extends n["e"]{constructor(){super(...arguments),this.search={name:{placeholder:"请输入屏蔽名称"},enable:{placeholder:"请选择屏蔽状态",list:[{type:"1",label:"屏蔽中"},{type:"2",label:"已停用"}]}},this.list=[{productType:"1"}],this.current=1,this.size=20,this.total=0,this.search_data={},this.multipleSelection=[],this.operateType="",this.moment=d.a,this.visible=!1,this.authList=[],this.headerOperateBtns={alarm_create:"创建屏蔽",del:"删除",apply:"应用",stop:"停用"},this.operateBtns={detail:"详情",edit:"修改",apply:"应用",stop:"停用",del:"删除"}}created(){this.getShieldList(),this.authList=this.$store.state.auth_info[this.$route.name]}async getShieldList(){let e=await p["a"].get_shield_list({page:this.current,pageSize:this.size,name:this.search_data.name,enable:this.search_data.enable?Number(this.search_data.enable):void 0});"Success"===e.code&&(this.list=e.data.datas,this.total=e.data.total)}fn_search(e={}){this.current=1,this.search_data={...e},this.getShieldList()}handleSizeChange(e){this.size=e,this.getShieldList()}handleCurrentChange(e){this.current=e,this.getShieldList()}handleSelectionChange(e){this.multipleSelection=e}handle(e,t={}){Object.keys(t).length>0&&(this.multipleSelection=[t]),this.operateType=e,"alarm_create"===e?this.$router.push("/alarmInfo/create"):"edit"===e?this.$router.push({path:"/alarmInfo/create",query:{id:t.id}}):"detail"===e?this.visible=!0:["apply","stop"].includes(e)?this.apply():"del"===e&&this.del()}judgeDeadTime(e){return!!e&&d()(new Date).diff(d()(e),"seconds")>0}judgeOperate(){return this.judge(this.operateType,this.multipleSelection)}judge(e,t){let a=!0;if("apply"===e){let e=t.some(e=>1===e.enable||this.judgeDeadTime(e.shield_end_time));a=!e}else["stop"].includes(e)?a=!t.some(e=>0===e.enable):["edit","del"].includes(e)&&(a=!t.some(e=>1===e.enable));return a}FnDisable(e,t){return this.judge(e,[t])}apply(){if(!this.judgeOperate())return void("apply"===this.operateType?this.$message.warning("只能对已停用且静默时间未到期的策略进行应用"):this.$message.warning("只能对屏蔽中的策略进行停用"));const e=this.$createElement;let t="apply"===this.operateType?"应用":"停用",a=this.multipleSelection.map(e=>e.shield_name);this.$msgbox({title:"提示",message:e("p",null,[e("span",null,`确定${t} `),e("i",{style:"color: #455cc6"},a.join(",")),e("span",null," 这些屏蔽策略吗? ")]),showCancelButton:!0,confirmButtonText:"确定",cancelButtonText:"取消"}).then(async e=>{let t=await p["a"].shield_apply({ids:this.multipleSelection.map(e=>e.id),enable:"apply"===this.operateType?1:0});"Success"===t.code&&(this.$message.success(t.message),this.getShieldList())})}del(){if(!this.judgeOperate())return void this.$message.warning("只能对已停用的策略进行删除");const e=this.$createElement;let t=this.multipleSelection.map(e=>e.shield_name);this.$msgbox({title:"提示",message:e("p",null,[e("span",null,"确定删除 "),e("i",{style:"color: #455cc6"},t.join(",")+" "),e("span",null,"吗？ "),e("div",null," 删除该屏蔽策略后，所有产品无法使用该屏蔽策略，且删除后无法恢复? ")]),showCancelButton:!0,confirmButtonText:"确定",cancelButtonText:"取消"}).then(async e=>{let t=await p["a"].shield_del({ids:this.multipleSelection.map(e=>e.id)});"Success"===t.code&&(this.$message.success(t.message),this.getShieldList())})}};k=Object(l["a"])([Object(n["a"])({components:{ActionBlock:c["a"],ShieldDetail:D["a"]}})],k);var C=k,L=C,Y=(a("5d74"),Object(S["a"])(L,j,x,!1,null,"18e5dd0d",null)),O=Y.exports;let z=class extends n["e"]{constructor(){super(...arguments),this.activeName="1"}};z=Object(l["a"])([Object(n["a"])({components:{Info:T,Shield:O}})],z);var N=z,$=N,M=Object(S["a"])($,i,s,!1,null,null,null);t["default"]=M.exports},ab43:function(e,t,a){"use strict";var i=a("23e7"),s=a("c65b"),l=a("59ed"),n=a("825a"),o=a("46c4"),r=a("c5cc"),c=a("9bdd"),u=a("2a62"),h=a("2baa"),d=a("f99f"),p=a("c430"),m=!p&&!h("map",(function(){})),b=!p&&!m&&d("map",TypeError),_=p||m||b,f=r((function(){var e=this.iterator,t=n(s(this.next,e)),a=this.done=!!t.done;if(!a)return c(e,this.mapper,[t.value,this.counter++],!0)}));i({target:"Iterator",proto:!0,real:!0,forced:_},{map:function(e){n(this);try{l(e)}catch(t){u(this,"throw",t)}return b?s(b,this,e):new f(o(this),{mapper:e})}})},bf40:function(e,t,a){"use strict";a("56e0")},c2c3:function(e,t,a){"use strict";a("6253")},c8d7:function(e,t,a){"use strict";var i=function(){var e=this,t=e._self._c;e._self._setupProxy;return t("el-dialog",{attrs:{title:"屏蔽详情",visible:e.visibleSync,width:"800px","destroy-on-close":!0,"close-on-click-modal":!1},on:{"update:visible":function(t){e.visibleSync=t}}},[t("div",{staticClass:"box"},[t("el-descriptions",{attrs:{title:"",column:1,labelClassName:"label"}},e._l(e.info,(function(a,i){return t("el-descriptions-item",{key:i,attrs:{label:a.label}},[t("span",{domProps:{innerHTML:e._s(a.value)}})])})),1),t("el-table",{staticClass:"m-top10",attrs:{data:e.conditions,border:""}},[t("el-table-column",{attrs:{prop:"condition_object_ch",label:"条件对象",align:"center"}}),t("el-table-column",{attrs:{prop:"condition_value",label:"取值",align:"center"}})],1)],1)])},s=[],l=a("9ab4"),n=a("1b40"),o=a("2966");let r=class extends n["e"]{constructor(){super(...arguments),this.info={shield_name:{label:"屏蔽名称",value:""},shield_mechanism_ch:{label:"告警机制",value:""},effective_scope_ch:{label:"抑制范围",value:""},shield_time_ch:{label:"静默时间",value:""}},this.conditions=[],this.id=this.detaiId}created(){this.detail()}async detail(){let e=await o["a"].shield_detail({id:this.id});if("Success"===e.code){this.info.shield_name.value=e.data.shield_name,this.info.shield_mechanism_ch.value=e.data.shield_mechanism_ch,this.info.effective_scope_ch.value=e.data.effective_scope_ch,this.conditions=e.data.conditions;let t={0:'<div class="m-top10">'+e.data.shield_start_time+" —— "+e.data.shield_end_time+"</div>",1:'<div class="m-top10">'+e.data.shield_end_time+"</div>",2:""};this.info.shield_time_ch.value=e.data.shield_time_ch+"<br>"+t[e.data.shield_time]}}};Object(l["a"])([Object(n["c"])()],r.prototype,"detaiId",void 0),Object(l["a"])([Object(n["d"])("visible")],r.prototype,"visibleSync",void 0),r=Object(l["a"])([Object(n["a"])({components:{}})],r);var c=r,u=c,h=(a("bf40"),a("2877")),d=Object(h["a"])(u,i,s,!1,null,null,null);t["a"]=d.exports}}]);
//# sourceMappingURL=chunk-124d6606.1764214676553.js.map