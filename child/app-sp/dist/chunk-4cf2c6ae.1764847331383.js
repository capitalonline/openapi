(window["webpackJsonp_AppSp"]=window["webpackJsonp_AppSp"]||[]).push([["chunk-4cf2c6ae"],{"1c50":function(t,e,a){"use strict";var i=a("81a9");e["a"]={get_maintask_list(t){return Object(i["a"])({method:"GET",url:"/api/v1/maintask/configuration",params:t})},add_maintask(t){return Object(i["a"])({method:"POST",url:"/api/v1/maintask/configuration",data:t})},update_maitask(t){return Object(i["a"])({method:"PUT",url:"/api/v1/maintask/configuration",data:t})},delete_maintask(t){return Object(i["a"])({method:"DELETE",url:"/api/v1/maintask/configuration",params:t})},get_maintask_detail(t){return Object(i["a"])({method:"GET",url:"/api/v1/maintask/configuration/detail",params:t})}}},"49c0":function(t,e,a){"use strict";a("a785")},"6f25":function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",[e("action-block",{attrs:{search_option:t.search_con,create_btn:"新建主任务配置",disabled:!t.operate_auth.includes("create")},on:{"fn-search":t.FnGetList,"fn-create":t.FnShowCreate}}),e("el-table",{attrs:{data:t.task_list,border:""}},[e("el-table-column",{attrs:{prop:"id",label:"ID"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("el-button",{attrs:{type:"text",disabled:!t.operate_auth.includes("main_task_detail")},on:{click:function(e){return t.FnDetail(a.row.id)}}},[t._v(t._s(a.row.id))])]}}])}),e("el-table-column",{attrs:{prop:"maintask_name",label:"名称"}}),e("el-table-column",{attrs:{prop:"priority",label:"优先级"}}),e("el-table-column",{attrs:{prop:"retry",label:"重试次数"}}),e("el-table-column",{attrs:{prop:"timeout",label:"超时时间"}}),e("el-table-column",{attrs:{prop:"callback_url",label:"回退地址"}}),e("el-table-column",{attrs:{prop:"is_valid",label:"is_valid"}}),e("el-table-column",{attrs:{label:"操作"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("el-button",{attrs:{type:"text",disabled:!t.operate_auth.includes("edit")},on:{click:function(e){return t.FnShowUpdate(a.row)}}},[t._v("编辑")]),e("el-button",{attrs:{type:"text",disabled:!t.operate_auth.includes("delete")},on:{click:function(e){return t.FnShowDel(a.row.id,a.row.maintask_name)}}},[t._v("删除")])]}}])})],1),e("el-pagination",{attrs:{"current-page":t.page_info.page_index,"page-sizes":t.page_info.page_sizes,"page-size":t.page_info.page_size,layout:"total, sizes, prev, pager, next, jumper",total:t.page_info.total},on:{"size-change":function(e){return t.FnGetList()},"current-change":function(e){return t.FnGetList()},"update:currentPage":function(e){return t.$set(t.page_info,"page_index",e)},"update:current-page":function(e){return t.$set(t.page_info,"page_index",e)},"update:pageSize":function(e){return t.$set(t.page_info,"page_size",e)},"update:page-size":function(e){return t.$set(t.page_info,"page_size",e)}}}),e("el-dialog",{attrs:{title:t.dialog_title,visible:t.create_dialog,width:"50%"},on:{"update:visible":function(e){t.create_dialog=e},close:t.FnClose}},[e("div",[e("label-block",{attrs:{label:"主任务名称"},scopedSlots:t._u([{key:"default",fn:function(){return[e("el-input",{attrs:{type:"text"},model:{value:t.main_config.main_name,callback:function(e){t.$set(t.main_config,"main_name",e)},expression:"main_config.main_name"}})]},proxy:!0}])}),e("label-block",{attrs:{label:"主任务优先级"},scopedSlots:t._u([{key:"default",fn:function(){return[e("el-input-number",{attrs:{min:1,max:10},model:{value:t.main_config.priority,callback:function(e){t.$set(t.main_config,"priority",e)},expression:"main_config.priority"}})]},proxy:!0}])}),e("label-block",{attrs:{label:"主任务重试次数"},scopedSlots:t._u([{key:"default",fn:function(){return[e("el-input-number",{attrs:{min:1,max:10},model:{value:t.main_config.retry,callback:function(e){t.$set(t.main_config,"retry",e)},expression:"main_config.retry"}}),t._v(" 次 ")]},proxy:!0}])}),e("label-block",{attrs:{label:"主任务超时时间"},scopedSlots:t._u([{key:"default",fn:function(){return[e("el-input-number",{attrs:{min:1,max:600},model:{value:t.main_config.timeout,callback:function(e){t.$set(t.main_config,"timeout",e)},expression:"main_config.timeout"}}),t._v(" 秒 ")]},proxy:!0}])}),e("label-block",{attrs:{label:"主任务回退地址"},scopedSlots:t._u([{key:"default",fn:function(){return[e("el-input",{attrs:{type:"text"},model:{value:t.main_config.callback_url,callback:function(e){t.$set(t.main_config,"callback_url",e)},expression:"main_config.callback_url"}})]},proxy:!0}])}),t.default_id?e("label-block",{staticClass:"switch-box",attrs:{label:"有效"},scopedSlots:t._u([{key:"default",fn:function(){return[e("el-switch",{attrs:{"active-color":"#455cc6","inactive-color":"#ccc"},model:{value:t.main_config.is_valid,callback:function(e){t.$set(t.main_config,"is_valid",e)},expression:"main_config.is_valid"}})]},proxy:!0}],null,!1,1067134834)}):t._e(),e("label-block",{attrs:{label:"子任务配置"},scopedSlots:t._u([{key:"default",fn:function(){return[e("dragger-task",{attrs:{sub_task:t.sub_task_list,rel_task:t.default_sub_task},on:{"fn-rel-task":t.FnGetRelTask}})]},proxy:!0}])})],1),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{attrs:{type:"primary"},on:{click:t.FnConfirm}},[t._v("确 定")]),e("el-button",{on:{click:t.FnClose}},[t._v("取 消")])],1)])],1)},s=[],n=(a("14d9"),a("e9f5"),a("ab43"),a("9ab4")),l=a("1b40"),o=a("98c9"),r=a("b508"),c=a("c811"),u=a("1c50"),p=a("bcc9");let _=class extends l["e"]{constructor(){super(...arguments),this.search_con={id:{placeholder:"请输入任务ID"},maintask_name:{placeholder:"请输入任务名称"}},this.create_dialog=!1,this.dialog_title="",this.task_list=[],this.operate_auth=[],this.default_id="",this.default_sub_task=[],this.main_config={main_name:"",main_type:"",priority:1,retry:1,timeout:60,callback_url:"",sub_task:[],is_valid:!0},this.sub_task_list=[],this.page_info={page_sizes:[20,50,100],page_size:20,page_index:1,total:0}}FnShowCreate(){this.create_dialog=!0,this.dialog_title="新建主任务配置",this.FnGetSubList()}async FnShowUpdate(t){this.create_dialog=!0,this.dialog_title="更新主任务配置",await this.FnGetSubList(),this.default_id=t.id,this.main_config.main_name=t.maintask_name,this.main_config.retry=t.retry,this.main_config.priority=t.priority,this.main_config.timeout=t.timeout,this.main_config.callback_url=t.callback_url,this.main_config.is_valid=Boolean(t.is_valid),this.default_sub_task=JSON.parse(t.subtask_flow).map(t=>t.map(t=>t.subtask_index_id))}FnClose(){this.create_dialog=!1,this.main_config.main_name="",this.main_config.main_type="",this.main_config.retry=1,this.main_config.priority=1,this.main_config.timeout=60,this.main_config.callback_url="",this.main_config.sub_task=[],this.main_config.is_valid=!0,this.sub_task_list=[],this.default_id="",this.default_sub_task=[]}async FnGetList(t={}){let e={};t.id&&(e.id=t.id),t.maintask_type&&(e.maintask_type=t.maintask_type),t.maintask_name&&(e.maintask_name=t.maintask_name),e.page_number=this.page_info.page_index,e.page_size=this.page_info.page_size;const a=await u["a"].get_maintask_list(e);"Success"===a.code&&(this.task_list=a.data.maintask_info,this.page_info.total=a.data.total)}async FnGetSubList(){const t=await p["a"].get_subtask_list();"Success"===t.code&&(this.sub_task_list=t.data.subtask_info)}FnGetRelTask(t){this.main_config.sub_task=t.map(t=>t.map(t=>({subtask_index_id:t})))}FnConfirm(){let t={maintask_name:this.main_config.main_name,priority:this.main_config.priority,retry:this.main_config.retry,timeout:this.main_config.timeout,callback_url:this.main_config.callback_url,subtask_flow:JSON.stringify(this.main_config.sub_task),is_valid:Number(this.main_config.is_valid)};this.default_id?this.FnUpdate(t):this.FnCreate(t)}async FnCreate(t){const e=await u["a"].add_maintask(t);"Success"===e.code&&(this.FnClose(),this.$message.success(e.msg||"成功新建主任务配置！"),this.FnGetList())}async FnUpdate(t){const e=await u["a"].update_maitask(Object.assign({},t,{id:this.default_id}));"Success"===e.code&&(this.FnClose(),this.$message.success(e.msg||"成功更新主任务配置！"),this.FnGetList())}FnShowDel(t,e){this.$confirm("确认删除主任务配置 -- "+e,"删除提示",{cancelButtonText:"取消",confirmButtonText:"确定",type:"warning"}).then(()=>{this.default_id=t,this.FnDel()}).catch()}async FnDel(){const t=await u["a"].delete_maintask({id:this.default_id});"Success"===t.code&&(this.$message.success(t.msg||"成功删除主项目配置！"),this.FnGetList())}FnDetail(t){this.$router.push("/mainTaskDetail/"+t)}created(){this.operate_auth=this.$store.state.auth_info[this.$route.name],this.FnGetList()}};_=Object(n["a"])([Object(l["a"])({components:{LabelBlock:o["a"],draggerTask:r["a"],actionBlock:c["a"]}})],_);var d=_,h=d,m=(a("49c0"),a("2877")),f=Object(m["a"])(h,i,s,!1,null,"0c3d3a9b",null);e["default"]=f.exports},"7fa7":function(t,e,a){"use strict";a("9db6")},"9a8d":function(t,e,a){"use strict";var i=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("el-date-picker",{attrs:{type:t.time_option.type,editable:!1,"range-separator":"至","picker-options":{disabledDate:t.dis_date,onPick:t.onPicker},clearable:t.time_option.clearable,"start-placeholder":t.time_option.placeholder[0],"end-placeholder":t.time_option.placeholder[1]},on:{change:t.FnEmit},model:{value:t.time,callback:function(e){t.time=e},expression:"time"}})},s=[],n=a("9ab4"),l=a("1b40");let o=class extends l["e"]{constructor(){super(...arguments),this.time=[],this.min_date="",this.day=0}dis_date(t){const{day:e}=this;if(0===e)return;let a=864e5,i=(new Date).getTime(),s=(new Date).getTime(),n=(new Date).getTime();return this.time_option.min_date?(s=new Date(this.time_option.min_date).getTime(),t.getTime()>n||t.getTime()<s-a):t.getTime()>n||t.getTime()>(this.min_date||i)+a*e||this.min_date&&t.getTime()<this.min_date-a*e}onPicker({maxDate:t,minDate:e}){this.min_date=e.getTime()}created(){this.day=this.time_option.dis_day-1||0,this.FnChangeDefaultTime(this.time_option.defaultTime)}FnClear(){this.FnChangeDefaultTime(this.time_option.defaultTime)}FnChangeDefaultTime(t){t.length,this.time=t,this.FnEmit()}FnEmit(){return this.min_date="",this.time}};Object(n["a"])([Object(l["c"])({default:()=>({placeholder:["开始时间","结束时间"],type:"daterange",width:"360",clearable:!1,dis_day:31,min_date:"",defaultTime:[new Date,new Date]})})],o.prototype,"time_option",void 0),Object(n["a"])([Object(l["c"])({default:!1})],o.prototype,"clear",void 0),Object(n["a"])([Object(l["f"])("time_option.defaultTime")],o.prototype,"FnChangeDefaultTime",null),Object(n["a"])([Object(l["b"])("fn-emit")],o.prototype,"FnEmit",null),o=Object(n["a"])([l["a"]],o);var r=o,c=r,u=a("2877"),p=Object(u["a"])(c,i,s,!1,null,null,null);e["a"]=p.exports},"9db6":function(t,e,a){},a785:function(t,e,a){},ab43:function(t,e,a){"use strict";var i=a("23e7"),s=a("c65b"),n=a("59ed"),l=a("825a"),o=a("46c4"),r=a("c5cc"),c=a("9bdd"),u=a("2a62"),p=a("2baa"),_=a("f99f"),d=a("c430"),h=!d&&!p("map",(function(){})),m=!d&&!h&&_("map",TypeError),f=d||h||m,b=r((function(){var t=this.iterator,e=l(s(this.next,t)),a=this.done=!!e.done;if(!a)return c(t,this.mapper,[e.value,this.counter++],!0)}));i({target:"Iterator",proto:!0,real:!0,forced:f},{map:function(t){l(this);try{n(t)}catch(e){u(this,"throw",e)}return m?s(m,this,t):new b(o(this),{mapper:t})}})},bcc9:function(t,e,a){"use strict";var i=a("81a9");e["a"]={get_subtask_list(t={}){return Object(i["a"])({method:"GET",url:"/api/v1/subtask/configuration",params:t})},add_subtask(t){return Object(i["a"])({method:"POST",url:"/api/v1/subtask/configuration",data:t})},update_subtask(t){return Object(i["a"])({method:"PUT",url:"/api/v1/subtask/configuration",data:t})},delete_subtask(t){return Object(i["a"])({method:"DELETE",url:"/api/v1/subtask/configuration",params:t})}}},c811:function(t,e,a){"use strict";a("e9f5"),a("910d");var i=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",{staticClass:"action-box",style:t.isShowBg?{}:{background:"#fff",padding:0,margin:0,border:"none"}},[e("div",{ref:"search",staticClass:"search-box",class:{fold:!t.isOpen}},[t._l(t.search_option,(function(a,i){return e("div",{key:i,staticClass:"search-input",style:a.width?{width:a.width+"px"}:{}},[a.list&&!a.type?e("el-select",{attrs:{placeholder:a.placeholder,multiple:a.multiple,filterable:a.filter,clearable:""},model:{value:t.search_value[i],callback:function(e){t.$set(t.search_value,i,e)},expression:"search_value[key]"}},t._l(a.list,(function(t,i){return e("el-option",{key:Array.isArray(a.list)?t.type:i,attrs:{label:Array.isArray(a.list)?t.label:t,value:Array.isArray(a.list)?t.type:i}})})),1):t._e(),(a.list||a.type||a.multi)&&"composite"!==a.type?t._e():e("el-input",{staticClass:"composite",style:a.width?{width:a.width+"px"}:{},attrs:{placeholder:a.placeholder,clearable:""},model:{value:t.search_value[i],callback:function(e){t.$set(t.search_value,i,e)},expression:"search_value[key]"}},["composite"===a.type?e("el-select",{attrs:{slot:"prepend",placeholder:"请选择"},slot:"prepend",model:{value:t.search_value[i+"sub"],callback:function(e){t.$set(t.search_value,i+"sub",e)},expression:"search_value[key + 'sub']"}},t._l(a.list,(function(t){return e("el-option",{key:t.type,attrs:{label:t.label,value:t.type}})})),1):t._e()],1),a.multi?e("el-popover",{attrs:{placement:"bottom",width:"250",trigger:"click"}},[e("el-input",{attrs:{type:"textarea",rows:4,placeholder:a.placeholder+"（使用回车或英文逗号隔开）"},model:{value:t.search_value[i],callback:function(e){t.$set(t.search_value,i,e)},expression:"search_value[key]"}}),!a.list&&!a.type||a.multi?e("el-input",{staticClass:"multi_input",style:a.width?{width:a.width+"px"}:{},attrs:{slot:"reference",placeholder:a.placeholder,clearable:""},slot:"reference",model:{value:t.search_value[i],callback:function(e){t.$set(t.search_value,i,e)},expression:"search_value[key]"}}):t._e()],1):t._e(),"datetimerange"===a.type||"daterange"===a.type?[e("date-picker",{ref:"datepicker",refInFor:!0,attrs:{time_option:t.search_option[i]},on:{"fn-emit":function(e){return t.FnGetTime(e,i)}}})]:t._e()],2)})),t.type?t._e():e("div",{staticClass:"m-bottom20"},[e("el-button",{attrs:{type:"primary"},on:{click:t.FnSearch}},[t._v("查 询")]),e("el-button",{attrs:{type:"default"},on:{click:t.FnClear}},[t._v("清 空")])],1)],2),t.type?e("div",{staticClass:"m-bottom5"},[e("el-button",{attrs:{type:"primary"},on:{click:t.FnSearch}},[t._v("查 询")]),"physical"===t.type?e("el-button",{attrs:{type:"primary"},on:{click:t.FnMultiSearch}},[t._v("批量查询")]):t._e(),e("el-button",{attrs:{type:"default"},on:{click:t.FnClear}},[t._v("清 空")]),e("el-button",{staticClass:"m-bottom10",attrs:{type:"text"},on:{click:t.operate}},[t._v(t._s(t.isOpen?"折叠":"展开"))])],1):t._e(),t._t("default",(function(){return[t.create_btn?e("el-button",{attrs:{type:"primary",disabled:t.disabled},on:{click:t.FnShowCreate}},[t._v(t._s(t.create_btn))]):t._e()]})),e("el-dialog",{attrs:{title:"批量查询",visible:t.syncVisible,width:"400px","destroy-on-close":!0,"close-on-click-modal":!1}},[e("el-input",{attrs:{type:"textarea",rows:13,placeholder:"请输入主机ID/名称,格式如下：\nPOD01-CLU01-H001\nPOD01-CLU01-H002\nPOD01-CLU01-H003\n..."},model:{value:t.search_value["host_info"],callback:function(e){t.$set(t.search_value,"host_info",e)},expression:"search_value['host_info']"}}),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{attrs:{type:"primary"},on:{click:t.FnSearch}},[t._v("确认")]),e("el-button",{on:{click:function(e){t.syncVisible=!1}}},[t._v("取消")])],1)],1)],2)},s=[],n=a("9ab4"),l=a("1b40"),o=a("9a8d");let r=class extends l["e"]{constructor(){super(...arguments),this.search_value={},this.time=null,this.date_key="",this.syncVisible=!1,this.isOpen=!0}FnGetTime(t,e){this.time=t,this.date_key=e}FnSearch(){return this.syncVisible=!1,this.search_value[this.date_key]=this.time,this.search_value}watch_search_option(){this.type&&this.$nextTick(()=>{let t=this.$refs.search,e=window.getComputedStyle(t).height.replace("px","");parseInt(e)>52&&this.isOpen&&(this.isOpen=!1),this.FnOperate()})}FnMultiSearch(){this.syncVisible=!0}operate(){this.isOpen=!this.isOpen,this.FnOperate()}FnOperate(){}FnShowCreate(){}watch_search_value(t,e){}FnClear(){for(let t in this.search_option)["datetimerange","daterange"].includes(this.search_option[t].type)?this.$refs.datepicker[0].FnClear():this.search_value={};this.FnSearch()}watchDefaultValue(t){for(let e in t)void 0!==t[e].default_value&&this.$set(this.search_value,e,t[e].default_value)}mounted(){let t=0;for(let e in this.search_option)this.search_option[e].default_value&&(this.$set(this.search_value,e,this.search_option[e].default_value),t++),"composite"===this.search_option[e].type&&this.$set(this.search_value,e+"sub",this.search_option[e].list[0].type);(t>0||"physical"===this.type)&&setTimeout(()=>{this.FnSearch()},500)}};Object(n["a"])([Object(l["c"])({default:{}})],r.prototype,"search_option",void 0),Object(n["a"])([Object(l["c"])({default:""})],r.prototype,"create_btn",void 0),Object(n["a"])([Object(l["c"])({default:!0})],r.prototype,"disabled",void 0),Object(n["a"])([Object(l["c"])({default:!1})],r.prototype,"type",void 0),Object(n["a"])([Object(l["c"])({default:!0})],r.prototype,"isShowBg",void 0),Object(n["a"])([Object(l["b"])("fn-search")],r.prototype,"FnSearch",null),Object(n["a"])([Object(l["f"])("search_option",{immediate:!0,deep:!0})],r.prototype,"watch_search_option",null),Object(n["a"])([Object(l["b"])("fn-operate")],r.prototype,"FnOperate",null),Object(n["a"])([Object(l["b"])("fn-create")],r.prototype,"FnShowCreate",null),Object(n["a"])([Object(l["f"])("search_value",{immediate:!0,deep:!0})],r.prototype,"watch_search_value",null),Object(n["a"])([Object(l["f"])("search_option",{deep:!0})],r.prototype,"watchDefaultValue",null),r=Object(n["a"])([Object(l["a"])({components:{DatePicker:o["a"]}})],r);var c=r,u=c,p=(a("f06f"),a("7fa7"),a("2877")),_=Object(p["a"])(u,i,s,!1,null,"310f9641",null);e["a"]=_.exports},f06f:function(t,e,a){"use strict";a("f621")},f621:function(t,e,a){}}]);