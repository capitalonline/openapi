(window["webpackJsonp_AppSp"]=window["webpackJsonp_AppSp"]||[]).push([["chunk-58cbbfd1"],{1296:function(e,t,a){"use strict";var s=a("81a9"),i=a("bff7");t["a"]={get_event_list(e){return Object(s["a"])(Object(i["b"])("POST","/event/get_event_list/",e))},get_filter_list(e){return Object(s["a"])(Object(i["b"])("POST","/event/get_filter_item/",e))},get_filter_item(e){return Object(s["a"])(Object(i["b"])("POST","/event/get_filter_item/",e))},retry_task(e){return Object(s["a"])(Object(i["b"])("POST","/event/retry_task/",e))},get_error_task_list(e){return Object(s["a"])(Object(i["b"])("POST","/event/get_error_task_list/",e))},ignore(e){return Object(s["a"])(Object(i["b"])("POST","/event/task_status/",e))},get_repair_event_list(e){return Object(s["a"])(Object(i["b"])("POST","/event/get_error_task_list/",e))},getUnderlyingTasks(e){return Object(s["a"])(Object(i["b"])("GET","/event/get_maintask_detail/",e))},getTasksStatus(e){return Object(s["a"])(Object(i["b"])("GET","/event/check_task_resource/",e))},setTasksStatus(e){return Object(s["a"])(Object(i["b"])("POST","/event/repair_task_resource/",e))},setReTasks(e){return Object(s["a"])(Object(i["b"])("POST","/event/repair_task/",e))},getResourceStatus(){return Object(s["a"])(Object(i["b"])("GET","/event/resource_status/"))},task_flow_check(e){return Object(s["a"])(Object(i["b"])("GET","/event/task_flow_check/",e))}}},"26f3":function(e,t,a){"use strict";a("4f3f")},"310a":function(e,t,a){"use strict";a("b786")},4774:function(e,t,a){"use strict";a("835c")},"4f3f":function(e,t,a){},"5eb3":function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e._self._c;e._self._setupProxy;return t("div",[t("action-block",{attrs:{search_option:e.search},on:{"fn-search":e.fn_search}}),t("div",{staticClass:"event-detail"},[t("div",[e._v("事件总数："+e._s(e.event_num))]),t("div",{staticClass:"finish"},[e._v("已完成:"+e._s(e.finish_num))]),t("div",[e._v("完成率："+e._s(e.finished_percent))]),t("div",[e._v("失败："+e._s(e.fail_num))]),t("div",{staticClass:"error"},[e._v("失败率："+e._s(e.error_percent))]),t("el-button",{attrs:{type:"primary"},on:{click:e.check}},[e._v("任务流检测")])],1),t("el-table",{staticClass:"event-table",attrs:{data:e.event_list,border:""},on:{"sort-change":e.FnSortChange,"filter-change":e.filterAttribute}},[t("el-table-column",{attrs:{prop:"event_id",label:"事件ID"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("span",{staticClass:"clickble",on:{click:function(t){return e.view(a.row.event_id,a.row.event_name)}}},[e._v(e._s(a.row.event_id))])]}}])}),t("el-table-column",{attrs:{prop:"customer_id",label:"客户ID"}}),t("el-table-column",{attrs:{prop:"customer",label:"客户名称"}}),t("el-table-column",{attrs:{prop:"event_name",label:"事件名称"}}),t("el-table-column",{attrs:{prop:"event_state_name",label:"事件状态","filter-multiple":!1,"column-key":"status",filters:e.status_list},scopedSlots:e._u([{key:"default",fn:function(a){return[t("span",{class:["failed"===a.row.status||"part_fail"===a.row.status?"err":""]},[e._v(e._s(a.row.event_state_name))])]}}])}),t("el-table-column",{attrs:{prop:"implementation_name",label:"任务执行情况"}}),t("el-table-column",{attrs:{prop:"op_user",label:"操作用户"}}),t("el-table-column",{attrs:{prop:"create_time",label:"创建时间",sortable:"custom"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("span",[e._v(e._s(a.row.create_time?e.moment(a.row.create_time).format("YYYY-MM-DD HH:mm:ss"):"--"))])]}}])}),t("el-table-column",{attrs:{prop:"update_time",label:"完成时间",sortable:"custom"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("span",[e._v(e._s(a.row.update_time?e.moment(a.row.update_time).format("YYYY-MM-DD HH:mm:ss"):"--"))])]}}])}),t("el-table-column",{attrs:{label:"任务"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{type:"text",disabled:!e.event_detail},on:{click:function(t){return e.view(a.row.event_id,a.row.event_name)}}},[e._v("查看")])]}}])})],1),t("el-pagination",{attrs:{"current-page":e.current,"page-sizes":[20,50,100],"page-size":e.size,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)},i=[],r=(a("14d9"),a("9ab4")),n=a("1b40"),l=a("c811"),o=a("1296"),c=a("c1df"),u=a.n(c);let _=class extends n["e"]{constructor(){super(...arguments),this.search={event_id:{placeholder:"请输入事件ID"},event_name:{placeholder:"请输入事件名称"},resource_id:{placeholder:"请输入资源ID"},task_id:{placeholder:"请输入任务ID"},customer_id:{placeholder:"请输入客户ID"},customer_name:{placeholder:"请输入客户名称"},op_user:{placeholder:"请输入操作用户"},time:{type:"datetimerange",placeholder:["开始时间","结束时间"],clearable:!1,width:360,dis_day:31,defaultTime:[u()(new Date).format("YYYY-MM-DD 00:00:00"),u()(new Date).format("YYYY-MM-DD HH:mm:ss")]}},this.event_num=0,this.finish_num=0,this.finished_percent="0.00%",this.fail_num=0,this.error_percent="0.00%",this.err="err",this.current=1,this.size=20,this.total=0,this.moment=u.a,this.event_list=[],this.min_date="",this.search_data={},this.event_detail=!1,this.sort_prop_name="",this.sort_value="",this.status_list=[],this.filter_obj={},this.clear=null}created(){this.getFilterList(),this.event_detail=!!this.$store.state.auth_info["event_detail"],this.fn_search()}watch_pod(e){e&&this.fn_search(this.search_data)}async getFilterList(){let e=await o["a"].get_filter_list({filed_names:["event_status"]});if("Success"===e.code)for(let t in e.data.event_status)this.status_list.push({text:e.data.event_status[t],value:t})}fn_search(e={}){this.FnClearTimer(),this.current=1,this.search_data={...e,...this.filter_obj},this.getEventList(!0,!1)}getFormattedTime(e,t){const a=u()(new Date).format("YYYY-MM-DD HH:mm:ss");return e?(console.log("&&&&&"),a):t&&t.time&&t.time[1]?u()(t.time[1]).format("YYYY-MM-DD HH:mm:ss"):void 0}async getEventList(e=!0,t){e||this.$store.commit("SET_LOADING",!1);const{search_data:a}=this,s=await o["a"].get_event_list({pod_id:this.$store.state.pod_id,page_index:this.current,page_size:this.size,event_id:a.event_id||"",event_name:a.event_name||"",resource_id:a.resource_id||"",[this.sort_prop_name]:this.sort_value,task_id:a.task_id||"",customer_id:a.customer_id||"",customer_name:a.customer_name||"",op_user:a.op_user||"",event_status:a.status?a.status[0]:void 0,start_time:a.time?u()(a.time[0]).format("YYYY-MM-DD HH:mm:ss"):u()(new Date).format("YYYY-MM-DD 00:00:00"),end_time:this.getFormattedTime(t,a)});var i,r,n,l,c,_;"Success"===s.code?(this.event_list=(null===(i=s.data)||void 0===i?void 0:i.event_list)||[],this.total=(null===(r=s.data)||void 0===r||null===(n=r.page_info)||void 0===n?void 0:n.count)||0,this.event_num=(null===(l=s.data)||void 0===l?void 0:l.event_num)||0,this.finish_num=(null===(c=s.data)||void 0===c?void 0:c.success_num)||0,this.fail_num=(null===(_=s.data)||void 0===_?void 0:_.fail_num)||0,this.finished_percent=this.event_num?(this.finish_num/this.event_num*100).toFixed(2)+"%":"0.00%",this.error_percent=this.event_num?(this.fail_num/this.event_num*100).toFixed(2)+"%":"0.00%"):this.$message.error(s.msg||"操作错误");this.FnSetTimer()}handleSizeChange(e){this.size=e,this.getEventList(!0,!1)}handleCurrentChange(e){this.current=e,this.getEventList(!0,!1)}FnSortChange(e){this.sort_prop_name="sort_"+e.prop,this.sort_value="descending"===e.order?"0":"ascending"===e.order?"1":void 0,this.getEventList(!0,!1)}filterAttribute(e){this.filter_obj={...this.filter_obj,...e},this.fn_search(this.search_data)}view(e,t){this.$router.push({path:"/event/"+e,query:{name:t||"123"}})}async check(){const e=await o["a"].task_flow_check({pod_id:this.$store.state.pod_id});"Success"===e.code&&(this.$message.success(e.message),setTimeout(()=>{this.getEventList(!1,!0)},2e3))}FnSetTimer(){this.clear&&this.FnClearTimer(),this.clear=setTimeout(()=>{this.getEventList(!1,!1)},1e4)}FnClearTimer(){this.clear&&clearTimeout(this.clear)}beforeDestroy(){this.FnClearTimer()}};Object(r["a"])([Object(n["f"])("$store.state.pod_id")],_.prototype,"watch_pod",null),_=Object(r["a"])([Object(n["a"])({components:{ActionBlock:l["a"]}})],_);var h=_,p=h,d=(a("310a"),a("2877")),m=Object(d["a"])(p,s,i,!1,null,"b489bcb0",null);t["default"]=m.exports},"835c":function(e,t,a){},"9a8d":function(e,t,a){"use strict";var s=function(){var e=this,t=e._self._c;e._self._setupProxy;return t("el-date-picker",{attrs:{type:e.time_option.type,editable:!1,"range-separator":"至","picker-options":{disabledDate:e.dis_date,onPick:e.onPicker},clearable:e.time_option.clearable,"start-placeholder":e.time_option.placeholder[0],"end-placeholder":e.time_option.placeholder[1]},on:{change:e.FnEmit},model:{value:e.time,callback:function(t){e.time=t},expression:"time"}})},i=[],r=a("9ab4"),n=a("1b40");let l=class extends n["e"]{constructor(){super(...arguments),this.time=[],this.min_date="",this.day=0}dis_date(e){const{day:t}=this;if(0===t)return;let a=864e5,s=(new Date).getTime(),i=(new Date).getTime(),r=(new Date).getTime();return this.time_option.min_date?(i=new Date(this.time_option.min_date).getTime(),e.getTime()>r||e.getTime()<i-a):e.getTime()>r||e.getTime()>(this.min_date||s)+a*t||this.min_date&&e.getTime()<this.min_date-a*t}onPicker({maxDate:e,minDate:t}){this.min_date=t.getTime()}created(){this.day=this.time_option.dis_day-1||0,this.FnChangeDefaultTime(this.time_option.defaultTime)}FnClear(){this.FnChangeDefaultTime(this.time_option.defaultTime)}FnChangeDefaultTime(e){console.log("clear",e),e.length,this.time=e,this.FnEmit()}FnEmit(){return this.min_date="",this.time}};Object(r["a"])([Object(n["c"])({default:()=>({placeholder:["开始时间","结束时间"],type:"daterange",width:"360",clearable:!1,dis_day:31,min_date:"",defaultTime:[new Date,new Date]})})],l.prototype,"time_option",void 0),Object(r["a"])([Object(n["c"])({default:!1})],l.prototype,"clear",void 0),Object(r["a"])([Object(n["f"])("time_option.defaultTime")],l.prototype,"FnChangeDefaultTime",null),Object(r["a"])([Object(n["b"])("fn-emit")],l.prototype,"FnEmit",null),l=Object(r["a"])([n["a"]],l);var o=l,c=o,u=a("2877"),_=Object(u["a"])(c,s,i,!1,null,null,null);t["a"]=_.exports},b786:function(e,t,a){},c811:function(e,t,a){"use strict";a("e9f5"),a("910d");var s=function(){var e=this,t=e._self._c;e._self._setupProxy;return t("div",{staticClass:"action-box",style:e.isShowBg?{}:{background:"#fff",padding:0,margin:0,border:"none"}},[t("div",{ref:"search",staticClass:"search-box",class:{fold:!e.isOpen}},[e._l(e.search_option,(function(a,s){return t("div",{key:s,staticClass:"search-input",style:a.width?{width:a.width+"px"}:{}},[a.list&&!a.type?t("el-select",{attrs:{placeholder:a.placeholder,multiple:a.multiple,filterable:a.filter,clearable:""},model:{value:e.search_value[s],callback:function(t){e.$set(e.search_value,s,t)},expression:"search_value[key]"}},e._l(a.list,(function(e,s){return t("el-option",{key:Array.isArray(a.list)?e.type:s,attrs:{label:Array.isArray(a.list)?e.label:e,value:Array.isArray(a.list)?e.type:s}})})),1):e._e(),(a.list||a.type||a.multi)&&"composite"!==a.type?e._e():t("el-input",{staticClass:"composite",style:a.width?{width:a.width+"px"}:{},attrs:{placeholder:a.placeholder,clearable:""},model:{value:e.search_value[s],callback:function(t){e.$set(e.search_value,s,t)},expression:"search_value[key]"}},["composite"===a.type?t("el-select",{attrs:{slot:"prepend",placeholder:"请选择"},slot:"prepend",model:{value:e.search_value[s+"sub"],callback:function(t){e.$set(e.search_value,s+"sub",t)},expression:"search_value[key + 'sub']"}},e._l(a.list,(function(e){return t("el-option",{key:e.type,attrs:{label:e.label,value:e.type}})})),1):e._e()],1),a.multi?t("el-popover",{attrs:{placement:"bottom",width:"250",trigger:"click"}},[t("el-input",{attrs:{type:"textarea",rows:4,placeholder:a.placeholder+"（使用回车或英文逗号隔开）"},model:{value:e.search_value[s],callback:function(t){e.$set(e.search_value,s,t)},expression:"search_value[key]"}}),!a.list&&!a.type||a.multi?t("el-input",{staticClass:"multi_input",style:a.width?{width:a.width+"px"}:{},attrs:{slot:"reference",placeholder:a.placeholder,clearable:""},slot:"reference",model:{value:e.search_value[s],callback:function(t){e.$set(e.search_value,s,t)},expression:"search_value[key]"}}):e._e()],1):e._e(),"datetimerange"===a.type||"daterange"===a.type?[t("date-picker",{ref:"datepicker",refInFor:!0,attrs:{time_option:e.search_option[s]},on:{"fn-emit":function(t){return e.FnGetTime(t,s)}}})]:e._e()],2)})),e.type?e._e():t("div",{staticClass:"m-bottom20"},[t("el-button",{attrs:{type:"primary"},on:{click:e.FnSearch}},[e._v("查 询")]),t("el-button",{attrs:{type:"default"},on:{click:e.FnClear}},[e._v("清 空")])],1)],2),e.type?t("div",{staticClass:"m-bottom5"},[t("el-button",{attrs:{type:"primary"},on:{click:e.FnSearch}},[e._v("查 询")]),"physical"===e.type?t("el-button",{attrs:{type:"primary"},on:{click:e.FnMultiSearch}},[e._v("批量查询")]):e._e(),t("el-button",{attrs:{type:"default"},on:{click:e.FnClear}},[e._v("清 空")]),t("el-button",{staticClass:"m-bottom10",attrs:{type:"text"},on:{click:e.operate}},[e._v(e._s(e.isOpen?"折叠":"展开"))])],1):e._e(),e._t("default",(function(){return[e.create_btn?t("el-button",{attrs:{type:"primary",disabled:e.disabled},on:{click:e.FnShowCreate}},[e._v(e._s(e.create_btn))]):e._e()]})),t("el-dialog",{attrs:{title:"批量查询",visible:e.syncVisible,width:"400px","destroy-on-close":!0,"close-on-click-modal":!1}},[t("el-input",{attrs:{type:"textarea",rows:13,placeholder:"请输入主机ID/名称,格式如下：\nPOD01-CLU01-H001\nPOD01-CLU01-H002\nPOD01-CLU01-H003\n..."},model:{value:e.search_value["host_info"],callback:function(t){e.$set(e.search_value,"host_info",t)},expression:"search_value['host_info']"}}),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"primary"},on:{click:e.FnSearch}},[e._v("确认")]),t("el-button",{on:{click:function(t){e.syncVisible=!1}}},[e._v("取消")])],1)],1)],2)},i=[],r=a("9ab4"),n=a("1b40"),l=a("9a8d");let o=class extends n["e"]{constructor(){super(...arguments),this.search_value={},this.time=null,this.date_key="",this.syncVisible=!1,this.isOpen=!0}FnGetTime(e,t){this.time=e,this.date_key=t}FnSearch(){return this.syncVisible=!1,this.search_value[this.date_key]=this.time,this.search_value}watch_search_option(){this.type&&this.$nextTick(()=>{let e=this.$refs.search,t=window.getComputedStyle(e).height.replace("px","");parseInt(t)>52&&this.isOpen&&(this.isOpen=!1),this.FnOperate()})}FnMultiSearch(){this.syncVisible=!0}operate(){this.isOpen=!this.isOpen,this.FnOperate()}FnOperate(){}FnShowCreate(){}watch_search_value(e,t){}FnClear(){for(let e in this.search_option)["datetimerange","daterange"].includes(this.search_option[e].type)?this.$refs.datepicker[0].FnClear():this.search_value={};this.FnSearch()}mounted(){let e=0;for(let t in this.search_option)this.search_option[t].default_value&&(this.$set(this.search_value,t,this.search_option[t].default_value),e++),"composite"===this.search_option[t].type&&this.$set(this.search_value,t+"sub",this.search_option[t].list[0].type);(e>0||"physical"===this.type)&&setTimeout(()=>{this.FnSearch()},500)}};Object(r["a"])([Object(n["c"])({default:{}})],o.prototype,"search_option",void 0),Object(r["a"])([Object(n["c"])({default:""})],o.prototype,"create_btn",void 0),Object(r["a"])([Object(n["c"])({default:!0})],o.prototype,"disabled",void 0),Object(r["a"])([Object(n["c"])({default:!1})],o.prototype,"type",void 0),Object(r["a"])([Object(n["c"])({default:!0})],o.prototype,"isShowBg",void 0),Object(r["a"])([Object(n["b"])("fn-search")],o.prototype,"FnSearch",null),Object(r["a"])([Object(n["f"])("search_option",{immediate:!0,deep:!0})],o.prototype,"watch_search_option",null),Object(r["a"])([Object(n["b"])("fn-operate")],o.prototype,"FnOperate",null),Object(r["a"])([Object(n["b"])("fn-create")],o.prototype,"FnShowCreate",null),Object(r["a"])([Object(n["f"])("search_value",{immediate:!0,deep:!0})],o.prototype,"watch_search_value",null),o=Object(r["a"])([Object(n["a"])({components:{DatePicker:l["a"]}})],o);var c=o,u=c,_=(a("4774"),a("26f3"),a("2877")),h=Object(_["a"])(u,s,i,!1,null,"20a86f62",null);t["a"]=h.exports}}]);
//# sourceMappingURL=chunk-58cbbfd1.1751615839339.js.map