(window["webpackJsonp_AppSp"]=window["webpackJsonp_AppSp"]||[]).push([["chunk-4038c0a1"],{"1b7c":function(t,e,i){"use strict";var s=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("el-tooltip",{attrs:{content:t.content,placement:t.placement,effect:t.effect,"popper-class":"tooltip-class"},scopedSlots:t._u([{key:"content",fn:function(){return[t._t("content")]},proxy:!0}],null,!0)},[e("el-button",{attrs:{type:"text"}},[e("svg-icon",{attrs:{icon:"info",viewBox:"0 0 18 18"}})],1)],1)},a=[],_=i("9ab4"),n=i("1b40"),d=i("3673");let o=class extends n["e"]{};Object(_["a"])([Object(n["c"])({default:""})],o.prototype,"content",void 0),Object(_["a"])([Object(n["c"])({default:"right"})],o.prototype,"placement",void 0),Object(_["a"])([Object(n["c"])({default:"light"})],o.prototype,"effect",void 0),o=Object(_["a"])([Object(n["a"])({components:{svgIcon:d["a"]}})],o);var c=o,l=c,r=(i("74c5"),i("2877")),u=Object(r["a"])(l,s,a,!1,null,null,null);e["a"]=u.exports},"1c98":function(t,e,i){"use strict";var s=i("81a9"),a=i("bff7");e["a"]={create(t){return Object(s["a"])(Object(a["b"])("POST","/ebs/create_disk/",t))},get_disk_type(t){return Object(s["a"])(Object(a["b"])("GET","/ebs/disk_info/",t))},get_price(t){return Object(s["a"])(Object(a["b"])("POST","/ecs/get_price/",t))},get_capacity_price(t){return Object(s["a"])(Object(a["b"])("POST","/ebs/get_ebs_price/",t))},get_disk_limit(t){return Object(s["a"])(Object(a["b"])("POST","/ebs/get_disk_limit/",t))},get_disk_detail(t){return Object(s["a"])(Object(a["b"])("GET","/ebs/get_disk_detail/",t))},getDiskRules(t){return Object(s["a"])(Object(a["b"])("POST","/ebs/disk_rules/",t))}}},"24fb":function(t,e,i){},"2dc0":function(t,e,i){},"32df":function(t,e,i){"use strict";i("3d1f")},"3d1f":function(t,e,i){},4875:function(t,e,i){"use strict";var s=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("el-input-number",{attrs:{disabled:t.disable,step:t.size_info.disk_step,min:t.size_info.disk_min,max:t.size_info.disk_max},on:{blur:t.FnChange,change:t.FnChange},model:{value:t.size_info.size,callback:function(e){t.$set(t.size_info,"size",e)},expression:"size_info.size"}})},a=[],_=i("9ab4"),n=i("1b40");let d=class extends n["e"]{constructor(){super(...arguments),this.size_info={...this.info,size:NaN}}watch_info(t){this.size_info={...this.size_info,...this.info},this.FnChange()}async FnChange(){let t=0;if(this.size_info.size){let e=Math.min(this.size_info.disk_max,this.size_info.size)-this.size_info.disk_min;e=e>0?e:0;let i=Math.floor(e/this.size_info.disk_step);t=i*this.size_info.disk_step+this.size_info.disk_min}else t=this.size_info.disk_min;this.$nextTick(()=>{this.size_info.size=t,this.returnValue()})}returnValue(){return this.size_info}};Object(_["a"])([Object(n["c"])({default:!1})],d.prototype,"disable",void 0),Object(_["a"])([Object(n["c"])({default:()=>({disk_step:1,disk_min:1,disk_max:1})})],d.prototype,"info",void 0),Object(_["a"])([Object(n["f"])("info",{deep:!0,immediate:!0})],d.prototype,"watch_info",null),Object(_["a"])([Object(n["b"])("func")],d.prototype,"returnValue",null),d=Object(_["a"])([Object(n["a"])({})],d);var o=d,c=o,l=i("2877"),r=Object(l["a"])(c,s,a,!1,null,null,null);e["a"]=r.exports},6848:function(t,e,i){"use strict";i.r(e);var s=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",{staticClass:"root"},[e("back-header",{attrs:{title:"创建云盘",back_url:"/disk"}}),e("div",{staticClass:"main_box"},[e("div",{staticClass:"form_box"},[e("el-form",{ref:"form",staticClass:"demo-dynamic",attrs:{model:t.form_data,"label-width":"120px"}},[e("el-card",[e("el-form-item",{attrs:{prop:"customer_id",label:"客户ID",rules:[{required:!0,trigger:"blur",validator:t.validate_customer}]}},[e("el-input",{model:{value:t.form_data.customer_id,callback:function(e){t.$set(t.form_data,"customer_id",e)},expression:"form_data.customer_id"}})],1),e("el-form-item",{attrs:{prop:"customer_name",label:"客户名称"}},[e("div",[t._v(t._s(t.form_data.customer_name))])]),e("el-form-item",{attrs:{prop:"is_bill",label:"是否计费"}},[e("el-switch",{staticClass:"m-right10",attrs:{disabled:!t.form_data.customer_name,"active-value":"1","inactive-value":"0"},on:{change:t.changeBillMode},model:{value:t.form_data.is_bill,callback:function(e){t.$set(t.form_data,"is_bill",e)},expression:"form_data.is_bill"}}),e("mark-tip",{attrs:{content:"未计费的云盘无法挂载至计费的实例上"}})],1)],1),e("el-card",[e("el-form-item",{attrs:{prop:"isMounted",label:"是否挂载"}},[[e("el-button",{attrs:{type:"1"===t.form_data.isMounted?"primary":"default",disabled:!t.form_data.customer_name},on:{click:function(e){return t.mount("1")}}},[t._v("挂载到实例")]),e("el-button",{attrs:{type:"1"===t.form_data.isMounted?"default":"primary",disabled:!t.form_data.customer_name},on:{click:function(e){return t.mount("0")}}},[t._v("暂不挂载")])]],2)],1),e("el-card",[e("div",{staticClass:"card_inline"},[e("el-form-item",{attrs:{prop:"area",label:"1"===t.form_data.isMounted?"ECS实例":"地域及可用区"}},[e("Area",{attrs:{list:t.area_list,area:t.form_data.area},on:{get_area_id:t.get_area_id}})],1),e("el-form-item",{attrs:{prop:"az",label:""}},[e("el-select",{attrs:{placeholder:"请选择可用区"},model:{value:t.form_data.az,callback:function(e){t.$set(t.form_data,"az",e)},expression:"form_data.az"}},t._l(t.az_list,(function(t){return e("el-option",{key:t.az_id,attrs:{label:t.az_name,value:t.az_id}})})),1)],1),"1"===t.form_data.isMounted?e("el-form-item",{attrs:{prop:"ecs_id",label:""}},[e("el-select",{attrs:{placeholder:"请选择或输入实例名称（实例ID)",filterable:"","filter-method":t.get_instance_list},on:{"visible-change":t.change_ecs},model:{value:t.form_data.ecs_id,callback:function(e){t.$set(t.form_data,"ecs_id",e)},expression:"form_data.ecs_id"}},t._l(t.ECS_instance_list,(function(t){return e("el-option",{key:t.ecs_id,attrs:{label:`${t.ecs_id} / ${t.ecs_name}`,value:t.ecs_id}})})),1),t.form_data.ecs_id||"1"!==t.form_data.isMounted?t._e():e("div",{staticClass:"ecs-error"},[t._v("请选择或输入实例")])],1):t._e()],1),t.form_data.ecs_id&&"1"===t.form_data.isMounted?[e("el-form-item",{attrs:{prop:"instance_detail",label:"实例详情"}},[[e("div",{staticClass:"area"},[t._v("地域及可用区："+t._s(`${t.config_info.regionAz.value.split("-")[1]} ${t.config_info.regionAz.value.split("-")[2]}`))]),e("div",{staticClass:"area"},[t._v("实例规格: "+t._s(t.ecs_specifications))])],e("div",{staticClass:"prompt_message"},[t._v("提示：云盘挂载到实例后，您需要登录实例对挂载的云盘进行“分区格式化和挂载新分区”的操作后即可正式使用云盘")])],2)]:t._e()],2),"1"===t.form_data.isMounted?[e("el-card",[e("el-form-item",{attrs:{prop:"del_set",label:"删除设置"}},[e("el-checkbox",{model:{value:t.form_data.del_set,callback:function(e){t.$set(t.form_data,"del_set",e)},expression:"form_data.del_set"}},[t._v("云盘随实例删除")])],1)],1)]:t._e(),t._l(t.form_data.disk_list,(function(i,s){return e("el-card",{key:s},[e("el-form-item",{attrs:{prop:"disk_name",label:"云盘名称"}},[e("div",{staticClass:"disk-name"},[e("el-input",{attrs:{minlength:"2",maxlength:"40","show-word-limit":""},model:{value:i.disk_name,callback:function(e){t.$set(i,"disk_name",e)},expression:"inn.disk_name"}}),1===i.disk_name.trim().length?e("span",{staticClass:"name-error"},[t._v("云盘名称长度不能为1")]):i.disk_name.trim().length>1&&!/^[A-Za-z][\u4e00-\u9fa5_a-zA-Z0-9-_:()\u002E]{1,39}$/.test(i.disk_name)?e("span",{staticClass:"name-error"},[t._v("云盘名称不符合规范")]):t._e()],1),e("div",{staticClass:"remark"},[t._v("2-40个字符，可包含大小写字母、中文、数字、点号(.)、下划线(_)、半角冒号(:)、连字符(-)、英文括号(英文输入法下的括号)字符，以大小写字母开头")])]),e("div",{staticClass:"card_inline"},[e("el-form-item",{attrs:{prop:"ecs_goods_id",label:"类型/容量"}},[e("el-select",{on:{change:function(e){return t.change_type(e,s)}},model:{value:i.ecs_goods_id,callback:function(e){t.$set(i,"ecs_goods_id",e)},expression:"inn.ecs_goods_id"}},t._l(t.disk_type_list,(function(t){return e("el-option",{key:t.ecs_goods_id,attrs:{label:t.disk_value,value:t.ecs_goods_id}})})),1),e("div",{staticClass:"prompt_message"},[t._v("当前区域已购买 "),e("span",{staticClass:"num_message"},[t._v(t._s(t.data_disk_info&&t.data_disk_info[i.ecs_goods_id]?t.data_disk_info[i.ecs_goods_id].disk_feature:""))]),e("span",{staticClass:"num_message"},[t._v(" "+t._s(i?i.disk_size*i.amount:0))]),t._v(" "+t._s(t.data_disk_info&&t.data_disk_info[i.ecs_goods_id]?t.data_disk_info[i.ecs_goods_id].disk_unit:"GB")+"，还可以购买的容量额度为： "),e("span",{staticClass:"num_message"},[t._v(t._s(i?t.getResetInfo(i.ecs_goods_id,i.disk_size,i.amount).capacity:0))]),t._v(" "+t._s(t.data_disk_info&&t.data_disk_info[i.ecs_goods_id]?t.data_disk_info[i.ecs_goods_id].disk_unit:"GB")+" ")])],1),e("el-form-item",{attrs:{prop:"disk_size",label:""}},[e("input-number",{attrs:{disable:!t.form_data.customer_name,info:t.data_disk_info?t.size_info:null},on:{func:t.change_capacity}}),t._v("  "+t._s(t.data_disk_info&&t.data_disk_info[i.ecs_goods_id]?t.data_disk_info[i.ecs_goods_id].disk_unit:"GB")+" ")],1)],1),e("el-form-item",{attrs:{prop:"amount",label:"数量"}},[e("el-input-number",{attrs:{step:1,min:1,disabled:!t.form_data.customer_name,max:t.getEveryMaxNum(i)},on:{blur:function(e){return t.changeNum(s,i.amount)},change:function(e){return t.changeNum(s,i.amount)}},model:{value:i.amount,callback:function(e){t.$set(i,"amount",e)},expression:"inn.amount"}}),t._v(" 块 "),"1"===t.form_data.isMounted?e("div",{staticClass:"prompt_message"},[t._v("还可以挂载  "),e("span",{staticClass:"num_message"},[t._v(t._s(i?t.getEveryMaxNum(i)-i.amount:0))]),t._v("  块盘， 已挂载 "),e("span",{staticClass:"num_message"},[t._v(t._s(t.mounted_disk))]),t._v(" 块盘")]):t._e()],1)],1)})),"1"===t.form_data.is_bill?e("el-card",{staticClass:"m-bottom10"},[e("el-form-item",{attrs:{prop:"fee",label:"计费方式"}},[[e("el-button",{attrs:{type:"primary"}},[t._v("按需计费")])]],2)],1):t._e()],2)],1),e("div",{staticClass:"detail_box fixed-top"},[e("el-card",{staticClass:"box-card"},[e("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[e("span",[t._v("当前配置信息")])]),t._l(t.config_info,(function(i,s){return e("div",{key:s,staticClass:"config-info"},[e("div",[t._v(t._s(i.label))]),"ecs_name"===s?e("div",{class:["--"===i.value?"":"clickble"],on:{click:function(e){return t.goToDetail(i.value)}}},[t._v(t._s(i.value))]):e("div",[t._v(t._s(i.value))])])}))],2)],1),e("div",{staticClass:"button_box"},[e("el-card",{staticClass:"box-card"},["1"===t.form_data.is_bill?e("div",{staticClass:"flex-between m-bottom20"},[e("div",[t._v("总价：")]),e("div",{staticClass:"num_message price"},[t._v(t._s(t.total_price))])]):t._e(),e("el-button",{attrs:{type:"primary",disabled:!t.form_data.customer_name||t.curTotal>t.showResetVolume[t.form_data.disk_list[0].disk_feature]},on:{click:t.create}},[t._v("创建")])],1)],1)]),t.detail_visible?[e("Detail",{attrs:{visible:t.detail_visible,detail_id:t.form_data.ecs_id},on:{"close-detail":t.closeDetail}})]:t._e(),t.visible?[e("confirm-box",{attrs:{visible:t.visible},on:{"update:visible":function(e){t.visible=e},"fn-create":t.createConfirm}})]:t._e()],2)},a=[],_=(i("d9e2"),i("14d9"),i("e9f5"),i("910d"),i("7d54"),i("ab43"),i("a732"),i("9ab4")),n=i("1b40"),d=i("ed46"),o=i("38a7"),c=i("9074"),l=i("e527"),r=i("1c98"),u=i("d772"),m=i("76ff"),f=i("3673"),p=i("8bcb"),b=i("8ce4"),h=i("1b7c"),g=i("c550"),k=i("4875");let v=class extends n["e"]{constructor(){super(...arguments),this.form_data={customer_id:"",customer_name:"",isMounted:"1",is_bill:"1",area:"",az:"",ecs_id:"",del_set:!0,disk_list:[{disk_name:"",ecs_goods_id:"",disk_size:0,amount:1,iops:2824,throughput:96,disk_feature:"",disk_max:1}]},this.data_disk_info=null,this.ecs_specifications="",this.az_list=[],this.ECS_instance_list=[],this.area_list=[],this.disk_type_list=[],this.detail_visible=!1,this.customerID="",this.billing_info={},this.visible=!1,this.total_price="￥0.00/天",this.price_unit="￥",this.showResetVolume={},this.ecs_mounted_disk=0,this.mounted_disk=0,this.size_info={},this.config_info={regionAz:{label:"地域及可用区：",value:"--"},ecs_name:{label:"挂载实例名称：",value:"--"},disk:{label:"云盘规格：",value:"--"},amount:{label:"购买数量：",value:"1"},fee:{label:"计费方式",value:"按需计费"}},this.validate_customer=(t,e,i)=>e?e.length>0&&e.length<=6?i(new Error("请输入正确的客户ID")):i():i(new Error("请输入客户ID"))}mounted(){const t=this.$refs.form;t.validate(t=>{})}watch_customer_id(t){const e=this.$refs.form;e.validate(t=>{t&&this.get_customer_name()})}watch_ecs_id(t){t&&this.get_mounted_num()}watch_az(t){let e=this.config_info.regionAz.value.split("-"),i=this.az_list.filter(e=>e.az_id===t);e[2]=i[0].az_name,this.config_info.regionAz.value=e.join("-"),this.get_instance_list(),this.get_disk_info()}get curTotal(){return"1"===this.form_data.is_bill&&this.getDiskFee(),this.form_data.disk_list[0].disk_size*this.form_data.disk_list[0].amount}async get_customer_name(){const t=await c["a"].get_customer_name({customer_id:this.form_data.customer_id});"Success"==t.code&&(this.form_data={...this.form_data,customer_name:t.data.customer_name},this.mount(this.form_data.isMounted),this.customerID=t.data.customer_id,this.get_area_list(),this.price_unit=t.data.area_id,this.total_price="$"===this.price_unit?"$0.00/day":"￥0.00/天")}async get_area_list(){const t=await c["a"].get_region_az_list({customer_id:this.form_data.customer_id});"Success"==t.code&&(this.area_list=t.data)}change_ecs(t){!t&&this.form_data.customer_id&&this.get_instance_list()}changeBillMode(t){this.form_data.is_bill=t,this.form_data.ecs_id="",this.get_instance_list(),this.config_info.ecs_name.value="",0===Number(t)?(this.total_price="$"===this.price_unit?"$0.00/day":"￥0.00/天",this.config_info.fee.value="不计费"):(this.getDiskFee(),this.config_info.fee.value="按需计费")}async getDiskFee(){let t=this.form_data.disk_list[0];if(0===Object.keys(this.billing_info).length||!t.disk_feature)return;const e=["ebs_goods_id","storage_space","iops","ebs_number","handling_capacity","disk_feature"],i=["ecs_goods_id","disk_size","iops","amount","throughput","disk_feature"];let s=Object(b["b"])(this.form_data.disk_list,e,i),a=Object(b["a"])(this.billing_info),_=await r["a"].get_price({az_id:this.form_data.az,customer_id:this.form_data.customer_id,number:1,is_gpu:0,billing_method:"0",disk_info:{billing_info:a,data_disk:s}});if("Success"===_.code){const{price_symbol:t,price_unit:e,total_price:i}=_.data;this.total_price=`${t}${Number(i).toFixed(2)}/${e}`}}async get_instance_list(t=""){const e=await l["a"].get_instance_list({page_index:1,page_size:20,keyword:t,customer_id:this.form_data.customer_id,az_id:this.form_data.az,billing_method:"all"});"Success"==e.code&&(this.ECS_instance_list=e.data.ecs_list.filter(t=>["running","shutdown"].includes(t.status)&&!t.is_gpu&&t.is_charge===Number(this.form_data.is_bill)&&!t.no_charge_for_shutdown))}async get_disk_info(){const t=await r["a"].get_disk_type({customer_id:this.form_data.customer_id,az_id:this.form_data.az,billing_method:"0"});if("Success"==t.code){this.billing_info=t.data.billing_info,this.disk_type_list=t.data.data_disk;let e=[];this.disk_type_list.map(t=>{e.push(t.disk_feature),this.data_disk_info=Object.assign({},this.data_disk_info,{[t.ecs_goods_id]:t})}),this.get_disk_limit(e)}}async get_disk_limit(t){let e=await r["a"].get_disk_limit({customer_id:this.form_data.customer_id,az_id:this.form_data.az,feature:t});if("Success"===e.code){this.showResetVolume={};for(let t in e.data)this.showResetVolume[t]=e.data[t].rest_volume;this.$nextTick(()=>{let t=this.disk_type_list.filter(t=>"SSD"===t.disk_feature);0===t.length&&(t=[this.disk_type_list[0]]),this.form_data={...this.form_data,disk_list:this.form_data.disk_list.map((e,i)=>(e.ecs_goods_id=t[0].ecs_goods_id,e.disk_feature=t[0].disk_feature,e.amount=1,this.change_type(e.ecs_goods_id,i),this.getEveryMaxNum(e),this.config_info.amount.value=this.form_data.disk_list[0].amount,e))}})}}getEveryMaxNum(t){if(!this.form_data.customer_id)return 16;let e=t.disk_size*t.amount,i=Math.floor(Math.max(this.showResetVolume[t.disk_feature]-e,0)/t.disk_size),s=i+t.amount>16-this.mounted_disk?16-this.mounted_disk:i+t.amount;return"1"===this.form_data.isMounted?s:i+t.amount}getResetInfo(t,e,i){let s=0;if(this.data_disk_info&&this.data_disk_info[t]&&this.showResetVolume[this.data_disk_info[t].disk_feature]>0){let a=this.showResetVolume[this.data_disk_info[t].disk_feature]?this.showResetVolume[this.data_disk_info[t].disk_feature]-e*i:0;s=a,this.config_info.disk.value=`${this.data_disk_info[t].disk_feature} | ${e*i}GB`}return{capacity:s}}clearEcs(){this.form_data.ecs_id="",this.mounted_disk=0,this.config_info.ecs_name.value="--",this.ecs_specifications="",this.get_instance_list()}async get_mounted_num(){const t=await u["a"].get_detail({ecs_id:this.form_data.ecs_id});if("Success"==t.code){const{data:{disk:e,ecs_rule:i,ecs_name:s}}=t;this.mounted_disk=e.data_disk_conf?e.data_disk_conf.length:0,this.config_info.ecs_name.value=s,this.ecs_specifications=i.name+"  "+i.cpu_num+i.cpu_unit+i.ram+i.ram_unit,16===this.mounted_disk&&(this.$message.warning("该实例云盘已挂满！"),this.clearEcs()),this.resetDiskMounted()}}resetDiskMounted(){this.form_data={...this.form_data,disk_list:this.form_data.disk_list.map(t=>(t.amount=1,t))},this.config_info.amount.value=this.form_data.disk_list[0].amount}mount(t){this.resetDiskMounted(),this.clearEcs(),this.form_data={...this.form_data,isMounted:t}}get_area_id(t){const{area_list:e}=this;let i,s;e.forEach(e=>{e.region_list&&e.region_list.forEach(a=>{a.region_id===t&&(s=a.region_name,i=e.region_group_name,this.az_list=a.az_list)})}),this.form_data={...this.form_data,area:t,az:this.az_list[0].az_id},this.config_info.regionAz.value=i+"-"+s+"-"+this.az_list[0].az_name,this.clearEcs()}async changeNum(t,e){await this.$nextTick(()=>{e||this.$set(this.form_data.disk_list[t],"amount",1)}),this.config_info.amount.value=this.form_data.disk_list[0].amount,this.getDiskFee()}goToDetail(t){"--"!==t&&(this.detail_visible=!0)}closeDetail(){this.detail_visible=!1}get_step_max(t){return this.data_disk_info?{step:this.data_disk_info[t].disk_step,max:this.form_data.disk_list[0].disk_max,min:this.data_disk_info[t].disk_min}:{step:1,max:1,min:1}}change_type(t,e){this.form_data.disk_list[e].disk_feature=this.data_disk_info[t].disk_feature;let i=this.form_data.disk_list[e].disk_feature;this.form_data.disk_list[e].iops=Object(p["a"])(this.data_disk_info[t]).iops,this.form_data.disk_list[e].throughput=Object(p["a"])(this.data_disk_info[t]).throughput,this.form_data.disk_list[e].disk_size=this.data_disk_info[t].disk_min,this.form_data.disk_list[e].disk_max=this.showResetVolume[i]?Math.min(this.showResetVolume[i],this.data_disk_info[t].disk_max):this.data_disk_info[t].disk_max,this.get_step_max(this.form_data.disk_list[e].ecs_goods_id),this.size_info={...this.data_disk_info[t],disk_max:this.get_step_max(t).max,size:this.data_disk_info[t].disk_min},this.getDiskFee()}async change_capacity(t){this.form_data.disk_list.map(e=>(e.ecs_goods_id===t.ecs_goods_id&&(e.disk_size=t.size,e.iops=Object(p["a"])(t,t.size).iops,e.throughput=Object(p["a"])(t,t.size).throughput,e.disk_size*e.amount>this.showResetVolume[e.disk_feature]&&(e.amount=1),this.config_info.amount.value=this.form_data.disk_list[0].amount),e)),"1"===this.form_data.is_bill&&this.getDiskFee()}createConfirm(){const t=this.$refs.form,e=["ebs_goods_id","disk_size","storage_space","disk_iops","iops","amount","band_mbps","handling_capacity","disk_feature","disk_name"],i=["ecs_goods_id","disk_size","disk_size","iops","iops","amount","throughput","throughput","disk_feature","disk_name"];let s=Object(b["b"])(this.form_data.disk_list,e,i),a=Object(b["a"])(this.billing_info,!0);t.validate(async t=>{if(!t)return!1;{const{form_data:{ecs_id:t,del_set:e,az:i}}=this;let _=await r["a"].create({customer_id:this.customerID,ecs_id:t,is_follow_delete:e?"1":"0",az_id:i,disk_list:s,billing_info:"1"===this.form_data.is_bill?a:{}});"Success"===_.code&&this.$message.success("云盘创建任务下发成功"),this.$router.push("/disk")}})}async create(){if(""===this.form_data.ecs_id&&"1"===this.form_data.isMounted)return;let t=/^[A-Za-z][\u4e00-\u9fa5_a-zA-Z0-9-_:()\u002E]{1,39}$/;this.form_data.disk_list.some(e=>1===e.disk_name.trim().length||e.disk_name.trim().length>1&&!t.test(e.disk_name))||(this.form_data.disk_list.map(t=>(t.disk_name=0===t.disk_name.trim().length?"":t.disk_name,t)),this.visible=!0)}};Object(_["a"])([Object(n["f"])("form_data.customer_id")],v.prototype,"watch_customer_id",null),Object(_["a"])([Object(n["f"])("form_data.ecs_id")],v.prototype,"watch_ecs_id",null),Object(_["a"])([Object(n["f"])("form_data.az")],v.prototype,"watch_az",null),v=Object(_["a"])([Object(n["a"])({components:{backHeader:d["a"],Area:o["a"],Detail:m["a"],svgIcon:f["a"],MarkTip:h["a"],ConfirmBox:g["a"],InputNumber:k["a"]}})],v);var O=v,j=O,y=(i("cb71"),i("32df"),i("2877")),z=Object(y["a"])(j,s,a,!1,null,"65be626a",null);e["default"]=z.exports},"74c5":function(t,e,i){"use strict";i("2dc0")},"76ff":function(t,e,i){"use strict";var s=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",[e("el-dialog",{attrs:{title:"配置详情",visible:t.visible,width:"60%","destroy-on-close":!0},on:{"update:visible":function(e){t.visible=e},close:t.back}},[e("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}]},[e("el-row",{attrs:{gutter:20}},[e("el-col",{attrs:{span:10}},[e("span",{staticClass:"label"},[t._v("云服务器ID:")]),e("span",[t._v(t._s(t.detail&&t.detail.ecs_id))])]),e("el-col",{attrs:{span:10}},[e("span",{staticClass:"label"},[t._v("地域:")]),e("span",[t._v(t._s(t.detail&&t.detail.region_name))])])],1),e("el-row",{attrs:{gutter:20}},[e("el-col",{staticClass:"name-row",attrs:{span:10}},[e("span",{staticClass:"label"},[t._v("云服务器名称:")]),e("span",[e("pre",[t._v(t._s(t.detail&&t.detail.ecs_name))])])]),e("el-col",{attrs:{span:10}},[e("span",{staticClass:"label"},[t._v("可用区:")]),e("span",[t._v(t._s(t.detail&&t.detail.az_name))])])],1),e("el-row",{attrs:{gutter:20}},[e("el-col",{attrs:{span:10}},[e("span",{staticClass:"label"},[t._v("状态:")]),e("span",[t._v(t._s(t.detail&&t.detail.status_display))])])],1),e("div",{staticClass:"title"},[t._v("计算规格")]),e("el-row",{attrs:{gutter:20}},[t.detail&&t.detail.ecs_rule&&t.detail.ecs_rule.conf_name?e("el-col",{attrs:{span:20}},[e("span",{staticClass:"label"},[t._v(t._s(t.detail&&t.detail.ecs_rule&&t.detail.ecs_rule.conf_name)+":")]),e("span",[t._v(t._s(t.detail&&t.detail.ecs_rule&&t.detail.ecs_rule.name))]),t.detail&&t.detail.ecs_rule&&t.detail.ecs_rule.cpu_num?e("span",[t._v("   "+t._s(t.detail&&t.detail.ecs_rule&&t.detail.ecs_rule.cpu_num)+"vCPU "),e("span",[t._v(t._s(t.detail&&t.detail.ecs_rule&&t.detail.ecs_rule.ram)+"GiB")]),t.detail&&t.detail.is_gpu?e("span",[t._v(t._s(t.detail&&t.detail.ecs_rule&&t.detail.ecs_rule.gpu)+"*"+t._s(t.detail&&t.detail.card_name))]):t._e()]):t._e()]):t._e()],1),e("div",{staticClass:"title"},[t._v("操作系统")]),e("div",{staticClass:"content"},[t._v(t._s(t.detail&&t.detail.os_info&&t.detail.os_info.name))]),e("div",{staticClass:"title"},[t._v("存储")]),e("div",{staticClass:"content"},[e("span",{staticClass:"label"},[t._v("系统盘：")]),t.detail&&t.detail.disk&&t.detail.disk.system_disk_conf?e("span",{staticClass:"data-disk"},[t._v(t._s(t.detail&&t.detail.disk&&t.detail.disk.system_disk_conf&&t.detail.disk.system_disk_conf.disk_name))]):t._e(),t.detail&&t.detail.disk&&t.detail.disk.system_disk_conf&&t.detail.disk.system_disk_conf.size?e("span",{staticClass:"data-disk-unit"},[t._v(t._s(t.detail&&t.detail.disk&&t.detail.disk.system_disk_conf&&t.detail.disk.system_disk_conf.size)+t._s(t.detail&&t.detail.disk&&t.detail.disk.system_disk_conf&&t.detail.disk.system_disk_conf.unit))]):t._e(),t.detail&&t.detail.disk&&t.detail.disk.system_disk_conf&&t.detail.disk.system_disk_conf.id?e("span",{staticClass:"id_name"},[t._v("("+t._s(t.detail&&t.detail.disk&&t.detail.disk.system_disk_conf&&t.detail.disk.system_disk_conf.id)+" / "+t._s(t.detail&&t.detail.disk&&t.detail.disk.system_disk_conf&&t.detail.disk.system_disk_conf.name)+")")]):t._e()]),e("div",{staticClass:"content data_disk"},[e("span",{staticClass:"label"},[t._v("数据盘：")]),t.detail&&t.detail.disk&&t.detail.disk.data_disk_conf?e("div",{staticClass:"disk_content"},t._l(t.detail.disk.data_disk_conf,(function(i){return e("div",{key:i.id},[e("span",{staticClass:"data-disk"},[t._v(t._s(i.disk_name))]),e("span",{staticClass:"data-disk-unit"},[t._v(t._s(i.size)+t._s(i.unit))]),e("span",{staticClass:"id_name"},[t._v("("+t._s(i.id)+" / "+t._s(i.name)+")")]),e("span",[t._v(t._s(i.is_follow_delete?"随实例删除":"不随实例删除"))])])})),0):t._e()]),e("div",{staticClass:"title"},[t._v("网络")]),e("div",{staticClass:"content"},[e("span",{staticClass:"label"},[t._v("VPC:")]),t.detail&&t.detail.pipe&&t.detail.pipe.vpc_id?e("span",[t._v(t._s(t.detail&&t.detail.pipe&&t.detail.pipe.vpc_id)+" / "+t._s(t.detail&&t.detail.pipe&&t.detail.pipe.vpc_name))]):t._e()]),e("div",{staticClass:"content"},[e("span",{staticClass:"label"},[t._v("子网:")]),t.detail&&t.detail.pipe&&t.detail.pipe.subnet_id?e("span",[t._v(t._s(t.detail&&t.detail.pipe&&t.detail.pipe.subnet_id)+" / "+t._s(t.detail&&t.detail.pipe&&t.detail.pipe.subnet_name))]):t._e()]),e("div",{staticClass:"content display-flex"},[e("span",{staticClass:"label"},[t._v("私网IP：")]),t.detail&&t.detail.pipe?e("span",[t.detail.pipe.private_net?[t._v(t._s(t.detail.pipe.private_net)+" （主）")]:t._e(),e("br"),t.detail.pipe.pub_net?[t._v(" "+t._s(t.detail.pipe.pub_net)+" "),t.detail.pipe.eip_info[t.detail.pipe.pub_net]&&t.detail.pipe.eip_info[t.detail.pipe.pub_net].conf_name?[t._v(" （"+t._s(t.detail.pipe.eip_info[t.detail.pipe.pub_net].conf_name)+"） ")]:t._e(),e("br")]:t._e(),t._l(t.detail.pipe.virtual_net,(function(i){return e("span",{key:i},[t._v(" "+t._s(i)+" "),t.detail.pipe.eip_info[i]&&t.detail.pipe.eip_info[i].conf_name?[t._v(" （"+t._s(t.detail.pipe.eip_info[i].conf_name)+"） ")]:t._e(),e("br")],2)}))],2):t._e()]),e("div",{staticClass:"content display-flex"},[e("span",{staticClass:"label"},[t._v("公网IP：")]),t.detail&&t.detail.pipe?e("span",[t.detail.pipe.pub_net&&t.detail.pipe.eip_info[t.detail.pipe.pub_net]&&t.detail.pipe.eip_info[t.detail.pipe.pub_net].eip_ip?[t._v(" "+t._s(t.detail.pipe.eip_info[t.detail.pipe.pub_net].eip_ip)+" （"+t._s(t.detail.pipe.eip_info[t.detail.pipe.pub_net].conf_name)+"） "),e("br")]:t._e(),t._l(t.detail.pipe.virtual_net,(function(i){return e("span",{key:i},[t.detail.pipe.eip_info[i]&&t.detail.pipe.eip_info[i].conf_name?[t._v(" "+t._s(i.eip_ip)+" （"+t._s(t.detail.pipe.eip_info[i].conf_name)+"） ")]:t._e(),e("br")],2)}))],2):t._e()]),e("div",{staticClass:"divider"}),e("div",{staticClass:"content"},[e("span",{staticClass:"label"},[t._v("所属机房:")]),e("span",[t._v(t._s(t.detail&&t.detail.engine_room))])]),e("div",{staticClass:"content"},[e("span",{staticClass:"label"},[t._v("所属节点:")]),e("span",[t._v(t._s(t.detail&&t.detail.host_name))])]),e("div",{staticClass:"content"},[e("span",{staticClass:"label"},[t._v("所属物理机:")]),t.detail&&t.detail.host_id?e("span",[t._v(t._s(t.detail&&t.detail.host_id)+"   "),t.detail&&t.detail.host_status?e("span",[t._v("( "+t._s(t.detail&&t.detail.host_status)+" )")]):t._e()]):t._e()]),e("div",{staticClass:"content"},[e("span",{staticClass:"label"},[t._v("处理器型号:")]),e("span",[t._v(t._s(t.detail&&t.detail.cpu_type))])]),e("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{attrs:{type:"primary"},on:{click:t.back}},[t._v("返回")])],1)],1)])],1)},a=[],_=i("9ab4"),n=i("1b40"),d=i("d772");let o=class extends n["e"]{constructor(){super(...arguments),this.detail=null,this.loading=!1}async getDetail(){let t=await d["a"].get_detail({ecs_id:this.detail_id});"Success"===t.code?(this.loading=!1,this.detail=t.data):this.loading=!1}back(){}created(){this.getDetail()}};Object(_["a"])([Object(n["c"])(Boolean)],o.prototype,"visible",void 0),Object(_["a"])([Object(n["c"])(String)],o.prototype,"detail_id",void 0),Object(_["a"])([Object(n["b"])("close-detail")],o.prototype,"back",null),o=Object(_["a"])([n["a"]],o);var c=o,l=c,r=(i("88bb"),i("2877")),u=Object(r["a"])(l,s,a,!1,null,"33b12e64",null);e["a"]=u.exports},"88bb":function(t,e,i){"use strict";i("d9aa")},"8bcb":function(t,e,i){"use strict";function s(t,e=NaN){let i=e?(e-Number(t.disk_min))/Number(t.disk_step):0,s=Number(t.min_iops)+Number(t.iops_step)*i>t.max_iops?t.max_iops:Number(t.min_iops)+Number(t.iops_step)*i,a=Number(t.min_throughput)+Number(t.throughput_step)*i>t.max_throughput?t.max_throughput:Number(t.min_throughput)+Number(t.throughput_step)*i;return{iops_show:s+" "+t.iops_unit,throughput_show:a+" "+t.throughput_unit,iops:s,throughput:a}}i.d(e,"a",(function(){return s}))},"8ce4":function(t,e,i){"use strict";i.d(e,"e",(function(){return s})),i.d(e,"b",(function(){return a})),i.d(e,"a",(function(){return _})),i.d(e,"c",(function(){return n})),i.d(e,"d",(function(){return d}));i("14d9"),i("e9f5"),i("ab43");function s(t,e,i,s,a){let _=[];return t.map(t=>{_.push({[s]:t[e],[a]:t[i]})}),_}function a(t,e,i,s={}){let a=[];return t.map(t=>{let _={};e.map((e,s)=>{_[e]=t[i[s]]}),a.push({..._,...s})}),a}function _(t,e=!1){let i={};for(let s in t){const{billing_scheme_id:a,billing_cycle_id:_,billing_items:n,gic_goods_id:d}=t[s];let o={};for(let t in n){let i={attr_id:n[t].attr_id,name:n[t].name},s={id:n[t].id,key:t};o[t]=e?{...i,...s}:s}i[s]={billing_scheme_id:a,billing_cycle_id:_,billing_items:o,gic_goods_id:e?d:void 0}}return i}function n(t,e){return t.map(t=>t[e])}function d(t){let e="";for(let i in t)t[i]&&(e+=`${i}=${t[i]}&`);return""===e?"":"?"+e.slice(0,e.length-1)}},9074:function(t,e,i){"use strict";var s=i("81a9"),a=i("bff7");e["a"]={get_customer_name(t){return Object(s["a"])(Object(a["b"])("POST","/ecs/get_customer_name/",t))},get_region_az_list(t){return Object(s["a"])(Object(a["b"])("POST","/ecs/region_az_info/",t))},get_net_list(t){return Object(s["a"])(Object(a["b"])("POST","/ecs/net_info/",t))},get_all_cpu_ram(){return Object(s["a"])(Object(a["b"])("GET","/ecs/ram_cpu_list/"))},get_category_list(t){return Object(s["a"])(Object(a["b"])("GET","/ecs/ecs_category_list/",t))},ecs_family_info(t){return Object(s["a"])(Object(a["b"])("GET","/ecs/ecs_family_info/",t))},get_os_list(t){return Object(s["a"])(Object(a["b"])("POST","/img/image_info/",t))},get_price(t){return Object(s["a"])(Object(a["b"])("POST","/ecs/get_price/",t))},create_instance(t){return Object(s["a"])(Object(a["b"])("POST","/ecs/create_ecs/",t))},get_ecs_limit(t){return Object(s["a"])(Object(a["b"])("POST","/ecs/get_ecs_limit/",t))},get_ram_cpu_price_list(t){return Object(s["a"])(Object(a["b"])("POST","/ecs/ecs_spec_attach_price/",t))},difference_price(t){return Object(s["a"])(Object(a["b"])("POST","/ecs/ecs_difference_price/",t))},change_configure_limit(t){return Object(s["a"])(Object(a["b"])("POST","/ecs/change_configure_limit/",t))}}},a732:function(t,e,i){"use strict";var s=i("23e7"),a=i("c65b"),_=i("2266"),n=i("59ed"),d=i("825a"),o=i("46c4"),c=i("2a62"),l=i("f99f"),r=l("some",TypeError);s({target:"Iterator",proto:!0,real:!0,forced:r},{some:function(t){d(this);try{n(t)}catch(s){c(this,"throw",s)}if(r)return a(r,this,t);var e=o(this),i=0;return _(e,(function(e,s){if(t(e,i++))return s()}),{IS_RECORD:!0,INTERRUPTED:!0}).stopped}})},cb71:function(t,e,i){"use strict";i("24fb")},d772:function(t,e,i){"use strict";var s=i("81a9"),a=i("bff7");e["a"]={get_operate_record_list(t){return Object(s["a"])(Object(a["b"])("GET","/ecs/history_record/",t))},get_detail(t){return Object(s["a"])(Object(a["b"])("GET","/ecs/get_ecs_detail/",t))}}},d9aa:function(t,e,i){},e527:function(t,e,i){"use strict";var s=i("81a9"),a=i("bff7"),_=i("4328"),n=i.n(_);e["a"]={get_instance_list(t){return Object(s["a"])(Object(a["b"])("POST","/ecs/ecs_list/",t))},operate_instance(t){return Object(s["a"])(Object(a["b"])("POST","/ecs/operate/",t))},delete_instance(t){return Object(s["a"])(Object(a["b"])("POST","/ecs/delete/",t))},recover_instance(t){return Object(s["a"])(Object(a["b"])("POST","/ecs/recover/",t))},destroy_instance(t){return Object(s["a"])(Object(a["b"])("POST","/ecs/destroy/",t))},get_status_list(){return Object(s["a"])(Object(a["b"])("GET","/ecs/ecs_status_list/"))},get_family_data(){return Object(s["a"])(Object(a["b"])("GET","/ecs/get_family_data/"))},reset_password(t){return Object(s["a"])(Object(a["b"])("POST","/ecs/ecs_reset_password/",t))},update_spec(t){return Object(s["a"])(Object(a["b"])("POST","/ecs/ecs_change_configure/",t))},update_system(t){return Object(s["a"])(Object(a["b"])("POST","/ecs/ecs_change_system/",t))},get_usage_ip(t){return Object(s["a"])(Object(a["b"])("GET","/ecs/get_deleted_ecs_ip/",t))},get_vnc_url(t){return Object(s["a"])(Object(a["b"])("GET","/ecs/vnc_info/",t))},start_charge(t){return Object(s["a"])(Object(a["b"])("POST","/resource/start_charge/",t))},change_config_price(t){return Object(s["a"])(Object(a["b"])("POST","/ecs/change_config_price/",t))},change_system_price(t){return Object(s["a"])(Object(a["b"])("POST","/ecs/change_system_price/",t))},each_resource_price(t){return Object(s["a"])(Object(a["b"])("POST","/ecs/each_resource_price/",t))},add_common_mirror(t){return Object(s["a"])(Object(a["b"])("POST","/img/create_pub_image_by_ecs/",t))},set_net(t){return Object(s["a"])(Object(a["b"])("POST","/ecs/ecs_set_base_nic/",t))},get_default_dns(t){return Object(s["a"])(Object(a["b"])("POST","/ecs/az_default_dns/",t))},mount_gpu_card(t){return Object(s["a"])(Object(a["b"])("POST","/ecs/instance_gpu_card/",t))},update_gpu_status(t){return Object(s["a"])(Object(a["b"])("POST","/ecs/update_gpu_status/",t))},export_list(t){return Object(s["a"])({method:"GET",url:"/ecs_business/v1/ecs/ecs_list_download/",params:t,paramsSerializer:t=>n.a.stringify(t),responseType:"blob"})},get_tag_list(){return Object(s["a"])(Object(a["b"])("GET","/ecs/get_tag_list/"))},get_rescue_image_list(t){return Object(s["a"])(Object(a["b"])("GET","/ecs/get_rescue_image_list/",t))},enter_rescue(t){return Object(s["a"])(Object(a["b"])("POST","/ecs/enter_rescue/",t))},exit_rescue(t){return Object(s["a"])(Object(a["b"])("POST","/ecs/exit_rescue/",t))}}}}]);