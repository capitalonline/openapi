(window["webpackJsonp_AppSp"]=window["webpackJsonp_AppSp"]||[]).push([["chunk-1365e416"],{"78da":function(e,t,s){},"8e80":function(e,t,s){"use strict";s.r(t);var i=function(){var e=this,t=e._self._c;e._self._setupProxy;return t("div",[t("action-block",{attrs:{search_option:e.search_con,create_btn:"新建子任务配置",disabled:!1},on:{"fn-search":e.FnGetList,"fn-create":e.FnShowCreate}}),t("el-table",{ref:"table",attrs:{data:e.task_list,border:"","row-class-name":e.rowStyle},on:{"selection-change":e.handleSelectionChange,"row-click":e.FnOperRow,"row-contextmenu":e.FnRightClick}},[t("el-table-column",{attrs:{type:"selection"}}),t("el-table-column",{attrs:{type:"expand"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("el-form",{attrs:{"label-position":"left"}},[t("el-form-item",{attrs:{label:"依赖参数"}},[t("span",[e._v(e._s(s.row.dependent_params))])]),t("el-form-item",{attrs:{label:"执行对象"}},[t("span",[e._v(e._s(s.row.executor))])]),t("el-form-item",{attrs:{label:"执行地址"}},[t("span",[e._v(e._s(s.row.executor_path))])]),t("el-form-item",{attrs:{label:"检查URL"}},[t("span",[e._v(e._s(s.row.check_url))])]),t("el-form-item",{attrs:{label:"回退URL"}},[t("span",[e._v(e._s(s.row.callback_url))])])],1)]}}])}),t("el-table-column",{attrs:{prop:"id",label:"ID"}}),t("el-table-column",{attrs:{prop:"subtask_name",label:"名称"}}),t("el-table-column",{attrs:{prop:"is_series",label:"重复配置"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("div",[e._v(e._s(s.row.is_series))]),s.row.is_series?t("div",[e._v(e._s(s.row.serial_set_key))]):e._e()]}}])}),t("el-table-column",{attrs:{prop:"priority",label:"优先级"}}),t("el-table-column",{attrs:{prop:"retry",label:"重试次数"}}),t("el-table-column",{attrs:{prop:"timeout",label:"超时时间"}}),t("el-table-column",{attrs:{prop:"is_period",label:"周期性任务"}}),t("el-table-column",{attrs:{prop:"is_async",label:"异步任务"}}),t("el-table-column",{attrs:{prop:"timeout",label:"检查时间间隔"}}),t("el-table-column",{attrs:{prop:"is_valid",label:"is_valid"}})],1),t("el-pagination",{attrs:{"current-page":e.page_info.page_index,"page-sizes":e.page_info.page_sizes,"page-size":e.page_info.page_size,layout:"total, sizes, prev, pager, next, jumper",total:e.page_info.total},on:{"size-change":function(t){return e.FnGetList()},"current-change":function(t){return e.FnGetList()},"update:currentPage":function(t){return e.$set(e.page_info,"page_index",t)},"update:current-page":function(t){return e.$set(e.page_info,"page_index",t)},"update:pageSize":function(t){return e.$set(e.page_info,"page_size",t)},"update:page-size":function(t){return e.$set(e.page_info,"page_size",t)}}}),t("el-dialog",{attrs:{title:e.dialog_title,visible:e.create_dialog,width:"60%"},on:{"update:visible":function(t){e.create_dialog=t},close:e.FnClose}},[t("div",[t("label-block",{attrs:{label:"子任务名称"},scopedSlots:e._u([{key:"default",fn:function(){return[t("el-input",{attrs:{type:"text"},model:{value:e.sub_config.subtask_name,callback:function(t){e.$set(e.sub_config,"subtask_name",t)},expression:"sub_config.subtask_name"}})]},proxy:!0}])}),t("label-block",{staticClass:"switch-box",attrs:{label:"可重复配置"},scopedSlots:e._u([{key:"default",fn:function(){return[t("el-switch",{attrs:{"active-color":"#455cc6","inactive-color":"#ccc"},model:{value:e.sub_config.is_series,callback:function(t){e.$set(e.sub_config,"is_series",t)},expression:"sub_config.is_series"}}),e.sub_config.is_series?t("label-block",{attrs:{label:"重复配置主参数"},scopedSlots:e._u([{key:"default",fn:function(){return[t("el-input",{attrs:{type:"text"},model:{value:e.sub_config.serial_set_key,callback:function(t){e.$set(e.sub_config,"serial_set_key",t)},expression:"sub_config.serial_set_key"}})]},proxy:!0}],null,!1,2914736650)}):e._e(),e.sub_config.is_series?t("label-block",{attrs:{label:"重复配置子参数"},scopedSlots:e._u([{key:"default",fn:function(){return[t("params",{attrs:{params:e.FnHandleParam(e.default_serial_set_sub_params)},on:{"fn-change":e.FnGetSerial}})]},proxy:!0}],null,!1,1059413572)}):e._e()]},proxy:!0}])}),t("label-block",{attrs:{label:"子任务依赖参数"},scopedSlots:e._u([{key:"default",fn:function(){return[t("params",{attrs:{params:e.FnHandleParam(e.default_dependent_params)},on:{"fn-change":e.FnGetDep}})]},proxy:!0}])}),t("label-block",{attrs:{label:"子任务优先级"},scopedSlots:e._u([{key:"default",fn:function(){return[t("el-input-number",{attrs:{min:1,max:10},model:{value:e.sub_config.priority,callback:function(t){e.$set(e.sub_config,"priority",t)},expression:"sub_config.priority"}})]},proxy:!0}])}),t("label-block",{attrs:{label:"子任务重试次数"},scopedSlots:e._u([{key:"default",fn:function(){return[t("el-input-number",{attrs:{min:1,max:10},model:{value:e.sub_config.retry,callback:function(t){e.$set(e.sub_config,"retry",t)},expression:"sub_config.retry"}}),e._v(" 次 ")]},proxy:!0}])}),t("label-block",{attrs:{label:"子任务超时时间"},scopedSlots:e._u([{key:"default",fn:function(){return[t("el-input-number",{attrs:{min:1,max:86400},model:{value:e.sub_config.timeout,callback:function(t){e.$set(e.sub_config,"timeout",t)},expression:"sub_config.timeout"}}),e._v(" 秒 ")]},proxy:!0}])}),t("label-block",{staticClass:"switch-box",attrs:{label:"周期性任务"},scopedSlots:e._u([{key:"default",fn:function(){return[t("el-switch",{attrs:{"active-color":"#455cc6","inactive-color":"#ccc"},model:{value:e.sub_config.is_period,callback:function(t){e.$set(e.sub_config,"is_period",t)},expression:"sub_config.is_period"}})]},proxy:!0}])}),t("label-block",{staticClass:"switch-box",attrs:{label:"异步任务"},scopedSlots:e._u([{key:"default",fn:function(){return[t("el-switch",{attrs:{"active-color":"#455cc6","inactive-color":"#ccc"},model:{value:e.sub_config.is_async,callback:function(t){e.$set(e.sub_config,"is_async",t)},expression:"sub_config.is_async"}})]},proxy:!0}])}),t("label-block",{attrs:{label:"检查时间间隔"},scopedSlots:e._u([{key:"default",fn:function(){return[t("el-input-number",{attrs:{min:1,max:600},model:{value:e.sub_config.check_interval,callback:function(t){e.$set(e.sub_config,"check_interval",t)},expression:"sub_config.check_interval"}}),e._v(" 秒 ")]},proxy:!0}])}),t("label-block",{staticClass:"switch-box",attrs:{label:"资源调度"},scopedSlots:e._u([{key:"default",fn:function(){return[t("el-switch",{attrs:{"active-color":"#455cc6","inactive-color":"#ccc"},model:{value:e.sub_config.need_schedule,callback:function(t){e.$set(e.sub_config,"need_schedule",t)},expression:"sub_config.need_schedule"}}),e.sub_config.need_schedule?t("label-block",{attrs:{label:"调度参数"},scopedSlots:e._u([{key:"default",fn:function(){return[t("Item",{attrs:{params:e.default_schedule_output_params,type:"key"},on:{"fn-change":e.FnGetSchedule}})]},proxy:!0}],null,!1,3332012638)}):e._e()]},proxy:!0}])}),t("label-block",{attrs:{label:"子任务执行对象"},scopedSlots:e._u([{key:"default",fn:function(){return[t("el-select",{model:{value:e.sub_config.executor,callback:function(t){e.$set(e.sub_config,"executor",t)},expression:"sub_config.executor"}},e._l(e.executor_list,(function(e){return t("el-option",{key:e,attrs:{value:e,label:e}})})),1)]},proxy:!0}])}),t("label-block",{attrs:{label:"子任务执行地址"},scopedSlots:e._u([{key:"default",fn:function(){return[t("el-input",{attrs:{type:"text"},model:{value:e.sub_config.executor_path,callback:function(t){e.$set(e.sub_config,"executor_path",t)},expression:"sub_config.executor_path"}})]},proxy:!0}])}),t("label-block",{attrs:{label:"子任务检查URL"},scopedSlots:e._u([{key:"default",fn:function(){return[t("el-input",{attrs:{type:"text"},model:{value:e.sub_config.check_url,callback:function(t){e.$set(e.sub_config,"check_url",t)},expression:"sub_config.check_url"}})]},proxy:!0}])}),t("label-block",{attrs:{label:"子任务回退URL"},scopedSlots:e._u([{key:"default",fn:function(){return[t("el-input",{attrs:{type:"text"},model:{value:e.sub_config.callback_url,callback:function(t){e.$set(e.sub_config,"callback_url",t)},expression:"sub_config.callback_url"}})]},proxy:!0}])}),e.default_id?t("label-block",{staticClass:"switch-box",attrs:{label:"有效"},scopedSlots:e._u([{key:"default",fn:function(){return[t("el-switch",{attrs:{"active-color":"#455cc6","inactive-color":"#ccc"},model:{value:e.sub_config.is_valid,callback:function(t){e.$set(e.sub_config,"is_valid",t)},expression:"sub_config.is_valid"}})]},proxy:!0}],null,!1,2954258269)}):e._e()],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"primary"},on:{click:e.FnConfirm}},[e._v("确 定")]),t("el-button",{on:{click:e.FnClose}},[e._v("取 消")])],1)]),1===e.multi_rows.length?t("right-click",{attrs:{multi_rows:e.multi_rows,menus:e.menus,name:e.multi_rows.length>0?e.multi_rows[0].subtask_name:""},on:{"fn-click":e.infoClick}}):e._e()],1)},a=[],l=(s("14d9"),s("e9f5"),s("7d54"),s("ab43"),s("a732"),s("9ab4")),n=s("1b40"),o=s("c811"),c=s("98c9"),r=s("5b46"),u=s("1184"),_=s("bcc9"),b=s("e8c0"),f=s("bd4d"),p=s("cf88");let d=class extends n["e"]{constructor(){super(...arguments),this.search_con={id:{placeholder:"请输入任务ID"},subtask_name:{placeholder:"请输入任务名称"},executor:{placeholder:"请选择子任务执行对象",list:[]}},this.create_dialog=!1,this.dialog_title="",this.task_list=[],this.operate_auth=[],this.default_id="",this.default_dependent_params={},this.default_serial_set_sub_params={},this.default_schedule_output_params=[],this.executor_list=["kvm_sec_controller","kvm_ecs_controller","kvm_ebs_controller","kvm_images_controller","kvm_test_controller","kvm_nas_controller"],this.sub_config={subtask_name:"",subtask_type:"",dependent_params:[],priority:1,retry:1,timeout:60,is_series:!1,serial_set_key:"",serial_set_sub_params:[],is_period:!0,is_async:!0,check_interval:60,executor:"",executor_path:"",executor_path_body:[],check_url:"",callback_url:"",is_valid:!0,need_schedule:!1,schedule_output_params:[]},this.page_info={page_sizes:[20,50,100],page_size:20,page_index:1,total:0},this.multi_rows=[],this.menus=[{label:"编辑",value:"edit",single:!0,disabled:!1},{label:"删除",value:"delete",single:!0,disabled:!1}]}FnShowCreate(){this.create_dialog=!0,this.dialog_title="新建子任务配置"}FnShowUpdate(e){this.create_dialog=!0,this.dialog_title="更新子任务配置",this.default_id=e.id,this.sub_config.subtask_name=e.subtask_name,this.sub_config.is_series=Boolean(e.is_series),this.sub_config.serial_set_key=e.serial_set_key,this.sub_config.dependent_params=[],this.sub_config.serial_set_sub_params=[],this.default_serial_set_sub_params={};let t=JSON.parse(e.dependent_params);this.default_dependent_params={};let s=[];for(let i in t)this.sub_config.serial_set_key===i&&this.sub_config.is_series?s=t[i]:this.default_dependent_params[i]=t[i];for(let i in s)this.default_serial_set_sub_params[i]=s[i];this.sub_config.priority=e.priority,this.sub_config.retry=e.retry,this.sub_config.timeout=e.timeout,this.sub_config.is_period=Boolean(e.is_period),this.sub_config.is_async=Boolean(e.is_async),this.sub_config.check_interval=e.check_interval,this.sub_config.executor=e.executor,this.sub_config.executor_path=e.executor_path,this.sub_config.executor_path_body=[],this.sub_config.check_url=e.check_url,this.sub_config.callback_url=e.callback_url,this.sub_config.is_valid=Boolean(e.is_valid),this.sub_config.need_schedule=Boolean(e.need_schedule),this.default_schedule_output_params=e.schedule_output_params.split(",").map(e=>({key:e}))}handleSelectionChange(e){this.multi_rows=e}infoClick(e){const{label:t,value:s}=e;"edit"===s?this.FnShowUpdate(this.multi_rows[0]):this.FnShowDel(this.multi_rows[0].id,this.multi_rows[0].subtask_name),Object(p["a"])()}FnOperRow(e){this.$refs.table.toggleRowSelection(e)}rowStyle({row:e}){const t=this.multi_rows.some(t=>t.id===e.id);if(t)return"rowStyle"}FnRightClick(e,t,s){console.log(s);const i=this.multi_rows.some(t=>t.id===e.id);i||this.$refs.table.toggleRowSelection(e),Object(b["a"])(e,t,s)}FnHandleParam(e){let t="",s=[];for(let i in e){e[i]instanceof Array?t="list":e[i]instanceof Object&&Object.keys(e[i]).length>0?(t=typeof e[i],e[i]=this.FnHandleParam(e[i])):t=typeof e[i];let a="",l="";i.indexOf(".")>0?(a=i.split(".")[0],l=i.split(".")[1]):a=i,s.push({key:a,second_key:l,type:t,value:e[i]})}return s}FnGetDep(e){this.sub_config.dependent_params=e}FnGetSerial(e){this.sub_config.serial_set_sub_params=e}FnGetExec(e){this.sub_config.executor_path_body=e}FnGetSchedule(e){this.sub_config.schedule_output_params=e}FnClose(){this.create_dialog=!1,this.default_id="",this.sub_config.subtask_type="",this.sub_config.subtask_name="",this.sub_config.dependent_params=[],this.default_dependent_params={},this.sub_config.priority=1,this.sub_config.retry=1,this.sub_config.timeout=60,this.sub_config.is_series=!1,this.sub_config.serial_set_key="",this.sub_config.serial_set_sub_params=[],this.default_serial_set_sub_params={},this.sub_config.is_period=!0,this.sub_config.is_async=!0,this.sub_config.check_interval=60,this.sub_config.executor="",this.sub_config.executor_path="",this.sub_config.executor_path_body=[],this.sub_config.check_url="",this.sub_config.callback_url=""}async FnGetList(e={}){let t={};e.id&&(t.id=e.id),e.subtask_type&&(t.subtask_type=e.subtask_type),e.subtask_name&&(t.subtask_name=e.subtask_name),e.executor&&(t.executor=e.executor),t.page_number=this.page_info.page_index,t.page_size=this.page_info.page_size;const s=await _["a"].get_subtask_list(t);"Success"===s.code&&(this.task_list=s.data.subtask_info,this.page_info.total=s.data.total)}FnConfirm(){let e={},t=[];if(this.sub_config.dependent_params.forEach(t=>{if("object"===t.type){let s="";s=t.second_key?t.key+"."+t.second_key:t.key,e[s]={},t.value instanceof Array&&t.value.forEach(t=>{e[s][t.key]=t.value})}else e[t.key]=t.value}),this.sub_config.is_series){let t={};this.sub_config.serial_set_sub_params.forEach(e=>{t[e.key]=e.value}),this.sub_config.serial_set_key&&(e[this.sub_config.serial_set_key]=t)}this.sub_config.need_schedule&&(t=this.sub_config.schedule_output_params.map(e=>e.key));let s={subtask_name:this.sub_config.subtask_name,dependent_params:JSON.stringify(e),priority:this.sub_config.priority,retry:this.sub_config.retry,timeout:this.sub_config.timeout,is_series:Number(this.sub_config.is_series),serial_set_key:this.sub_config.serial_set_key,is_period:Number(this.sub_config.is_period),is_async:Number(this.sub_config.is_async),check_interval:this.sub_config.check_interval,executor:this.sub_config.executor,executor_path:this.sub_config.executor_path,check_url:this.sub_config.check_url,callback_url:this.sub_config.callback_url,is_valid:Number(this.sub_config.is_valid),need_schedule:Number(this.sub_config.need_schedule),schedule_output_params:t.join()};this.default_id?this.FnUpdate(s):this.FnCreate(s)}async FnCreate(e){const t=await _["a"].add_subtask(e);"Success"===t.code&&(this.FnClose(),this.$message.success(t.msg||"成功新建子任务配置！"),this.FnGetList())}async FnUpdate(e){const t=await _["a"].update_subtask(Object.assign({},e,{id:this.default_id}));"Success"===t.code&&(this.FnClose(),this.$message.success(t.msg||"成功新建子任务配置！"),this.FnGetList())}FnShowDel(e,t){this.$confirm("确认删除子任务配置 -- "+t,"删除提示",{cancelButtonText:"取消",confirmButtonText:"确定",type:"warning"}).then(()=>{this.default_id=e,this.FnDel()}).catch()}async FnDel(){const e=await _["a"].delete_subtask({id:this.default_id});"Success"===e.code&&(this.$message.success(e.msg||"成功删除子项目配置！"),this.FnGetList())}created(){this.operate_auth=this.$store.state.auth_info[this.$route.name],this.search_con.executor.list=this.executor_list.map(e=>({label:e,type:e})),this.FnGetList()}};d=Object(l["a"])([Object(n["a"])({components:{LabelBlock:c["a"],ActionBlock:o["a"],Params:r["a"],Item:u["a"],RightClick:f["a"]}})],d);var h=d,g=h,m=(s("ebcd"),s("2877")),k=Object(m["a"])(g,i,a,!1,null,"381b2ef2",null);t["default"]=k.exports},a732:function(e,t,s){"use strict";var i=s("23e7"),a=s("c65b"),l=s("2266"),n=s("59ed"),o=s("825a"),c=s("46c4"),r=s("2a62"),u=s("f99f"),_=u("some",TypeError);i({target:"Iterator",proto:!0,real:!0,forced:_},{some:function(e){o(this);try{n(e)}catch(i){r(this,"throw",i)}if(_)return a(_,this,e);var t=c(this),s=0;return l(t,(function(t,i){if(e(t,s++))return i()}),{IS_RECORD:!0,INTERRUPTED:!0}).stopped}})},e8c0:function(e,t,s){"use strict";s.d(t,"a",(function(){return a}));var i=s("cf88");function a(e,t,s){s.preventDefault(),document.addEventListener("contextmenu",e=>{const t=e.target;if(t.closest(".el-table")){let t=document.querySelector("#menu");if(t){t.style.display="block";let s=t.offsetHeight,a=t.offsetWidth;console.log("menuHeight",s);let l=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,n=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,o=e.clientX,c=e.clientY,r=o,u=c;n<o+a&&(r=o-a),l<c+s&&(u=l-s),t.style.left=r-250+"px",t.style.top=u-50+"px",t.style.display="block",t.style.zIndex="1000",document.addEventListener("click",i["a"])}}}),document.addEventListener("contextmenu",i["a"])}},ebcd:function(e,t,s){"use strict";s("78da")}}]);
//# sourceMappingURL=chunk-1365e416.1764214676553.js.map