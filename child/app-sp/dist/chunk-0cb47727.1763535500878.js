(window["webpackJsonp_AppSp"]=window["webpackJsonp_AppSp"]||[]).push([["chunk-0cb47727"],{"039b":function(t,e,s){"use strict";var i=s("81a9"),a=s("bff7");e["a"]={get_snapshot_list(t){return Object(i["a"])(Object(a["b"])("GET","/snapshot/snapshot_list/",t))},get_snapshot_chains_list(t){return Object(i["a"])(Object(a["b"])("GET","/snapshot/snapshot_chains_list/",t))},chains_detail(t){return Object(i["a"])(Object(a["b"])("GET","/snapshot/snapshot_chains_detail/",t))},record(t){return Object(i["a"])(Object(a["b"])("GET","/snapshot/history_record/",t))},get_monitor_id(t){return Object(i["a"])(Object(a["b"])("GET","/snapshot/snapshot_disk_ids/",t))},get_snapshot_info(t){return Object(i["a"])(Object(a["i"])("POST","/snapshot/snapshot_use_monitor",t))}}},"065f":function(t,e,s){"use strict";s("2cd4")},"0752":function(t,e,s){},1477:function(t,e,s){"use strict";var i=s("81a9"),a=s("bff7");e["a"]={get_host_list(t){return Object(i["a"])(Object(a["d"])("POST","/host/get_host_list/",t))},get_room_list(t){return Object(i["a"])(Object(a["d"])("GET","/host/machine_room_list/",t))},get_status_list(t){return Object(i["a"])(Object(a["d"])("GET","/host/host_status_list/",t))},external_management(t){return Object(i["a"])(Object(a["d"])("GET","/host/external_management/",t))},migrate(t){return Object(i["a"])(Object(a["d"])("POST","/host/migration_operation/",t))},disperse(t){return Object(i["a"])(Object(a["d"])("POST","/host/disperse_operation/",t))},record(t){return Object(i["a"])(Object(a["d"])("POST","/host/host_operation_record/",t))},recommended_host(t){return Object(i["a"])(Object(a["d"])("POST","/host/recommended_host/",t))},host_maintenance(t){return Object(i["a"])(Object(a["d"])("POST","/host/host_maintenance/",t))},finish_maintenance(t){return Object(i["a"])(Object(a["d"])("POST","/host/host_finish_maintenance/",t))},shelves(t){return Object(i["a"])(Object(a["d"])("POST","/host/host_off_shelves/",t))},get_detail_overview(t){return Object(i["a"])(Object(a["d"])("GET","/host/host_main_details/",t))},get_detail_storage(t){return Object(i["a"])(Object(a["d"])("GET","/host/host_disk/",t))},down(t){return Object(i["a"])(Object(a["d"])("GET","/host/host_list_download/",t))},host_operate(t){return Object(i["a"])(Object(a["d"])("POST","/host/operate/",t))},host_import(t){return Object(i["a"])(Object(a["d"])("POST","/host/import/",t))},get_host_attribution(t){return Object(i["a"])(Object(a["d"])("GET","/host/get_host_attribution/",t))},set_host_attribution(t){return Object(i["a"])(Object(a["d"])("POST","/host/set_host_attribution/",t))},get_host_type(t){return Object(i["a"])(Object(a["d"])("GET","/host/get_host_config/",t))},update_attribute(t){return Object(i["a"])(Object(a["d"])("POST","/host/set_host_config/",t))},getCustomerList(t){return Object(i["a"])(Object(a["d"])("POST","/host/get_customer_list/",t))},getFamilyList(t){return Object(i["a"])(Object(a["d"])("POST","/host/get_family_list/",t))},finish_validate(t){return Object(i["a"])(Object(a["d"])("POST","/host/verification_finish/",t))},get_host_recycle_department(t){return Object(i["a"])(Object(a["d"])("GET","/host/get_host_recycle_department/",t))},get_host_list_field(t){return Object(i["a"])(Object(a["d"])("GET","/host/get_host_list_field/",t))},get_task_list(t){return Object(i["a"])(Object(a["d"])("GET","/host/business_test_task/",t))},create_test_task(t){return Object(i["a"])(Object(a["d"])("POST","/host/create_test_task/",t))},get_host_filter_item(t){return Object(i["a"])(Object(a["d"])("POST","/host/get_host_filter_item/",t))},set_remark(t){return Object(i["a"])(Object(a["d"])("POST","/host/set_host_remark/",t))},set_flag(t){return Object(i["a"])(Object(a["d"])("POST","/host/set_host_tag/",t))},update_ecs_info(t){return Object(i["a"])(Object(a["d"])("POST","/ecs/update_ecs_info/",t))},crash_clear(t){return Object(i["a"])(Object(a["b"])("POST","/host/crash_clear/",t))},crash_recover(t){return Object(i["a"])(Object(a["b"])("POST","/host/crash_recover/",t))},set_lock(t){return Object(i["a"])(Object(a["d"])("POST","/host/host_lock/",t))},set_unlock(t){return Object(i["a"])(Object(a["d"])("POST","/host/host_unlock/",t))},set_maintenance(t){return Object(i["a"])(Object(a["d"])("POST","/host/host_maintenance/",t))},get_maintenance_record(t){return Object(i["a"])(Object(a["d"])("GET","/host/host_maintenance_record/",t))},get_lock_record(t){return Object(i["a"])(Object(a["d"])("GET","/host/host_lock_record/",t))},recover_storage_error(t){return Object(i["a"])(Object(a["d"])("POST","/host/recover_storage_error/",t))},agent_update(t){return Object(i["a"])(Object(a["d"])("POST","/host/handle_host_agent_update/",t))},agent_rollback(t){return Object(i["a"])(Object(a["d"])("POST","/host/handle_host_agent_rollback/",t))},set_prepare_host(t){return Object(i["a"])(Object(a["d"])("POST","/host/set_prepare_host/",t))},get_ovs_version(t){return Object(i["a"])(Object(a["d"])("GET","/host/ovs_version_list/",t))},update_host_power_status(t){return Object(i["a"])(Object(a["d"])("POST","/host/update_host_power_status/",t))},update_ecs_status(t){return Object(i["a"])(Object(a["d"])("POST","/host/update_host_ecs_status/",t))}}},"1e5a":function(t,e,s){"use strict";var i=s("23e7"),a=s("9961"),o=s("5320"),l=s("dad2"),r=!l("symmetricDifference")||!o("symmetricDifference");i({target:"Set",proto:!0,real:!0,forced:r},{symmetricDifference:a})},"1e70":function(t,e,s){"use strict";var i=s("23e7"),a=s("a5f7"),o=s("d039"),l=s("dad2"),r=!l("difference",(function(t){return 0===t.size})),n=r||o((function(){var t={size:1,has:function(){return!0},keys:function(){var t=0;return{next:function(){var s=t++>1;return e.has(1)&&e.clear(),{done:s,value:2}}}}},e=new Set([1,2,3,4]);return 3!==e.difference(t).size}));i({target:"Set",proto:!0,real:!0,forced:n},{difference:a})},2002:function(t,e,s){},"21ec":function(t,e,s){},"268f":function(t,e,s){"use strict";var i=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",[e("el-dialog",{attrs:{title:"操作记录",visible:t.visible,width:"60%","destroy-on-close":!0,"close-on-click-modal":!1},on:{"update:visible":function(e){t.visible=e},close:t.back}},[e("div",[e("el-dialog",{attrs:{title:"响应信息",visible:t.res_visible,width:"60%","destroy-on-close":!0,"append-to-body":"","custom-class":"response-data"},on:{"update:visible":function(e){t.res_visible=e},close:t.clost_res}},[e("div",[t._v(t._s(t.response))])])],1),e("div",[e("action-block",{attrs:{search_option:["physical","message"].includes(t.type)?{...t.search}:t.search},on:{"fn-search":t.fn_search}}),["physical","message"].includes(t.type)?e("div",{staticClass:"icon m-bottom10"},[e("el-tooltip",{attrs:{content:"刷新",placement:"bottom",effect:"light"}},[e("el-button",{attrs:{type:"text"},on:{click:t.getOperateRecordList}},[e("svg-icon",{staticClass:"refresh",attrs:{icon:"refresh"}})],1)],1)],1):t._e(),e("el-table",{staticClass:"record-table",attrs:{data:t.record_list,border:""}},[e("el-table-column",{attrs:{prop:"oper_time",label:"操作时间"},scopedSlots:t._u([{key:"default",fn:function(s){return[e("span",[t._v(t._s(s.row.oper_time?t.moment(s.row.oper_time).format("YYYY-MM-DD HH:mm:ss"):""))])]}}])}),e("el-table-column",{attrs:{prop:"oper_type_display",label:"操作内容"}}),e("el-table-column",{attrs:{prop:"status_display",label:"状态"}}),["message","physical"].includes(t.type)?e("el-table-column",{attrs:{prop:"response",label:"响应信息"},scopedSlots:t._u([{key:"default",fn:function(s){return[s.row.response?e("el-button",{attrs:{type:"text"},on:{click:function(e){return t.view(s.row.response)}}},[t._v("查看")]):e("span",[t._v("-")])]}}])}):e("el-table-column",{attrs:{prop:"response",label:"响应信息"},scopedSlots:t._u([{key:"default",fn:function(s){return[s.row.result?e("el-button",{attrs:{type:"text"},on:{click:function(e){return t.view(s.row.result)}}},[t._v("查看")]):e("span",[t._v("-")])]}}],null,!1,79404134)}),e("el-table-column",{attrs:{prop:"finish_time",label:"完成时间"},scopedSlots:t._u([{key:"default",fn:function(s){return[e("span",[t._v(t._s(s.row.finish_time?t.moment(s.row.finish_time).format("YYYY-MM-DD HH:mm:ss"):""))])]}}])}),e("el-table-column",{attrs:{prop:"oper_user",label:"nas"===t.type?"操作用户":"用户名"}}),["physical","message"].includes(t.type)?t._e():e("el-table-column",{attrs:{prop:"flag_display",label:"操作标识"}})],1),e("el-pagination",{attrs:{"current-page":t.current,"page-sizes":[20,50,100],"page-size":t.size,layout:"total, sizes, prev, pager, next, jumper",total:t.total},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}}),e("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{attrs:{type:"primary"},on:{click:t.back}},[t._v("返回")])],1)],1)])],1)},a=[],o=s("9ab4"),l=s("1b40"),r=s("c811"),n=s("d772"),c=s("1477"),_=s("e4d0"),u=s("039b"),d=s("fc43"),p=s("c1df"),h=s.n(p),m=s("8ce4"),b=s("3673");let f=class extends l["e"]{constructor(){super(...arguments),this.state_list=[{type:"",label:"全部"},{type:"doing",label:"执行中"},{type:"success",label:"成功"},{type:"failed",label:"失败"}],this.search={state:{list:this.state_list,placeholder:"请选择状态"},content:{placeholder:"请输入操作内容"}},this.record_list=[],this.current=1,this.size=20,this.total=0,this.search_data={},this.moment=h.a,this.response="",this.res_visible=!1}created(){this.fn_search()}fn_search(t={}){this.current=1,this.search_data=t,this.getOperateRecordList()}async getOperateRecordList(){let t;const{search_data:e}=this;let s="physical"!==this.type?{task_type:e.content,cloud_id:this.record_id}:{content:e.content,cloud_id:this.record_id,cloud_type:"host"},i={status:e.state||"",page_size:this.size,page_index:this.current,...s};if(t="physical"===this.type?await c["a"].record({...i}):"message"===this.type?await _["a"].get_pub_operate_record({os_id:this.record_id,status:e.state||"",content_type:e.content,page_size:this.size,page_index:this.current}):"snapshot"===this.type?await u["a"].record({cloud_id:this.record_id,cloud_type:"snapshot",status:e.state||"",task_type:e.content,page_size:this.size,page_index:this.current}):"nas"===this.type?await d["a"].get_nas_record({...i}):await n["a"].get_operate_record_list({cloud_type:this.type?this.type:"ecs",...i}),"Success"===t.code){var a,o;if(["physical","message"].includes(this.type)){let e=["create_time","content","status_name","response","update_time","op_user"],s=["oper_time","oper_type_display","status_display","response","finish_time","oper_user"];this.record_list=Object(m["b"])(t.data.operation_list,s,e)}else{var l;this.record_list=(null===(l=t.data)||void 0===l?void 0:l.history_record)||[]}this.total=(null===(a=t.data)||void 0===a||null===(o=a.page_info)||void 0===o?void 0:o.count)||0}}handleSizeChange(t){this.size=t,this.getOperateRecordList()}handleCurrentChange(t){this.current=t,this.getOperateRecordList()}view(t){this.response=t,this.res_visible=!0}clost_res(){this.res_visible=!1,this.response=""}back(){}};Object(o["a"])([Object(l["c"])(Boolean)],f.prototype,"visible",void 0),Object(o["a"])([Object(l["c"])(String)],f.prototype,"record_id",void 0),Object(o["a"])([Object(l["c"])(String)],f.prototype,"type",void 0),Object(o["a"])([Object(l["b"])("close")],f.prototype,"back",null),f=Object(o["a"])([Object(l["a"])({components:{ActionBlock:r["a"],SvgIcon:b["a"]}})],f);var v=f,g=v,y=(s("f813"),s("2877")),w=Object(y["a"])(g,i,a,!1,null,null,null);e["a"]=w.exports},"2cd4":function(t,e,s){},3013:function(t,e,s){},"384f":function(t,e,s){"use strict";var i=s("e330"),a=s("5388"),o=s("cb27"),l=o.Set,r=o.proto,n=i(r.forEach),c=i(r.keys),_=c(new l).next;t.exports=function(t,e,s){return s?a({iterator:c(t),next:_},e):n(t,e)}},"395e":function(t,e,s){"use strict";var i=s("dc19"),a=s("cb27").has,o=s("8e16"),l=s("7f65"),r=s("5388"),n=s("2a62");t.exports=function(t){var e=i(this),s=l(t);if(o(e)<s.size)return!1;var c=s.getIterator();return!1!==r(c,(function(t){if(!a(e,t))return n(c,"normal",!1)}))}},"39a7":function(t,e,s){"use strict";s("21ec")},"3c69":function(t,e,s){"use strict";s("ac8f")},"3f8d":function(t,e,s){"use strict";s.d(e,"b",(function(){return l})),s.d(e,"c",(function(){return r}));const i={building:"创建中",running:"运行中",restarting:"重启中",shutting_down:"关机中",shutdown:"已关机",starting_up:"开机中",deleting:"删除中",deleted:"已删除",destroying:"销毁中",destroy:"已销毁",updating:"更新中",error:"错误",recovering:"恢复中",failed:"创建失败"},a={start_up_ecs:{auth:["shutdown"],msg:"已选实例状态需为已关机！",label:"开 机"},shutdown_ecs:{auth:["running"],msg:"已选实例需为运行中！",label:"关 机"},restart_ecs:{auth:["running"],msg:"已选实例状态需为运行中！",label:"重 启"},delete_ecs:{auth:["running","shutdown","error"],msg:"已选实例状态需为已关机或运行中或错误！",label:"逻辑删除"},recover_ecs:{auth:["deleted"],msg:"已选实例状态需为已删除！",label:"恢 复"},destroy_ecs:{auth:["deleted","failed"],msg:"已选实例状态需为已删除或创建失败！",label:"销 毁"},update_spec:{auth:["shutdown"],msg:"已选实例状态需为已关机！",label:"更换实例规格"},update_system:{auth:["shutdown"],msg:"已选实例状态需为已关机！",label:"更换操作系统"},reset_pwd:{auth:["running"],msg:"已选实例状态需为运行中！",label:"更换密码"},open_bill:{auth:["running","shutdown"],msg:"已选实例状态需为运行中或已关机！",label:"开启计费"},net_set:{auth:["running"],msg:"已选实例状态需为运行中！",label:"网络设置"}},o={start_up_host:{power:["shutdown"],host:["offline","online","exception","maintenance"],msg:"已选主机需为在线、离线、异常或维护状态",label:"开机"},shutdown_host:{power:["running"],host:["maintenance"],vm:1,msg:"已选主机需为维护状态",msg2:"操作关机前，请确保物理机上无云主机运行",label:"关机"},restart_host:{power:["running"],host:["offline","online","maintenance"],msg:"已选主机需为在线、离线或维护状态",label:"重启"},online_maintenance:{power:[],host:["online","exception"],msg:"已选主机需为在线状态",label:"在线维护"},maintenance:{power:[],host:[],msg:"",label:"设置维护"},offline_maintenance:{power:[],host:["offline","online","exception"],vm:1,msg:"已选主机需为在线或离线状态且已选主机上不能有虚拟机运行",label:"离线维护"},finish:{power:[],host:["maintenance","online_maintenance","offline_maintenance"],msg:"已选主机需为维护中状态",label:"完成维护"},shelves:{power:[],host:[],vm:1,msg:"已选主机上不能有虚拟机运行",label:"下架"},disperse:{power:["running"],host:["online"],msg:"已选主机需为在线状态",label:"驱散"},out_of_band:{power:[],host:["offline","online"],msg:"已选主机需为在线或离线状态",label:"进入带外管理"},migrate:{power:["running"],host:["online","storage_error","crash"],msg:"已选主机需为在线、存储异常或宕机状态",label:"迁移"},lock:{power:[],host:[],msg:"",label:"锁定"},unlock:{power:[],host:["lock"],msg:"已选主机需为锁定状态",label:"解锁"},unstore_exception:{power:[],host:["storage_error"],msg:"已选主机需为存储异常状态",label:"解除存储异常"},service:{power:[],host:[],msg:"",label:"服务更新"},rollback:{power:[],host:[],label:"回滚"},physical_detail:{power:[],host:[],msg:"",label:"详情"},data_clear:{power:[],host:["crash_clear"],msg:"",label:"数据清理同步"},down_recover:{power:[],host:["crash_recover"],msg:"",label:"宕机恢复"},sign:{power:[],host:[],msg:"",label:"设备标记"},upload:{power:[],host:[],msg:"",label:"导入"},under_sync:{power:[],host:[],msg:"",label:"底层同步"},cheat:{power:[],host:[],msg:"",label:"欺骗器管理"},business_test:{power:[],host:[],msg:"",label:"业务测试"},record:{power:[],host:[],msg:"",label:"操作记录"},resource:{power:[],host:[],msg:"",label:"分配资源"},remark:{power:[],host:[],msg:"",label:"编辑备注"},add_cluster:{power:[],host:["online"],msg:"已选主机需为在线状态",label:"加入集群"},change_cluster:{power:[],host:[],msg:"",label:"更换集群"},remove_cluster:{power:[],host:["maintenance"],mag:"",label:"移出集群"},set_label:{power:[],host:[],msg:"",label:"添加标签"},set_prepar_host:{power:[],host:["online"],msg:"已选主机需为在线状态",label:"设为备机"},set_resource_pools:{power:[],host:["online"],msg:"",label:"设为资源池"}};e["a"]={getInsOperateAuth(t){return a[t]}};const l=t=>i[t],r=t=>o[t]},"3fdb":function(t,e,s){},"40a9":function(t,e,s){},"49c5":function(t,e,s){"use strict";s("3fdb")},5320:function(t,e,s){"use strict";t.exports=function(t){try{var e=new Set,s={size:0,has:function(){return!0},keys:function(){return Object.defineProperty({},"next",{get:function(){return e.clear(),e.add(4),function(){return{done:!0}}}})}},i=e[t](s);return 1===i.size&&4===i.values().next().value}catch(a){return!1}}},5388:function(t,e,s){"use strict";var i=s("c65b");t.exports=function(t,e,s){var a,o,l=s?t:t.iterator,r=t.next;while(!(a=i(r,l)).done)if(o=e(a.value),void 0!==o)return o}},"682f":function(t,e,s){"use strict";var i=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",{staticClass:"total"},[e("div",{staticClass:"used",style:{height:t.hei&&0!==t.hei?t.hei+"%":0,background:t.hei>=0&&t.hei<50?"#67c23a":t.hei<80?"yellow":"red"}})])},a=[],o=s("9ab4"),l=s("1b40");let r=class extends l["e"]{};Object(o["a"])([Object(l["c"])(Number)],r.prototype,"hei",void 0),r=Object(o["a"])([Object(l["a"])({})],r);var n=r,c=n,_=(s("8a6c"),s("2877")),u=Object(_["a"])(c,i,a,!1,null,"43aeadcd",null);e["a"]=u.exports},"68df":function(t,e,s){"use strict";var i=s("dc19"),a=s("8e16"),o=s("384f"),l=s("7f65");t.exports=function(t){var e=i(this),s=l(t);return!(a(e)>s.size)&&!1!==o(e,(function(t){if(!s.includes(t))return!1}),!0)}},7282:function(t,e,s){"use strict";var i=s("e330"),a=s("59ed");t.exports=function(t,e,s){try{return i(a(Object.getOwnPropertyDescriptor(t,e)[s]))}catch(o){}}},"72c3":function(t,e,s){"use strict";var i=s("23e7"),a=s("e9bc"),o=s("5320"),l=s("dad2"),r=!l("union")||!o("union");i({target:"Set",proto:!0,real:!0,forced:r},{union:a})},"76ff":function(t,e,s){"use strict";var i=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",[e("el-dialog",{attrs:{title:"配置详情",visible:t.visible,width:"60%","destroy-on-close":!0},on:{"update:visible":function(e){t.visible=e},close:t.back}},[e("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}]},[e("el-row",{attrs:{gutter:20}},[e("el-col",{attrs:{span:10}},[e("span",{staticClass:"label"},[t._v("云服务器ID:")]),e("span",[t._v(t._s(t.detail&&t.detail.ecs_id))])]),e("el-col",{attrs:{span:10}},[e("span",{staticClass:"label"},[t._v("地域:")]),e("span",[t._v(t._s(t.detail&&t.detail.region_name))])])],1),e("el-row",{attrs:{gutter:20}},[e("el-col",{staticClass:"name-row",attrs:{span:10}},[e("span",{staticClass:"label"},[t._v("云服务器名称:")]),e("span",[e("pre",[t._v(t._s(t.detail&&t.detail.ecs_name))])])]),e("el-col",{attrs:{span:10}},[e("span",{staticClass:"label"},[t._v("可用区:")]),e("span",[t._v(t._s(t.detail&&t.detail.az_name))])])],1),e("el-row",{attrs:{gutter:20}},[e("el-col",{attrs:{span:10}},[e("span",{staticClass:"label"},[t._v("状态:")]),e("span",[t._v(t._s(t.detail&&t.detail.status_display))])])],1),e("div",{staticClass:"title"},[t._v("计算规格")]),e("el-row",{attrs:{gutter:20}},[t.detail&&t.detail.ecs_rule&&t.detail.ecs_rule.conf_name?e("el-col",{attrs:{span:20}},[e("span",{staticClass:"label"},[t._v(t._s(t.detail&&t.detail.ecs_rule&&t.detail.ecs_rule.conf_name)+":")]),e("span",[t._v(t._s(t.detail&&t.detail.ecs_rule&&t.detail.ecs_rule.name))]),t.detail&&t.detail.ecs_rule&&t.detail.ecs_rule.cpu_num?e("span",[t._v("   "+t._s(t.detail&&t.detail.ecs_rule&&t.detail.ecs_rule.cpu_num)+"vCPU "),e("span",[t._v(t._s(t.detail&&t.detail.ecs_rule&&t.detail.ecs_rule.ram)+"GiB")]),t.detail&&t.detail.is_gpu?e("span",[t._v(t._s(t.detail&&t.detail.ecs_rule&&t.detail.ecs_rule.gpu)+"*"+t._s(t.detail&&t.detail.card_name))]):t._e()]):t._e()]):t._e()],1),e("div",{staticClass:"title"},[t._v("操作系统")]),e("div",{staticClass:"content"},[t._v(t._s(t.detail&&t.detail.os_info&&t.detail.os_info.name))]),e("div",{staticClass:"title"},[t._v("存储")]),e("div",{staticClass:"content"},[e("span",{staticClass:"label"},[t._v("系统盘：")]),t.detail&&t.detail.disk&&t.detail.disk.system_disk_conf?e("span",{staticClass:"data-disk"},[t._v(t._s(t.detail&&t.detail.disk&&t.detail.disk.system_disk_conf&&t.detail.disk.system_disk_conf.disk_name))]):t._e(),t.detail&&t.detail.disk&&t.detail.disk.system_disk_conf&&t.detail.disk.system_disk_conf.size?e("span",{staticClass:"data-disk-unit"},[t._v(t._s(t.detail&&t.detail.disk&&t.detail.disk.system_disk_conf&&t.detail.disk.system_disk_conf.size)+t._s(t.detail&&t.detail.disk&&t.detail.disk.system_disk_conf&&t.detail.disk.system_disk_conf.unit))]):t._e(),t.detail&&t.detail.disk&&t.detail.disk.system_disk_conf&&t.detail.disk.system_disk_conf.id?e("span",{staticClass:"id_name"},[t._v("("+t._s(t.detail&&t.detail.disk&&t.detail.disk.system_disk_conf&&t.detail.disk.system_disk_conf.id)+" / "+t._s(t.detail&&t.detail.disk&&t.detail.disk.system_disk_conf&&t.detail.disk.system_disk_conf.name)+")")]):t._e()]),e("div",{staticClass:"content data_disk"},[e("span",{staticClass:"label"},[t._v("数据盘：")]),t.detail&&t.detail.disk&&t.detail.disk.data_disk_conf?e("div",{staticClass:"disk_content"},t._l(t.detail.disk.data_disk_conf,(function(s){return e("div",{key:s.id},[e("span",{staticClass:"data-disk"},[t._v(t._s(s.disk_name))]),e("span",{staticClass:"data-disk-unit"},[t._v(t._s(s.size)+t._s(s.unit))]),e("span",{staticClass:"id_name"},[t._v("("+t._s(s.id)+" / "+t._s(s.name)+")")]),e("span",[t._v(t._s(s.is_follow_delete?"随实例删除":"不随实例删除"))])])})),0):t._e()]),e("div",{staticClass:"title"},[t._v("网络")]),e("div",{staticClass:"content"},[e("span",{staticClass:"label"},[t._v("VPC:")]),t.detail&&t.detail.pipe&&t.detail.pipe.vpc_id?e("span",[t._v(t._s(t.detail&&t.detail.pipe&&t.detail.pipe.vpc_id)+" / "+t._s(t.detail&&t.detail.pipe&&t.detail.pipe.vpc_name))]):t._e()]),e("div",{staticClass:"content"},[e("span",{staticClass:"label"},[t._v("子网:")]),t.detail&&t.detail.pipe&&t.detail.pipe.subnet_id?e("span",[t._v(t._s(t.detail&&t.detail.pipe&&t.detail.pipe.subnet_id)+" / "+t._s(t.detail&&t.detail.pipe&&t.detail.pipe.subnet_name))]):t._e()]),e("div",{staticClass:"content display-flex"},[e("span",{staticClass:"label"},[t._v("私网IP：")]),t.detail&&t.detail.pipe?e("span",[t.detail.pipe.private_net?[t._v(t._s(t.detail.pipe.private_net)+" （主）")]:t._e(),e("br"),t.detail.pipe.pub_net?[t._v(" "+t._s(t.detail.pipe.pub_net)+" "),t.detail.pipe.eip_info[t.detail.pipe.pub_net]&&t.detail.pipe.eip_info[t.detail.pipe.pub_net].conf_name?[t._v(" （"+t._s(t.detail.pipe.eip_info[t.detail.pipe.pub_net].conf_name)+"） ")]:t._e(),e("br")]:t._e(),t._l(t.detail.pipe.virtual_net,(function(s){return e("span",{key:s},[t._v(" "+t._s(s)+" "),t.detail.pipe.eip_info[s]&&t.detail.pipe.eip_info[s].conf_name?[t._v(" （"+t._s(t.detail.pipe.eip_info[s].conf_name)+"） ")]:t._e(),e("br")],2)}))],2):t._e()]),e("div",{staticClass:"content display-flex"},[e("span",{staticClass:"label"},[t._v("公网IP：")]),t.detail&&t.detail.pipe?e("span",[t.detail.pipe.pub_net&&t.detail.pipe.eip_info[t.detail.pipe.pub_net]&&t.detail.pipe.eip_info[t.detail.pipe.pub_net].eip_ip?[t._v(" "+t._s(t.detail.pipe.eip_info[t.detail.pipe.pub_net].eip_ip)+" （"+t._s(t.detail.pipe.eip_info[t.detail.pipe.pub_net].conf_name)+"） "),e("br")]:t._e(),t._l(t.detail.pipe.virtual_net,(function(s){return e("span",{key:s},[t.detail.pipe.eip_info[s]&&t.detail.pipe.eip_info[s].conf_name?[t._v(" "+t._s(s.eip_ip)+" （"+t._s(t.detail.pipe.eip_info[s].conf_name)+"） ")]:t._e(),e("br")],2)}))],2):t._e()]),e("div",{staticClass:"divider"}),e("div",{staticClass:"content"},[e("span",{staticClass:"label"},[t._v("所属机房:")]),e("span",[t._v(t._s(t.detail&&t.detail.engine_room))])]),e("div",{staticClass:"content"},[e("span",{staticClass:"label"},[t._v("所属节点:")]),e("span",[t._v(t._s(t.detail&&t.detail.host_name))])]),e("div",{staticClass:"content"},[e("span",{staticClass:"label"},[t._v("所属物理机:")]),t.detail&&t.detail.host_id?e("span",[t._v(t._s(t.detail&&t.detail.host_id)+"   "),t.detail&&t.detail.host_status?e("span",[t._v("( "+t._s(t.detail&&t.detail.host_status)+" )")]):t._e()]):t._e()]),e("div",{staticClass:"content"},[e("span",{staticClass:"label"},[t._v("处理器型号:")]),e("span",[t._v(t._s(t.detail&&t.detail.cpu_type))])]),e("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{attrs:{type:"primary"},on:{click:t.back}},[t._v("返回")])],1)],1)])],1)},a=[],o=s("9ab4"),l=s("1b40"),r=s("d772");let n=class extends l["e"]{constructor(){super(...arguments),this.detail=null,this.loading=!1}async getDetail(){let t=await r["a"].get_detail({ecs_id:this.detail_id});"Success"===t.code?(this.loading=!1,this.detail=t.data):this.loading=!1}back(){}created(){this.getDetail()}};Object(o["a"])([Object(l["c"])(Boolean)],n.prototype,"visible",void 0),Object(o["a"])([Object(l["c"])(String)],n.prototype,"detail_id",void 0),Object(o["a"])([Object(l["b"])("close-detail")],n.prototype,"back",null),n=Object(o["a"])([l["a"]],n);var c=n,_=c,u=(s("88bb"),s("2877")),d=Object(u["a"])(_,i,a,!1,null,"33b12e64",null);e["a"]=d.exports},7903:function(t,e,s){},"79a4":function(t,e,s){"use strict";var i=s("23e7"),a=s("d039"),o=s("953b"),l=s("dad2"),r=!l("intersection",(function(t){return 2===t.size&&t.has(1)&&t.has(2)}))||a((function(){return"3,2"!==String(Array.from(new Set([1,2,3]).intersection(new Set([3,2]))))}));i({target:"Set",proto:!0,real:!0,forced:r},{intersection:o})},"7f65":function(t,e,s){"use strict";var i=s("59ed"),a=s("825a"),o=s("c65b"),l=s("5926"),r=s("46c4"),n="Invalid size",c=RangeError,_=TypeError,u=Math.max,d=function(t,e){this.set=t,this.size=u(e,0),this.has=i(t.has),this.keys=i(t.keys)};d.prototype={getIterator:function(){return r(a(o(this.keys,this.set)))},includes:function(t){return o(this.has,this.set,t)}},t.exports=function(t){a(t);var e=+t.size;if(e!==e)throw new _(n);var s=l(e);if(s<0)throw new c(n);return new d(t,s)}},"83b9e":function(t,e,s){"use strict";var i=s("cb27"),a=s("384f"),o=i.Set,l=i.add;t.exports=function(t){var e=new o;return a(t,(function(t){l(e,t)})),e}},"88bb":function(t,e,s){"use strict";s("d9aa")},"8a6c":function(t,e,s){"use strict";s("baed")},"8b00":function(t,e,s){"use strict";var i=s("23e7"),a=s("68df"),o=s("dad2"),l=!o("isSubsetOf",(function(t){return t}));i({target:"Set",proto:!0,real:!0,forced:l},{isSubsetOf:a})},"8ce4":function(t,e,s){"use strict";s.d(e,"e",(function(){return i})),s.d(e,"b",(function(){return a})),s.d(e,"a",(function(){return o})),s.d(e,"c",(function(){return l})),s.d(e,"d",(function(){return r}));s("14d9"),s("e9f5"),s("ab43");function i(t,e,s,i,a){let o=[];return t.map(t=>{o.push({[i]:t[e],[a]:t[s]})}),o}function a(t,e,s,i={}){let a=[];return t.map(t=>{let o={};e.map((e,i)=>{o[e]=t[s[i]]}),a.push({...o,...i})}),a}function o(t,e=!1){let s={};for(let i in t){const{billing_scheme_id:a,billing_cycle_id:o,billing_items:l,gic_goods_id:r}=t[i];let n={};for(let t in l){let s={attr_id:l[t].attr_id,name:l[t].name},i={id:l[t].id,key:t};n[t]=e?{...s,...i}:i}s[i]={billing_scheme_id:a,billing_cycle_id:o,billing_items:n,gic_goods_id:e?r:void 0}}return s}function l(t,e){return t.map(t=>t[e])}function r(t){let e="";for(let s in t)t[s]&&(e+=`${s}=${t[s]}&`);return""===e?"":"?"+e.slice(0,e.length-1)}},"8da7":function(t,e,s){"use strict";s.r(e);s("e9f5"),s("ab43");var i=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",[e("action-block",{attrs:{search_option:t.search_option,type:"physical"},on:{"fn-search":t.fn_search,"fn-operate":t.FnOperate},scopedSlots:t._u([{key:"default",fn:function(){return[t._l(t.operate_btns,(function(s){return[s.subItems&&s.subItems.length>0?e("el-dropdown",{key:s.value,on:{command:t.handleMore}},[e("el-button",{staticClass:"dropdownbtn",attrs:{type:"primary"}},[t._v(" "+t._s(s.text)),e("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),e("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},t._l(s.subItems,(function(s,i){return e("el-dropdown-item",{key:i,attrs:{command:{label:s.label,value:s.value}}},[t._v(" "+t._s(s.label)+" ")])})),1)],1):["business_test"===s.value&&t.$store.state.is_special_user?t._e():e("el-button",{key:s.value,staticClass:"dropdownbtn",attrs:{type:"primary"},on:{click:function(e){return t.handle(s.label,s.value)}}},[t._v(" "+t._s(s.label)+" ")])]]}))]},proxy:!0}])}),e("div",{staticClass:"icon m-bottom10"},[e("el-tooltip",{attrs:{content:"自定义列表项",placement:"bottom",effect:"light"}},[e("el-button",{attrs:{type:"text"},on:{click:t.FnCustom}},[e("i",{staticClass:"el-icon-s-tools"})])],1),e("el-tooltip",{attrs:{content:"刷新",placement:"bottom",effect:"light"}},[e("el-button",{attrs:{type:"text"},on:{click:t.refresh}},[e("svg-icon",{staticClass:"refresh",attrs:{icon:"refresh"}})],1)],1),e("el-tooltip",{attrs:{content:"导出",placement:"bottom",effect:"light"}},[e("el-button",{attrs:{type:"text",disabled:!t.auth_list.includes("export")},on:{click:t.down}},[e("svg-icon",{staticClass:"export",attrs:{icon:"export"}})],1)],1)],1),e("el-table",{ref:"table",attrs:{data:t.list,border:"","max-height":t.tableHeight},on:{"selection-change":t.handleSelectionChange,"sort-change":t.FnSortChange,"filter-change":t.filterAttribute,"expand-change":t.FnExpand}},[e("el-table-column",{attrs:{type:"selection"}}),t._l(t.custom_host,(function(s){return e("el-table-column",{key:s.prop,attrs:{"filter-multiple":!s.column_key&&null,prop:s.prop,"column-key":s.column_key?s.column_key:null,filters:s.column_key?s.list:null,sortable:s.sortable?s.sortable:null,width:s.width?s.width:null,type:s.type,"class-name":s.className?s.className:null},scopedSlots:t._u([{key:"header",fn:function(i){return["ecs_num"===s.prop?[e("span",[t._v("虚拟机数量")]),e("el-tooltip",{attrs:{"popper-class":"tooltip-width",content:"云桌面/文件存储转发的虚机未纳入统计，所以主机属性为云桌面/文件存储转发的物理机虚机数量为0不代表无虚机。",effect:"light"}},[e("el-button",{staticClass:"m-left5 m-right5",attrs:{type:"text"}},[e("svg-icon",{staticClass:"more",attrs:{icon:"info",viewBox:"0 0 20 20"}})],1)],1)]:e("span",[t._v(t._s(s.label))])]}},"machine_status_name"===s.prop?{key:"default",fn:function(s){return["maintenance"!==s.row.machine_status&&"lock"!==s.row.machine_status?e("div",{class:"crash"===s.row.machine_status?"error":""},[t._v(t._s(s.row.machine_status_name))]):t._e(),"off_shelves"===s.row.machine_status?e("div",{staticClass:"destroy"},[t._v(t._s(s.row.recycle_department))]):t._e(),"maintenance"===s.row.machine_status||"lock"===s.row.machine_status?e("div",{staticClass:"destroy"},[e("el-popover",{attrs:{placement:"bottom",width:"350",trigger:"click"}},[e("el-table",{attrs:{data:t.reason_list}},[e("el-table-column",{attrs:{width:"150",property:"reason",label:"备注信息"}}),e("el-table-column",{attrs:{width:"90",property:"create_time",label:"时间"}}),e("el-table-column",{attrs:{width:"100",property:"op_user",label:"操作人"}})],1),e("el-button",{attrs:{slot:"reference",type:"text"},on:{click:function(e){return t.get_reason_list(s.row.machine_status,s.row.host_id)}},slot:"reference"},[t._v(t._s(s.row.machine_status_name))])],1)],1):t._e()]}}:"net_nic"===s.prop?{key:"default",fn:function(s){return[s.row.net_nic.length>0?e("el-tooltip",{attrs:{effect:"light"}},[e("div",{attrs:{slot:"content"},slot:"content"},t._l(s.row.net_nic,(function(s,i){return e("div",{key:i},[t._v(t._s(s))])})),0),e("div",{staticClass:"tooltip-cell"},[t._v(t._s(s.row.net_nic[0]))])]):e("div")]}}:"cpu"===s.prop?{key:"default",fn:function(s){return[e("span",[t._v(t._s(parseFloat(s.row.cpu).toFixed(2)+"%"))])]}}:"hugepages_free"===s.prop?{key:"default",fn:function(s){return[e("span",[t._v(t._s(s.row.hugepages_free+"GB"))])]}}:"ram"===s.prop?{key:"default",fn:function(s){return[e("span",[t._v(t._s(parseFloat(s.row.ram).toFixed(2)+"%"))]),e("br"),e("span",[t._v("("+t._s(parseFloat(s.row.raw_available/1024).toFixed(2)+"GB")+")")])]}}:"ecs_num"===s.prop?{key:"default",fn:function(s){return[e("el-button",{attrs:{type:"text"}},[t._v(t._s(s.row.ecs_num))])]}}:"gpu_info"===s.prop?{key:"default",fn:function(s){return[s.row.gpu_info.length>0?e("el-tooltip",{attrs:{effect:"light"}},[e("div",{attrs:{slot:"content"},slot:"content"},t._l(s.row.gpu_info,(function(s,i){return e("div",{key:i},[t._v(" "+t._s(s.card_name)+" ")])})),0),e("div",{staticClass:"tooltip-cell"},[t._v(t._s(s.row.gpu_info[0].card_name))])]):e("div")]}}:"exclusive_black_customers"===s.prop?{key:"default",fn:function(s){return[s.row.exclusive_black_customers.length>1?e("el-tooltip",{attrs:{effect:"light"},scopedSlots:t._u([{key:"content",fn:function(){return t._l(s.row.exclusive_black_customers,(function(s){return e("div",[t._v(t._s(`${s.id} (${s.name})`))])}))},proxy:!0}],null,!0)},[e("span",[t._v(t._s(s.row.exclusive_black_customers.map(t=>t.id).join(",")))])]):1===s.row.exclusive_black_customers.length?e("span",[t._v(t._s(`${s.row.exclusive_black_customers[0].id} (${s.row.exclusive_black_customers[0].name})`))]):e("span")]}}:"exclusive_customers"===s.prop?{key:"default",fn:function(s){return[s.row.exclusive_customers.length>1?e("el-tooltip",{scopedSlots:t._u([{key:"content",fn:function(){return t._l(s.row.exclusive_customers,(function(s){return e("div",[t._v(t._s(`${s.id} (${s.name})`))])}))},proxy:!0}],null,!0)},[e("span",[t._v(t._s(s.row.exclusive_customers.map(t=>t.id).join(",")))])]):1===s.row.exclusive_customers.length?e("span",[t._v(t._s(`${s.row.exclusive_customers[0].id} (${s.row.exclusive_customers[0].name})`))]):e("span",[t._v("全部客户")])]}}:"ecs_num_expand"===s.prop?{key:"default",fn:function(i){return[i.row.ecs_detail?e("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"vm_table",refInFor:!0,attrs:{data:i.row.ecs_detail,"max-height":400},on:{"selection-change":e=>t.handleSelectVMList(e,i)},model:{value:t.multi_vm_rows,callback:function(e){t.multi_vm_rows=e},expression:"multi_vm_rows"}},[e("el-table-column",{attrs:{type:"selection"}}),t._l(t.ecs_fields,(function(i){return e("el-table-column",{key:i.prop,ref:"ecs_list",refInFor:!0,attrs:{label:i.label,prop:i.prop,width:i.width?i.width:null},scopedSlots:t._u(["ecs_name"===i.prop?{key:"default",fn:function(s){return[e("span",{staticClass:"clickble",on:{click:function(e){return t.FnToDetail(s.row.ecs_id)}}},[t._v(t._s(s.row.ecs_name))])]}}:"status"===i.prop?{key:"default",fn:function(s){return[e("span",{class:s.row.status},[t._v(t._s(s.row.status_display))])]}}:"private_net"===i.prop?{key:"default",fn:function(s){return t._l(s.row.private_net.split(";"),(function(i){return e("div",{key:i},[s.row.eip_info[i]?e("span",[t._v(" "+t._s(i)+" （vlan "+t._s(s.row.eip_info[i].vlan_id)+"） ")]):t._e()])}))}}:"pub_net"===i.prop?{key:"default",fn:function(i){return[i.row.pub_net?e("div",[i.row.eip_info[i.row.pub_net]&&i.row.eip_info[i.row.pub_net].conf_name?e("span",{staticClass:"circel-border"},[t._v(" "+t._s(i.row.eip_info[i.row.pub_net].conf_name)+" ")]):t._e(),t._v(" "+t._s(i.row.pub_net)+" （vlan "+t._s(i.row.eip_info[i.row.pub_net].vlan_id)+"） ")]):t._e(),t._l(i.row.virtual_net,(function(a){return e("div",{key:a},[i.row.eip_info[a]&&i.row.eip_info[a].conf_name?e("span",{staticClass:"circel-border"},[t._v(" "+t._s(i.row.eip_info[a].conf_name)+" ")]):t._e(),t._v(" "+t._s(a)+"（vlan "+t._s(i.row.eip_info[s].vlan_id)+"）")])}))]}}:"pub_ip"===i.prop?{key:"default",fn:function(s){return[s.row.eip_info[s.row.pub_net]&&s.row.eip_info[s.row.pub_net].conf_name?e("div",[e("span",{staticClass:"circel-border"},[t._v(" "+t._s(s.row.eip_info[s.row.pub_net].conf_name)+" ")]),t._v(" "+t._s(s.row.eip_info[s.row.pub_net].eip_ip)+" ")]):t._e(),t._l(s.row.virtual_net,(function(i){return e("div",{key:i},[s.row.eip_info[i]&&s.row.eip_info[i].conf_name?[e("span",{staticClass:"circel-border"},[t._v(t._s(s.row.eip_info[i].conf_name))]),t._v(" "+t._s(s.row.eip_info[i].eip_ip)+" ")]:t._e()],2)}))]}}:"ecs_info"===i.prop?{key:"default",fn:function(s){return[t._v(" "+t._s(s.row.ecs_goods_name)+" "),e("br"),t._v(" "+t._s(s.row.cpu_size)+"vCPU | "+t._s(s.row.ram_size)+"GiB "),e("br"),s.row.gpu_size?e("span",[t._v("| "+t._s(s.row.gpu_size)+"*"+t._s(s.row.card_name))]):t._e()]}}:"disk"===i.prop?{key:"default",fn:function(s){return[e("div",[t._v("系统盘："+t._s(s.row.system_disk_type)+t._s(s.row.system_disk_size)+t._s(s.row.system_disk_unit))]),s.row.data_list_list.length>0?e("div",{staticClass:"disk"},[e("span",[t._v("数据盘：")]),e("div",t._l(s.row.data_list_list,(function(s){return e("p",{key:s.feature},[t._v(t._s(s.feature)+"云盘"+t._s(s.size)+t._s(s.unit))])})),0)]):t._e()]}}:null],null,!0)})}))],2):t._e()]}}:"cpu_with_model"===s.prop?{key:"default",fn:function(s){return[s.row.cpu_model?e("span",[t._v(t._s(s.row.cpu_model)+" * "+t._s(s.row.cpu_model_count))]):t._e()]}}:"backend_type"===s.prop?{key:"default",fn:function(s){return[e("span",[t._v(t._s(t.backendObj[s.row.backend_type]))])]}}:"remark"===s.prop?{key:"default",fn:function(s){return[s.row.remark.length>40?e("el-tooltip",{attrs:{"popper-class":"tooltip-width",effect:"light",content:s.row.remark,placement:"bottom"}},[e("span",[t._v(t._s(s.row.remark.slice(0,41)+"..."))])]):e("span",[t._v(t._s(s.row.remark))])]}}:"net_card_with_model"===s.prop?{key:"default",fn:function(s){return[e("div",{staticClass:"net-model"},[s.row.net_model?e("el-tooltip",{attrs:{content:s.row.net_model,"popper-class":"tooltip-width",placement:"right",effect:"light"}},[e("span",{staticClass:"id-cell"},[t._v(t._s(s.row.net_model))])]):t._e(),s.row.net_model?e("span",[t._v(" * "+t._s(s.row.net_model_count))]):t._e()],1)]}}:"is_spot"===s.prop?{key:"default",fn:function(s){return[e("span",[t._v(t._s(s.row.is_spot?"是":"否"))])]}}:null],null,!0)})})),e("el-table-column",{attrs:{label:"操作栏"},scopedSlots:t._u([{key:"default",fn:function(s){return[e("el-dropdown",{on:{command:t.handleOperate}},[e("el-button",{attrs:{type:"text"}},[e("svg-icon",{staticClass:"more",attrs:{icon:"more"}})],1),e("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},t._l(t.rows_operate_btns,(function(i){return e("el-dropdown-item",{key:i.value,attrs:{command:{title:i.label,label:i.value,value:s.row}}},[t._v(t._s(i.label))])})),1)],1)]}}])})],2),e("el-pagination",{attrs:{"current-page":t.page_info.current,"page-sizes":[20,50,100],"page-size":t.page_info.size,layout:"total, sizes, prev, pager, next, jumper",total:t.page_info.total},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}}),t.visible&&!["upload","migrate","record","resource","update_attribute","business_test","remark","service","rollback","update_vm_status"].includes(t.oper_type)?[e("Operate",{attrs:{title:t.oper_label,rows:t.multi_rows,oper_type:t.oper_type,visible:t.visible},on:{"update:visible":function(e){t.visible=e},close:t.close}})]:t._e(),t.visible&&"upload"===t.oper_type?[e("upload-file",{attrs:{visible:t.visible},on:{"update:visible":function(e){t.visible=e},close:t.close}})]:t._e(),t.visible&&"migrate"===t.oper_type?[e("Migrate",{attrs:{visible:t.visible,rows:t.multi_rows},on:{"update:visible":function(e){t.visible=e},close:t.close}})]:t._e(),t.visible&&"record"===t.oper_type?[e("Record",{attrs:{visible:t.visible,type:"physical",record_id:t.multi_rows[0].host_id},on:{"update:visible":function(e){t.visible=e},close:t.close}})]:t._e(),t.visible&&["resource","service","rollback"].includes(t.oper_type)?[e("Resource",{attrs:{visible:t.visible,title:t.oper_label,oper_type:t.oper_type,rows:t.multi_rows},on:{"update:visible":function(e){t.visible=e},close:t.close}})]:t._e(),t.visible&&"update_vm_status"===t.oper_type?[e("update-vm-status",{attrs:{visible:t.visible,title:t.oper_label,rows:t.multi_vm_rows,current_host_id:t.current_host_id},on:{"update:visible":function(e){t.visible=e},close:t.close}})]:t._e(),t.detail_visible?[e("Detail",{attrs:{visible:t.detail_visible,detail_id:t.detail_id},on:{"close-detail":t.closeDetail}})]:t._e(),t.visible&&"update_attribute"===t.oper_type?[e("update-attribute",{attrs:{visible:t.visible,rows:t.multi_rows},on:{"update:visible":function(e){t.visible=e},close:t.close}})]:t._e(),t.visible&&"business_test"===t.oper_type?[e("business-test",{attrs:{visible:t.visible,az_info:t.az_info},on:{"update:visible":function(e){t.visible=e}}})]:t._e(),t.visible&&"remark"===t.oper_type?[e("remark",{attrs:{visible:t.visible,rows:t.multi_rows[0]},on:{"update:visible":function(e){t.visible=e},close:t.close}})]:t._e(),e("custom-list-item",{attrs:{visible:t.custom_visible,all_item:t.all_item,all_column_item:t.all_column_item},on:{"update:visible":function(e){t.custom_visible=e},"fn-custom":t.get_custom_columns}})],2)},a=[],o=(s("14d9"),s("d866"),s("910d"),s("f665"),s("7d54"),s("9ab4")),l=s("1b40"),r=s("c811"),n=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",[e("el-dialog",{attrs:{title:t.title,visible:t.visible_sync,width:"760px","destroy-on-close":!0,"close-on-click-modal":!1},on:{"update:visible":function(e){t.visible_sync=e},close:t.back}},[e("div",["restart_host"===t.oper_type?e("el-alert",{attrs:{title:"操作重启请检查是否有虚机运行，若有，请谨慎操作！",type:"warning",center:"",closable:!1}}):t._e(),["lock","maintenance","update_host_status"].includes(t.oper_type)?t._e():e("el-alert",{attrs:{title:t.alert_title,type:"warning",center:"",closable:!1}}),["lock","maintenance"].includes(t.oper_type)?e("el-alert",{attrs:{title:"lock"===t.oper_type?"请确认将下述机器置为锁定状态，置为锁定状态后，无法在此机器上开出云主机":"请确认将下述机器置为维护状态，置为维护状态后，机器将屏蔽告警和任务下发等功能",type:"warning",center:"",closable:!1}}):t._e(),"update_host_status"===t.oper_type?e("el-alert",{attrs:{title:"该功能只在特定异常故障时由运维人员操作使用。请核对如下信息，谨慎操作:",type:"warning",closable:!1}}):t._e(),e("el-table",{attrs:{data:t.list,border:"","max-height":"253"}},[e("el-table-column",{attrs:{prop:"host_name",label:"主机名",width:"150"}}),["lock","maintenance","update_host_status"].includes(t.oper_type)?e("el-table-column",{attrs:{prop:"out_band_address",label:"宿主机带外"}}):t._e(),"finish_validate"===t.oper_type?e("el-table-column",{attrs:{prop:"az_name",label:"区域"}}):t._e(),[...t.status_list,...t.flag_list].includes(t.title)?t._e():e("el-table-column",{attrs:{prop:"machine_status_name",label:"主机状态"}}),["lock"].includes(t.oper_type)?e("el-table-column",{attrs:{prop:"ecs_num",label:"虚拟机数量",width:"150"}}):t._e(),["lock","maintenance","update_host_status"].includes(t.oper_type)?t._e():e("el-table-column",{attrs:{prop:"power_status_name",label:"电源状态"}}),["schedule","migrate_flag","cheat"].includes(t.oper_type)?e("el-table-column",{attrs:{prop:"machine_status_name",label:"机器状态"}}):t._e(),"finish_validate"===t.oper_type?e("el-table-column",{attrs:{prop:"host_purpose",label:"主机用途"}}):t._e(),["finish_validate","shelves"].includes(t.oper_type)?e("el-table-column",{attrs:{prop:"host_source",label:"主机来源"}}):t._e(),["schedule"].includes(t.oper_type)?e("el-table-column",{attrs:{prop:"scheduled_display",label:"允许调度"}}):t._e(),["migrate_flag"].includes(t.oper_type)?e("el-table-column",{attrs:{prop:"migrated_display",label:"允许迁移"}}):t._e(),["cheat"].includes(t.oper_type)?e("el-table-column",{attrs:{prop:"dummy_display",label:"欺骗器"}}):t._e(),["maintenance"].includes(t.oper_type)?e("el-table-column",{attrs:{prop:"maintenance",label:"维护原因"},scopedSlots:t._u([{key:"default",fn:function(s){return[e("el-input",{attrs:{type:"textarea",placeholder:"请输入维护原因",maxlength:"50","show-word-limit":""},model:{value:s.row.maintenanceReason,callback:function(e){t.$set(s.row,"maintenanceReason",e)},expression:"scope.row.maintenanceReason"}}),e("div",{directives:[{name:"show",rawName:"v-show",value:!s.row.maintenanceReason,expression:"!scope.row.maintenanceReason"}],staticClass:"error_message"},[t._v("请输入维护原因")])]}}],null,!1,3682531027)}):t._e(),["lock"].includes(t.oper_type)?e("el-table-column",{attrs:{prop:"lock",label:"锁定原因"},scopedSlots:t._u([{key:"default",fn:function(s){return[e("el-input",{attrs:{type:"textarea",placeholder:"请输入锁定原因",maxlength:"50","show-word-limit":""},model:{value:s.row.lockReason,callback:function(e){t.$set(s.row,"lockReason",e)},expression:"scope.row.lockReason"}}),e("div",{directives:[{name:"show",rawName:"v-show",value:!s.row.lockReason,expression:"!scope.row.lockReason"}],staticClass:"error_message"},[t._v("请输入锁定原因")])]}}],null,!1,2858309765)}):t._e()],1),t.notSelectVmList.length>0?e("div",{staticClass:"m-top10"},[e("span",{staticClass:"tip_message"},[t._v("仅支持对状态为“初始化”、“初始化失败”、“锁定”、“存储异常”或“宕机”且无虚拟机运行的宿主机进行“设置维护”操作，有"+t._s(t.notSelectVmList.length)+"台宿主机不满足要求")])]):t._e(),["shelves","finish_validate","schedule","migrate_flag","cheat","update_host_status"].includes(t.oper_type)?e("el-form",{ref:"form",staticClass:"m-top20",attrs:{model:t.form_data,"label-width":"100px","label-position":"left"}},["finish_validate"===t.oper_type?e("el-form-item",{attrs:{prop:"valid",label:"验证结果:",rules:[{required:!0,message:"请选择验证结果",trigger:"blur"}]}},[e("el-radio-group",{model:{value:t.form_data.valid,callback:function(e){t.$set(t.form_data,"valid",e)},expression:"form_data.valid"}},[e("el-radio",{attrs:{label:"1"}},[t._v("成功")]),e("el-radio",{attrs:{label:"0"}},[t._v("失败")])],1)],1):t._e(),["schedule","migrate_flag","cheat"].includes(t.oper_type)?e("el-form-item",{attrs:{prop:"isFlag",label:t.labelObj[t.oper_type]}},[e("el-radio-group",{model:{value:t.form_data.isSet,callback:function(e){t.$set(t.form_data,"isSet",e)},expression:"form_data.isSet"}},[e("el-radio",{attrs:{label:"1"}},[t._v(t._s(t.valueObj[t.oper_type][0]))]),e("el-radio",{attrs:{label:"0"}},[t._v(t._s(t.valueObj[t.oper_type][1]))])],1)],1):t._e(),["schedule","migrate_flag","cheat"].includes(t.oper_type)||"finish_validate"===t.oper_type&&"0"===t.form_data.valid?e("el-form-item",{attrs:{prop:"reason",label:"说明:"}},[e("el-input",{attrs:{type:"textarea","show-word-limit":"",maxlength:["schedule","migrate_flag","cheat"].includes(t.oper_type)?128:256},model:{value:t.form_data.reason,callback:function(e){t.$set(t.form_data,"reason",e)},expression:"form_data.reason"}})],1):t._e(),["schedule","migrate_flag","cheat","update_host_status"].includes(t.oper_type)?t._e():e("el-form-item",{attrs:{prop:"recycleId",label:"finish_validate"===t.oper_type?"通知对象：":"回收部门：",rules:[{required:!0,message:"请选择"+("finish_validate"===t.oper_type?"通知对象":"回收部门"),trigger:"blur"}]}},[e("el-select",{model:{value:t.form_data.recycleId,callback:function(e){t.$set(t.form_data,"recycleId",e)},expression:"form_data.recycleId"}},t._l(t.recycle_list,(function(t){return e("el-option",{key:t.department_en,attrs:{label:t.department_name,value:t.department_name}})})),1)],1),"update_host_status"===t.oper_type?e("el-form-item",{attrs:{prop:"power_status","label-width":"150px",label:"状态变更为：",rules:[{required:!0,message:"请选择变更状态",trigger:"blur"}]}},[e("el-radio-group",{model:{value:t.form_data.power_status,callback:function(e){t.$set(t.form_data,"power_status",e)},expression:"form_data.power_status"}},[e("el-radio",{attrs:{label:"running"}},[t._v("运行中")]),e("el-radio",{attrs:{label:"shutdown"}},[t._v("已关机")])],1)],1):t._e()],1):t._e()],1),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{attrs:{type:"primary",disabled:0===t.list.length},on:{click:t.confirm}},[t._v("确认")]),e("el-button",{on:{click:function(e){return t.back("0")}}},[t._v("取消")])],1)])],1)},c=[],_=(s("a732"),s("1477"));let u=class extends l["e"]{constructor(){super(...arguments),this.alert_title=`是否确定对以下${this.rows.length}台物理机执行${this.title}操作？`,this.status_list=["开机","关机","重启"],this.flag_list=["调度标记","迁移标记","欺骗器管理"],this.valid=1,this.isFlag=1,this.selectVmList=[],this.notSelectVmList=[],this.list=[],this.labelObj={schedule:"是否允许调度",migrate_flag:"是否允许迁移",cheat:"欺骗器"},this.op_typ_list={schedule:"set_host_scheduled",migrate_flag:"set_host_migrated",cheat:"set_host_dummy"},this.op_typ_req={schedule:"scheduled",migrate_flag:"migrated",cheat:"dummy"},this.valueObj={schedule:["是","否"],migrate_flag:["是","否"],cheat:["有","无"]},this.recycle_list=[],this.form_data={valid:"",recycleId:"",reason:"",isSet:"cheat"===this.oper_type?"0":"1",power_status:"running"},this.operate_info={start_up_host:"host_operate",shutdown_host:"host_operate",restart_host:"host_operate",online_maintenance:"host_maintenance",offline_maintenance:"host_maintenance",finish:"finish_maintenance",shelves:"shelves",disperse:"disperse",finish_validate:"finish_validate",schedule:"set_flag",migrate_flag:"set_flag",cheat:"set_flag",under_sync:"update_ecs_info",data_clear:"crash_clear",down_recover:"crash_recover",lock:"set_lock",unlock:"set_unlock",maintenance:"set_maintenance",unstore_exception:"recover_storage_error",update_host_status:"update_host_power_status"}}created(){["shelves","finish_validate"].includes(this.oper_type)&&this.get_host_recycle_department(),"maintenance"===this.oper_type?(this.rows.forEach(t=>{["lock","storage_error","crash","init","init_error"].includes(t.machine_status)&&0===t.ecs_list.length?this.selectVmList.push(t):this.notSelectVmList.push(t)}),this.list=this.selectVmList.map(t=>({...t,maintenanceReason:""}))):"lock"===this.oper_type?this.list=this.rows.map(t=>({...t,lockReason:""})):(this.list=[],this.list=[...this.list,...this.rows])}async get_host_recycle_department(){let t=await _["a"].get_host_recycle_department({});"Success"===t.code&&(this.recycle_list=t.data)}async confirm(){if(["shelves","finish_validate"].includes(this.oper_type)){let t=!0,e=this.$refs.form;if(e.validate(e=>{e||(t=!1)}),!t)return!1}if("maintenance"===this.oper_type){let t=this.list.some(t=>!t.maintenanceReason);if(t)return!1}if("lock"===this.oper_type){let t=this.list.some(t=>!t.lockReason);if(t)return!1}const t=this.list.map(t=>({host_id:t.host_id,reason:t.maintenanceReason})),e=this.list.map(t=>({host_id:t.host_id,reason:t.lockReason}));let s=this.status_list.includes(this.title)?{op_type:this.oper_type,host_ids:this.rows.map(t=>t.host_id)}:["schedule","migrate_flag","cheat"].includes(this.oper_type)?{host_ids:this.rows.map(t=>t.host_id),[this.op_typ_req[this.oper_type]]:Number(this.form_data.isSet),description:this.form_data.reason,op_type:this.op_typ_list[this.oper_type]}:["online_maintenance","offline_maintenance"].includes(this.oper_type)?{maintenance_type:this.oper_type,host_ids:this.rows.map(t=>t.host_id)}:"finish_validate"===this.oper_type?{host_ids:this.rows.map(t=>t.host_id),status:"1"===this.form_data.valid?"READY":"INIT_ERROR",noticer:this.form_data.recycleId,reason:"0"===this.form_data.valid?this.form_data.reason:void 0}:"shelves"===this.oper_type?{host_ids:this.rows.map(t=>t.host_id),department_name:this.form_data.recycleId}:"under_sync"===this.oper_type?{pod_id:this.$store.state.pod_id,host_ecs:{}}:"maintenance"===this.oper_type?{maintenance_detail:t,host_ids:this.list.map(t=>t.host_id)}:"lock"===this.oper_type?{lock_detail:e,host_ids:this.list.map(t=>t.host_id)}:"update_host_status"===this.oper_type?{power_status:this.form_data.power_status,host_id:this.list[0].host_id}:{host_ids:this.rows.map(t=>t.host_id)};if("under_sync"===this.oper_type)for(let l of this.rows)s.host_ecs[l.host_id]=[],l.ecs_list.length>0&&l.ecs_list.map(t=>{s.host_ecs[l.host_id].push(t.ecs_id)});let i=await _["a"][this.operate_info[this.oper_type]]({...s});if("Success"===i.code)if("finish_validate"===this.oper_type||"disperse"===this.oper_type||"under_sync"===this.oper_type)this.$message.success(i.message),this.back("1");else if("data_clear"===this.oper_type||"down_recover"===this.oper_type){if(i.data.fail_host_list.length>0)return this.$message.warning(i.message+"。"+i.data.error_msg),void this.back("1");this.$message.success(i.message),this.back("1")}else{var a,o;if((null===(a=i.data)||void 0===a||null===(o=a.fail_host_list)||void 0===o?void 0:o.length)>0){if("maintenance"!==this.oper_type)return this.$message.warning(i.message+i.data.fail_msg),void(i.data.success_host_list.length>0?this.back("1"):this.back("0"));{let t="";for(let e in i.data.fail_msg_group_by_host)t+=i.data.fail_msg_group_by_host[e]+"\n";this.$message.error(t),this.back("0")}}else this.$message.success(i.message),this.back("1")}else this.back("0")}back(t){this.visible_sync=!1}};Object(o["a"])([Object(l["d"])("visible")],u.prototype,"visible_sync",void 0),Object(o["a"])([Object(l["c"])({default:()=>[]})],u.prototype,"rows",void 0),Object(o["a"])([Object(l["c"])(String)],u.prototype,"title",void 0),Object(o["a"])([Object(l["c"])(String)],u.prototype,"oper_type",void 0),Object(o["a"])([Object(l["b"])("close")],u.prototype,"back",null),u=Object(o["a"])([Object(l["a"])({components:{ActionBlock:r["a"]}})],u);var d=u,p=d,h=s("2877"),m=Object(h["a"])(p,n,c,!1,null,null,null),b=m.exports,f=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",[e("el-dialog",{attrs:{title:"数据批量导入",visible:t.visible_sync,width:"600px","destroy-on-close":!0,"custom-class":"upload","close-on-click-modal":!1},on:{"update:visible":function(e){t.visible_sync=e},close:t.back}},[e("div",{staticClass:"upload"},[e("div",{staticClass:"m-bottom10"},[t._v("请选择需要导入的可用区")]),e("el-select",{attrs:{filterable:"","filter-method":t.getPodList,placeholder:"请选择"},on:{"visible-change":t.change_pod},model:{value:t.az,callback:function(e){t.az=e},expression:"az"}},t._l(t.az_list,(function(s){return e("el-option",{key:s.pod_id,attrs:{label:`${s.az_name} ( ${s.pod_name} ) `,value:s.pod_id}},[t._v(t._s(s.az_name)+" ("+t._s(s.pod_name)+")")])})),1),0===t.az.length?e("span",{staticClass:"error_message m-left10"},[t._v("请选择可用区")]):t._e(),e("div",{staticClass:"flex-between m-top10 m-bottom20 down"},[e("span",[t._v("请选择需要上传的文件")]),e("a",{staticClass:"clickble",on:{click:t.down}},[t._v("下载导入模板")])]),e("el-upload",{ref:"upload",staticClass:"upload-demo",attrs:{action:"/ecs_business/v1/host/import_host/?pod_id="+t.az,"before-upload":t.before_upload,"file-list":t.fileList,accept:".xls,.xlsx",name:"host_template","auto-upload":!1,"on-success":t.FnSuccess,headers:{"Access-Token":t.$store.state.token}}},[e("el-button",{attrs:{size:"small",type:"primary"}},[t._v("选择文件")])],1)],1),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{attrs:{type:"primary"},on:{click:t.confirm}},[t._v("确认")]),e("el-button",{on:{click:function(e){return t.back("0")}}},[t._v("取消")])],1)])],1)},v=[],g=s("c839");let y=class extends l["e"]{constructor(){super(...arguments),this.fileList=[],this.az_list=[],this.az=""}created(){this.getPodList()}change_pod(t){t||this.getPodList()}async getPodList(t=""){let e=await g["a"].get_pod_list({page_index:1,page_size:20,search_info:t});"Success"===e.code&&(this.az_list=e.data.pod_list.filter(t=>t.status))}before_upload(t){}FnSuccess(t,e,s){if("Success"===t.code){if(t.data.fail_host_list.length>0)return this.$message.warning("物理机导入任务下发失败！"),void this.back("1");this.$message.success("物理机导入任务下发成功！"),this.back("1")}else this.$message.error(JSON.stringify(t.message)),this.back("0")}down(){window.location.href="/ecs_business/v1/host/download_template/"}async confirm(){if(!this.az)return;const t=this.$refs.upload;t.submit()}back(t){this.visible_sync=!1}};Object(o["a"])([Object(l["d"])("visible")],y.prototype,"visible_sync",void 0),Object(o["a"])([Object(l["b"])("close")],y.prototype,"back",null),y=Object(o["a"])([Object(l["a"])({})],y);var w=y,O=w,k=(s("d468"),Object(h["a"])(O,f,v,!1,null,null,null)),j=k.exports,x=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",[e("el-dialog",{attrs:{title:"迁移",visible:t.visible_sync,width:"1180px","destroy-on-close":!0,"custom-class":"upload","close-on-click-modal":!1},on:{"update:visible":function(e){t.visible_sync=e},close:t.back}},[e("div",{staticClass:"migrate"},[e("div",{staticClass:"left"},[e("div",{staticClass:"m-bottom10"},[e("el-checkbox",{attrs:{indeterminate:t.isIndeterminate,disabled:0===t.useable_list.length},on:{change:t.handleCheckAllChange},model:{value:t.checked,callback:function(e){t.checked=e},expression:"checked"}}),t._v(" "+t._s(t.rows[0].host_name)+"("),e("span",{staticClass:"num_message"},[t._v(t._s(t.selected.length))]),t._v("/"+t._s(t.list.length)+") "),e("span",{staticClass:"warning_message"},[t._v("(若是GPU型云主机，建议单选虚拟机)")]),e("el-button",{attrs:{type:"text"},on:{click:t.getHostList}},[e("svg-icon",{attrs:{icon:"refresh"}})],1)],1),e("el-table",{ref:"table",attrs:{data:t.list,border:"","max-height":"500"},on:{"selection-change":t.handleSelectionChange}},[e("el-table-column",{attrs:{type:"selection",selectable:t.checkSelectable}}),e("el-table-column",{attrs:{prop:"customer_id",label:"客户ID"}}),e("el-table-column",{attrs:{prop:"customer_name",label:"客户名称"}}),e("el-table-column",{attrs:{prop:"ecs_id",label:"实例名称/实例ID"},scopedSlots:t._u([{key:"default",fn:function(s){return[e("div",[t._v(t._s(s.row.name)+" / ")]),t.useable_list.includes(s.row.ecs_id)?e("span",[t._v(t._s(s.row.ecs_id))]):e("el-tooltip",{attrs:{content:t.getMsg(s.row),effect:"light"}},[e("div",[t._v(t._s(s.row.ecs_id))])])]}}])}),e("el-table-column",{attrs:{prop:"status",label:"状态"}}),e("el-table-column",{attrs:{prop:"genre",label:"计算规格"}}),e("el-table-column",{attrs:{prop:"genre",label:"存储",width:"130px"},scopedSlots:t._u([{key:"default",fn:function(s){return[s.row.disk_info?e("div",[t._v("系统盘："+t._s(Object.keys(s.row.disk_info.system)[0])+" "+t._s(s.row.disk_info.system[Object.keys(s.row.disk_info.system)[0]])+t._s(s.row.disk_info.unit))]):t._e(),s.row.disk_info&&Object.keys(s.row.disk_info.data).length>0?e("div",{staticClass:"data-item"},[t._v(" 数据盘： "),t._l(s.row.disk_info.data,(function(i,a){return e("div",{key:a},[t._v(t._s(a)+" "+t._s(i)+t._s(s.row.disk_info.unit))])}))],2):t._e()]}}])}),e("el-table-column",{attrs:{label:"迁移检查",fixed:"right"},scopedSlots:t._u([{key:"default",fn:function(s){return[s.row.is_gpu||"LOCAL"==Object.keys(s.row.disk_info.system)[0]?e("el-tooltip",{attrs:{content:"GPU型云主机和本地盘云主机不支持开机迁移",placement:"bottom",effect:"light"}},[e("el-button",{attrs:{type:"text",disabled:""}},[t._v("开机检查")])],1):e("el-button",{attrs:{type:"text"},on:{click:function(e){return t.FnCheck(s.row,"running")}}},[t._v("开机检查")]),e("el-button",{attrs:{type:"text"},on:{click:function(e){return t.FnCheck(s.row,"shutdown")}}},[t._v("关机检查")])]}}])})],1),0===t.selected.length?e("div",{staticClass:"error_message m-top10"},[t._v("请选择虚拟机")]):t._e()],1),e("div",{staticClass:"center"},[e("div",[t._v("迁移至")]),e("div",[t._v("------------\x3e")])]),e("div",{staticClass:"right"},[e("h4",[t._v("目的主机:")]),e("div",{staticClass:"m-bottom10"},[e("el-input",{staticStyle:{"margin-right":"8px"},attrs:{placeholder:"请输入主机名称"},model:{value:t.host_name,callback:function(e){t.host_name=e},expression:"host_name"}})],1),e("div",{staticClass:"m-bottom20"},[e("span",{staticClass:"m-right10"},[t._v("可用区:")]),e("span",[t._v(t._s(t.rows[0].az_name))])]),e("div",[t._v("物理机："),e("span",{staticClass:"prompt_message"},[t._v("（若不选择则随机迁移至合适的目的主机）")])]),t.recommendList.length>0?e("div",{staticClass:"recommend"},t._l(t.recommendList,(function(s){return e("div",{key:s.host_id,staticClass:"item",class:t.physical.includes(s.host_id)?"active":"",on:{click:function(e){return t.handle(s.host_id)}}},[t._v(" "+t._s(s.host_name)),e("br"),t._v(" QEMU："+t._s(s.qemu_version)),e("br"),t._v(" OVS："+t._s(s.ovs_version)+" "),e("el-tooltip",{attrs:{content:s.cpu_usage?parseFloat(s.cpu_usage).toFixed(2)+"%":"0.00%",placement:"bottom",effect:"light"}},[e("div",{staticClass:"title"},[e("CustomIcon",{attrs:{hei:s.cpu_usage}}),e("div",[t._v("CPU")])],1)]),e("el-tooltip",{attrs:{content:s.memory_usage?parseFloat(s.memory_usage).toFixed(2)+"%":"0.00%",placement:"bottom",effect:"light"}},[e("div",{staticClass:"title"},[e("CustomIcon",{attrs:{hei:s.memory_usage}}),e("div",[t._v("内存")])],1)]),e("el-tooltip",{attrs:{content:s.local_storage_usage?parseFloat(s.local_storage_usage).toFixed(2)+"%":"0.00%",placement:"bottom",effect:"light"}},[e("div",{staticClass:"title"},[e("CustomIcon",{attrs:{hei:s.local_storage_usage}}),e("div",[t._v("本地存储")])],1)]),e("el-tooltip",{attrs:{content:`${s.used_gpu_num?s.used_gpu_num:0} / ${s.total_gpu_num?s.total_gpu_num:0}`,placement:"bottom",effect:"light"}},[e("div",{staticClass:"title"},[e("CustomIcon",{attrs:{hei:0===s.total_gpu_num?0:100*Number((s.used_gpu_num/s.total_gpu_num).toFixed(2))}}),e("div",[t._v("显卡")])],1)])],1)})),0):t.selected<1?e("div",{staticClass:"error_message m-top10"},[t._v("请选择迁移的虚机")]):e("div",{staticClass:"error_message m-top10"},[t._v("无合适的物理机，无法迁移。可选择单台虚机再次尝试")])])]),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{attrs:{type:"primary",disabled:0===this.recommend.length},on:{click:t.confirm}},[t._v("确认")]),e("el-button",{on:{click:function(e){return t.back("0")}}},[t._v("取消")])],1)]),t.check_visible?e("MigrateCheck",{attrs:{visible:t.check_visible,row:t.check_row,status:t.status,host_info:t.rows[0]},on:{"update:visible":function(e){t.check_visible=e}}}):t._e()],1)},S=[],C=(s("1e70"),s("79a4"),s("c1a1"),s("8b00"),s("a4e7"),s("1e5a"),s("72c3"),s("682f")),T=s("3673"),P=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",[e("el-dialog",{attrs:{visible:t.visible_sync,title:"检查结果",width:"40%","destroy-on-close":!0,"custom-class":"upload","append-to-body":""},on:{"update:visible":function(e){t.visible_sync=e}}},[t.recommend.length>0?e("div",{staticClass:"recommend"},t._l(t.recommend,(function(s){return e("div",{key:s.host_id,staticClass:"item"},[t._v(" "+t._s(s.host_name)),e("br"),t._v(" QEMU："+t._s(s.qemu_version)),e("br"),t._v(" OVS："+t._s(s.ovs_version)+" "),e("el-tooltip",{attrs:{content:s.cpu_usage?parseFloat(s.cpu_usage).toFixed(2)+"%":"0.00%",placement:"bottom",effect:"light"}},[e("div",{staticClass:"title"},[e("CustomIcon",{attrs:{hei:s.cpu_usage}}),e("div",[t._v("CPU")])],1)]),e("el-tooltip",{attrs:{content:s.memory_usage?parseFloat(s.memory_usage).toFixed(2)+"%":"0.00%",placement:"bottom",effect:"light"}},[e("div",{staticClass:"title"},[e("CustomIcon",{attrs:{hei:s.memory_usage}}),e("div",[t._v("内存")])],1)]),e("el-tooltip",{attrs:{content:s.local_storage_usage?parseFloat(s.local_storage_usage).toFixed(2)+"%":"0.00%",placement:"bottom",effect:"light"}},[e("div",{staticClass:"title"},[e("CustomIcon",{attrs:{hei:s.local_storage_usage}}),e("div",[t._v("本地存储")])],1)]),e("el-tooltip",{attrs:{content:`${s.used_gpu_num?s.used_gpu_num:0} / ${s.total_gpu_num?s.total_gpu_num:0}`,placement:"bottom",effect:"light"}},[e("div",{staticClass:"title"},[e("CustomIcon",{attrs:{hei:0===s.total_gpu_num?0:100*Number((s.used_gpu_num/s.total_gpu_num).toFixed(2))}}),e("div",[t._v("显卡")])],1)])],1)})),0):e("div",{staticClass:"recommend"},[e("div",{staticClass:"item"},[t._v(" 无合适的物理机，无法迁移 ")])]),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(e){t.visible_sync=!1}}},[t._v("返回")])],1)])],1)},z=[];let $=class extends l["e"]{constructor(){super(...arguments),this.recommend=[]}created(){this.get_recommended_host(this.row.host_name)}async get_recommended_host(t=""){this.$store.commit("SET_LOADING",!1);let e=await _["a"].recommended_host({host_id:this.host_info.host_id,ecs_ids:[this.row.ecs_id],is_gpu:"GPU"===this.host_info.host_purpose?"1":"0",gpu_card_name:this.host_info.gpu_real_name,migration_check_flag:this.status});"Success"===e.code&&(this.recommend=e.data.data)}};Object(o["a"])([Object(l["d"])("visible")],$.prototype,"visible_sync",void 0),Object(o["a"])([Object(l["c"])({default:()=>{}})],$.prototype,"row",void 0),Object(o["a"])([Object(l["c"])({default:()=>{}})],$.prototype,"host_info",void 0),Object(o["a"])([Object(l["c"])(String)],$.prototype,"status",void 0),$=Object(o["a"])([Object(l["a"])({components:{CustomIcon:C["a"]}})],$);var E=$,I=E,F=(s("918c"),Object(h["a"])(I,P,z,!1,null,"bbdc6a6e",null)),L=F.exports;let G=class extends l["e"]{constructor(){super(...arguments),this.list=this.rows[0].ecs_list,this.selected=[],this.checked=!1,this.allSelect=!1,this.isIndeterminate=!1,this.physical=[],this.physical_list=[],this.recommend=[],this.useable_list=[],this.host_name="",this.check_visible=!1,this.check_row={},this.status=""}created(){this.setUsableList(this.rows),this.list=this.rows[0].ecs_list}watch_selected(t){if(!this.allSelect&&t.length>0){let t=[],e=!(this.selected.length>0)||!this.selected[0].is_gpu;this.rows[0].ecs_list.forEach(s=>{s.is_gpu===!e&&t.push(s.ecs_id)}),this.useable_list=this.useable_list.filter(e=>t.includes(e))}else this.setUsableList(this.rows)}setUsableList(t){let e=t[0].ecs_list.filter(t=>["已关机","运行中"].includes(t.status)),s=[];e.map(t=>{t.is_gpu&&"已关机"===t.status&&!t.no_charge_shutdown_ecs?s.push(t.ecs_id):!t.is_gpu&&t.disk_info&&t.disk_info.system&&("local"!==Object.keys(t.disk_info.system)[0]?["已关机","运行中"].includes(t.status)&&s.push(t.ecs_id):"已关机"===t.status&&s.push(t.ecs_id))}),this.useable_list=s}async getHostList(){let t=await _["a"].get_host_list({host_name:this.rows[0].host_name});"Success"===t.code&&(this.list=t.data.host_list[0].ecs_list,this.setUsableList(t.data.host_list))}getMsg(t){return t.is_gpu||t.disk_info&&"local"===Object.keys(t.disk_info.system)[0]?"仅支持关机迁移":"仅运行中和已关机状态下迁移"}checkSelectable(t,e){return!!this.useable_list.includes(t.ecs_id)}judge(){let t=this.physical_list.filter(t=>"CPU"===t.host_purpose),e=t.map(t=>t.host_id),s=[...new Set([...e,...this.physical])].length;this.selected.some(t=>t.is_gpu)&&s<[...e,...this.physical].length&&(this.$message.warning("GPU云主机不能被迁移到非GPU物理机上"),this.physical=[])}async get_recommended_host(t=""){this.$store.commit("SET_LOADING",!1);let e=await _["a"].recommended_host({host_id:this.rows[0].host_id,host_name:t,ecs_ids:this.selected.map(t=>t.ecs_id),is_gpu:"GPU"===this.rows[0].host_purpose?"1":"0",gpu_card_name:this.rows[0].gpu_real_name});"Success"===e.code&&(this.recommend=e.data.data,0===this.selected.length&&(this.physical=[]))}handleCheckAllChange(t){const e=this.$refs.table;t?e.toggleAllSelection():e.clearSelection(),this.isIndeterminate=!1,this.allSelect=!this.allSelect}handleSelectionChange(t){this.selected=t,this.get_recommended_host(),this.checked=t.length===this.list.length,this.isIndeterminate=t.length>0&&t.length<this.list.length}handle(t){this.physical.includes(t)?this.physical=this.physical.filter(e=>e!==t):this.physical.push(t)}FnCheck(t,e){this.check_row=t,this.check_visible=!0,this.status=e}async confirm(){if(0===this.selected.length)return;let t=await _["a"].migrate({ecs_ids:this.selected.map(t=>t.ecs_id),start_host_id:this.rows[0].host_id,end_host_ids:this.physical,is_gpu:"GPU"===this.rows[0].host_purpose?"1":"0"});"Success"===t.code?(this.$message.success("物理机迁移任务下发成功！"),this.back("1")):this.back("0")}get recommendList(){const t=this.recommend.filter(t=>t.host_name===this.host_name);return this.host_name?t:this.recommend}back(t){this.visible_sync=!1}};Object(o["a"])([Object(l["d"])("visible")],G.prototype,"visible_sync",void 0),Object(o["a"])([Object(l["c"])({default:()=>[]})],G.prototype,"rows",void 0),Object(o["a"])([Object(l["f"])("selected")],G.prototype,"watch_selected",null),Object(o["a"])([Object(l["b"])("close")],G.prototype,"back",null),G=Object(o["a"])([Object(l["a"])({components:{MigrateCheck:L,CustomIcon:C["a"],svgIcon:T["a"]}})],G);var D=G,R=D,H=(s("49c5"),s("b3de"),Object(h["a"])(R,x,S,!1,null,null,null)),U=H.exports,M=s("9074"),A=s("e527"),Y=s("8ce4"),N=s("3f8d"),V=s("268f"),B=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",[e("el-dialog",{attrs:{title:t.title,visible:t.visible_sync,width:"760px","destroy-on-close":!0,"close-on-click-modal":!1},on:{"update:visible":function(e){t.visible_sync=e},close:t.back}},[e("div",[0!==t.rows.length?e("el-alert",{attrs:{title:t.alert_title,type:"warning",center:"",closable:!1}}):t._e(),0!==t.rows.length?e("el-table",{attrs:{data:t.rows,border:"","max-height":"253"}},[e("el-table-column",{attrs:{prop:"host_name",label:"主机名",width:"150"}}),e("el-table-column",{attrs:{prop:"az_name",label:"节点"}}),e("el-table-column",{attrs:{prop:"machine_status_name",label:"机器状态"}}),e("el-table-column",{attrs:{prop:"host_purpose",label:"主机用途"}}),e("el-table-column",{attrs:{prop:"host_attribution_name",label:"主机归属"}})],1):t._e(),["resource"].includes(t.oper_type)?e("div",{staticClass:"ecs-belong m-top20"},[e("span",{staticClass:"m-right20"},[t._v("设置主机归属：")]),e("el-select",{attrs:{placeholder:"请选择"},model:{value:t.ecs_id,callback:function(e){t.ecs_id=e},expression:"ecs_id"}},t._l(t.ecs_list,(function(t){return e("el-option",{key:t.host_attribution_id,attrs:{label:t.name,value:t.host_attribution_id}})})),1)],1):e("el-form",{ref:"form",staticClass:"m-top20",attrs:{model:t.form_data,"label-width":"100px","label-position":"left"}},[["service"].includes(t.oper_type)?e("el-form-item",{attrs:{prop:"tag",label:"tag:",rules:[{required:!0,message:"请输入tag",trigger:"blur"}]}},[e("el-input",{attrs:{maxlength:64},model:{value:t.form_data.tag,callback:function(e){t.$set(t.form_data,"tag",e)},expression:"form_data.tag"}})],1):t._e(),0===t.rows.length?e("el-form-item",{attrs:{prop:"az_id",label:"节点:",rules:[{required:!0,message:"请选择节点",trigger:"blur"}]}},[e("el-select",{staticStyle:{width:"100%"},model:{value:t.form_data.az_id,callback:function(e){t.$set(t.form_data,"az_id",e)},expression:"form_data.az_id"}},t._l(t.az_list,(function(t){return e("el-option",{key:t.az_id,attrs:{value:t.az_id,label:t.az_name}})})),1)],1):t._e(),e("el-form-item",{attrs:{prop:"serviceType",label:"服务类型:",rules:[{required:!0,message:"请选择服务类型",trigger:"blur"}]}},[e("el-radio-group",{model:{value:t.form_data.serviceType,callback:function(e){t.$set(t.form_data,"serviceType",e)},expression:"form_data.serviceType"}},[e("el-radio",{attrs:{label:"cds-os-agent"}},[t._v("agent")]),e("el-radio",{attrs:{label:"monitor-instance",disabled:""}},[t._v("monitor-instance")]),e("el-radio",{attrs:{label:"monitor-host",disabled:""}},[t._v("monitor-host")])],1)],1)],1)],1),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{attrs:{type:"primary"},on:{click:t.confirm}},[t._v("确认")]),e("el-button",{on:{click:function(e){return t.back("0")}}},[t._v("取消")])],1)])],1)},q=[];let J=class extends l["e"]{constructor(){super(...arguments),this.alert_title=`是否确定对以下${this.rows.length}台物理机执行${this.title}操作？`,this.ecs_list=[],this.ecs_id="",this.az_list=[],this.form_data={tag:"",az_id:"",serviceType:"cds-os-agent"}}created(){"resource"===this.oper_type?this.get_host_attribution():this.get_az_list()}async get_az_list(){this.az_list=[];let t=await M["a"].get_region_az_list({need_open_az:"1",employee_no:this.$store.state.employee_no,user_name:this.$store.state.login_name});"Success"===t.code&&(t.data.forEach(t=>{t.region_list.forEach(t=>{this.az_list.push(...t.az_list)})}),this.form_data.az_id=this.az_list[0].az_id)}async get_host_attribution(){let t=await _["a"].get_host_attribution({});"Success"===t.code&&(this.ecs_list=t.data.host_attribution_list,this.ecs_id=this.ecs_list[0].host_attribution_id)}async confirm(){let t,e=!0;if("resource"===this.oper_type)t=await _["a"].set_host_attribution({host_ids:this.rows.map(t=>t.host_id),host_attribution_id:this.ecs_id});else{let s=this.$refs.form;if(s.validate(t=>{t||(e=!1)}),!e)return!1;const i={az_id:0===this.rows.length?this.form_data.az_id:this.rows[0].az_id,host_ids:this.rows.map(t=>t.host_id),server_name:this.form_data.serviceType,is_node_update:0===this.rows.length?"1":void 0};t="service"===this.oper_type?await _["a"].agent_update({...i,server_tag:this.form_data.tag}):await _["a"].agent_rollback(i)}"Success"===t.code?"resource"===this.oper_type&&t.data.fail_host_list.length>0?(this.$message.warning(t.message),this.back("1")):(this.$message.success(t.message),this.back("1")):this.back("0")}back(t){this.visible_sync=!1}};Object(o["a"])([Object(l["d"])("visible")],J.prototype,"visible_sync",void 0),Object(o["a"])([Object(l["c"])({default:()=>[]})],J.prototype,"rows",void 0),Object(o["a"])([Object(l["c"])(String)],J.prototype,"title",void 0),Object(o["a"])([Object(l["c"])(String)],J.prototype,"oper_type",void 0),Object(o["a"])([Object(l["b"])("close")],J.prototype,"back",null),J=Object(o["a"])([Object(l["a"])({components:{ActionBlock:r["a"]}})],J);var Q=J,K=Q,W=(s("aed9c"),Object(h["a"])(K,B,q,!1,null,null,null)),X=W.exports,Z=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("el-dialog",{attrs:{title:"设置属性",visible:t.visible_sync,width:"600px","destroy-on-close":!0,"close-on-click-modal":!1},on:{"update:visible":function(e){t.visible_sync=e}}},[e("div",{staticClass:"main-edit"},[e("div",{staticClass:"m-bottom20"},[e("span",[t._v("主机类型")]),e("el-select",{on:{change:t.changeType},model:{value:t.type,callback:function(e){t.type=e},expression:"type"}},t._l(t.host_types,(function(t){return e("el-option",{key:t.type,attrs:{value:t.type,label:t.type_name}})})),1)],1),e("div",{staticClass:"m-bottom20"},[e("span",[t._v("主机用途")]),e("el-select",{model:{value:t.use,callback:function(e){t.use=e},expression:"use"}},t._l(t.host_uses,(function(t){return e("el-option",{key:t.use_type,attrs:{value:t.use_type,label:t.use_name}})})),1)],1),e("div",{staticClass:"m-bottom20"},[e("span",[t._v("专属客户")]),e("el-select",{attrs:{multiple:"",filterable:"",remote:"","remote-method":t.getCustomerList},on:{"visible-change":t.changeCustomer},model:{value:t.customer_id,callback:function(e){t.customer_id=e},expression:"customer_id"}},t._l(t.customerList,(function(s){return e("el-option",{key:s.id,attrs:{value:s.id,label:`${s.id}(${s.name})`}},[t._v(t._s(`${s.id}(${s.name})`))])})),1)],1),e("div",{staticClass:"m-bottom20"},[e("span",[t._v("产品规格族")]),e("el-select",{attrs:{multiple:"",filterable:"","filter-method":t.getFamilyList},on:{"visible-change":t.changeFamily},model:{value:t.family,callback:function(e){t.family=e},expression:"family"}},t._l(t.familyList,(function(t){return e("el-option",{key:t.spec_family_id,attrs:{value:t.spec_family_id,label:t.name}})})),1)],1)]),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{attrs:{type:"primary"},on:{click:t.confirm}},[t._v("确 定")]),e("el-button",{on:{click:function(e){return t.back("0")}}},[t._v("取 消")])],1)])},tt=[];let et=class extends l["e"]{constructor(){super(...arguments),this.type="",this.use="",this.host_types=[],this.host_uses=[],this.customer_id=[],this.customerList=[],this.family=[],this.familyList=[],this.flagFamily=!0}created(){this.getHostTypes(),this.getCustomerList("",!0),this.getFamilyList(),this.valBack()}async getHostTypes(){let t=await _["a"].get_host_type({});"Success"===t.code&&(this.host_types=t.data,this.type=this.host_types[0].type,this.host_uses=this.host_types[0].list,this.use=this.host_uses[0].use_type)}changeType(t){this.host_uses=this.host_types.filter(e=>e.type===t)[0].list,this.use=this.host_uses.length>0?this.host_uses[0].use_type:""}changeFamily(t){t||this.getFamilyList()}changeCustomer(t){t&&(this.customerList=[])}async getFamilyList(t=""){let e=await _["a"].getFamilyList({host_ids:this.rows.map(t=>t.host_id),spec_family_name:t});"Success"==e.code&&(this.familyList=e.data.spec_family_list,this.flagFamily&&(this.family=e.data.old_family_data_list),this.flagFamily=!1)}async getCustomerList(t="",e=!1){if(!t&&!e)return;let s=await _["a"].getCustomerList({host_ids:this.rows.map(t=>t.host_id),customer_id:t});"Success"==s.code&&(this.customerList=s.data.customer_list)}async confirm(){let t=await _["a"].update_attribute({host_ids:this.rows.map(t=>t.host_id),host_purpose:this.use,host_type:this.type,customer_ids:this.customer_id,spec_family_ids:this.family});if("Success"===t.code){if(t.data.fail_host_list.length>0)return this.$message.warning(t.message),void this.back("0");this.$message.success(t.message),this.back("1")}else this.back("0")}valBack(){1==this.rows.length&&(this.customer_id=this.rows[0].exclusive_customers.map(t=>"string"==typeof t?t:t.id))}back(t){this.visible_sync=!1}};Object(o["a"])([Object(l["d"])("visible")],et.prototype,"visible_sync",void 0),Object(o["a"])([Object(l["c"])({default:()=>[]})],et.prototype,"rows",void 0),Object(o["a"])([Object(l["b"])("close")],et.prototype,"back",null),et=Object(o["a"])([Object(l["a"])({})],et);var st=et,it=st,at=(s("39a7"),s("b1c5"),Object(h["a"])(it,Z,tt,!1,null,"379d45d3",null)),ot=at.exports,lt=s("af7d"),rt=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("el-dialog",{attrs:{title:"业务测试",visible:t.visible_sync,width:"1000px","destroy-on-close":!0,"close-on-click-modal":!1},on:{"update:visible":function(e){t.visible_sync=e},close:t.cancel}},[e("div",{staticClass:"m-left10"},[e("el-button",{staticClass:"m-bottom10",attrs:{type:"primary",disabled:t.selectedTasks.length===t.selectable.length},on:{click:t.add}},[t._v("新增测试任务")]),e("div",{staticClass:"m-bottom20"},[t._v("将对"),e("span",{staticClass:"m-left10 num_message m-right10"},[t._v(t._s(t.az_info.az_name))]),t._v("未通过业务测试的物理机进行业务测试，已通过业务测试的物理机不会再次进行以下测试。业务测试完成情况可在"),e("span",{staticClass:"clickble m-left10 m-right10",on:{click:function(e){return t.$router.push("/message")}}},[t._v("消息通知")]),t._v("进行查看")]),e("div",{staticClass:"m-bottom10"},[e("circle-icon",{attrs:{num:1}}),t._v(t._s(t.first.description?t.first.description:""))],1),t._l(t.selectedTasks,(function(s,i){return e("div",{key:i,staticClass:"m-bottom10"},[e("circle-icon",{attrs:{num:i+2}}),e("el-select",{attrs:{placeholder:"请选择测试任务列表"},on:{change:function(e){return t.changeTask(e,i)}},model:{value:s.task_id,callback:function(e){t.$set(s,"task_id",e)},expression:"item.task_id"}},t._l(t.selectable,(function(t){return e("el-option",{key:t.maintask_name,attrs:{value:t.maintask_name,label:t.display_name,disabled:s.disList.includes(t.maintask_name)}})})),1),s.task_id?e("span",{staticClass:"m-left10"},[t._v("该任务需设置参数，请点击"),e("el-button",{attrs:{type:"text"},on:{click:t.setParams}},[t._v("设置参数")])],1):t._e(),e("el-button",{staticClass:"m-left10",attrs:{type:"text"},on:{click:function(e){return t.del(i)}}},[t._v("删除")])],1)})),e("div",{staticClass:"m-bottom10"},[e("circle-icon",{attrs:{num:t.selectedTasks.length+2}}),t._v(t._s(t.second.description?t.second.description:""))],1),e("div",{staticClass:"m-bottom10"},[e("circle-icon",{attrs:{num:t.selectedTasks.length+3}}),t._v(t._s(t.third.description?t.third.description:""))],1)],2),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{attrs:{type:"primary"},on:{click:t.confirm}},[t._v("确 定")]),e("el-button",{on:{click:t.cancel}},[t._v("取 消")])],1)])},nt=[],ct=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",{staticClass:"circle"},[t._v(t._s(t.num))])},_t=[];let ut=class extends l["e"]{};Object(o["a"])([Object(l["c"])()],ut.prototype,"num",void 0),ut=Object(o["a"])([Object(l["a"])({})],ut);var dt=ut,pt=dt,ht=(s("065f"),Object(h["a"])(pt,ct,_t,!1,null,"91dfb8fa",null)),mt=ht.exports;let bt=class extends l["e"]{constructor(){super(...arguments),this.taskList=[],this.selectedTasks=[],this.task="",this.selectable=[],this.first={},this.second={},this.third={}}created(){this.get_task_list()}async get_task_list(){let t=await _["a"].get_task_list({});"Success"===t.code&&(this.taskList=[...t.data.task_list],this.taskList.map(t=>(["CreateEcsGpuInstanceForTestPipeline","DeleteEcsGpuInstanceForTestPipeline","UpdateHostForTestPipeline"].includes(t.maintask_name)||this.selectable.push(t),"CreateEcsGpuInstanceForTestPipeline"===t.maintask_name&&(this.first=t),"DeleteEcsGpuInstanceForTestPipeline"===t.maintask_name&&(this.second=t),"UpdateHostForTestPipeline"===t.maintask_name&&(this.third=t),t)))}set_disList(){let t=this.selectedTasks.map(t=>t.task_id);this.selectedTasks.map(e=>(e.disList=t.filter(t=>t!==e.maintask_name),e))}add(){this.selectedTasks.length!==this.selectable.length&&(this.selectedTasks.push({task_id:"",params:{},disList:[]}),this.set_disList())}changeTask(t,e){this.set_disList()}del(t){let e=[];this.selectedTasks.map((s,i)=>(i!==t&&e.push(s),s)),this.selectedTasks=e,this.set_disList()}setParams(){}async confirm(){let t=[{...this.first}];this.selectedTasks.map(e=>(t.push({maintask_name:e.task_id,dep_params:e.params}),e)),t.push(this.second),t.push(this.third);let e=await _["a"].create_test_task({az_id:this.az_info.az_id,task_list:t});"Success"===e.code&&this.$message.success(e.message),this.visible_sync=!1}cancel(){this.visible_sync=!1}};Object(o["a"])([Object(l["d"])("visible")],bt.prototype,"visible_sync",void 0),Object(o["a"])([Object(l["c"])({default:()=>({az_id:"",az_name:""})})],bt.prototype,"az_info",void 0),bt=Object(o["a"])([Object(l["a"])({components:{SvgIcon:T["a"],CircleIcon:mt}})],bt);var ft=bt,vt=ft,gt=(s("e948"),Object(h["a"])(vt,rt,nt,!1,null,"7889306c",null)),yt=gt.exports,wt=s("76ff"),Ot=s("c1df"),kt=s.n(Ot),jt=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("el-dialog",{attrs:{title:"编辑备注-"+t.rows.host_name,visible:t.visible_sync,width:"400px","destroy-on-close":!0,"close-on-click-modal":!1},on:{"update:visible":function(e){t.visible_sync=e}}},[e("el-input",{attrs:{type:"textarea",maxlength:"128","show-word-limit":"",rows:"5"},model:{value:t.value,callback:function(e){t.value=e},expression:"value"}}),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{attrs:{type:"primary"},on:{click:t.confirm}},[t._v("确认")]),e("el-button",{on:{click:function(e){t.visible_sync=!1}}},[t._v("取消")])],1)],1)},xt=[];let St=class extends l["e"]{constructor(){super(...arguments),this.value=this.rows.remark}created(){}async confirm(){let t=await _["a"].set_remark({host_ids:[this.rows.host_id],remark:this.value});"Success"===t.code?(this.$message.success(t.message),this.back("1")):this.back("0")}back(t){this.visible_sync=!1}};Object(o["a"])([Object(l["d"])("visible")],St.prototype,"visible_sync",void 0),Object(o["a"])([Object(l["c"])({default:()=>({host_name:"",remark:""})})],St.prototype,"rows",void 0),Object(o["a"])([Object(l["b"])("close")],St.prototype,"back",null),St=Object(o["a"])([Object(l["a"])({})],St);var Ct=St,Tt=Ct,Pt=(s("edb6"),Object(h["a"])(Tt,jt,xt,!1,null,"77861e6a",null)),zt=Pt.exports,$t=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",[e("el-dialog",{attrs:{title:t.title,visible:t.visible_sync,width:"760px","destroy-on-close":!0,"close-on-click-modal":!1},on:{"update:visible":function(e){t.visible_sync=e},close:t.back}},[e("div",[e("el-alert",{attrs:{title:"该功能只在特定异常故障时由运维人员操作使用。请核对如下信息，谨慎操作:",type:"warning",closable:!1}}),e("el-table",{attrs:{data:t.list,border:"","max-height":"253"}},[e("el-table-column",{attrs:{prop:"customer_name",label:"客户名称/客户ID",width:"150"},scopedSlots:t._u([{key:"default",fn:function(s){return[e("div",[t._v(t._s(s.row.customer_name))]),e("div",[t._v(t._s(s.row.customer_id))])]}}])}),e("el-table-column",{attrs:{prop:"ecs_name",label:"云服务器名称/云服务器ID",width:"160"},scopedSlots:t._u([{key:"default",fn:function(s){return[e("div",[t._v(t._s(s.row.ecs_name))]),e("div",[t._v(t._s(s.row.ecs_id))])]}}])}),e("el-table-column",{attrs:{prop:"calculation_specification",label:"云服务器规格",width:"200"}}),e("el-table-column",{attrs:{prop:"status_display",label:"状态"}}),e("el-table-column",{attrs:{prop:"gpu_card_status",label:"显卡状态",width:"100"}})],1),e("el-form",{ref:"form",staticClass:"m-top20",attrs:{model:t.form_data,"label-width":"100px","label-position":"left"}},[e("el-form-item",{attrs:{prop:"vm_status","label-width":"150px",label:"状态变更为：",rules:[{required:!0,message:"请选择变更状态",trigger:"blur"}]}},[e("el-radio-group",{model:{value:t.form_data.vm_status,callback:function(e){t.$set(t.form_data,"vm_status",e)},expression:"form_data.vm_status"}},[e("el-radio",{attrs:{label:"running"}},[t._v("运行中")]),e("el-radio",{attrs:{label:"shutdown"}},[t._v("已关机")])],1)],1)],1)],1),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{attrs:{type:"primary",disabled:0===t.list.length},on:{click:t.confirm}},[t._v("确认")]),e("el-button",{on:{click:function(e){return t.back("0")}}},[t._v("取消")])],1)])],1)},Et=[];let It=class extends l["e"]{constructor(){super(...arguments),this.list=[],this.form_data={vm_status:"running"}}created(){this.list=[...this.rows]}async confirm(){const t=this.list.map(t=>t.ecs_id);let e={host_id:this.current_host_id,status:this.form_data.vm_status,ecs_ids:t},s=await _["a"].update_ecs_status(e);"Success"===s.code?(this.$message.success(s.message),this.back("1")):this.back("0")}back(t){this.visible_sync=!1}};Object(o["a"])([Object(l["d"])("visible")],It.prototype,"visible_sync",void 0),Object(o["a"])([Object(l["c"])({default:()=>[]})],It.prototype,"rows",void 0),Object(o["a"])([Object(l["c"])(String)],It.prototype,"title",void 0),Object(o["a"])([Object(l["c"])(String)],It.prototype,"oper_type",void 0),Object(o["a"])([Object(l["c"])(String)],It.prototype,"current_host_id",void 0),Object(o["a"])([Object(l["b"])("close")],It.prototype,"back",null),It=Object(o["a"])([Object(l["a"])({components:{ActionBlock:r["a"]}})],It);var Ft=It,Lt=Ft,Gt=Object(h["a"])(Lt,$t,Et,!1,null,null,null),Dt=Gt.exports;let Rt=class extends l["e"]{constructor(){super(...arguments),this.search_option={out_band_address:{placeholder:"请输入带外IP"},host_ip:{placeholder:"请输入管理网IP"},host_name:{placeholder:"请输入主机名称"},host_id:{placeholder:"请输入主机ID"},vm_id:{placeholder:"请输入虚拟机ID"},cpu:{placeholder:"请输入CPU型号"},gpu_model:{placeholder:"请输入显卡型号"},nic:{placeholder:"请输入网卡型号"},room:{placeholder:"请选择机房",list:[]},host_rack:{placeholder:"请输入机柜编号"},bare_metal_id:{placeholder:"请输入物理机产品ID"},bare_metal_name:{placeholder:"请输入物理机产品名称"},ovs_version:{placeholder:"请选择OVS版本",list:[]},create_time:{placeholder:["开始时间","结束时间"],type:"datetimerange",width:"360",clearable:!0,dis_day:31,defaultTime:[]}},this.operate_btns=[{label:"导入",value:"upload"},{label:"完成验证",value:"finish_validate"},{label:"开机",value:"start_up_host"},{label:"关机",value:"shutdown_host"},{label:"重启",value:"restart_host"},{label:"设置维护",value:"maintenance"},{label:"完成维护",value:"finish"},{label:"驱散",value:"disperse"},{label:"业务测试",value:"business_test"},{label:"调度标记",value:"schedule"},{label:"迁移标记",value:"migrate_flag"},{label:"欺骗器管理",value:"cheat"},{label:"底层同步",value:"under_sync"},{text:"宕机处理",subItems:[{label:"数据清理同步",value:"data_clear"},{label:"宕机恢复",value:"down_recover"}]},{text:"机器锁定",subItems:[{label:"锁定机器",value:"lock"},{label:"解锁机器",value:"unlock"}]},{text:"解除异常",subItems:[{label:"解除存储异常",value:"unstore_exception"}]},{label:"服务更新",value:"service"},{label:"回滚",value:"rollback"},{label:"更新虚机状态",value:"update_vm_status"}],this.rows_operate_btns=[{label:"详情",value:"physical_detail"},{label:"迁移",value:"migrate"},{label:"操作记录",value:"record"},{label:"分配资源",value:"resource"},{label:"编辑备注",value:"remark"},{label:"服务更新",value:"service"},{label:"回滚",value:"rollback"},{label:"更新物理机电源状态",value:"update_host_status"}],this.error_msg={start_up_host:"已选主机需为在线或离线状态",shutdown_host:"已选主机需为在线或离线状态",restart_host:"已选主机需为在线或离线状态",online_maintenance:"已选主机需为在线状态",offline_maintenance:"已选主机需为在线或离线状态且已选主机上不能有虚拟机运行",finish:"已选主机需为在线维护中或离线维护中",shelves:"已选主机上不能有虚拟机运行",disperse:"已选主机需为在线状态",migrate:"已选主机需为在线状态",unlock:"已选主机需为锁定状态"},this.host_belongs=[],this.search_data={},this.page_info={current:1,size:20,total:0},this.list=[],this.visible=!1,this.oper_type="",this.oper_label="",this.multi_rows=[],this.multi_vm_rows=[],this.auth_list=[],this.filter_data={},this.host_types=[],this.host_uses=[],this.power_list=[],this.machine_list=[],this.host_source=[],this.all_column_item=[],this.all_item=[],this.custom_visible=!1,this.tableHeight=70,this.az_info={},this.loading=!1,this.expand_rows=[],this.new_prop_list=[],this.filter_info={},this.detail_id="",this.detail_visible=!1,this.timer=null,this.reason_list=[],this.multiple_selection_id=[],this.ecs_fields=[{label:"客户ID",prop:"customer_id"},{label:"客户名称",prop:"customer_name"},{label:"云服务器ID",prop:"ecs_id"},{label:"云服务器名称",prop:"ecs_name"},{label:"状态",prop:"status"},{label:"私网IP",prop:"private_net"},{label:"虚拟出网网关IP",prop:"pub_net"},{label:"公网IP",prop:"pub_ip"},{label:"计算规格",prop:"ecs_info"},{label:"存储",prop:"disk",width:"160px"},{label:"操作系统",prop:"os_name"},{label:"更新时间",prop:"update_time"},{label:"创建时间",prop:"create_time"}],this.filed_name_list=["supplier","bios_version","out_bond_version","host_brand","switch_one__name","switch_two__name","switch_three__name","switch_four__name","out_band_switch__name","net_model"],this.custom_host=["host_name","host_ip","out_band_address","machine_status_name","power_status_name","ecs_num","host_type_ch","host_purpose_ch","host_attribution_name","host_source","cpu_model","gpu_model","gpu_count","net_nic","cpu","ram","hugepages_free","create_time"],this.backendList=[{value:"block",text:"云盘"},{value:"local",text:"本地盘"},{value:"local,block",text:"云盘/本地盘"}],this.backendObj={block:"云盘",local:"本地盘","local,block":"云盘/本地盘"}}created(){this.get_room_list(),this.get_az_list(),this.get_status_list(),this.get_host_attribution(),this.getHostTypes(),this.get_host_recycle_department(),this.get_host_list_field(),this.get_ovs_list(),this.auth_list=this.$store.state.auth_info[this.$route.name],delete this.$store.state.host_search[""];for(let t in this.search_option)this.search_option[t].default_value=this.$store.state.host_search[t];this.$route.query.host_id&&(this.search_option.host_id.default_value=this.$route.query.host_id)}mounted(){this.setHeight()}FnOperate(){this.setHeight()}setHeight(){this.$nextTick(()=>{let t=this.$refs.table;this.tableHeight=window.innerHeight-t.$el.offsetTop-70;let e=this;window.onresize=function(){e.tableHeight=window.innerHeight-t.$el.offsetTop-70}})}async get_host_list_field(){let t=await _["a"].get_host_list_field({});if("Success"===t.code){let e=["field_name","show_name"],s=["prop","label"],i=[];t.data.map(t=>(i=[...i,...t.filed],t)),this.all_item=t.data,this.all_column_item=Object(Y["b"])(i,s,e),this.get_custom_columns(this.$store.state.custom_host),this.get_custom_columns(this.$store.state.custom_host)}}async get_ovs_list(){this.search_option.ovs_version.list=[];let t=await _["a"].get_ovs_version({pod_id:this.$store.state.pod_id});if("Success"===t.code){let e=t.data;e.forEach(t=>{this.search_option.ovs_version.list.push({label:t,type:t})})}}async get_reason_list(t,e){if(console.log(t,"type"),"lock"===t){let t=await _["a"].get_lock_record({host_id:e});"Success"===t.code&&(this.reason_list=t.data)}else{let t=await _["a"].get_maintenance_record({host_id:e});"Success"===t.code&&(this.reason_list=t.data)}}async get_custom_columns(t){if(0===t.length)return;this.custom_host=this.all_column_item.filter(e=>t.includes(e.label)),this.new_prop_list=this.custom_host.filter(t=>this.filed_name_list.includes(t.prop)).map(t=>t.prop),this.new_prop_list.length>0&&this.get_host_filter_item(),this.custom_host.map(t=>(["host_name","out_band_address","host_ip","cpu","ram","ecs_num","create_time","gpu_count","gpu_allot","ecs_gpu_count","gpu_ff_count","hugepages_free"].includes(t.prop)&&(t=Object.assign(t,{},{sortable:"custom"}),"ecs_num"===t.prop&&(t=Object.assign(t,{},{className:"physical",width:"140px"}))),["cpu_with_model","net_card_with_model"].includes(t.prop)&&(t=Object.assign(t,{},{width:"180px"})),"host_type_ch"===t.prop&&(t=Object.assign(t,{},{column_key:"host_type",list:this.host_types})),"host_purpose_ch"===t.prop&&(t=Object.assign(t,{},{column_key:"host_purpose",list:this.host_uses})),"host_attribution_name"===t.prop&&(t=Object.assign(t,{},{column_key:"host_attribution_id",list:this.host_belongs})),"host_source"===t.prop&&(t=Object.assign(t,{},{column_key:"host_source",list:this.host_source})),"power_status_name"===t.prop&&(t=Object.assign(t,{},{column_key:"power_status",list:this.power_list})),"machine_status_name"===t.prop&&(t=Object.assign(t,{},{column_key:"machine_status",list:this.machine_list})),"backend_type"===t.prop&&(t=Object.assign(t,{},{column_key:"backend_type",list:this.backendList})),"net_nic"===t.prop&&(t=Object.assign(t,{},{width:"180px"})),"gpu_info"===t.prop&&(t=Object.assign(t,{},{width:"180px"})),["scheduled_display"].includes(t.prop)&&(t=Object.assign(t,{},{column_key:"scheduled",list:[{text:"是",value:1},{text:"否",value:0}]})),["migrated_display"].includes(t.prop)&&(t=Object.assign(t,{},{column_key:"migrated",list:[{text:"是",value:1},{text:"否",value:0}]})),"dummy_display"===t.prop&&(t=Object.assign(t,{},{column_key:"dummy",list:[{text:"有",value:1},{text:"无",value:0}]})),"vgpu_segment_type"===t.prop&&(t=Object.assign(t,{},{column_key:"vgpu_segment_type",list:[{text:"Q",value:"Q"},{text:"B",value:"B"},{text:"C",value:"C"},{text:"A",value:"A"}]})),"host_business_type"===t.prop&&(t=Object.assign(t,{},{column_key:"host_business_type",list:[{text:"KVM",value:"KVM"},{text:"ECI",value:"ECI"}]})),this.filed_name_list.includes(t.prop)&&(t=Object.assign(t,{},{column_key:t.prop,list:[]})),"is_spot"===t.prop&&(t=Object.assign(t,{},{column_key:"is_spot",list:[{text:"是",value:"1"},{text:"否",value:"0"}]})),t));let e=this.custom_host.map(t=>t.prop);if(e.includes("ecs_num_expand"))return;let s=e.indexOf("ecs_num");if(s>-1){let t={type:"expand",label:"",prop:"ecs_num_expand"};this.custom_host.splice(s+1,0,t)}}fn_search(t={}){this.search_data={...t},this.page_info.current=1,this.judgeColumns(),this.get_physical_list()}beforeDestroy(){this.FnClearTimer(),this.$store.commit("SET_HOST_SEARCH",this.search_data)}FnCustom(){this.custom_visible=!0}refresh(){this.page_info.current=1,this.get_physical_list()}watch_pod(t){t&&(this.refresh(),this.get_ovs_list())}async get_physical_list(t=!0){t||(this.$store.commit("SET_LOADING",!1),this.multiple_selection_id=this.multi_rows.map(t=>t.host_id));const{room:e,host_name:s,vm_id:i,out_band_address:a,host_ip:o,host_id:l,gpu_model:r,host_rack:n,create_time:c,cpu:u,nic:d,bare_metal_name:p,bare_metal_id:h,vgpu_segment_type:m,host_info:b,ovs_version:f}=this.search_data;let v=await _["a"].get_host_list({pod_id:this.$store.state.pod_id,machine_room_name:e,host_name:s,vm_id:i,out_band_address:a,host_ip:o,host_id:l,gpu_model:r,host_rack:n,cpu:u,nic:d,bare_metal_name:p,bare_metal_id:h,host_info:b,ovs_version:f,vgpu_segment_type:m?m[0]:void 0,start_time:c&&c[0]?kt()(c[0]).format("YYYY-MM-DD HH:mm:ss"):void 0,end_time:c&&c[1]?kt()(c[1]).format("YYYY-MM-DD HH:mm:ss"):void 0,page_index:this.page_info.current,page_size:this.page_info.size,sort_cpu:this.search_data.sort_cpu,sort_ram:this.search_data.sort_ram,sort_create_time:this.search_data.sort_create_time,sort_gpu_count:this.search_data.sort_gpu_count,sort_gpu_allot:this.search_data.sort_gpu_allot,sort_ecs_num:this.search_data.sort_ecs_num,sort_host_name:this.search_data.sort_host_name,sort_out_band_address:this.search_data.sort_out_band_address,sort_ecs_gpu_count:this.search_data.sort_ecs_gpu_count,sort_gpu_ff_count:this.search_data.sort_gpu_ff_count,sort_host_ip:this.search_data.sort_host_ip,sort_hugepages_free:this.search_data.sort_hugepages_free,...this.filter_info});if("Success"===v.code){this.list=v.data.host_list,this.list.map(t=>(t.ecs_detail=[],t));var g=[];this.multi_rows.length>0&&(g=v.data.host_list.filter(t=>this.multiple_selection_id.includes(t.host_id))),g&&g.length>0&&this.$nextTick(()=>{g.forEach(t=>{this.$refs.table.toggleRowSelection(t)})}),this.page_info.total=v.data.page_info.count||0}this.FnSetTimer()}FnSetTimer(){this.timer&&this.FnClearTimer(),this.timer=setTimeout(()=>{this.get_physical_list(!1)},3e4)}FnClearTimer(){this.timer&&clearTimeout(this.timer)}async getHostTypes(){let t=await _["a"].get_host_type({});if("Success"===t.code){let e=["type","type_name","list"],s=["value","text","list"];this.host_types=Object(Y["b"])(t.data,s,e),this.setList(this.host_types,"host_type_ch")}}async get_host_filter_item(){let t=await _["a"].get_host_filter_item({filed_names:this.new_prop_list});if("Success"===t.code){let e=this.custom_host.map(t=>t.prop);for(let s in t.data){let i=e.indexOf(s),a=this.custom_host[i],o=[];t.data[s].map(t=>{o.push({text:t,value:t})}),this.custom_host.splice(i,1,{...a,list:o})}}}async get_host_attribution(){let t=await _["a"].get_host_attribution({});if("Success"===t.code){let e=["host_attribution_id","name"],s=["value","text"];this.host_belongs=Object(Y["b"])(t.data.host_attribution_list,s,e),this.setList(this.host_belongs,"host_attribution_name")}}FnToDetail(t){this.detail_id=t,this.detail_visible=!0}closeDetail(){this.detail_visible=!1}FnGetNet(t){let e=t.split(".");return[e[0],e[1],e[2],"0"].join(".")}async down(){const{room:t,host_name:e,vm_id:s,out_band_address:i,host_ip:a,host_id:o,gpu_model:l,host_rack:r,sort_host_ip:n,create_time:c,cpu:_,nic:u,bare_metal_name:d,bare_metal_id:p,ovs_version:h}=this.search_data;let m={pod_id:this.$store.state.pod_id,machine_room_name:t,host_name:e,vm_id:s,out_band_address:i,host_ip:a,host_id:o,gpu_model:l,host_rack:r,sort_host_ip:n,cpu:_,nic:u,bare_metal_name:d,bare_metal_id:p,ovs_version:h,start_time:c&&c[0]?kt()(c[0]).format("YYYY-MM-DD HH:mm:ss"):void 0,end_time:c&&c[1]?kt()(c[1]).format("YYYY-MM-DD HH:mm:ss"):void 0,...this.filter_info,field_names:JSON.stringify(this.custom_host.map(t=>t.prop))},b="";for(let v in m)m[v]&&(b+=`${v}=${m[v]}&`);let f=""===b?"":"?"+b.slice(0,b.length-1);window.location.href="/ecs_business/v1/host/host_list_download/"+f}async get_az_list(){let t=await M["a"].get_region_az_list({employee_no:this.$store.state.employee_no,user_name:this.$store.state.login_name});"Success"===t.code&&t.data.forEach(t=>{t.region_list.forEach(t=>{})})}async get_room_list(){let t=await _["a"].get_room_list({});"Success"===t.code&&t.data.machine_room.forEach(t=>{this.search_option.room.list.push({label:t,type:t})})}async get_status_list(){let t=await _["a"].get_status_list({});if("Success"===t.code){for(let e in t.data.power_status)this.power_list.push({text:t.data.power_status[e],value:e});for(let e in t.data.machine_status)this.machine_list.push({text:t.data.machine_status[e],value:e})}}async get_host_recycle_department(){let t=await _["a"].get_host_recycle_department({});if("Success"===t.code){let e=["department_name","department_name"],s=["value","text"];this.host_source=Object(Y["b"])(t.data,s,e),this.setList(this.host_source,"host_source")}}handleSelectionChange(t){this.multi_rows=t}handleSelectVMList(t,e){console.log(t,"sabdhbashdajs"),this.current_host_id=e.row.host_id,this.multi_vm_rows=t}FnSortChange(t){this.search_data.sort_cpu=void 0,this.search_data.sort_ram=void 0,this.search_data.sort_host_name=void 0,this.search_data.sort_out_band_address=void 0,this.search_data.sort_host_ip=void 0,this.search_data.sort_ecs_num=void 0,this.search_data.sort_create_time=void 0,this.search_data.sort_gpu_count=void 0,this.search_data.sort_ecs_gpu_count=void 0,this.search_data.sort_gpu_allot=void 0,this.search_data.sort_gpu_ff_count=void 0,this.search_data.hugepages_free=void 0,this.search_data["sort_"+t.prop]="descending"===t.order?"1":"ascending"===t.order?"0":void 0,this.get_physical_list()}handleSizeChange(t){this.page_info.size=t,this.get_physical_list()}handleCurrentChange(t){this.page_info.current=t,this.get_physical_list()}judgeColumns(){let t=Object.keys(this.filter_data),e=[...this.new_prop_list,"power_status","machine_status","host_attribution_id","host_purpose","host_type","host_source","backend_type","scheduled","migrated","dummy","vgpu_segment_type","host_business_type","is_spot"];t.map(t=>{e.includes(t)||delete this.filter_data[t]}),this.filter_info={};for(let s in this.filter_data)this.filter_info[s]=this.filter_data[s][0]}filterAttribute(t){if(this.filter_data={...this.filter_data,...t},this.judgeColumns(),this.filter_data.host_type&&this.filter_data.host_type.length>0){let t=["use_type","use_name"],e=["value","text"],s=this.host_types.filter(t=>t.value===this.filter_data.host_type[0]);this.host_uses=s.length>0?Object(Y["b"])(s[0].list,e,t):[]}else this.host_uses=[];this.setList(this.host_uses,"host_purpose_ch"),this.fn_search(this.search_data)}async FnExpand(t,e){let s=e.map(t=>t.host_id);if(s.includes(t.host_id)&&t.ecs_list.length>0){e.length>=this.expand_rows.length&&(this.loading=!0);let s=await A["a"].get_instance_list({ecs_ids:t.ecs_list.map(t=>t.ecs_id)});"Success"===s.code&&(this.list.map(e=>{e.host_id===t.host_id&&this.$set(e,"ecs_detail",s.data.ecs_list)}),this.loading=!1),this.expand_rows=e,this.multi_vm_rows=[]}}handle(t,e){if("update_vm_status"===e)return 0===this.multi_vm_rows.length?void this.$message.warning("请先勾选虚拟机!"):(this.oper_type=e,this.oper_label=t,void(this.visible=!0));if(0!==this.multi_rows.length||["upload","business_test","service","rollback"].includes(e)){if("finish_validate"===e)return this.multi_rows.every(t=>["init_error","init","offline"].includes(t.machine_status))?(this.oper_type=e,this.oper_label=t,void(this.visible=!0)):void this.$message.warning("物理机需为初始化状态或验证失败状态!");if("data_clear"===e){let s=this.multi_rows.find(t=>["crash_clear"].includes(t.machine_status));return s?(this.oper_type=e,this.oper_label=t,void(this.visible=!0)):void this.$message.warning("机器状态需为待清理状态!")}if("down_recover"===e){let s=this.multi_rows.find(t=>["crash_recover"].includes(t.machine_status));return s?(this.oper_type=e,this.oper_label=t,void(this.visible=!0)):void this.$message.warning("机器状态需为待恢复状态!")}if(["upload","resource","update_attribute","business_test","schedule","migrate_flag","cheat","under_sync"].includes(e)){if("business_test"===e){if(0===this.list.length)return void this.$message.warning("当前无宿主机可进行业务测试!");this.az_info={az_id:this.list[0].az_id,az_name:this.list[0].az_name}}return this.oper_type=e,this.oper_label=t,this.visible=!0,void console.log("ccc",this.oper_type)}if(this.judge(e)){if("disperse"===e){let t=this.multi_rows.filter(t=>"GPU"===t.host_purpose),e=t.every(t=>t.ecs_list.every(t=>t.is_gpu&&"已关机"===t.status||!t.is_gpu)),s=t.every(t=>{t.host_business_type});if(!e)return void this.$message.warning("GPU物理机中的GPU云主机需为关机状态!");if(!s)return void this.$message.warning("GPU物理机中的云主机业务类型需为KVM类型!")}this.oper_type=e,this.oper_label=t,this.visible=!0}else this.$message.warning(this.error_msg[e])}else this.$message.warning("请先勾选物理机!")}handleMore(t){const{label:e,value:s}=t;this.handle(e,s)}judge(t){const e=Object(N["c"])(t);let s=this.multi_rows.every(s=>{let i=0===e.power.length||e.power.includes(s.power_status),a=0===e.host.length||e.host.includes(s.machine_status),o=!e.vm||e.vm===s.ecs_list.length+1;return this.error_msg[t]=Object(N["c"])(t).msg,i&&a&&o});return s}handleOperate(t){const{title:e,label:s,value:i}=t;this.multi_rows=[i],"physical_detail"===s?this.$router.push({name:s,query:{id:i.host_id,name:i.host_name}}):"migrate"===s?this.judge(s)?(this.oper_type=s,this.visible=!0):this.$message.warning(this.error_msg[s]):"out_of_band"===s?this.out_of_band():(this.visible=!0,this.oper_type=s,this.oper_label=e)}async out_of_band(){let t=await _["a"].external_management({host_id:this.multi_rows[0].host_id});"Success"===t.code&&window.open(t.data.url.out_bond_addr)}setList(t,e){this.custom_host.map(s=>(s.prop===e&&(s.list=t),s))}close(t){"upload"===this.oper_type&&this.get_room_list(),"1"===t&&this.get_physical_list(),this.visible=!1,this.oper_type="",this.oper_label="",this.multi_rows=[];const e=this.$refs.table;e.clearSelection()}crashHandleCommand(t){"data_clear"===t?this.handle("数据清理同步",t):this.handle("宕机恢复",t)}};Object(o["a"])([Object(l["f"])("$store.state.pod_id")],Rt.prototype,"watch_pod",null),Rt=Object(o["a"])([Object(l["a"])({components:{ActionBlock:r["a"],Operate:b,UploadFile:j,Migrate:U,Record:V["a"],SvgIcon:T["a"],Resource:X,UpdateAttribute:ot,CustomListItem:lt["a"],BusinessTest:yt,Detail:wt["a"],Remark:zt,UpdateVmStatus:Dt}})],Rt);var Ht=Rt,Ut=Ht,Mt=(s("e831"),s("3c69"),Object(h["a"])(Ut,i,a,!1,null,"df1010ec",null));e["default"]=Mt.exports},"8e16":function(t,e,s){"use strict";var i=s("7282"),a=s("cb27");t.exports=i(a.proto,"size","get")||function(t){return t.size}},9074:function(t,e,s){"use strict";var i=s("81a9"),a=s("bff7");e["a"]={get_customer_name(t){return Object(i["a"])(Object(a["b"])("POST","/ecs/get_customer_name/",t))},get_region_az_list(t){return Object(i["a"])(Object(a["b"])("POST","/ecs/region_az_info/",t))},get_net_list(t){return Object(i["a"])(Object(a["b"])("POST","/ecs/net_info/",t))},get_all_cpu_ram(){return Object(i["a"])(Object(a["b"])("GET","/ecs/ram_cpu_list/"))},get_category_list(t){return Object(i["a"])(Object(a["b"])("GET","/ecs/ecs_category_list/",t))},ecs_family_info(t){return Object(i["a"])(Object(a["b"])("GET","/ecs/ecs_family_info/",t))},get_os_list(t){return Object(i["a"])(Object(a["b"])("POST","/img/image_info/",t))},get_price(t){return Object(i["a"])(Object(a["b"])("POST","/ecs/get_price/",t))},create_instance(t){return Object(i["a"])(Object(a["b"])("POST","/ecs/create_ecs/",t))},get_ecs_limit(t){return Object(i["a"])(Object(a["b"])("POST","/ecs/get_ecs_limit/",t))},get_ram_cpu_price_list(t){return Object(i["a"])(Object(a["b"])("POST","/ecs/ecs_spec_attach_price/",t))},difference_price(t){return Object(i["a"])(Object(a["b"])("POST","/ecs/ecs_difference_price/",t))},change_configure_limit(t){return Object(i["a"])(Object(a["b"])("POST","/ecs/change_configure_limit/",t))}}},"918c":function(t,e,s){"use strict";s("eb0f")},9409:function(t,e,s){},"953b":function(t,e,s){"use strict";var i=s("dc19"),a=s("cb27"),o=s("8e16"),l=s("7f65"),r=s("384f"),n=s("5388"),c=a.Set,_=a.add,u=a.has;t.exports=function(t){var e=i(this),s=l(t),a=new c;return o(e)>s.size?n(s.getIterator(),(function(t){u(e,t)&&_(a,t)})):r(e,(function(t){s.includes(t)&&_(a,t)})),a}},9961:function(t,e,s){"use strict";var i=s("dc19"),a=s("cb27"),o=s("83b9e"),l=s("7f65"),r=s("5388"),n=a.add,c=a.has,_=a.remove;t.exports=function(t){var e=i(this),s=l(t).getIterator(),a=o(e);return r(s,(function(t){c(e,t)?_(a,t):n(a,t)})),a}},a4e7:function(t,e,s){"use strict";var i=s("23e7"),a=s("395e"),o=s("dad2"),l=!o("isSupersetOf",(function(t){return!t}));i({target:"Set",proto:!0,real:!0,forced:l},{isSupersetOf:a})},a5f7:function(t,e,s){"use strict";var i=s("dc19"),a=s("cb27"),o=s("83b9e"),l=s("8e16"),r=s("7f65"),n=s("384f"),c=s("5388"),_=a.has,u=a.remove;t.exports=function(t){var e=i(this),s=r(t),a=o(e);return l(e)<=s.size?n(e,(function(t){s.includes(t)&&u(a,t)})):c(s.getIterator(),(function(t){_(a,t)&&u(a,t)})),a}},a732:function(t,e,s){"use strict";var i=s("23e7"),a=s("c65b"),o=s("2266"),l=s("59ed"),r=s("825a"),n=s("46c4"),c=s("2a62"),_=s("f99f"),u=_("some",TypeError);i({target:"Iterator",proto:!0,real:!0,forced:u},{some:function(t){r(this);try{l(t)}catch(i){c(this,"throw",i)}if(u)return a(u,this,t);var e=n(this),s=0;return o(e,(function(e,i){if(t(e,s++))return i()}),{IS_RECORD:!0,INTERRUPTED:!0}).stopped}})},ab43:function(t,e,s){"use strict";var i=s("23e7"),a=s("c65b"),o=s("59ed"),l=s("825a"),r=s("46c4"),n=s("c5cc"),c=s("9bdd"),_=s("2a62"),u=s("2baa"),d=s("f99f"),p=s("c430"),h=!p&&!u("map",(function(){})),m=!p&&!h&&d("map",TypeError),b=p||h||m,f=n((function(){var t=this.iterator,e=l(a(this.next,t)),s=this.done=!!e.done;if(!s)return c(t,this.mapper,[e.value,this.counter++],!0)}));i({target:"Iterator",proto:!0,real:!0,forced:b},{map:function(t){l(this);try{o(t)}catch(e){_(this,"throw",e)}return m?a(m,this,t):new f(r(this),{mapper:t})}})},ac8f:function(t,e,s){},aed9c:function(t,e,s){"use strict";s("40a9")},af7d:function(t,e,s){"use strict";var i=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("el-dialog",{attrs:{visible:t.visible,title:"自定义列表项","show-close":!1,"close-on-click-modal":!1},on:{"update:visible":function(e){t.visible=e}}},[e("div",{staticClass:"m-bottom10"},[t._v("清除缓存或者更换浏览器，自定义列表失效"),e("span",{staticClass:"warning_message m-left10"},[t._v("(最少选择5项，最多选择25项)")])]),e("div",{staticClass:"item"},[t._l(t.all_item,(function(s){return[e("div",{staticClass:"label"},[t._v(t._s(s.name))]),e("div",{class:[t.newView?"checkbox-box2":"checkbox-box"]},[e("el-checkbox-group",{model:{value:t.select_item,callback:function(e){t.select_item=e},expression:"select_item"}},t._l(s.filed,(function(t){return e("el-checkbox",{key:t.show_name,attrs:{label:t.show_name,disabled:"主机名"===t.show_name}})})),1)],1)]}))],2),e("span",[t._v("已选择："),e("span",{staticClass:"num_message"},[t._v(t._s(t.select_item.length))])]),e("span",{attrs:{slot:"footer"},slot:"footer"},[e("el-button",{attrs:{type:"primary"},on:{click:t.FnConfirm}},[t._v("确 定")]),e("el-button",{on:{click:t.FnClose}},[t._v("取 消")])],1)])},a=[],o=(s("e9f5"),s("ab43"),s("9ab4")),l=s("1b40");let r=class extends l["e"]{constructor(){super(...arguments),this.select_item=[],this.typeObj={host:{func:"SET_CUSTOM_HOST",value:"custom_host"},nas:{func:"SET_NAS_HOST",value:"nas_host"},cluster:{func:"SET_CLUSTER_HOST",value:"pod"},pod_host:{func:"SET_HOST_LIST",value:"pod"},pod_vm:{func:"SET_VM_HOST",value:"pod"}}}created(){"cluster"===this.type?this.FnHandleSelectItem(this.$store.state[this.typeObj[this.type].value].cluster_host):"pod_host"===this.type?this.FnHandleSelectItem(this.$store.state[this.typeObj[this.type].value].host_list):"pod_vm"===this.type?this.FnHandleSelectItem(this.$store.state[this.typeObj[this.type].value].vm_host):this.FnHandleSelectItem(this.$store.state[this.typeObj[this.type].value])}FnHandleSelectItem(t){t.length>0?this.select_item=[...t]:this.select_item=this.all_column_item.slice(0,25).map(t=>t.label),this.FnEmit()}FnConfirm(){this.select_item.length<5||this.select_item.length>25?this.$message.warning("自定义列表项最少为5项，最多为25项"):(this.$store.commit(this.typeObj[this.type].func,this.select_item),this.FnEmit(),this.FnClose())}FnClose(){this.$emit("update:visible",!1)}FnEmit(){return this.select_item}};Object(o["a"])([Object(l["c"])({default:!1})],r.prototype,"visible",void 0),Object(o["a"])([Object(l["c"])({default:"host"})],r.prototype,"type",void 0),Object(o["a"])([Object(l["c"])({default:()=>[]})],r.prototype,"all_column_item",void 0),Object(o["a"])([Object(l["c"])({default:()=>[]})],r.prototype,"all_item",void 0),Object(o["a"])([Object(l["c"])({default:!1})],r.prototype,"newView",void 0),Object(o["a"])([Object(l["b"])("fn-custom")],r.prototype,"FnEmit",null),r=Object(o["a"])([l["a"]],r);var n=r,c=n,_=(s("ea55"),s("2877")),u=Object(_["a"])(c,i,a,!1,null,"b2dbf330",null);e["a"]=u.exports},b1c5:function(t,e,s){"use strict";s("3013")},b3de:function(t,e,s){"use strict";s("7903")},b4bc:function(t,e,s){"use strict";var i=s("dc19"),a=s("cb27").has,o=s("8e16"),l=s("7f65"),r=s("384f"),n=s("5388"),c=s("2a62");t.exports=function(t){var e=i(this),s=l(t);if(o(e)<=s.size)return!1!==r(e,(function(t){if(s.includes(t))return!1}),!0);var _=s.getIterator();return!1!==n(_,(function(t){if(a(e,t))return c(_,"normal",!1)}))}},baed:function(t,e,s){},c1a1:function(t,e,s){"use strict";var i=s("23e7"),a=s("b4bc"),o=s("dad2"),l=!o("isDisjointFrom",(function(t){return!t}));i({target:"Set",proto:!0,real:!0,forced:l},{isDisjointFrom:a})},c839:function(t,e,s){"use strict";var i=s("81a9"),a=s("bff7");e["a"]={get_pod_list(t){return Object(i["a"])(Object(a["b"])("GET","/pod/get_pod_list/",t))},get_az_info(t){return Object(i["a"])(Object(a["b"])("GET","/pod/get_pod_info/",t))},create_pod(t){return Object(i["a"])(Object(a["b"])("POST","/pod/create_pod/",t))},update_pod(t){return Object(i["a"])(Object(a["b"])("POST","/pod/update_pod/",t))},get_pod_history(t){return Object(i["a"])(Object(a["b"])("GET","/pod/get_pod_history/",t))}}},cb27:function(t,e,s){"use strict";var i=s("e330"),a=Set.prototype;t.exports={Set:Set,add:i(a.add),has:i(a.has),remove:i(a["delete"]),proto:a}},d468:function(t,e,s){"use strict";s("0752")},d772:function(t,e,s){"use strict";var i=s("81a9"),a=s("bff7");e["a"]={get_operate_record_list(t){return Object(i["a"])(Object(a["b"])("GET","/ecs/history_record/",t))},get_detail(t){return Object(i["a"])(Object(a["b"])("GET","/ecs/get_ecs_detail/",t))}}},d866:function(t,e,s){"use strict";var i=s("23e7"),a=s("c65b"),o=s("2266"),l=s("59ed"),r=s("825a"),n=s("46c4"),c=s("2a62"),_=s("f99f"),u=_("every",TypeError);i({target:"Iterator",proto:!0,real:!0,forced:u},{every:function(t){r(this);try{l(t)}catch(i){c(this,"throw",i)}if(u)return a(u,this,t);var e=n(this),s=0;return!o(e,(function(e,i){if(!t(e,s++))return i()}),{IS_RECORD:!0,INTERRUPTED:!0}).stopped}})},d9aa:function(t,e,s){},dad2:function(t,e,s){"use strict";var i=s("d066"),a=function(t){return{size:t,has:function(){return!1},keys:function(){return{next:function(){return{done:!0}}}}}},o=function(t){return{size:t,has:function(){return!0},keys:function(){throw new Error("e")}}};t.exports=function(t,e){var s=i("Set");try{(new s)[t](a(0));try{return(new s)[t](a(-1)),!1}catch(r){if(!e)return!0;try{return(new s)[t](o(-1/0)),!1}catch(n){var l=new s;return l.add(1),l.add(2),e(l[t](o(1/0)))}}}catch(n){return!1}}},dc19:function(t,e,s){"use strict";var i=s("cb27").has;t.exports=function(t){return i(t),t}},e4d0:function(t,e,s){"use strict";var i=s("81a9"),a=s("bff7");e["a"]={get_pub_mirror_list(t){return Object(i["a"])(Object(a["b"])("GET","/img/get_pub_image_list/",t))},check_name(t){return Object(i["a"])(Object(a["b"])("POST","/img/name_check/",t))},get_mirror_type(t){return Object(i["a"])(Object(a["b"])("GET","/img/image_type/",t))},get_model_image_type(t){return Object(i["a"])(Object(a["b"])("GET","/img/model_image_type/",t))},add_pub_mirror(t){return Object(i["a"])(Object(a["b"])("GET","/img/create_pub_image/",t))},edit_pub_mirror(t){return Object(i["a"])(Object(a["b"])("POST","/img/edit_image/",t))},change_status(t){return Object(i["a"])(Object(a["b"])("POST","/img/alter_image/",t))},del_pub_mirror_az(t){return Object(i["a"])(Object(a["b"])("POST","/img/delete_pub_image/",t))},del_pub_mirror(t){return Object(i["a"])(Object(a["b"])("POST","/img/batch_delete_pub_image/",t))},get_pub_operate_record(t){return Object(i["a"])(Object(a["b"])("POST","/img/pub_image_operation_list/",t))},get_pub_sync_detail(t){return Object(i["a"])(Object(a["b"])("POST","/img/pub_image_info/",t))},sync_mirror(t){return Object(i["a"])(Object(a["b"])("POST","/img/sync_pub_image/",t))},get_private_mirror_list(t){return Object(i["a"])(Object(a["b"])("GET","/img/get_private_image_list/",t))},get_status_list(t){return Object(i["a"])(Object(a["b"])("GET","/img/get_image_status_list/",t))},get_available_az(t){return Object(i["a"])(Object(a["b"])("POST","/img/get_available_az/",t))},get_disk_list(t){return Object(i["a"])(Object(a["b"])("GET","/img/backend_type/",t))},get_product_source(){return Object(i["a"])(Object(a["b"])("GET","/ecs/get_product_source/"))}}},e527:function(t,e,s){"use strict";var i=s("81a9"),a=s("bff7"),o=s("4328"),l=s.n(o);e["a"]={get_instance_list(t){return Object(i["a"])(Object(a["b"])("POST","/ecs/ecs_list/",t))},operate_instance(t){return Object(i["a"])(Object(a["b"])("POST","/ecs/operate/",t))},delete_instance(t){return Object(i["a"])(Object(a["b"])("POST","/ecs/delete/",t))},recover_instance(t){return Object(i["a"])(Object(a["b"])("POST","/ecs/recover/",t))},destroy_instance(t){return Object(i["a"])(Object(a["b"])("POST","/ecs/destroy/",t))},get_status_list(){return Object(i["a"])(Object(a["b"])("GET","/ecs/ecs_status_list/"))},get_family_data(){return Object(i["a"])(Object(a["b"])("GET","/ecs/get_family_data/"))},reset_password(t){return Object(i["a"])(Object(a["b"])("POST","/ecs/ecs_reset_password/",t))},update_spec(t){return Object(i["a"])(Object(a["b"])("POST","/ecs/ecs_change_configure/",t))},update_system(t){return Object(i["a"])(Object(a["b"])("POST","/ecs/ecs_change_system/",t))},get_usage_ip(t){return Object(i["a"])(Object(a["b"])("GET","/ecs/get_deleted_ecs_ip/",t))},get_vnc_url(t){return Object(i["a"])(Object(a["b"])("GET","/ecs/vnc_info/",t))},start_charge(t){return Object(i["a"])(Object(a["b"])("POST","/resource/start_charge/",t))},change_config_price(t){return Object(i["a"])(Object(a["b"])("POST","/ecs/change_config_price/",t))},change_system_price(t){return Object(i["a"])(Object(a["b"])("POST","/ecs/change_system_price/",t))},each_resource_price(t){return Object(i["a"])(Object(a["b"])("POST","/ecs/each_resource_price/",t))},add_common_mirror(t){return Object(i["a"])(Object(a["b"])("POST","/img/create_pub_image_by_ecs/",t))},set_net(t){return Object(i["a"])(Object(a["b"])("POST","/ecs/ecs_set_base_nic/",t))},get_default_dns(t){return Object(i["a"])(Object(a["b"])("POST","/ecs/az_default_dns/",t))},mount_gpu_card(t){return Object(i["a"])(Object(a["b"])("POST","/ecs/instance_gpu_card/",t))},update_gpu_status(t){return Object(i["a"])(Object(a["b"])("POST","/ecs/update_gpu_status/",t))},export_list(t){return Object(i["a"])({method:"GET",url:"/ecs_business/v1/ecs/ecs_list_download/",params:t,paramsSerializer:t=>l.a.stringify(t),responseType:"blob"})},get_tag_list(){return Object(i["a"])(Object(a["b"])("GET","/ecs/get_tag_list/"))},get_rescue_image_list(t){return Object(i["a"])(Object(a["b"])("GET","/ecs/get_rescue_image_list/",t))},enter_rescue(t){return Object(i["a"])(Object(a["b"])("POST","/ecs/enter_rescue/",t))},exit_rescue(t){return Object(i["a"])(Object(a["b"])("POST","/ecs/exit_rescue/",t))}}},e831:function(t,e,s){"use strict";s("f6e6")},e867:function(t,e,s){},e948:function(t,e,s){"use strict";s("2002")},e9bc:function(t,e,s){"use strict";var i=s("dc19"),a=s("cb27").add,o=s("83b9e"),l=s("7f65"),r=s("5388");t.exports=function(t){var e=i(this),s=l(t).getIterator(),n=o(e);return r(s,(function(t){a(n,t)})),n}},ea55:function(t,e,s){"use strict";s("e867")},eb0f:function(t,e,s){},edb6:function(t,e,s){"use strict";s("eeb5")},eeb5:function(t,e,s){},f665:function(t,e,s){"use strict";var i=s("23e7"),a=s("c65b"),o=s("2266"),l=s("59ed"),r=s("825a"),n=s("46c4"),c=s("2a62"),_=s("f99f"),u=_("find",TypeError);i({target:"Iterator",proto:!0,real:!0,forced:u},{find:function(t){r(this);try{l(t)}catch(i){c(this,"throw",i)}if(u)return a(u,this,t);var e=n(this),s=0;return o(e,(function(e,i){if(t(e,s++))return i(e)}),{IS_RECORD:!0,INTERRUPTED:!0}).result}})},f6e6:function(t,e,s){},f813:function(t,e,s){"use strict";s("9409")}}]);
//# sourceMappingURL=chunk-0cb47727.1763535500878.js.map