(window["webpackJsonp_AppSp"]=window["webpackJsonp_AppSp"]||[]).push([["chunk-40476456"],{"03f5":function(t,e,r){"use strict";r("1821")},"0dd0":function(t,e,r){},1821:function(t,e,r){},"1e5a":function(t,e,r){"use strict";var a=r("23e7"),i=r("9961"),n=r("dad2");a({target:"Set",proto:!0,real:!0,forced:!n("symmetricDifference")},{symmetricDifference:i})},"1e70":function(t,e,r){"use strict";var a=r("23e7"),i=r("a5f7"),n=r("dad2"),s=!n("difference",(function(t){return 0===t.size}));a({target:"Set",proto:!0,real:!0,forced:s},{difference:i})},"1ee0":function(t,e,r){"use strict";r("0dd0")},"278d":function(t,e,r){},2966:function(t,e,r){"use strict";var a=r("81a9"),i=r("bff7");e["a"]={get_alarm_list(t){return Object(a["a"])(Object(i["a"])("GET","/record/list",t))},get_strategy_list(t){return Object(a["a"])(Object(i["a"])("GET","/strategy/list",t))},get_strategy_detail(t){return Object(a["a"])(Object(i["a"])("GET","/strategy",t))},get_index_list(t){return Object(a["a"])(Object(i["a"])("GET","/metrics/info",t))},add_strategy(t){return Object(a["a"])(Object(i["a"])("POST","/strategy",t))},update_strategy(t){return Object(a["a"])(Object(i["a"])("PUT","/strategy",t))},apply_strategy(t){return Object(a["a"])(Object(i["a"])("PUT","/strategy/apply",t))},delete_strategy(t){return Object(a["a"])({method:"DELETE",url:"/alarm/api/v1/strategy",data:t})},get_contact_list(t){return Object(a["a"])(Object(i["a"])("GET","/contact/list",t))},add_contact(t){return Object(a["a"])(Object(i["a"])("POST","/contact",t))},get_contact_detail(t){return Object(a["a"])(Object(i["a"])("GET","/contact",t))},update_contact(t){return Object(a["a"])(Object(i["a"])("PUT","/contact",t))},delete_contact(t){return Object(a["a"])({method:"DELETE",url:"/alarm/api/v1/contact",data:t})},add_contact_to_group(t){return Object(a["a"])(Object(i["a"])("PUT","/contact_group/relation",t))},get_contact_group_list(t){return Object(a["a"])(Object(i["a"])("GET","/contact_group/list",t))},get_contact_group_detail(t){return Object(a["a"])(Object(i["a"])("GET","/contact_group",t))},add_contact_group(t){return Object(a["a"])(Object(i["a"])("POST","/contact_group",t))},update_contact_group(t){return Object(a["a"])(Object(i["a"])("PUT","/contact_group",t))},delete_contact_group(t){return Object(a["a"])({method:"DELETE",url:"/alarm/api/v1/contact_group",data:t})},get_event_list(t){return Object(a["a"])(Object(i["a"])("GET","/strategy/event/list",t))},get_product_list(t){return Object(a["a"])(Object(i["a"])("GET","/strategy/product/list",t))},get_shield_list(t){return Object(a["a"])(Object(i["a"])("GET","/shield/list",t))},get_create_info(t){return Object(a["a"])(Object(i["a"])("GET","/shield/info",t))},get_strategy_info(t){return Object(a["a"])(Object(i["a"])("GET","/shield/condition/strategy",t))},get_rule_info(t){return Object(a["a"])(Object(i["a"])("GET","/shield/condition/rule",t))},create_shield(t){return Object(a["a"])(Object(i["a"])("POST","/shield",t))},edit_shield(t){return Object(a["a"])(Object(i["a"])("PUT","/shield",t))},shield_detail(t){return Object(a["a"])(Object(i["a"])("GET","/shield",t))},shield_apply(t){return Object(a["a"])(Object(i["a"])("PUT","/shield/apply",t))},shield_del(t){return Object(a["a"])(Object(i["a"])("POST","/shield/delete",t))}}},"384f":function(t,e,r){"use strict";var a=r("e330"),i=r("5388"),n=r("cb27"),s=n.Set,l=n.proto,c=a(l.forEach),o=a(l.keys),u=o(new s).next;t.exports=function(t,e,r){return r?i({iterator:o(t),next:u},e):c(t,e)}},"395e":function(t,e,r){"use strict";var a=r("dc19"),i=r("cb27").has,n=r("8e16"),s=r("7f65"),l=r("5388"),c=r("2a62");t.exports=function(t){var e=a(this),r=s(t);if(n(e)<r.size)return!1;var o=r.getIterator();return!1!==l(o,(function(t){if(!i(e,t))return c(o,"normal",!1)}))}},4780:function(t,e,r){"use strict";r.d(e,"g",(function(){return a})),r.d(e,"d",(function(){return i})),r.d(e,"b",(function(){return n})),r.d(e,"a",(function(){return s})),r.d(e,"f",(function(){return l})),r.d(e,"e",(function(){return c})),r.d(e,"c",(function(){return o}));Math.floor(1e6*(9*Math.random()+1)),Math.floor(1e6*(9*Math.random()+1)),Math.floor(1e6*(9*Math.random()+1)),Math.floor(1e6*(9*Math.random()+1)),Math.floor(1e6*(9*Math.random()+1)),Math.floor(1e6*(9*Math.random()+1)),Math.floor(1e6*(9*Math.random()+1)),Math.floor(1e6*(9*Math.random()+1)),Math.floor(1e6*(9*Math.random()+1));const a=[{id:">=",title:">="},{id:"<=",title:"<="},{id:">",title:">"},{id:"<",title:"<"}],i=[{id:"1",title:"1分钟一个周期"},{id:"15",title:"15分钟一个周期"},{id:"30",title:"30分钟一个周期"},{id:"60",title:"60分钟一个周期"}],n=[{id:"1",title:"持续1个周期"},{id:"3",title:"持续3个周期"},{id:"5",title:"持续5个周期"},{id:"10",title:"持续10个周期"},{id:"15",title:"持续15个周期"},{id:"30",title:"持续30个周期"}],s=[{id:"2",title:"严重"},{id:"1",title:"告警"},{id:"0",title:"普通"}],l=[{id:"email",name:"邮箱"},{id:"phone",name:"短信"}],c=[{id:"abnormal_event",title:"异常事件"}],o=[{id:"900",title:"15分钟"},{id:"1800",title:"30分钟"},{id:"3600",title:"60分钟"},{id:"10800",title:"3小时"},{id:"21600",title:"6小时"},{id:"43200",title:"12小时"},{id:"86400",title:"24小时"}]},5388:function(t,e,r){"use strict";var a=r("c65b");t.exports=function(t,e,r){var i,n,s=r?t:t.iterator,l=t.next;while(!(i=a(l,s)).done)if(n=e(i.value),void 0!==n)return n}},"68df":function(t,e,r){"use strict";var a=r("dc19"),i=r("8e16"),n=r("384f"),s=r("7f65");t.exports=function(t){var e=a(this),r=s(t);return!(i(e)>r.size)&&!1!==n(e,(function(t){if(!r.includes(t))return!1}),!0)}},7282:function(t,e,r){"use strict";var a=r("e330"),i=r("59ed");t.exports=function(t,e,r){try{return a(i(Object.getOwnPropertyDescriptor(t,e)[r]))}catch(n){}}},"72c3":function(t,e,r){"use strict";var a=r("23e7"),i=r("e9bc"),n=r("dad2");a({target:"Set",proto:!0,real:!0,forced:!n("union")},{union:i})},"79a4":function(t,e,r){"use strict";var a=r("23e7"),i=r("d039"),n=r("953b"),s=r("dad2"),l=!s("intersection",(function(t){return 2===t.size&&t.has(1)&&t.has(2)}))||i((function(){return"3,2"!==String(Array.from(new Set([1,2,3]).intersection(new Set([3,2]))))}));a({target:"Set",proto:!0,real:!0,forced:l},{intersection:n})},"7f65":function(t,e,r){"use strict";var a=r("59ed"),i=r("825a"),n=r("c65b"),s=r("5926"),l=r("46c4"),c="Invalid size",o=RangeError,u=TypeError,d=Math.max,_=function(t,e){this.set=t,this.size=d(e,0),this.has=a(t.has),this.keys=a(t.keys)};_.prototype={getIterator:function(){return l(i(n(this.keys,this.set)))},includes:function(t){return n(this.has,this.set,t)}},t.exports=function(t){i(t);var e=+t.size;if(e!==e)throw new u(c);var r=s(e);if(r<0)throw new o(c);return new _(t,r)}},"83b9e":function(t,e,r){"use strict";var a=r("cb27"),i=r("384f"),n=a.Set,s=a.add;t.exports=function(t){var e=new n;return i(t,(function(t){s(e,t)})),e}},"8b00":function(t,e,r){"use strict";var a=r("23e7"),i=r("68df"),n=r("dad2"),s=!n("isSubsetOf",(function(t){return t}));a({target:"Set",proto:!0,real:!0,forced:s},{isSubsetOf:i})},"8ce4":function(t,e,r){"use strict";r.d(e,"e",(function(){return a})),r.d(e,"b",(function(){return i})),r.d(e,"a",(function(){return n})),r.d(e,"c",(function(){return s})),r.d(e,"d",(function(){return l}));r("14d9"),r("e9f5"),r("ab43");function a(t,e,r,a,i){let n=[];return t.map(t=>{n.push({[a]:t[e],[i]:t[r]})}),n}function i(t,e,r,a={}){let i=[];return t.map(t=>{let n={};e.map((e,a)=>{n[e]=t[r[a]]}),i.push({...n,...a})}),i}function n(t,e=!1){let r={};for(let a in t){const{billing_scheme_id:i,billing_cycle_id:n,billing_items:s,gic_goods_id:l}=t[a];let c={};for(let t in s){let r={attr_id:s[t].attr_id,name:s[t].name},a={id:s[t].id,key:t};c[t]=e?{...r,...a}:a}r[a]={billing_scheme_id:i,billing_cycle_id:n,billing_items:c,gic_goods_id:e?l:void 0}}return r}function s(t,e){return t.map(t=>t[e])}function l(t){let e="";for(let r in t)t[r]&&(e+=`${r}=${t[r]}&`);return""===e?"":"?"+e.slice(0,e.length-1)}},"8e16":function(t,e,r){"use strict";var a=r("7282"),i=r("cb27");t.exports=a(i.proto,"size","get")||function(t){return t.size}},"953b":function(t,e,r){"use strict";var a=r("dc19"),i=r("cb27"),n=r("8e16"),s=r("7f65"),l=r("384f"),c=r("5388"),o=i.Set,u=i.add,d=i.has;t.exports=function(t){var e=a(this),r=s(t),i=new o;return n(e)>r.size?c(r.getIterator(),(function(t){d(e,t)&&u(i,t)})):l(e,(function(t){r.includes(t)&&u(i,t)})),i}},9961:function(t,e,r){"use strict";var a=r("dc19"),i=r("cb27"),n=r("83b9e"),s=r("7f65"),l=r("5388"),c=i.add,o=i.has,u=i.remove;t.exports=function(t){var e=a(this),r=s(t).getIterator(),i=n(e);return l(r,(function(t){o(e,t)?u(i,t):c(i,t)})),i}},a4e7:function(t,e,r){"use strict";var a=r("23e7"),i=r("395e"),n=r("dad2"),s=!n("isSupersetOf",(function(t){return!t}));a({target:"Set",proto:!0,real:!0,forced:s},{isSupersetOf:i})},a58a:function(t,e,r){"use strict";r("e410")},a5f7:function(t,e,r){"use strict";var a=r("dc19"),i=r("cb27"),n=r("83b9e"),s=r("8e16"),l=r("7f65"),c=r("384f"),o=r("5388"),u=i.has,d=i.remove;t.exports=function(t){var e=a(this),r=l(t),i=n(e);return s(e)<=r.size?c(e,(function(t){r.includes(t)&&d(i,t)})):o(r.getIterator(),(function(t){u(e,t)&&d(i,t)})),i}},a732:function(t,e,r){"use strict";var a=r("23e7"),i=r("c65b"),n=r("2266"),s=r("59ed"),l=r("825a"),c=r("46c4"),o=r("2a62"),u=r("f99f"),d=u("some",TypeError);a({target:"Iterator",proto:!0,real:!0,forced:d},{some:function(t){l(this);try{s(t)}catch(a){o(this,"throw",a)}if(d)return i(d,this,t);var e=c(this),r=0;return n(e,(function(e,a){if(t(e,r++))return a()}),{IS_RECORD:!0,INTERRUPTED:!0}).stopped}})},ab43:function(t,e,r){"use strict";var a=r("23e7"),i=r("c65b"),n=r("59ed"),s=r("825a"),l=r("46c4"),c=r("c5cc"),o=r("9bdd"),u=r("2a62"),d=r("f99f"),_=r("c430"),m=!_&&d("map",TypeError),p=c((function(){var t=this.iterator,e=s(i(this.next,t)),r=this.done=!!e.done;if(!r)return o(t,this.mapper,[e.value,this.counter++],!0)}));a({target:"Iterator",proto:!0,real:!0,forced:_||m},{map:function(t){s(this);try{n(t)}catch(e){u(this,"throw",e)}return m?i(m,this,t):new p(l(this),{mapper:t})}})},b4bc:function(t,e,r){"use strict";var a=r("dc19"),i=r("cb27").has,n=r("8e16"),s=r("7f65"),l=r("384f"),c=r("5388"),o=r("2a62");t.exports=function(t){var e=a(this),r=s(t);if(n(e)<=r.size)return!1!==l(e,(function(t){if(r.includes(t))return!1}),!0);var u=r.getIterator();return!1!==c(u,(function(t){if(i(e,t))return o(u,"normal",!1)}))}},bfa1:function(t,e,r){"use strict";r("278d")},c1a1:function(t,e,r){"use strict";var a=r("23e7"),i=r("b4bc"),n=r("dad2"),s=!n("isDisjointFrom",(function(t){return!t}));a({target:"Set",proto:!0,real:!0,forced:s},{isDisjointFrom:i})},cb27:function(t,e,r){"use strict";var a=r("e330"),i=Set.prototype;t.exports={Set:Set,add:a(i.add),has:a(i.has),remove:a(i["delete"]),proto:i}},dad2:function(t,e,r){"use strict";var a=r("d066"),i=function(t){return{size:t,has:function(){return!1},keys:function(){return{next:function(){return{done:!0}}}}}},n=function(t){return{size:t,has:function(){return!0},keys:function(){throw new Error("e")}}};t.exports=function(t,e){var r=a("Set");try{(new r)[t](i(0));try{return(new r)[t](i(-1)),!1}catch(l){if(!e)return!0;try{return(new r)[t](n(-1/0)),!1}catch(c){var s=new r;return s.add(1),s.add(2),e(s[t](n(1/0)))}}}catch(c){return!1}}},dc19:function(t,e,r){"use strict";var a=r("cb27").has;t.exports=function(t){return a(t),t}},e410:function(t,e,r){},e633:function(t,e,r){"use strict";r.r(e);var a=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",{staticClass:"create-stategy"},[e("el-card",{staticClass:"main_box"},[e("back-header",{attrs:{title:(""===t.edit_id?"创建":"编辑")+"报警策略",back_url:"/alarmStrategy",no_back:"true"}}),e("el-divider"),e("el-form",{ref:"form",staticClass:"demo-dynamic",attrs:{model:t.form_data,"label-width":"100px","label-position":"left",rules:t.rules}},[e("el-form-item",{attrs:{prop:"name",label:"策略名称"}},[e("el-input",{attrs:{minlength:"2",maxlength:"60",placeholder:"2-60个字符","show-word-limit":""},model:{value:t.form_data.name,callback:function(e){t.$set(t.form_data,"name",e)},expression:"form_data.name"}}),e("div",{staticClass:"prompt_message"},[t._v("可包含大小写字母,中文,数字,点号,下划线,半角冒号,连字符,英文括号")])],1),""===t.edit_id?e("el-form-item",{attrs:{prop:"stategy",label:"选择已有策略"}},[e("el-select",{attrs:{placeholder:"请选择已有策略",filterable:"","filter-method":t.getStrategyList},on:{"visible-change":t.change_strategy},model:{value:t.form_data.stategy,callback:function(e){t.$set(t.form_data,"stategy",e)},expression:"form_data.stategy"}},t._l(t.strategy_list,(function(r){return e("el-option",{key:r.id,attrs:{label:r.name,value:r.id,disabled:""!==t.edit_id}})})),1)],1):t._e()],1),e("RuleConfig",{ref:"rule_config",attrs:{strategy_data:t.strategy_data}})],1),e("div",{staticClass:"button_box"},[e("el-button",{attrs:{type:"primary"},on:{click:t.create}},[t._v(t._s(""===t.edit_id?"创建":"确定"))]),e("el-button",{staticClass:"confirm",staticStyle:{"margin-left":"5px"},on:{click:function(e){return t.$router.go(-1)}}},[t._v("返回")])],1)],1)},i=[],n=(r("14d9"),r("e9f5"),r("7d54"),r("ab43"),r("9ab4")),s=r("1b40"),l=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",[t._l(t.selected_products,(function(r){return e("div",{key:r.id,staticClass:"product_box"},[e("div",{staticClass:"title"},[e("span",[t._v(t._s(r.name))]),t.selected_products.length>1?e("el-button",{attrs:{type:"text"},on:{click:function(e){return t.del_product(r.id)}}},[t._v("删除")]):t._e()],1),e("el-table",{staticClass:"event-table",attrs:{data:r.rule_list}},[e("el-table-column",{attrs:{prop:"name",label:"规则名称"}}),e("el-table-column",{attrs:{prop:"desc",label:"规则描述"},scopedSlots:t._u([{key:"default",fn:function(r){return["1"===t.tab_key?e("span",[t._v(t._s(r.row.desc.join(",")))]):e("div",t._l(r.row.desc,(function(r){return e("div",{key:r},[t._v(t._s(r))])})),0)]}}],null,!0)}),e("el-table-column",{attrs:{label:"操作"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("el-button",{staticStyle:{margin:"0 10px 0 0"},attrs:{type:"text"},on:{click:function(e){return t.edit_rules(r.id,a.row.id,a.row.tab_key)}}},[t._v("编辑")]),1!==t.selected_products.length||1!==t.selected_products[0].rule_list.length?e("el-button",{attrs:{type:"text"},on:{click:function(e){return t.del_rule(r.id,a.row.id)}}},[t._v("删除")]):t._e()]}}],null,!0)})],1),e("div",{staticClass:"rule-box"},[e("el-button",{attrs:{type:"text"},on:{click:function(e){return t.show_rule_box(r.id,"add")}}},[e("i",{staticClass:"el-icon-circle-plus"}),t._v(" 添加规则")]),r.visible?e("div",{staticClass:"add-rule"},[e("el-tabs",{attrs:{type:"card"},on:{"tab-click":t.changeTab},model:{value:t.tab_key,callback:function(e){t.tab_key=e},expression:"tab_key"}},[e("el-tab-pane",{attrs:{label:"阈值报警",title:"0",disabled:"1"===t.edit_key}},[e("div",{staticClass:"rule-warn"},[e("el-form",{key:"rules_form",ref:"rules_form",refInFor:!0,staticClass:"demo-dynamic",attrs:{model:t.rule_data,"label-width":"150px"}},[e("el-form-item",{attrs:{prop:"name",label:"规则名称",rules:[{required:!0,message:"请输入规则名称",trigger:"blur"},{pattern:/^[\u4e00-\u9fa5_a-zA-Z0-9-_:()\u002E]{2,60}$/,message:"名称长度应为2-60个字符",trigger:"blur"}]}},[e("el-input",{attrs:{placeholder:"请输入规则名称,2-60个字符",minlength:"2",maxlength:"60","show-word-limit":""},model:{value:t.rule_data.name,callback:function(e){t.$set(t.rule_data,"name",e)},expression:"rule_data.name"}}),e("div",{staticClass:"prompt_message"},[t._v("可包含大小写字母,中文,数字,点号,下划线,半角冒号,连字符,英文括号")])],1),e("el-form-item",{attrs:{prop:"metricID",label:"指标名称",rules:[{required:!0,message:"请选择指标名称",trigger:"blur"}]}},[e("el-cascader",{attrs:{options:r.index_list,"show-all-levels":!1,props:{expandTrigger:"hover"}},on:{change:function(e){return t.watch_metricID(e,r.index_list)}},scopedSlots:t._u([{key:"default",fn:function({node:r,data:a}){return[e("span",[t._v(t._s(a.label))])]}}],null,!0),model:{value:t.rule_data.metricID,callback:function(e){t.$set(t.rule_data,"metricID",e)},expression:"rule_data.metricID"}})],1),e("el-form-item",{attrs:{prop:"level",label:"阈值及报警级别",rules:[{required:!0,message:"请选择阈值及报警级别"}]}},t._l(t.rule_data.level,(function(r,a){return e("div",{key:r.id,staticClass:"rule-level"},[e("el-select",{attrs:{size:"small"},model:{value:r.range,callback:function(e){t.$set(r,"range",e)},expression:"inn.range"}},t._l(t.static_list.range_list,(function(t){return e("el-option",{key:t.id,attrs:{label:t.title,value:t.id}})})),1),e("el-input",{attrs:{size:"small",oninput:"value= value.match(/\\d+(\\.\\d{0,9})?/) ? value.match(/\\d+(\\.\\d{0,9})?/)[0] : ''"},model:{value:r.num,callback:function(e){t.$set(r,"num",e)},expression:"inn.num"}},[e("span",{attrs:{slot:"suffix"},slot:"suffix"},[t._v(t._s(r.metricUnit))])]),""===r.num?e("span",{staticClass:"error_message remark"},[t._v(t._s("请输入指标项值"))]):t._e(),e("el-select",{attrs:{size:"small"},model:{value:r.cycle_time,callback:function(e){t.$set(r,"cycle_time",e)},expression:"inn.cycle_time"}},t._l(t.static_list.cycle_time,(function(t){return e("el-option",{key:t.id,attrs:{label:t.title,value:t.id}})})),1),e("el-select",{attrs:{size:"small"},model:{value:r.cycle_num,callback:function(e){t.$set(r,"cycle_num",e)},expression:"inn.cycle_num"}},t._l(t.static_list.cycle_num,(function(t){return e("el-option",{key:t.id,attrs:{label:t.title,value:t.id}})})),1),e("el-select",{attrs:{size:"small"},model:{value:r.alram_type,callback:function(e){t.$set(r,"alram_type",e)},expression:"inn.alram_type"}},t._l(t.static_list.alarm_type,(function(t){return e("el-option",{key:t.id,attrs:{label:t.title,value:t.id}})})),1),e("div",{staticClass:"notice"},[e("div",{staticClass:"check"},[e("span",[t._v("通知：")]),e("el-checkbox-group",{model:{value:r.notice,callback:function(e){t.$set(r,"notice",e)},expression:"inn.notice"}},t._l(t.static_list.notice_list,(function(r){return e("el-checkbox",{key:r.id,attrs:{label:r.id}},[t._v(t._s(r.name))])})),1)],1),a===t.rule_data.level.length-1?e("div",{staticClass:"level-btn"},[e("i",{staticClass:"el-icon-circle-plus",attrs:{type:"primary"},on:{click:t.add_level}}),t.rule_data.level.length>1?e("i",{staticClass:"el-icon-remove",on:{click:t.del_level}}):t._e()]):t._e()])],1)})),0)],1)],1)]),e("el-tab-pane",{attrs:{label:"事件报警",title:"1",disabled:"0"===t.edit_key}},[e("div",{staticClass:"rule-warn"},[e("el-form",{key:"event_form",ref:"event_form",refInFor:!0,staticClass:"demo-dynamic",attrs:{model:t.rule_data,"label-width":"150px"}},[e("el-form-item",{attrs:{prop:"name",label:"规则名称",rules:[{required:!0,message:"请输入规则名称",trigger:"blur"},{pattern:/^[\u4e00-\u9fa5_a-zA-Z0-9-_:()\u002E]{2,60}$/,message:"名称长度应为2-60个字符",trigger:"blur"}]}},[e("el-input",{attrs:{placeholder:"请输入规则名称,2-60个字符",minlength:"2",maxlength:"60","show-word-limit":""},model:{value:t.rule_data.name,callback:function(e){t.$set(t.rule_data,"name",e)},expression:"rule_data.name"}}),e("div",{staticClass:"prompt_message"},[t._v("可包含大小写字母,中文,数字,点号,下划线,半角冒号,连字符,英文括号")])],1),e("el-form-item",{attrs:{prop:"event_type",label:"事件类型",rules:[{required:!0,message:"请选择事件类型",trigger:"blur"}]}},[e("el-select",{attrs:{placeholder:"请选择事件类型"},on:{change:function(e){return t.watch_event_type(e,r.event_type,r.id)}},model:{value:t.rule_data.event_type,callback:function(e){t.$set(t.rule_data,"event_type",e)},expression:"rule_data.event_type"}},t._l(r.event_type,(function(t){return e("el-option",{key:t.event_type,attrs:{label:t.type_name,value:t.event_type}})})),1)],1),e("el-form-item",{attrs:{prop:"event_name",label:"事件名称",rules:[{required:!0,message:"请选择事件名称",trigger:"blur"}]}},[e("el-select",{attrs:{placeholder:"请选择事件名称"},model:{value:t.rule_data.event_name,callback:function(e){t.$set(t.rule_data,"event_name",e)},expression:"rule_data.event_name"}},t._l(r.event_name,(function(t){return e("el-option",{key:t.id,attrs:{label:t.title,value:t.id}})})),1)],1),e("el-form-item",{attrs:{prop:"alram_type",label:"事件等级及报警",rules:[{required:!0,message:"请选择事件等级及报警",trigger:"blur"}]}},[e("el-select",{attrs:{placeholder:"请选择事件等级及报警"},model:{value:t.rule_data.alram_type,callback:function(e){t.$set(t.rule_data,"alram_type",e)},expression:"rule_data.alram_type"}},t._l(t.static_list.alarm_type,(function(t){return e("el-option",{key:t.id,attrs:{label:t.title,value:t.id}})})),1)],1),e("el-form-item",{attrs:{prop:"notice",label:"",rules:[{required:!0,message:"请选择通知方式",trigger:"blur"}]}},[e("div",{staticClass:"check"},[e("span",[t._v("通知：")]),e("el-checkbox-group",{model:{value:t.rule_data.notice,callback:function(e){t.$set(t.rule_data,"notice",e)},expression:"rule_data.notice"}},t._l(t.static_list.notice_list,(function(r){return e("el-checkbox",{key:r.id,attrs:{label:r.id}},[t._v(t._s(r.name))])})),1)],1)])],1)],1)])],1),e("div",{staticClass:"btn"},[e("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.add_rule()}}},[t._v("确定")]),e("el-button",{attrs:{type:"cancel"},on:{click:t.cancel}},[t._v("取消")])],1)],1):t._e()],1)],1)})),e("el-dropdown",{staticClass:"m-top10",on:{command:t.handle}},[e("el-button",{attrs:{type:"primary"}},[t._v(" 添加产品"),e("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),e("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},t._l(t.product_list,(function(r){return e("el-dropdown-item",{key:r.id,attrs:{command:r.id}},[t._v(t._s(r.name))])})),1)],1)],2)},c=[],o=(r("910d"),r("a732"),r("1e70"),r("79a4"),r("c1a1"),r("8b00"),r("a4e7"),r("1e5a"),r("72c3"),r("4780")),u=r("2966"),d=r("8ce4");let _=class extends s["e"]{constructor(){super(...arguments),this.tab_key="0",this.edit_key="",this.selected_product_id="",this.edit_rule_id="",this.index_list=[],this.rule_data={name:"",metricID:[],event_type:"",event_name:"",alram_type:"",notice:[],level:[{range:">=",num:"",cycle_time:"1",cycle_num:"1",alram_type:"2",notice:["email"],metricUnit:""}]},this.static_list={range_list:o["g"],notice_list:o["f"],alarm_type:o["a"],cycle_num:o["b"],cycle_time:o["d"],event_type:o["e"],event_name:[]},this.product_list=[],this.selected_products=[]}created(){this.getProductList()}valid(t){this.$nextTick(()=>{const e=this.$refs[t];e&&e[0].validate(async t=>{})})}get event(){const{event_type:t,event_name:e,alram_type:r,notice:a}=this.rule_data;return{event_type:t,event_name:e,alram_type:r,notice:a}}watch_event(t){this.valid("event_form")}async getProductList(){let t=await u["a"].get_product_list({});"Success"===t.code&&t.data.forEach(t=>{this.product_list.push({...t,visible:!1,rule_list:[]})})}watch_metricID(t,e){this.valid("rules_form");let r="";e.forEach(e=>{e.children.forEach(e=>{e.value===t[1]&&(r=e.unit)})}),this.rule_data.level.map(t=>t.metricUnit=r)}watch_event_type(t,e,r){let a=["event_name_zh","event_id"],i=["title","id"],n=e.filter(e=>e.event_type===t);this.selected_products.map(t=>{if(t.id===r){t.event_name=n.length>0?Object(d["b"])(n[0].list,i,a):[];const e=t.event_name.map(t=>t.id);new Set([...e,this.rule_data.event_name]).size>e.length&&(this.rule_data.event_name="")}})}setEventList(t){let e=["event_name_zh","event_id"],r=["title","id"],a=t,i=[];return t.map(t=>{i=[...i,...t.list]}),i=Object(d["b"])(i,r,e),[a,i]}get_index_list_by_value(t,e){let r=[];return e.forEach(e=>{e.children.forEach(a=>{a.value===t&&(r=[e.value,t])})}),r}setIndexList(t){let e=[];return t&&t.forEach(t=>{let r=[];t.metric_infos.forEach(t=>{r.push({value:t.metric,label:t.description,unit:t.unit,description:t.description})}),e.push({value:t.name,label:t.name,children:r})}),e}setRules(t,e,r,a){const i={id:t.id,tab_key:"event"===t.ruleRecords[0].alarmType?"1":"0",name:t.name,metricID:"event"===t.ruleRecords[0].alarmType?[]:this.get_index_list_by_value(t.ruleRecords[0].metricID,r),event_type:t.ruleRecords[0].eventType,event_name:t.ruleRecords[0].eventId&&t.ruleRecords[0].eventId.length>0?t.ruleRecords[0].eventId[0]:"",metricUnit:"event"===t.ruleRecords[0].alarmType?"":t.ruleRecords[0].metricUnit,alram_type:"event"===t.ruleRecords[0].alarmType?t.ruleRecords[0].level.toString():"",notice:"event"===t.ruleRecords[0].alarmType?t.ruleRecords[0].alarmMethod:[],level:e,desc:"event"===t.ruleRecords[0].alarmType?[`${this.trans_arr(t.ruleRecords[0].level.toString(),this.static_list.alarm_type)} | ${this.trans_arr(t.ruleRecords[0].eventId,a[1])}`]:e.map(e=>`${this.getDescription(t.ruleRecords[0].metricID,r)} ${e.range} ${e.num}${e.metricUnit} ${this.trans_arr(e.alram_type,this.static_list.alarm_type)} 持续${e.cycle_num}次就报警`)},n=this.selected_products.filter(e=>e.id===t.productType);n.length>0?this.selected_products.map(e=>(e.id===t.productType&&(e.rule_list=[...e.rule_list,i],e.index_list=r,e.event_type=a[0],e.event_name=a[1]),e)):this.selected_products.push({id:t.productType,name:t.productName,visible:!1,rule_list:[i],index_list:r,event_type:a[0],event_name:a[1]})}watch_strategy_data(t,e){0!==Object.keys(t).length&&(this.selected_products=[],t.rules.forEach(async t=>{const e=[];t.ruleRecords.forEach(t=>{e.push({range:t.metricCondition,num:t.metricValue,cycle_time:t.metricPeriod.toString(),cycle_num:t.metricPeriodNum.toString(),alram_type:"event"===t.alarmType?"":t.level.toString(),notice:"event"===t.alarmType?[]:t.alarmMethod,metricUnit:t.metricUnit})}),Promise.all([u["a"].get_index_list({type:t.productType}),u["a"].get_event_list({type:t.productType})]).then(r=>{this.setRules(t,e,this.setIndexList(r[0].data),this.setEventList(r[1].data))})}))}getDescription(t,e){let r="";return e.forEach(e=>{e.children.forEach(e=>{e.value===t&&(r=e.description)})}),r}handle(t){this.add_product(t)}add_product(t){this.selected_products.filter(e=>e.id===t).length>0||Promise.all([u["a"].get_index_list({type:t}),u["a"].get_event_list({type:t})]).then(e=>{const r=this.product_list.filter(e=>e.id===t);r[0].rule_list=[],r[0].index_list=this.setIndexList(e[0].data),r[0].event_type=this.setEventList(e[1].data)[0],r[0].event_name=this.setEventList(e[1].data)[1],this.selected_products=[...this.selected_products,...r]})}del_product(t){this.selected_products=this.selected_products.filter(e=>e.id!==t),0===this.selected_products.length&&(this.selected_product_id="")}show_rule_box(t="",e="add"){this.selected_products.map(r=>(r.id===t?(r.visible=!r.visible,""===this.edit_key&&r.visible&&this.clear(),"edit"!==e||r.visible||(this.edit_key="")):r.visible=!1,r))}add_level(){this.rule_data.level.length;const t={range:">=",num:"",cycle_time:"1",cycle_num:"1",alram_type:"2",notice:["email"],metricUnit:this.rule_data.level[0].metricUnit};this.rule_data={...this.rule_data,level:[...this.rule_data.level,t]}}del_level(){const{level:t}=this.rule_data;this.rule_data={...this.rule_data,level:t.filter((e,r)=>r<t.length-1)}}add_rule(){const t="0"===this.tab_key?this.$refs.rules_form[0]:this.$refs.event_form[0];t.validate(async t=>{if(t){if("0"===this.tab_key&&this.rule_data.level.some(t=>""===t.num))return;const{selected_products:t,tab_key:e,edit_key:r,edit_rule_id:a}=this;t.map(t=>{if(t.visible)if(""===r){const r={...this.rule_data,tab_key:e,id:t.id+Math.floor(1e6*(9*Math.random()+1))};t.rule_list="0"===e?[...t.rule_list,{...r,desc:this.rule_data.level.map(e=>`${this.getDescription(this.rule_data.metricID[1],t.index_list)} ${e.range} ${e.num}${e.metricUnit} ${this.trans_arr(e.alram_type,this.static_list.alarm_type)} 持续${e.cycle_num}次就报警`)}]:[...t.rule_list,{...r,desc:[`${this.trans_arr(this.rule_data.alram_type,this.static_list.alarm_type)} | ${this.trans_arr(this.rule_data.event_name,t.event_name)}`]}]}else t.rule_list=t.rule_list.map(e=>(e.id===a&&(e={...e,...this.rule_data},e.desc="0"===e.tab_key?e.level.map(e=>`${this.getDescription(this.rule_data.metricID[1],t.index_list)} ${e.range} ${e.num}${e.metricUnit}${this.trans_arr(e.alram_type,this.static_list.alarm_type)} 持续${e.cycle_num}次就报警`):[`${this.trans_arr(e.alram_type,this.static_list.alarm_type)} | ${this.trans_arr(e.event_name,t.event_name)}`]),e));return t}),this.edit_key="",this.edit_rule_id="",this.show_rule_box()}})}cancel(){this.edit_key="",this.show_rule_box()}del_rule(t,e){this.selected_products.map(r=>(r.id===t&&(r.rule_list=r.rule_list.filter(t=>t.id!==e)),r))}clear(){this.tab_key="0",this.$nextTick(()=>{const t=this.$refs.rules_form[0],e=this.$refs.event_form[0];t.resetFields(),e.resetFields(),this.valid("rules_form"),this.valid("event_form"),this.rule_data={name:"",metricID:[],event_type:"",event_name:"",alram_type:"",notice:[],level:[{range:">=",num:"",cycle_time:"1",cycle_num:"1",alram_type:"2",notice:["email"],metricUnit:""}]}})}edit_rules(t,e,r){this.tab_key=r,this.edit_key=r,this.edit_rule_id=e,this.show_rule_box(t,"edit");const a=this.selected_products.filter(e=>e.id===t),i=a[0].rule_list.filter(t=>t.id===e);this.rule_data=JSON.parse(JSON.stringify(i[0])),"1"===i[0].tab_key&&this.watch_event_type(i[0].event_type,a[0].event_type,a[0].id)}change_rule_notice(t){}changeTab(t){}trans_arr(t,e){if("string"===typeof t){const r=e.filter(e=>e.id===t);return r[0].title}{let r=[];return e.map(e=>{t.indexOf(e.id)>-1&&r.push(e.title)}),r}}};Object(n["a"])([Object(s["c"])({default:()=>[]})],_.prototype,"strategy_data",void 0),Object(n["a"])([Object(s["f"])("event",{immediate:!0,deep:!0})],_.prototype,"watch_event",null),Object(n["a"])([Object(s["f"])("strategy_data",{immediate:!0,deep:!0})],_.prototype,"watch_strategy_data",null),_=Object(n["a"])([Object(s["a"])({})],_);var m=_,p=m,f=(r("bfa1"),r("1ee0"),r("2877")),h=Object(f["a"])(p,l,c,!1,null,"1ca42563",null),v=h.exports,b=r("ed46");let y=class extends s["e"]{constructor(){super(...arguments),this.form_data={name:"",stategy:""},this.edit_id="",this.strategy_list=[],this.strategy_data={},this.rules={name:[{required:!0,message:"请输入策略名称",trigger:"blur"},{pattern:/^[\u4e00-\u9fa5_a-zA-Z0-9-_:()\u002E]{2,60}$/,message:"名称长度应为2-60个字符",trigger:"blur"}]}}created(){this.edit_id=this.$route.query.id?this.$route.query.id:"",this.getStrategyList()}change_strategy(t){t||this.getStrategyList()}async getStrategyList(t=""){let e=await u["a"].get_strategy_list({name:t,page:1,pageSize:20});"Success"===e.code&&(this.strategy_list=e.data.datas||[],""!==this.edit_id&&(this.form_data.stategy=this.edit_id))}async change_stategy(t){const e=await u["a"].get_strategy_detail({id:t});"Success"===e.code&&(this.strategy_data=e.data,""!==this.edit_id&&(this.form_data.name=e.data.name))}create(){const t=this.$refs.form,e=this.$refs.rule_config;t.validate(async t=>{if(t){const t=e.selected_products;if(0===t.length)return void this.$message.warning("请添加产品！");if(0===t[0].rule_list.length)return void this.$message.warning("请添加规则！");const r=[];if(t.forEach(t=>{t.rule_list.forEach(e=>{const a=[];e.level.map(t=>{const r={metricID:e.metricID[1],metricCondition:t.range,metricValue:Number(t.num),metricPeriod:parseInt(t.cycle_time),metricPeriodNum:parseInt(t.cycle_num),level:parseInt(t.alram_type),alarmType:"0"===e.tab_key?"metric":"event",alarmMethod:t.notice?t.notice:[],metricUnit:t.metricUnit};a.push(r)});const i={name:e.name,productType:t.id,ruleRecords:"0"===e.tab_key?a:[{metricID:"",alarmType:"0"===e.tab_key?"metric":"event",alarmMethod:e.notice?e.notice:[],eventId:[e.event_name],eventType:e.event_type,level:parseInt(e.alram_type)}]};r.push(i)})}),""===this.edit_id){let t=await u["a"].add_strategy({name:this.form_data.name,rules:r});"Success"===t.code&&(this.$message.success("创建策略任务下发成功"),this.$router.go(-1))}else{const{az:t,callbackURL:e,effectEndTime:a,effectStartTime:i,enable:n,id:s,regions:l,contactGroupIDs:c}=this.strategy_data;let o=await u["a"].update_strategy({name:this.form_data.name,rules:r.map(t=>(t=Object.assign({},t,{strategyID:this.edit_id}),t)),az:t,callbackURL:e,contactGroupID:c,effectEndTime:a,effectStartTime:i,enable:n,id:s,regions:l});"Success"===o.code&&(this.$message.success("编辑策略任务下发成功"),this.$router.go(-1))}}})}};Object(n["a"])([Object(s["f"])("form_data.stategy")],y.prototype,"change_stategy",null),y=Object(n["a"])([Object(s["a"])({components:{RuleConfig:v,BackHeader:b["a"]}})],y);var g=y,k=g,O=(r("03f5"),Object(f["a"])(k,a,i,!1,null,"c63c38c0",null));e["default"]=O.exports},e9bc:function(t,e,r){"use strict";var a=r("dc19"),i=r("cb27").add,n=r("83b9e"),s=r("7f65"),l=r("5388");t.exports=function(t){var e=a(this),r=s(t).getIterator(),c=n(e);return l(r,(function(t){i(c,t)})),c}},ed46:function(t,e,r){"use strict";var a=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",[e("div",{staticClass:"box"},[e("div",[e("span",[t._v(t._s(t.title))]),t._t("left")],2),e("div",[t._t("default"),t.no_back?t._e():e("el-button",{attrs:{type:"primary",plain:""},on:{click:t.FnBack}},[t._v("返回")])],2)]),e("div",{staticClass:"perch"})])},i=[],n=(r("14d9"),r("9ab4")),s=r("1b40");let l=class extends s["e"]{FnBack(){this.back_url?this.$router.push(this.back_url):this.$router.go(-1)}};Object(n["a"])([Object(s["c"])({default:""})],l.prototype,"title",void 0),Object(n["a"])([Object(s["c"])({default:""})],l.prototype,"back_url",void 0),Object(n["a"])([Object(s["c"])({default:!1})],l.prototype,"no_back",void 0),l=Object(n["a"])([s["a"]],l);var c=l,o=c,u=(r("a58a"),r("2877")),d=Object(u["a"])(o,a,i,!1,null,"bdf5ebe2",null);e["a"]=d.exports}}]);
//# sourceMappingURL=chunk-40476456.1751615839339.js.map