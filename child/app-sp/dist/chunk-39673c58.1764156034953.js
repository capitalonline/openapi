(window["webpackJsonp_AppSp"]=window["webpackJsonp_AppSp"]||[]).push([["chunk-39673c58"],{"580a":function(t,e,s){},7949:function(t,e,s){"use strict";s("580a")},a074:function(t,e,s){},a732:function(t,e,s){"use strict";var i=s("23e7"),a=s("c65b"),o=s("2266"),n=s("59ed"),l=s("825a"),c=s("46c4"),r=s("2a62"),u=s("f99f"),h=u("some",TypeError);i({target:"Iterator",proto:!0,real:!0,forced:h},{some:function(t){l(this);try{n(t)}catch(i){r(this,"throw",i)}if(h)return a(h,this,t);var e=c(this),s=0;return o(e,(function(e,i){if(t(e,s++))return i()}),{IS_RECORD:!0,INTERRUPTED:!0}).stopped}})},b40d:function(t,e,s){"use strict";s("a074")},c4f5:function(t,e,s){"use strict";s.r(e);var i=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",[e("el-tabs",{on:{"tab-click":t.handleClick},model:{value:t.activeName,callback:function(e){t.activeName=e},expression:"activeName"}},[e("el-tab-pane",{attrs:{label:"报警联系人",name:"0"}}),e("el-tab-pane",{attrs:{label:"报警联系组",name:"1"}})],1),e("div",["1"===t.activeName?[e("GroupList")]:[e("List")]],2)],1)},a=[],o=s("9ab4"),n=s("1b40"),l=s("c811"),c=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",[e("action-block",{attrs:{search_option:t.search},on:{"fn-search":t.fn_search},scopedSlots:t._u([{key:"default",fn:function(){return[e("el-button",{attrs:{type:"primary",disabled:!t.auth_list.includes("add_contact")},on:{click:t.add}},[t._v("新建联系人")])]},proxy:!0}])}),e("el-table",{ref:"contact_list",staticClass:"event-table",attrs:{data:t.list,border:"","row-class-name":t.rowStyle},on:{"selection-change":t.handleSelectionChange,"row-click":t.FnOperRow,"row-contextmenu":t.FnRightClick}},[e("el-table-column",{attrs:{type:"selection"}}),e("el-table-column",{attrs:{prop:"name",label:"姓名"}}),e("el-table-column",{attrs:{prop:"email",label:"邮箱"}}),e("el-table-column",{attrs:{prop:"phone",label:"电话号码"}}),e("el-table-column",{attrs:{prop:"groupName",label:"所属报警组"}})],1),e("el-pagination",{attrs:{"current-page":t.current,"page-sizes":[2,20,50,100],"page-size":t.size,layout:"total, sizes, prev, pager, next, jumper",total:t.total},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}}),t.user_visible?[e("AddContact",{attrs:{title:t.user_title,id:t.user_id,visible:t.user_visible},on:{close:t.close}})]:t._e(),t.group_visible?[e("AddToGroup",{attrs:{visible:t.group_visible,contact_rows:t.contact_rows},on:{close:t.close}})]:t._e(),t.del_visible?[e("common-dialog",{attrs:{visible:t.del_visible,title:"删除联系人",contact_rows:t.contact_rows},on:{"update:visible":function(e){t.del_visible=e},close:t.close}})]:t._e(),e("right-click",{attrs:{multi_rows:t.contact_rows,menus:t.menus,name:t.contact_rows.length>0?t.contact_rows[0].name:""},on:{"fn-click":t.handle}})],2)},r=[],u=(s("e9f5"),s("ab43"),s("a732"),s("da87")),h=s("dfe3"),d=s("2966"),p=s("d085"),_=s("e8c0"),g=s("bd4d"),b=s("cf88");let m=class extends n["e"]{constructor(){super(...arguments),this.type_list=[{type:"name",label:"姓名"},{type:"email",label:"邮箱"},{type:"phone",label:"电话号码"}],this.search={type:{placeholder:"请输入后查询",list:this.type_list,type:"composite",width:340}},this.list=[],this.current=1,this.size=20,this.total=0,this.user_visible=!1,this.user_id="",this.user_title="新建联系人",this.group_visible=!1,this.del_visible=!1,this.contact_rows=[],this.search_data={},this.auth_list=[],this.menus=[{label:"编辑",value:"edit_contact",single:!0,disabled:!1},{label:"删除联系人",value:"delete_contact",disabled:!1},{label:"添加至报警联系组",value:"add_to_group",disabled:!1}]}created(){this.fn_search(),this.auth_list=this.$store.state.auth_info["alarm_contact"]}FnOperRow(t){this.$refs.contact_list.toggleRowSelection(t)}rowStyle({row:t}){const e=this.contact_rows.some(e=>e.id===t.id);if(e)return"rowStyle"}FnRightClick(t,e,s){const i=this.contact_rows.some(e=>e.id===t.id);i||this.$refs.contact_list.toggleRowSelection(t),Object(_["a"])(t,e,s)}handle(t){const{label:e,value:s}=t;"edit_contact"===s?this.edit(this.contact_rows[0].id):"delete_contact"===s?this.contact_rows.length>=1?this.del({}):this.del(this.contact_rows[0]):this.addToWarnGroup(),Object(b["a"])()}fn_search(t={}){this.current=1,this.search_data=t,this.getContactList()}async getContactList(){let t=await d["a"].get_contact_list({page:this.current,pageSize:this.size,[this.search_data.typesub?this.search_data.typesub:"name"]:this.search_data.type});"Success"===t.code&&(this.list=t.data.datas,this.list.map(t=>{let e=t.groups.map(t=>t.name);return t.groupName=e.join(","),t}),this.total=t.data.total||0)}handleSizeChange(t){this.size=t,this.getContactList()}handleCurrentChange(t){this.current=t,this.getContactList()}handleSelectionChange(t){this.contact_rows=t}add(){this.user_title="新建联系人",this.user_visible=!0}async edit(t){this.user_id=t,this.user_title="编辑联系人",this.user_visible=!0}del(t){Object.keys(t).length>0&&(this.contact_rows=[t]),0!==this.contact_rows.length?this.del_visible=!0:this.$message.warning("请勾选联系人！")}close(t){this.user_visible=!1,this.group_visible=!1,this.del_visible=!1,this.contact_rows=[],this.user_id="","1"===t&&this.getContactList();const e=this.$refs.contact_list;e.clearSelection()}addToWarnGroup(){0!==this.contact_rows.length?this.group_visible=!0:this.$message.warning("请先勾选联系人！")}};m=Object(o["a"])([Object(n["a"])({components:{RightClick:g["a"],ActionBlock:l["a"],AddContact:u["a"],AddToGroup:h["a"],CommonDialog:p["a"]}})],m);var f=m,v=f,w=s("2877"),y=Object(w["a"])(v,c,r,!1,null,null,null),C=y.exports,k=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",[e("action-block",{attrs:{search_option:t.search},on:{"fn-search":t.fn_search},scopedSlots:t._u([{key:"default",fn:function(){return[e("el-button",{attrs:{type:"primary",disabled:!t.auth_list.includes("add_contact_group")},on:{click:t.add}},[t._v("新建联系人组")]),e("el-button",{attrs:{type:"primary",disabled:!t.auth_list.includes("delete_contact_group")},on:{click:t.del}},[t._v("删除联系人组")])]},proxy:!0}])}),e("el-collapse",{staticClass:"contact-group-box",attrs:{accordion:""}},t._l(t.group_list,(function(s){return e("el-collapse-item",{key:s.id},[e("template",{slot:"title"},[e("div",{staticClass:"collapse-header"},[e("el-checkbox",{on:{change:function(e){return t.sel_users(s.id,e)}},model:{value:s.check,callback:function(e){t.$set(s,"check",e)},expression:"item.check"}},[t._v(" "+t._s(s.name)+" ")]),e("el-button",{staticClass:"edit",attrs:{type:"text",disabled:!t.auth_list.includes("edit_contact_group")},on:{click:function(e){return e.stopPropagation(),t.edit(s.id)}}},[t._v(" 编辑 ")])],1)]),e("div",{staticClass:"table-box"},[e("el-table",{staticClass:"event-table",attrs:{data:s.members,border:"","max-height":"396"}},[e("el-table-column",{attrs:{prop:"name",label:"姓名"}}),e("el-table-column",{attrs:{prop:"email",label:"邮箱"}}),e("el-table-column",{attrs:{prop:"phone",label:"电话号码"}}),e("el-table-column",{attrs:{prop:"groups",label:"所属报警组"},scopedSlots:t._u([{key:"default",fn:function(s){return t._l(s.row.groups,(function(i,a){return e("span",{key:i.id},[t._v(" "+t._s(a===s.row.groups.length-1?i.name:i.name+",")+" ")])}))}}],null,!0)}),e("el-table-column",{attrs:{label:"操作"},scopedSlots:t._u([{key:"default",fn:function(i){return[e("el-button",{attrs:{type:"text",disabled:!t.auth_list.includes("remove_contact")},on:{click:function(e){return t.remove(i.row.id,s.id,s.name)}}},[t._v(" 移除 ")])]}}],null,!0)})],1)],1)],2)})),1),e("el-pagination",{attrs:{"current-page":t.current,"page-sizes":[2,20,50,100],"page-size":t.size,layout:"total, sizes, prev, pager, next, jumper",total:t.total},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}}),t.group_visible?[e("AddGroup",{attrs:{title:t.group_title,id:t.group_id,visible:t.group_visible},on:{"update:visible":function(e){t.group_visible=e},close:t.close_group}})]:t._e()],2)},x=[],S=(s("910d"),s("6aac")),z=s("7afc");let L=class extends n["e"]{constructor(){super(...arguments),this.search={name:{placeholder:"请输入组名后查询"}},this.search_data={},this.list=[],this.current=1,this.size=20,this.total=0,this.group_list=[],this.group_title="新建联系人组",this.group_visible=!1,this.del_visible=!1,this.group_id="",this.group_rows=[],this.auth_list=[]}created(){this.fn_search(),this.auth_list=this.$store.state.auth_info["alarm_contact"]}fn_search(t={}){this.search_data=t,this.current=1,this.getContactGroupList()}async getContactGroupList(){let t=await d["a"].get_contact_group_list({name:this.search_data.name,page:this.current,pageSize:this.size});"Success"===t.code&&(this.group_list=t.data.datas.map(t=>(t=Object.assign({},t,{check:!1}),t)),this.total=t.data.total||0)}handleSizeChange(t){this.size=t,this.getContactGroupList()}handleCurrentChange(t){this.current=t,this.getContactGroupList()}handleSelectionChange(t){this.group_rows=t}async remove(t,e,s){const i=this.group_list.filter(t=>t.id===e)[0].members;this.$confirm(`确定将此用户从${s}中移去吗， 是否继续?`,"联系人移除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{let a=await d["a"].update_contact_group({id:e,name:s,contactIDs:i.map(e=>{if(e.id!==t)return e.id})});"Success"===a.code&&(this.$message.success("移除联系人任务下发成功！"),this.getContactGroupList())}).catch(()=>{this.$message({type:"info",message:"已取消移除"})})}close_group(t){this.group_visible=!1,this.del_visible=!1,this.group_rows=[],this.group_id="","1"===t&&this.getContactGroupList()}add(){this.group_title="新建联系人组",this.group_visible=!0}edit(t){this.group_id=t,this.group_title="编辑联系人组",this.group_visible=!0}sel_users(){}del(){if(this.group_rows=this.group_list.filter(t=>t.check),0===this.group_rows.length)return void this.$message.warning("请先勾选联系人组!");const t=this.group_rows.map(t=>t.name),e=this.group_rows.map(t=>t.id),s=this.$createElement;this.$msgbox({title:"提示",message:s("p",null,[s("span",null,"确定删除 "),s("i",{style:"color: #455cc6"},""+t.join(",")),s("span",null,"  吗, 是否继续?")]),showCancelButton:!0,confirmButtonText:"确定",cancelButtonText:"取消",iconClass:"el-icon-warning",customClass:"message-box"}).then(async()=>{let t=await d["a"].delete_contact_group({ids:e});"Success"===t.code&&(this.$message.success("删除联系人组任务下发成功！"),this.getContactGroupList())}).catch(()=>{this.$message({type:"info",message:"已取消删除"}),this.getContactGroupList()})}addToWarnGroup(){}};L=Object(o["a"])([Object(n["a"])({components:{ActionBlock:l["a"],AddGroup:S["a"],CommonDel:z["a"]}})],L);var j=L,G=j,$=(s("b40d"),s("7949"),Object(w["a"])(G,k,x,!1,null,"3eb4de1f",null)),O=$.exports;let T=class extends n["e"]{constructor(){super(...arguments),this.activeName="0"}handleClick(){}};T=Object(o["a"])([Object(n["a"])({components:{ActionBlock:l["a"],List:C,GroupList:O}})],T);var A=T,R=A,E=Object(w["a"])(R,i,a,!1,null,null,null);e["default"]=E.exports},e8c0:function(t,e,s){"use strict";s.d(e,"a",(function(){return a}));var i=s("cf88");function a(t,e,s){s.preventDefault(),document.addEventListener("contextmenu",t=>{const e=t.target;if(e.closest(".el-table")){let e=document.querySelector("#menu");if(e){e.style.display="block";let s=e.offsetHeight,a=e.offsetWidth;console.log("menuHeight",s);let o=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,n=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,l=t.clientX,c=t.clientY,r=l,u=c;n<l+a&&(r=l-a),o<c+s&&(u=o-s),e.style.left=r-250+"px",e.style.top=u-50+"px",e.style.display="block",e.style.zIndex="1000",document.addEventListener("click",i["a"])}}}),document.addEventListener("contextmenu",i["a"])}}}]);
//# sourceMappingURL=chunk-39673c58.1764156034953.js.map