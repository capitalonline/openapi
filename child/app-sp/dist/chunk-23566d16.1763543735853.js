(window["webpackJsonp_AppSp"]=window["webpackJsonp_AppSp"]||[]).push([["chunk-23566d16"],{"1ac7c":function(e,t,a){"use strict";a("704e")},"26f3":function(e,t,a){"use strict";a("4f3f")},2966:function(e,t,a){"use strict";var i=a("81a9"),l=a("bff7");t["a"]={get_alarm_list(e){return Object(i["a"])(Object(l["a"])("GET","/record/list",e))},get_strategy_list(e){return Object(i["a"])(Object(l["a"])("GET","/strategy/list",e))},get_strategy_detail(e){return Object(i["a"])(Object(l["a"])("GET","/strategy",e))},get_index_list(e){return Object(i["a"])(Object(l["a"])("GET","/metrics/info",e))},add_strategy(e){return Object(i["a"])(Object(l["a"])("POST","/strategy",e))},update_strategy(e){return Object(i["a"])(Object(l["a"])("PUT","/strategy",e))},apply_strategy(e){return Object(i["a"])(Object(l["a"])("PUT","/strategy/apply",e))},delete_strategy(e){return Object(i["a"])({method:"DELETE",url:"/alarm/api/v1/strategy",data:e})},get_contact_list(e){return Object(i["a"])(Object(l["a"])("GET","/contact/list",e))},add_contact(e){return Object(i["a"])(Object(l["a"])("POST","/contact",e))},get_contact_detail(e){return Object(i["a"])(Object(l["a"])("GET","/contact",e))},update_contact(e){return Object(i["a"])(Object(l["a"])("PUT","/contact",e))},delete_contact(e){return Object(i["a"])({method:"DELETE",url:"/alarm/api/v1/contact",data:e})},add_contact_to_group(e){return Object(i["a"])(Object(l["a"])("PUT","/contact_group/relation",e))},get_contact_group_list(e){return Object(i["a"])(Object(l["a"])("GET","/contact_group/list",e))},get_contact_group_detail(e){return Object(i["a"])(Object(l["a"])("GET","/contact_group",e))},add_contact_group(e){return Object(i["a"])(Object(l["a"])("POST","/contact_group",e))},update_contact_group(e){return Object(i["a"])(Object(l["a"])("PUT","/contact_group",e))},delete_contact_group(e){return Object(i["a"])({method:"DELETE",url:"/alarm/api/v1/contact_group",data:e})},get_event_list(e){return Object(i["a"])(Object(l["a"])("GET","/strategy/event/list",e))},get_product_list(e){return Object(i["a"])(Object(l["a"])("GET","/strategy/product/list",e))},get_shield_list(e){return Object(i["a"])(Object(l["a"])("GET","/shield/list",e))},get_create_info(e){return Object(i["a"])(Object(l["a"])("GET","/shield/info",e))},get_strategy_info(e){return Object(i["a"])(Object(l["a"])("GET","/shield/condition/strategy",e))},get_rule_info(e){return Object(i["a"])(Object(l["a"])("GET","/shield/condition/rule",e))},create_shield(e){return Object(i["a"])(Object(l["a"])("POST","/shield",e))},edit_shield(e){return Object(i["a"])(Object(l["a"])("PUT","/shield",e))},shield_detail(e){return Object(i["a"])(Object(l["a"])("GET","/shield",e))},shield_apply(e){return Object(i["a"])(Object(l["a"])("PUT","/shield/apply",e))},shield_del(e){return Object(i["a"])(Object(l["a"])("POST","/shield/delete",e))}}},4774:function(e,t,a){"use strict";a("835c")},"4f3f":function(e,t,a){},"56e0":function(e,t,a){},"5f9c":function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e._self._c;e._self._setupProxy;return t("div",[t("action-block",{attrs:{search_option:e.search},on:{"fn-search":e.fn_search}},e._l(e.headerOperateBtns,(function(a){return t("el-button",{key:a.value,attrs:{type:"primary",disabled:!e.authList.includes(a.value)},on:{click:function(t){return e.handle(a)}}},[e._v(e._s(a.label))])})),1),t("el-table",{ref:"table",attrs:{data:e.list,border:"","row-class-name":e.rowStyle},on:{"selection-change":e.handleSelectionChange,"row-click":e.FnOperRow,"row-contextmenu":e.FnRightClick}},[t("el-table-column",{attrs:{type:"selection"}}),t("el-table-column",{attrs:{prop:"shield_name",label:"屏蔽名称"}}),t("el-table-column",{attrs:{prop:"createTime",label:"屏蔽状态"},scopedSlots:e._u([{key:"default",fn:function(a){return[1===a.row.enable?t("span",{staticClass:"running"},[e._v("屏蔽中")]):t("span",{staticClass:"build_fail"},[e._v("已停用")])]}}])}),t("el-table-column",{attrs:{prop:"created_time",label:"创建时间"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("span",[e._v(e._s(e.moment(a.row.created_time).format("YYYY-MM-DD HH:mm:ss")))])]}}])}),t("el-table-column",{attrs:{prop:"updated_time",label:"修改时间"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("span",[e._v(e._s(e.moment(a.row.updated_time).format("YYYY-MM-DD HH:mm:ss")))])]}}])})],1),t("el-pagination",{attrs:{"current-page":e.current,"page-sizes":[20,50,100],"page-size":e.size,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}}),e.visible?[t("shield-detail",{attrs:{detaiId:e.multipleSelection[0].id,visible:e.visible},on:{"update:visible":function(t){e.visible=t}}})]:e._e(),t("right-click",{attrs:{multi_rows:e.multipleSelection,menus:e.menus,name:e.multipleSelection.length>0?e.multipleSelection[0].shield_name:""},on:{"fn-click":e.handle}})],2)},l=[],s=(a("14d9"),a("e9f5"),a("ab43"),a("a732"),a("9ab4")),n=a("1b40"),c=a("c811"),r=a("c1df"),o=a.n(r),d=a("2966"),u=a("c8d7"),h=a("e8c0"),p=a("bd4d"),b=a("cf88");let _=class extends n["e"]{constructor(){super(...arguments),this.search={name:{placeholder:"请输入屏蔽名称"},enable:{placeholder:"请选择屏蔽状态",list:[{type:"1",label:"屏蔽中"},{type:"2",label:"已停用"}]}},this.list=[{productType:"1"}],this.current=1,this.size=20,this.total=0,this.search_data={},this.multipleSelection=[],this.operateType="",this.moment=o.a,this.visible=!1,this.authList=[],this.headerOperateBtns=[{label:"创建屏蔽",value:"alarm_create"}],this.menus=[{label:"详情",value:"detail",single:!0,disabled:!1},{label:"修改",value:"edit",single:!0,disabled:!1},{label:"应用",value:"apply",disabled:!1},{label:"停用",value:"stop",disabled:!1},{label:"删除",value:"del",disabled:!1}]}watch_multi(){this.handleMenus()}handleMenus(){if(this.multipleSelection.length>0)for(const e of this.menus)e.disabled=this.FnDisable(e.value,this.multipleSelection[0])}created(){this.getShieldList(),this.authList=this.$store.state.auth_info["alarm_info"]}FnOperRow(e){this.$refs.table.toggleRowSelection(e)}rowStyle({row:e}){const t=this.multipleSelection.some(t=>t.id===e.id);if(t)return"rowStyle"}FnRightClick(e,t,a){const i=this.multipleSelection.some(t=>t.id===e.id);i||this.$refs.table.toggleRowSelection(e),Object(h["a"])(e,t,a)}async getShieldList(){let e=await d["a"].get_shield_list({page:this.current,pageSize:this.size,name:this.search_data.name,enable:this.search_data.enable?Number(this.search_data.enable):void 0});"Success"===e.code&&(this.list=e.data.datas,this.total=e.data.total)}fn_search(e={}){this.current=1,this.search_data={...e},this.getShieldList()}handleSizeChange(e){this.size=e,this.getShieldList()}handleCurrentChange(e){this.current=e,this.getShieldList()}handleSelectionChange(e){this.multipleSelection=e}handle(e){const{label:t,value:a}=e;this.operateType=a,"alarm_create"===a?this.$router.push("/alarm_info/create"):"edit"===a?this.$router.push({path:"/alarm_info/create",query:{id:this.multipleSelection[0].id}}):"detail"===a?this.visible=!0:["apply","stop"].includes(a)?this.apply():"del"===a&&this.del(),Object(b["a"])()}judgeDeadTime(e){return!!e&&o()(new Date).diff(o()(e),"seconds")>0}judgeOperate(){return this.judge(this.operateType,this.multipleSelection)}judge(e,t){let a=!1;if(t.length>0)if("apply"===e){let e=t.some(e=>1===e.enable||this.judgeDeadTime(e.shield_end_time));a=e}else["stop"].includes(e)?a=t.some(e=>0===e.enable):["edit","del"].includes(e)&&(a=t.some(e=>1===e.enable));return a}FnDisable(e,t){return this.judge(e,[t])}apply(){if(this.judgeOperate())return void("apply"===this.operateType?this.$message.warning("只能对已停用且静默时间未到期的策略进行应用"):this.$message.warning("只能对屏蔽中的策略进行停用"));const e=this.$createElement;let t="apply"===this.operateType?"应用":"停用",a=this.multipleSelection.map(e=>e.shield_name);this.$msgbox({title:"提示",message:e("p",null,[e("span",null,`确定${t} `),e("i",{style:"color: #455cc6"},a.join(",")),e("span",null," 这些屏蔽策略吗? ")]),showCancelButton:!0,confirmButtonText:"确定",cancelButtonText:"取消"}).then(async e=>{let t=await d["a"].shield_apply({ids:this.multipleSelection.map(e=>e.id),enable:"apply"===this.operateType?1:0});"Success"===t.code&&(this.$message.success(t.message),this.getShieldList())})}del(){if(this.judgeOperate())return void this.$message.warning("只能对已停用的策略进行删除");const e=this.$createElement;let t=this.multipleSelection.map(e=>e.shield_name);this.$msgbox({title:"提示",message:e("p",null,[e("span",null,"确定删除 "),e("i",{style:"color: #455cc6"},t.join(",")+" "),e("span",null,"吗？ "),e("div",null," 删除该屏蔽策略后，所有产品无法使用该屏蔽策略，且删除后无法恢复? ")]),showCancelButton:!0,confirmButtonText:"确定",cancelButtonText:"取消"}).then(async e=>{let t=await d["a"].shield_del({ids:this.multipleSelection.map(e=>e.id)});"Success"===t.code&&(this.$message.success(t.message),this.getShieldList())})}};Object(s["a"])([Object(n["f"])("multipleSelection",{immediate:!0,deep:!0})],_.prototype,"watch_multi",null),_=Object(s["a"])([Object(n["a"])({components:{ActionBlock:c["a"],ShieldDetail:u["a"],RightClick:p["a"]}})],_);var m=_,f=m,y=(a("1ac7c"),a("2877")),g=Object(y["a"])(f,i,l,!1,null,"cc5bf138",null);t["default"]=g.exports},"704e":function(e,t,a){},"835c":function(e,t,a){},"9a8d":function(e,t,a){"use strict";var i=function(){var e=this,t=e._self._c;e._self._setupProxy;return t("el-date-picker",{attrs:{type:e.time_option.type,editable:!1,"range-separator":"至","picker-options":{disabledDate:e.dis_date,onPick:e.onPicker},clearable:e.time_option.clearable,"start-placeholder":e.time_option.placeholder[0],"end-placeholder":e.time_option.placeholder[1]},on:{change:e.FnEmit},model:{value:e.time,callback:function(t){e.time=t},expression:"time"}})},l=[],s=a("9ab4"),n=a("1b40");let c=class extends n["e"]{constructor(){super(...arguments),this.time=[],this.min_date="",this.day=0}dis_date(e){const{day:t}=this;if(0===t)return;let a=864e5,i=(new Date).getTime(),l=(new Date).getTime(),s=(new Date).getTime();return this.time_option.min_date?(l=new Date(this.time_option.min_date).getTime(),e.getTime()>s||e.getTime()<l-a):e.getTime()>s||e.getTime()>(this.min_date||i)+a*t||this.min_date&&e.getTime()<this.min_date-a*t}onPicker({maxDate:e,minDate:t}){this.min_date=t.getTime()}created(){this.day=this.time_option.dis_day-1||0,this.FnChangeDefaultTime(this.time_option.defaultTime)}FnClear(){this.FnChangeDefaultTime(this.time_option.defaultTime)}FnChangeDefaultTime(e){e.length,this.time=e,this.FnEmit()}FnEmit(){return this.min_date="",this.time}};Object(s["a"])([Object(n["c"])({default:()=>({placeholder:["开始时间","结束时间"],type:"daterange",width:"360",clearable:!1,dis_day:31,min_date:"",defaultTime:[new Date,new Date]})})],c.prototype,"time_option",void 0),Object(s["a"])([Object(n["c"])({default:!1})],c.prototype,"clear",void 0),Object(s["a"])([Object(n["f"])("time_option.defaultTime")],c.prototype,"FnChangeDefaultTime",null),Object(s["a"])([Object(n["b"])("fn-emit")],c.prototype,"FnEmit",null),c=Object(s["a"])([n["a"]],c);var r=c,o=r,d=a("2877"),u=Object(d["a"])(o,i,l,!1,null,null,null);t["a"]=u.exports},a732:function(e,t,a){"use strict";var i=a("23e7"),l=a("c65b"),s=a("2266"),n=a("59ed"),c=a("825a"),r=a("46c4"),o=a("2a62"),d=a("f99f"),u=d("some",TypeError);i({target:"Iterator",proto:!0,real:!0,forced:u},{some:function(e){c(this);try{n(e)}catch(i){o(this,"throw",i)}if(u)return l(u,this,e);var t=r(this),a=0;return s(t,(function(t,i){if(e(t,a++))return i()}),{IS_RECORD:!0,INTERRUPTED:!0}).stopped}})},bf40:function(e,t,a){"use strict";a("56e0")},c811:function(e,t,a){"use strict";a("e9f5"),a("910d");var i=function(){var e=this,t=e._self._c;e._self._setupProxy;return t("div",{staticClass:"action-box",style:e.isShowBg?{}:{background:"#fff",padding:0,margin:0,border:"none"}},[t("div",{ref:"search",staticClass:"search-box",class:{fold:!e.isOpen}},[e._l(e.search_option,(function(a,i){return t("div",{key:i,staticClass:"search-input",style:a.width?{width:a.width+"px"}:{}},[a.list&&!a.type?t("el-select",{attrs:{placeholder:a.placeholder,multiple:a.multiple,filterable:a.filter,clearable:""},model:{value:e.search_value[i],callback:function(t){e.$set(e.search_value,i,t)},expression:"search_value[key]"}},e._l(a.list,(function(e,i){return t("el-option",{key:Array.isArray(a.list)?e.type:i,attrs:{label:Array.isArray(a.list)?e.label:e,value:Array.isArray(a.list)?e.type:i}})})),1):e._e(),(a.list||a.type||a.multi)&&"composite"!==a.type?e._e():t("el-input",{staticClass:"composite",style:a.width?{width:a.width+"px"}:{},attrs:{placeholder:a.placeholder,clearable:""},model:{value:e.search_value[i],callback:function(t){e.$set(e.search_value,i,t)},expression:"search_value[key]"}},["composite"===a.type?t("el-select",{attrs:{slot:"prepend",placeholder:"请选择"},slot:"prepend",model:{value:e.search_value[i+"sub"],callback:function(t){e.$set(e.search_value,i+"sub",t)},expression:"search_value[key + 'sub']"}},e._l(a.list,(function(e){return t("el-option",{key:e.type,attrs:{label:e.label,value:e.type}})})),1):e._e()],1),a.multi?t("el-popover",{attrs:{placement:"bottom",width:"250",trigger:"click"}},[t("el-input",{attrs:{type:"textarea",rows:4,placeholder:a.placeholder+"（使用回车或英文逗号隔开）"},model:{value:e.search_value[i],callback:function(t){e.$set(e.search_value,i,t)},expression:"search_value[key]"}}),!a.list&&!a.type||a.multi?t("el-input",{staticClass:"multi_input",style:a.width?{width:a.width+"px"}:{},attrs:{slot:"reference",placeholder:a.placeholder,clearable:""},slot:"reference",model:{value:e.search_value[i],callback:function(t){e.$set(e.search_value,i,t)},expression:"search_value[key]"}}):e._e()],1):e._e(),"datetimerange"===a.type||"daterange"===a.type?[t("date-picker",{ref:"datepicker",refInFor:!0,attrs:{time_option:e.search_option[i]},on:{"fn-emit":function(t){return e.FnGetTime(t,i)}}})]:e._e()],2)})),e.type?e._e():t("div",{staticClass:"m-bottom20"},[t("el-button",{attrs:{type:"primary"},on:{click:e.FnSearch}},[e._v("查 询")]),t("el-button",{attrs:{type:"default"},on:{click:e.FnClear}},[e._v("清 空")])],1)],2),e.type?t("div",{staticClass:"m-bottom5"},[t("el-button",{attrs:{type:"primary"},on:{click:e.FnSearch}},[e._v("查 询")]),"physical"===e.type?t("el-button",{attrs:{type:"primary"},on:{click:e.FnMultiSearch}},[e._v("批量查询")]):e._e(),t("el-button",{attrs:{type:"default"},on:{click:e.FnClear}},[e._v("清 空")]),t("el-button",{staticClass:"m-bottom10",attrs:{type:"text"},on:{click:e.operate}},[e._v(e._s(e.isOpen?"折叠":"展开"))])],1):e._e(),e._t("default",(function(){return[e.create_btn?t("el-button",{attrs:{type:"primary",disabled:e.disabled},on:{click:e.FnShowCreate}},[e._v(e._s(e.create_btn))]):e._e()]})),t("el-dialog",{attrs:{title:"批量查询",visible:e.syncVisible,width:"400px","destroy-on-close":!0,"close-on-click-modal":!1}},[t("el-input",{attrs:{type:"textarea",rows:13,placeholder:"请输入主机ID/名称,格式如下：\nPOD01-CLU01-H001\nPOD01-CLU01-H002\nPOD01-CLU01-H003\n..."},model:{value:e.search_value["host_info"],callback:function(t){e.$set(e.search_value,"host_info",t)},expression:"search_value['host_info']"}}),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"primary"},on:{click:e.FnSearch}},[e._v("确认")]),t("el-button",{on:{click:function(t){e.syncVisible=!1}}},[e._v("取消")])],1)],1)],2)},l=[],s=a("9ab4"),n=a("1b40"),c=a("9a8d");let r=class extends n["e"]{constructor(){super(...arguments),this.search_value={},this.time=null,this.date_key="",this.syncVisible=!1,this.isOpen=!0}FnGetTime(e,t){this.time=e,this.date_key=t}FnSearch(){return this.syncVisible=!1,this.search_value[this.date_key]=this.time,this.search_value}watch_search_option(){this.type&&this.$nextTick(()=>{let e=this.$refs.search,t=window.getComputedStyle(e).height.replace("px","");parseInt(t)>52&&this.isOpen&&(this.isOpen=!1),this.FnOperate()})}FnMultiSearch(){this.syncVisible=!0}operate(){this.isOpen=!this.isOpen,this.FnOperate()}FnOperate(){}FnShowCreate(){}watch_search_value(e,t){}FnClear(){for(let e in this.search_option)["datetimerange","daterange"].includes(this.search_option[e].type)?this.$refs.datepicker[0].FnClear():this.search_value={};this.FnSearch()}mounted(){let e=0;for(let t in this.search_option)this.search_option[t].default_value&&(this.$set(this.search_value,t,this.search_option[t].default_value),e++),"composite"===this.search_option[t].type&&this.$set(this.search_value,t+"sub",this.search_option[t].list[0].type);(e>0||"physical"===this.type)&&setTimeout(()=>{this.FnSearch()},500)}};Object(s["a"])([Object(n["c"])({default:{}})],r.prototype,"search_option",void 0),Object(s["a"])([Object(n["c"])({default:""})],r.prototype,"create_btn",void 0),Object(s["a"])([Object(n["c"])({default:!0})],r.prototype,"disabled",void 0),Object(s["a"])([Object(n["c"])({default:!1})],r.prototype,"type",void 0),Object(s["a"])([Object(n["c"])({default:!0})],r.prototype,"isShowBg",void 0),Object(s["a"])([Object(n["b"])("fn-search")],r.prototype,"FnSearch",null),Object(s["a"])([Object(n["f"])("search_option",{immediate:!0,deep:!0})],r.prototype,"watch_search_option",null),Object(s["a"])([Object(n["b"])("fn-operate")],r.prototype,"FnOperate",null),Object(s["a"])([Object(n["b"])("fn-create")],r.prototype,"FnShowCreate",null),Object(s["a"])([Object(n["f"])("search_value",{immediate:!0,deep:!0})],r.prototype,"watch_search_value",null),r=Object(s["a"])([Object(n["a"])({components:{DatePicker:c["a"]}})],r);var o=r,d=o,u=(a("4774"),a("26f3"),a("2877")),h=Object(u["a"])(d,i,l,!1,null,"20a86f62",null);t["a"]=h.exports},c8d7:function(e,t,a){"use strict";var i=function(){var e=this,t=e._self._c;e._self._setupProxy;return t("el-dialog",{attrs:{title:"屏蔽详情",visible:e.visibleSync,width:"800px","destroy-on-close":!0,"close-on-click-modal":!1},on:{"update:visible":function(t){e.visibleSync=t}}},[t("div",{staticClass:"box"},[t("el-descriptions",{attrs:{title:"",column:1,labelClassName:"label"}},e._l(e.info,(function(a,i){return t("el-descriptions-item",{key:i,attrs:{label:a.label}},[t("span",{domProps:{innerHTML:e._s(a.value)}})])})),1),t("el-table",{staticClass:"m-top10",attrs:{data:e.conditions,border:""}},[t("el-table-column",{attrs:{prop:"condition_object_ch",label:"条件对象",align:"center"}}),t("el-table-column",{attrs:{prop:"condition_value",label:"取值",align:"center"}})],1)],1)])},l=[],s=a("9ab4"),n=a("1b40"),c=a("2966");let r=class extends n["e"]{constructor(){super(...arguments),this.info={shield_name:{label:"屏蔽名称",value:""},shield_mechanism_ch:{label:"告警机制",value:""},effective_scope_ch:{label:"抑制范围",value:""},shield_time_ch:{label:"静默时间",value:""}},this.conditions=[],this.id=this.detaiId}created(){this.detail()}async detail(){let e=await c["a"].shield_detail({id:this.id});if("Success"===e.code){this.info.shield_name.value=e.data.shield_name,this.info.shield_mechanism_ch.value=e.data.shield_mechanism_ch,this.info.effective_scope_ch.value=e.data.effective_scope_ch,this.conditions=e.data.conditions;let t={0:'<div class="m-top10">'+e.data.shield_start_time+" —— "+e.data.shield_end_time+"</div>",1:'<div class="m-top10">'+e.data.shield_end_time+"</div>",2:""};this.info.shield_time_ch.value=e.data.shield_time_ch+"<br>"+t[e.data.shield_time]}}};Object(s["a"])([Object(n["c"])()],r.prototype,"detaiId",void 0),Object(s["a"])([Object(n["d"])("visible")],r.prototype,"visibleSync",void 0),r=Object(s["a"])([Object(n["a"])({components:{}})],r);var o=r,d=o,u=(a("bf40"),a("2877")),h=Object(u["a"])(d,i,l,!1,null,null,null);t["a"]=h.exports},e8c0:function(e,t,a){"use strict";a.d(t,"a",(function(){return l}));var i=a("cf88");function l(e,t,a){a.preventDefault(),document.addEventListener("contextmenu",e=>{const t=e.target;if(t.closest(".el-table")){let t=document.querySelector("#menu");if(t){t.style.display="block";let a=t.offsetHeight,l=t.offsetWidth,s=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,n=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,c=e.clientX,r=e.clientY,o=c,d=r;n<c+l&&(o=c-l),s<r+a&&(d=s-a),t.style.left=o-250+"px",t.style.top=d-50+"px",t.style.display="block",t.style.zIndex="1000",document.addEventListener("click",i["a"])}}}),document.addEventListener("contextmenu",i["a"])}}}]);