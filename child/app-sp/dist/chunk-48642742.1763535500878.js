(window["webpackJsonp_AppSp"]=window["webpackJsonp_AppSp"]||[]).push([["chunk-48642742"],{1496:function(e,t,i){"use strict";i("f309")},"1e5a":function(e,t,i){"use strict";var a=i("23e7"),s=i("9961"),r=i("5320"),n=i("dad2"),o=!n("symmetricDifference")||!r("symmetricDifference");a({target:"Set",proto:!0,real:!0,forced:o},{symmetricDifference:s})},"1e70":function(e,t,i){"use strict";var a=i("23e7"),s=i("a5f7"),r=i("d039"),n=i("dad2"),o=!n("difference",(function(e){return 0===e.size})),l=o||r((function(){var e={size:1,has:function(){return!0},keys:function(){var e=0;return{next:function(){var i=e++>1;return t.has(1)&&t.clear(),{done:i,value:2}}}}},t=new Set([1,2,3,4]);return 3!==t.difference(e).size}));a({target:"Set",proto:!0,real:!0,forced:l},{difference:s})},"2cfd":function(e,t,i){"use strict";i("c96d")},"384f":function(e,t,i){"use strict";var a=i("e330"),s=i("5388"),r=i("cb27"),n=r.Set,o=r.proto,l=a(o.forEach),c=a(o.keys),d=c(new n).next;e.exports=function(e,t,i){return i?s({iterator:c(e),next:d},t):l(e,t)}},"395e":function(e,t,i){"use strict";var a=i("dc19"),s=i("cb27").has,r=i("8e16"),n=i("7f65"),o=i("5388"),l=i("2a62");e.exports=function(e){var t=a(this),i=n(e);if(r(t)<i.size)return!1;var c=i.getIterator();return!1!==o(c,(function(e){if(!s(t,e))return l(c,"normal",!1)}))}},"3a50":function(e,t,i){},4780:function(e,t,i){"use strict";i.d(t,"g",(function(){return a})),i.d(t,"d",(function(){return s})),i.d(t,"b",(function(){return r})),i.d(t,"a",(function(){return n})),i.d(t,"f",(function(){return o})),i.d(t,"e",(function(){return l})),i.d(t,"c",(function(){return c}));Math.floor(1e6*(9*Math.random()+1)),Math.floor(1e6*(9*Math.random()+1)),Math.floor(1e6*(9*Math.random()+1)),Math.floor(1e6*(9*Math.random()+1)),Math.floor(1e6*(9*Math.random()+1)),Math.floor(1e6*(9*Math.random()+1)),Math.floor(1e6*(9*Math.random()+1)),Math.floor(1e6*(9*Math.random()+1)),Math.floor(1e6*(9*Math.random()+1));const a=[{id:">=",title:">="},{id:"<=",title:"<="},{id:">",title:">"},{id:"<",title:"<"}],s=[{id:"1",title:"1分钟一个周期"},{id:"15",title:"15分钟一个周期"},{id:"30",title:"30分钟一个周期"},{id:"60",title:"60分钟一个周期"}],r=[{id:"1",title:"持续1个周期"},{id:"3",title:"持续3个周期"},{id:"5",title:"持续5个周期"},{id:"10",title:"持续10个周期"},{id:"15",title:"持续15个周期"},{id:"30",title:"持续30个周期"}],n=[{id:"2",title:"严重"},{id:"1",title:"告警"},{id:"0",title:"普通"}],o=[{id:"email",name:"邮箱"},{id:"phone",name:"短信"}],l=[{id:"abnormal_event",title:"异常事件"}],c=[{id:"900",title:"15分钟"},{id:"1800",title:"30分钟"},{id:"3600",title:"60分钟"},{id:"10800",title:"3小时"},{id:"21600",title:"6小时"},{id:"43200",title:"12小时"},{id:"86400",title:"24小时"}]},5320:function(e,t,i){"use strict";e.exports=function(e){try{var t=new Set,i={size:0,has:function(){return!0},keys:function(){return Object.defineProperty({},"next",{get:function(){return t.clear(),t.add(4),function(){return{done:!0}}}})}},a=t[e](i);return 1===a.size&&4===a.values().next().value}catch(s){return!1}}},5388:function(e,t,i){"use strict";var a=i("c65b");e.exports=function(e,t,i){var s,r,n=i?e:e.iterator,o=e.next;while(!(s=a(o,n)).done)if(r=t(s.value),void 0!==r)return r}},"68df":function(e,t,i){"use strict";var a=i("dc19"),s=i("8e16"),r=i("384f"),n=i("7f65");e.exports=function(e){var t=a(this),i=n(e);return!(s(t)>i.size)&&!1!==r(t,(function(e){if(!i.includes(e))return!1}),!0)}},"72c3":function(e,t,i){"use strict";var a=i("23e7"),s=i("e9bc"),r=i("5320"),n=i("dad2"),o=!n("union")||!r("union");a({target:"Set",proto:!0,real:!0,forced:o},{union:s})},"77ee":function(e,t,i){"use strict";i("cdc9")},"79a4":function(e,t,i){"use strict";var a=i("23e7"),s=i("d039"),r=i("953b"),n=i("dad2"),o=!n("intersection",(function(e){return 2===e.size&&e.has(1)&&e.has(2)}))||s((function(){return"3,2"!==String(Array.from(new Set([1,2,3]).intersection(new Set([3,2]))))}));a({target:"Set",proto:!0,real:!0,forced:o},{intersection:r})},"79dc":function(e,t,i){"use strict";var a=function(){var e=this,t=e._self._c;e._self._setupProxy;return t("div",[t("el-dialog",{attrs:{title:"报警策略详情",visible:e.detail_visible,width:"800px","destroy-on-close":!0,"close-on-click-modal":!1},on:{"update:visible":function(t){e.detail_visible=t},close:e.back}},[t("div",[t("div",{staticClass:"m-bottom10"},[t("span",[e._v("策略名称：")]),t("span",[e._v(e._s(this.rows[0].name))])]),e._l(e.list,(function(i){return t("div",{key:i.id,staticClass:"m-bottom10"},[t("p",{staticClass:"m-bottom10"},[e._v(e._s(i.id))]),t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{data:i.rule_list,"max-height":"350",border:""}},[t("el-table-column",{attrs:{prop:"name",label:"规则名称"}}),t("el-table-column",{attrs:{prop:"desc",label:"规则描述"},scopedSlots:e._u([{key:"default",fn:function(i){return[t("div",e._l(i.row.desc,(function(i){return t("div",{key:i},[e._v(e._s(i))])})),0)]}}],null,!0)}),t("el-table-column",{attrs:{prop:"notie",label:"通知方式"},scopedSlots:e._u([{key:"default",fn:function(i){return e._l(i.row.notice,(function(i,a){return t("div",{key:a},[e._v(e._s(i))])}))}}],null,!0)})],1)],1)})),t("div",{staticClass:"back"},[t("el-button",{on:{click:function(t){return e.back("0")}}},[e._v("返回")])],1)],2)])],1)},s=[],r=(i("14d9"),i("e9f5"),i("910d"),i("7d54"),i("ab43"),i("9ab4")),n=i("1b40"),o=i("4780"),l=i("2966"),c=i("8ce4");let d=class extends n["e"]{constructor(){super(...arguments),this.list=[],this.index_list=[],this.loading=!0,this.event_name=[]}created(){this.getEventList()}async getEventList(){let e=await l["a"].get_event_list({type:"all"});if("Success"===e.code){let t=["event_name_zh","event_id"],i=["title","id"];e.data.map(e=>{this.event_name=[...this.event_name,...e.list]}),this.event_name=Object(c["b"])(this.event_name,i,t),this.get_index_list()}}async get_index_list(){let e=await l["a"].get_index_list({type:"all"});"Success"===e.code&&(e.data&&e.data.forEach(e=>{let t=[];e.metric_infos.forEach(e=>{t.push({value:e.metric,label:e.metric,unit:e.unit,description:e.description})}),this.index_list.push({value:e.name,label:e.name,children:t})}),this.get_list())}get_list(){1===this.rows.length&&this.rows[0].rules.forEach(e=>{const t=[];e.ruleRecords.forEach(e=>{t.push({range:e.metricCondition,num:e.metricValue,cycle_num:e.metricPeriodNum.toString(),alram_type:"event"===e.alarmType?"":e.level.toString(),notice:"event"===e.alarmType?[]:e.alarmMethod,metricUnit:e.metricUnit})});const i={id:e.id,name:e.name,desc:"event"===e.ruleRecords[0].alarmType?[`${this.trans_arr(e.ruleRecords[0].level.toString(),o["a"])} | ${this.trans_arr(e.ruleRecords[0].eventId,this.event_name)}`]:t.map(t=>`${this.getDescription(e.ruleRecords[0].metricID)} ${t.range} ${t.num}${t.metricUnit} ${this.trans_arr(t.alram_type,o["a"])} 持续${t.cycle_num}次就报警`),notice:"event"===e.ruleRecords[0].alarmType?[this.getNotice(e.ruleRecords[0].alarmMethod)]:t.map(e=>this.getNotice(e.notice))},a=this.list.filter(t=>t.id===e.productType);a.length>0?this.list.map(t=>(t.id===e.productType&&(t.rule_list=[...t.rule_list,i]),t)):this.list.push({id:e.productType,name:e.productType,rule_list:[i]})}),this.loading=!1}getDescription(e){let t="";return this.index_list.forEach(i=>{i.children.forEach(i=>{i.value===e&&(t=i.description)})}),t}getNotice(e){const t={email:"邮件",phone:"短信"},i=e.map(e=>t[e]);return i.join(" | ")}trans_arr(e,t){if("string"===typeof e){const i=t.filter(t=>t.id===e);return i[0].title}{let i=[];return t.map(t=>{e.indexOf(t.id)>-1&&i.push(t.title)}),i}}back(e){this.detail_visible=!1}};Object(r["a"])([Object(n["d"])("visible")],d.prototype,"detail_visible",void 0),Object(r["a"])([Object(n["c"])({default:()=>[]})],d.prototype,"rows",void 0),Object(r["a"])([Object(n["b"])("close")],d.prototype,"back",null),d=Object(r["a"])([Object(n["a"])({})],d);var u=d,_=u,h=(i("8b29"),i("2877")),f=Object(h["a"])(_,a,s,!1,null,"1f4562d7",null);t["a"]=f.exports},"7f65":function(e,t,i){"use strict";var a=i("59ed"),s=i("825a"),r=i("c65b"),n=i("5926"),o=i("46c4"),l="Invalid size",c=RangeError,d=TypeError,u=Math.max,_=function(e,t){this.set=e,this.size=u(t,0),this.has=a(e.has),this.keys=a(e.keys)};_.prototype={getIterator:function(){return o(s(r(this.keys,this.set)))},includes:function(e){return r(this.has,this.set,e)}},e.exports=function(e){s(e);var t=+e.size;if(t!==t)throw new d(l);var i=n(t);if(i<0)throw new c(l);return new _(e,i)}},"83b9e":function(e,t,i){"use strict";var a=i("cb27"),s=i("384f"),r=a.Set,n=a.add;e.exports=function(e){var t=new r;return s(e,(function(e){n(t,e)})),t}},"86d6":function(e,t,i){},"8b00":function(e,t,i){"use strict";var a=i("23e7"),s=i("68df"),r=i("dad2"),n=!r("isSubsetOf",(function(e){return e}));a({target:"Set",proto:!0,real:!0,forced:n},{isSubsetOf:s})},"8b29":function(e,t,i){"use strict";i("e07e")},"8e16":function(e,t,i){"use strict";var a=i("7282"),s=i("cb27");e.exports=a(s.proto,"size","get")||function(e){return e.size}},9074:function(e,t,i){"use strict";var a=i("81a9"),s=i("bff7");t["a"]={get_customer_name(e){return Object(a["a"])(Object(s["b"])("POST","/ecs/get_customer_name/",e))},get_region_az_list(e){return Object(a["a"])(Object(s["b"])("POST","/ecs/region_az_info/",e))},get_net_list(e){return Object(a["a"])(Object(s["b"])("POST","/ecs/net_info/",e))},get_all_cpu_ram(){return Object(a["a"])(Object(s["b"])("GET","/ecs/ram_cpu_list/"))},get_category_list(e){return Object(a["a"])(Object(s["b"])("GET","/ecs/ecs_category_list/",e))},ecs_family_info(e){return Object(a["a"])(Object(s["b"])("GET","/ecs/ecs_family_info/",e))},get_os_list(e){return Object(a["a"])(Object(s["b"])("POST","/img/image_info/",e))},get_price(e){return Object(a["a"])(Object(s["b"])("POST","/ecs/get_price/",e))},create_instance(e){return Object(a["a"])(Object(s["b"])("POST","/ecs/create_ecs/",e))},get_ecs_limit(e){return Object(a["a"])(Object(s["b"])("POST","/ecs/get_ecs_limit/",e))},get_ram_cpu_price_list(e){return Object(a["a"])(Object(s["b"])("POST","/ecs/ecs_spec_attach_price/",e))},difference_price(e){return Object(a["a"])(Object(s["b"])("POST","/ecs/ecs_difference_price/",e))},change_configure_limit(e){return Object(a["a"])(Object(s["b"])("POST","/ecs/change_configure_limit/",e))}}},"953b":function(e,t,i){"use strict";var a=i("dc19"),s=i("cb27"),r=i("8e16"),n=i("7f65"),o=i("384f"),l=i("5388"),c=s.Set,d=s.add,u=s.has;e.exports=function(e){var t=a(this),i=n(e),s=new c;return r(t)>i.size?l(i.getIterator(),(function(e){u(t,e)&&d(s,e)})):o(t,(function(e){i.includes(e)&&d(s,e)})),s}},9961:function(e,t,i){"use strict";var a=i("dc19"),s=i("cb27"),r=i("83b9e"),n=i("7f65"),o=i("5388"),l=s.add,c=s.has,d=s.remove;e.exports=function(e){var t=a(this),i=n(e).getIterator(),s=r(t);return o(i,(function(e){c(t,e)?d(s,e):l(s,e)})),s}},a2e0:function(e,t,i){"use strict";i("c17b")},a4e7:function(e,t,i){"use strict";var a=i("23e7"),s=i("395e"),r=i("dad2"),n=!r("isSupersetOf",(function(e){return!e}));a({target:"Set",proto:!0,real:!0,forced:n},{isSupersetOf:s})},a5f7:function(e,t,i){"use strict";var a=i("dc19"),s=i("cb27"),r=i("83b9e"),n=i("8e16"),o=i("7f65"),l=i("384f"),c=i("5388"),d=s.has,u=s.remove;e.exports=function(e){var t=a(this),i=o(e),s=r(t);return n(t)<=i.size?l(t,(function(e){i.includes(e)&&u(s,e)})):c(i.getIterator(),(function(e){d(s,e)&&u(s,e)})),s}},a732:function(e,t,i){"use strict";var a=i("23e7"),s=i("c65b"),r=i("2266"),n=i("59ed"),o=i("825a"),l=i("46c4"),c=i("2a62"),d=i("f99f"),u=d("some",TypeError);a({target:"Iterator",proto:!0,real:!0,forced:u},{some:function(e){o(this);try{n(e)}catch(a){c(this,"throw",a)}if(u)return s(u,this,e);var t=l(this),i=0;return r(t,(function(t,a){if(e(t,i++))return a()}),{IS_RECORD:!0,INTERRUPTED:!0}).stopped}})},b4bc:function(e,t,i){"use strict";var a=i("dc19"),s=i("cb27").has,r=i("8e16"),n=i("7f65"),o=i("384f"),l=i("5388"),c=i("2a62");e.exports=function(e){var t=a(this),i=n(e);if(r(t)<=i.size)return!1!==o(t,(function(e){if(i.includes(e))return!1}),!0);var d=i.getIterator();return!1!==l(d,(function(e){if(s(t,e))return c(d,"normal",!1)}))}},bbad:function(e,t,i){"use strict";i("86d6")},bc94:function(e,t,i){"use strict";i.r(t);var a=function(){var e=this,t=e._self._c;e._self._setupProxy;return t("div",[t("action-block",{attrs:{search_option:e.search},on:{"fn-search":e.fn_search},scopedSlots:e._u([{key:"default",fn:function(){return[t("el-button",{attrs:{type:"primary",disabled:!e.auth_list.includes("alarm_strategy_create")},on:{click:e.create}},[e._v("创建策略")])]},proxy:!0}])}),t("el-table",{ref:"strategy_table",attrs:{data:e.list,border:"","row-class-name":e.rowStyle},on:{"selection-change":e.handleSelectionChange,"row-click":e.FnOperRow,"row-contextmenu":e.FnRightClick}},[t("el-table-column",{attrs:{type:"selection"}}),t("el-table-column",{attrs:{prop:"id",label:"策略名称/ID",width:"400px"},scopedSlots:e._u([{key:"default",fn:function(i){return[t("span",[e._v(e._s(i.row.name)+" / "+e._s(i.row.id))])]}}])}),t("el-table-column",{attrs:{prop:"instances",label:"被应用过的产品"},scopedSlots:e._u([{key:"default",fn:function(i){return[t("div",{staticClass:"used-products"},[i.row.instances&&i.row.instances.length>2?t("span",{staticClass:"app"},[e._v(" "+e._s(i.row.instances?i.row.instances.length>2?`${i.row.instances[0].instance_name};${i.row.instances[1].instance_name};...`:i.row.instances.join(";"):"--"))]):t("span",[e._v(e._s(i.row.instances_name.join(";")))]),i.row.instances?t("i",{staticClass:"el-icon-document",on:{click:function(t){return e.go_detail(i.row)}}}):e._e()])]}}])}),t("el-table-column",{attrs:{prop:"enable",label:"策略状态"},scopedSlots:e._u([{key:"default",fn:function(i){return[t("span",[e._v(e._s(i.row.enable?"已启用":"未启用"))])]}}])}),t("el-table-column",{attrs:{prop:"createTime",label:"创建时间"},scopedSlots:e._u([{key:"default",fn:function(i){return[t("span",[e._v(e._s(i.row.createTime?e.moment(i.row.createTime).format("YYYY-MM-DD HH:mm:ss"):""))])]}}])}),t("el-table-column",{attrs:{prop:"updateTime",label:"修改时间"},scopedSlots:e._u([{key:"default",fn:function(i){return[t("span",[e._v(e._s(i.row.updateTime?e.moment(i.row.updateTime).format("YYYY-MM-DD HH:mm:ss"):""))])]}}])})],1),t("el-pagination",{attrs:{"current-page":e.current,"page-sizes":[2,20,50,100],"page-size":e.size,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}}),e.drawer?[t("ApplyStrategy",{attrs:{drawer:e.drawer,list:e.strategy_rows,enable:e.enable},on:{"update:drawer":function(t){e.drawer=t},close:e.close_apply}})]:e._e(),e.del_visible?[t("common-del",{attrs:{visible:e.del_visible,title:"删除策略",rows:e.strategy_rows},on:{"update:visible":function(t){e.del_visible=t},close:e.close_apply}})]:e._e(),e.detail_visible?[t("apply-detail",{attrs:{visible:e.detail_visible,rows:e.strategy_rows},on:{"update:visible":function(t){e.detail_visible=t},close:e.close_apply}})]:e._e(),e.strategy_detail?[t("Detail",{attrs:{visible:e.strategy_detail,rows:e.strategy_rows},on:{"update:visible":function(t){e.strategy_detail=t},close:e.close_apply}})]:e._e(),t("right-click",{attrs:{multi_rows:e.strategy_rows,menus:e.menus,name:e.strategy_rows.length>0?e.strategy_rows[0].name:""},on:{"fn-click":e.handle}})],2)},s=[],r=(i("14d9"),i("e9f5"),i("d866"),i("7d54"),i("ab43"),i("a732"),i("9ab4")),n=i("1b40"),o=i("c811"),l=i("d179"),c=i("79dc"),d=i("2966"),u=i("7afc"),_=i("e785"),h=i("c1df"),f=i.n(h),m=i("e8c0"),p=i("bd4d"),g=i("cf88");let b=class extends n["e"]{constructor(){super(...arguments),this.search={name:{placeholder:"请输入策略名称"}},this.list=[],this.drawer=!1,this.search_data={},this.current=1,this.size=20,this.total=0,this.moment=f.a,this.del_visible=!1,this.detail_visible=!1,this.strategy_detail=!1,this.strategy_rows=[],this.enable=!0,this.auth_list=[],this.menus=[{label:"修改",value:"edit",single:!0,disabled:!1},{label:"详情",value:"detail",single:!0,disabled:!1},{label:"应用",value:"apply",disabled:!1},{label:"停用",value:"stop",disabled:!1},{label:"删除",value:"delete",disabled:!1}]}created(){this.fn_search(),this.auth_list=this.$store.state.auth_info["alarm_strategy"]}watch_multi(e){e.length>0&&this.handleMenus()}watch_drawer(e){this.clear_info(e)}watch_del_visible(e){this.clear_info(e)}watch_strategy_detail(e){this.clear_info(e)}handleMenus(){this.menus.forEach(e=>{e.disabled=this.judge(e.value),"apply"===e.value&&(e.label=this.strategy_rows.length>=1?"应用":this.strategy_rows[0].enable?"应用详情":"应用")})}judge(e){let t=!1;switch(e){case"edit":case"delete":t=this.strategy_rows.every(e=>e.enable)||!this.auth_list.includes(e);break;case"stop":t=!this.strategy_rows.every(e=>e.enable)||!this.auth_list.includes(e);break;case"detail":case"apply":t=!this.auth_list.includes(e);break;default:return console.warn("Unknown value passed to judge: "+e),!1}return t}handle(e){const{label:t,value:i}=e,a=1===this.strategy_rows.length,s=a?this.strategy_rows[0]:null,r={edit:()=>this.edit(s.id),detail:()=>this.detail(s),apply:()=>this.apply(!0,s),stop:()=>this.apply(!1,s),delete:()=>this.del(s)},n={apply:()=>this.apply(!0,""),stop:()=>this.apply(!1,""),delete:()=>this.del(!1)};a?r[i]&&r[i]():n[i]&&n[i](),Object(g["a"])()}FnOperRow(e){this.$refs.strategy_table.toggleRowSelection(e)}rowStyle({row:e}){const t=this.strategy_rows.some(t=>t.id===e.id);if(t)return"rowStyle"}FnRightClick(e,t,i){const a=this.strategy_rows.some(t=>t.id===e.id);a||this.$refs.strategy_table.toggleRowSelection(e),Object(m["a"])(e,t,i)}clear_info(e){e||(this.strategy_rows=[],this.toggleSelection())}toggleSelection(){const e=this.$refs.strategy_table;e.clearSelection()}fn_search(e={}){this.current=1,this.search_data=e,this.getStrategyList()}async getStrategyList(){const{search_data:{name:e}}=this;let t=await d["a"].get_strategy_list({name:e,page:this.current,pageSize:this.size});"Success"===t.code&&(this.list=t.data.datas||[],this.list.map(e=>(e=Object.assign(e,{instances_name:e.instances.map(e=>e.instance_name)}),e)),this.total=t.data.total||0)}handleSizeChange(e){this.size=e,this.getStrategyList()}handleCurrentChange(e){this.current=e,this.getStrategyList()}handleSelectionChange(e){this.strategy_rows=e}create(){this.$router.push("/alarm_strategy/create")}go_detail(e){this.strategy_rows=[e],this.detail_visible=!0}edit(e){this.$router.push({path:"/alarm_strategy/create",query:{id:e}})}detail(e){this.strategy_rows=[e],this.strategy_detail=!0}del(e){e||0!==this.strategy_rows.length?this.strategy_rows.every(e=>!e.enable)?(e&&(this.strategy_rows=[e]),this.del_visible=!0):this.$message.warning("已启用的策略不能被删除！"):this.$message.warning("请先勾选策略！")}async stop(){const e=[];this.strategy_rows.map(t=>{const{az:i,callbackURL:a,contactGroupIDs:s,customerID:r,customer_name:n,regions:o,silentPeriod:l,effectStartTime:c,effectEndTime:d,enable:u,id:_,name:h}=t;let f={az:i,callbackURL:a,contactGroupIDs:s,customerID:r,customer_name:n,regions:o,silentPeriod:l,effectStartTime:c,effectEndTime:d,enable:!u,id:_,name:h};return e.push(f),t});let t=await d["a"].apply_strategy({data:e});"Success"===t.code&&(this.$message.warning("停用策略任务下发成功！"),this.strategy_rows=[],this.getStrategyList())}apply(e,t){if(t&&(this.strategy_rows=[t]),t||0!==this.strategy_rows.length)if(t||this.strategy_rows.every(t=>t.enable===!e))if(e)this.drawer=!0,this.enable=e;else{const e=this.strategy_rows.map(e=>e.name),t=this.$createElement;this.$msgbox({title:"提示",message:t("p",null,[t("span",null,"确定停用 "),t("i",{style:"color: #455cc6"},""+e.join(",")),t("span",null,"  这些策略吗, 是否继续?")]),showCancelButton:!0,confirmButtonText:"确定",cancelButtonText:"取消",iconClass:"el-icon-warning"}).then(()=>{this.stop()}).catch(()=>{this.$message({type:"info",message:"已取消停用"}),this.strategy_rows=[],this.toggleSelection()})}else this.$message.warning(`只允许对${e?"未应用":"已应用"}的策略执行批量操作！`);else this.$message.warning("请先勾选策略！")}close_apply(e){this.strategy_rows=[],"1"===e&&this.getStrategyList()}};Object(r["a"])([Object(n["f"])("strategy_rows",{immediate:!0,deep:!0})],b.prototype,"watch_multi",null),Object(r["a"])([Object(n["f"])("drawer")],b.prototype,"watch_drawer",null),Object(r["a"])([Object(n["f"])("del_visible")],b.prototype,"watch_del_visible",null),Object(r["a"])([Object(n["f"])("strategy_detail")],b.prototype,"watch_strategy_detail",null),b=Object(r["a"])([Object(n["a"])({components:{RightClick:p["a"],ActionBlock:o["a"],ApplyStrategy:l["a"],CommonDel:u["a"],ApplyDetail:_["a"],Detail:c["a"]}})],b);var v=b,y=v,w=(i("2cfd"),i("2877")),z=Object(w["a"])(y,a,s,!1,null,"054d0329",null);t["default"]=z.exports},c17b:function(e,t,i){},c1a1:function(e,t,i){"use strict";var a=i("23e7"),s=i("b4bc"),r=i("dad2"),n=!r("isDisjointFrom",(function(e){return!e}));a({target:"Set",proto:!0,real:!0,forced:n},{isDisjointFrom:s})},c96d:function(e,t,i){},cb27:function(e,t,i){"use strict";var a=i("e330"),s=Set.prototype;e.exports={Set:Set,add:a(s.add),has:a(s.has),remove:a(s["delete"]),proto:s}},cdc9:function(e,t,i){},d179:function(e,t,i){"use strict";var a=function(){var e=this,t=e._self._c;e._self._setupProxy;return t("el-drawer",{attrs:{title:"应用策略",visible:e.drawer_sync,wrapperClosable:!1,size:"40%"},on:{"update:visible":function(t){e.drawer_sync=t}}},[t("div",{staticClass:"drawer"},[t("el-form",{ref:"form",staticClass:"demo-dynamic",attrs:{model:e.form_data,"label-width":"150px"}},[t("el-form-item",{attrs:{prop:"customer_id",label:"客户ID",rules:[{required:!1,trigger:"blur",validator:e.validate_customer}]}},[t("el-input",{model:{value:e.form_data.customer_id,callback:function(t){e.$set(e.form_data,"customer_id",t)},expression:"form_data.customer_id"}})],1),t("el-form-item",{attrs:{prop:"customer_name",label:"客户名称"}},[t("div",[e._v(e._s(e.form_data.customer_name))])]),t("Region",{attrs:{region_id:e.region_az_id,customerId:e.form_data.customer_id,customerName:e.form_data.customer_name},on:{get_area_id:e.get_area_id}}),t("el-form-item",{attrs:{prop:"cycle",label:"通道沉默周期:"}},[t("span",{attrs:{slot:"label"},slot:"label"},[t("span",[e._v("通道沉默周期:")]),t("el-tooltip",{attrs:{placement:"bottom",effect:"light",content:"报警发生后未恢复正常，间隔多久重复发送一次报警通知"}},[t("i",{staticClass:"el-icon-question"})])],1),t("el-select",{attrs:{placeholder:"请选择通道沉默周期"},model:{value:e.form_data.cycle,callback:function(t){e.$set(e.form_data,"cycle",t)},expression:"form_data.cycle"}},e._l(e.cycle_list,(function(e){return t("el-option",{key:e.id,attrs:{label:e.title,value:e.id}})})),1)],1),t("el-form-item",{attrs:{prop:"time",label:"生效时间:"}},[t("div",{staticClass:"time"},[t("el-time-select",{attrs:{clearable:!1,editable:!1,"picker-options":{format:"HH:mm",start:"00:00",step:"01:00",end:"23:00"},placeholder:"开始时间"},model:{value:e.form_data.start_time,callback:function(t){e.$set(e.form_data,"start_time",t)},expression:"form_data.start_time"}}),e._v(" 至  "),t("el-time-select",{attrs:{clearable:!1,editable:!1,"picker-options":{format:"HH:mm",start:"00:59",step:"01:00",end:"23:59"},placeholder:"结束时间"},model:{value:e.form_data.end_time,callback:function(t){e.$set(e.form_data,"end_time",t)},expression:"form_data.end_time"}})],1)]),t("el-form-item",{attrs:{prop:"address",label:"报警回调:"}},[t("el-input",{attrs:{placeholder:"请输入报警回调地址"},model:{value:e.form_data.address,callback:function(t){e.$set(e.form_data,"address",t)},expression:"form_data.address"}})],1),t("el-form-item",{attrs:{prop:"notice_user",label:"通知对象:",rules:[{required:!0,message:"请选择通知对象",trigger:"blur"}]}},[t("div",{staticClass:"notice-user"},[t("el-select",{attrs:{multiple:"","multiple-limit":"7",placeholder:"请选择通知对象",filterable:"","filter-method":e.getContactGroupList,"popper-class":"noticer","collapse-tags":""},on:{"visible-change":e.changeGroup},model:{value:e.form_data.notice_user,callback:function(t){e.$set(e.form_data,"notice_user",t)},expression:"form_data.notice_user"}},e._l(e.contact_group_list,(function(e){return t("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1)])],1),t("div",{staticClass:"foot-btn"},[this.list[0].enable?e._e():t("el-button",{attrs:{type:"primary"},on:{click:e.confirm}},[e._v("确认应用")]),t("el-button",{on:{click:function(t){return e.close("0")}}},[e._v(e._s(this.list[0].enable?"返回":"取消"))])],1)],1)])},s=[],r=(i("d9e2"),i("14d9"),i("e9f5"),i("ab43"),i("9ab4")),n=i("1b40"),o=i("9074"),l=i("2966"),c=function(){var e=this,t=e._self._c;e._self._setupProxy;return t("div",{staticClass:"apply"},[t("el-form",{ref:"form",staticClass:"demo-dynamic",attrs:{model:e.form_data,"label-width":"150px"}},[t("el-form-item",{attrs:{prop:"regions",label:"地域："}},[t("el-popover",{attrs:{placement:"bottom",width:"400",trigger:"click","popper-class":"popper"},model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}},[t("div",[e.area_list.length>0?t("el-checkbox",{attrs:{indeterminate:e.isIndeterminate},on:{change:function(t){return e.handleCheckAllChange(t,"area_list")}},model:{value:e.checkAll,callback:function(t){e.checkAll=t},expression:"checkAll"}},[e._v("全选")]):e._e(),e._l(e.area_list,(function(i){return t("div",{key:i.region_group_id},[t("el-divider",{staticClass:"divider",attrs:{"content-position":"left"}},[e._v(e._s(i.region_group_name))]),t("el-checkbox",{staticClass:"group-all",attrs:{indeterminate:i.isIndeterminate_group},on:{change:function(t){return e.handleCheckGroupChange(t,i.region_group_id,"area_list")}},model:{value:i.check,callback:function(t){e.$set(i,"check",t)},expression:"item.check"}},[e._v("全选")]),t("el-checkbox-group",{staticClass:"group",model:{value:e.form_data.regions,callback:function(t){e.$set(e.form_data,"regions",t)},expression:"form_data.regions"}},e._l(i.region_list,(function(i){return t("el-checkbox",{key:i.region_id,attrs:{label:i.region_id}},[e._v(e._s(i.region_name))])})),1)],1)})),0===e.area_list.length?t("div",{staticClass:"no-data"},[e._v("暂无数据")]):e._e()],2),t("el-select",{ref:"region-select",staticClass:"region",attrs:{slot:"reference",multiple:"","allow-create":"","popper-class":"select-area"},slot:"reference",model:{value:e.sel_region,callback:function(t){e.sel_region=t},expression:"sel_region"}})],1)],1),t("el-form-item",{attrs:{prop:"az",label:"可用区:"}},[t("el-popover",{attrs:{placement:"bottom",width:"400",trigger:"click","popper-class":"popper"},model:{value:e.az_visible,callback:function(t){e.az_visible=t},expression:"az_visible"}},[t("div",[e.az_list.length>0?t("el-checkbox",{attrs:{indeterminate:e.az_isIndeterminate},on:{change:function(t){return e.handleCheckAllChange(t,"az_list")}},model:{value:e.az_checkAll,callback:function(t){e.az_checkAll=t},expression:"az_checkAll"}},[e._v("全选")]):e._e(),e._l(e.az_list,(function(i){return t("div",{key:i.region_group_id},[t("el-divider",{staticClass:"divider",attrs:{"content-position":"left"}},[e._v(e._s(i.region_group_name))]),t("el-checkbox",{staticClass:"group-all",attrs:{indeterminate:i.isIndeterminate_group},on:{change:function(t){return e.handleCheckGroupChange(t,i.region_group_id,"az_list")}},model:{value:i.check,callback:function(t){e.$set(i,"check",t)},expression:"item.check"}},[e._v("全选")]),t("el-checkbox-group",{staticClass:"group",model:{value:e.form_data.az,callback:function(t){e.$set(e.form_data,"az",t)},expression:"form_data.az"}},e._l(i.region_list,(function(i){return t("el-checkbox",{key:i.region_id,attrs:{label:i.region_id}},[e._v(e._s(i.region_name))])})),1)],1)})),0===e.az_list.length?t("div",{staticClass:"no-data"},[e._v("暂无数据")]):e._e()],2),t("el-select",{ref:"region-select",staticClass:"region",attrs:{slot:"reference",multiple:"","allow-create":"","popper-class":"select-area"},slot:"reference",model:{value:e.sel_az,callback:function(t){e.sel_az=t},expression:"sel_az"}})],1)],1)],1)],1)},d=[],u=(i("d866"),i("910d"),i("1e70"),i("79a4"),i("c1a1"),i("8b00"),i("a4e7"),i("1e5a"),i("72c3"),i("8ce4"));let _=class extends n["e"]{constructor(){super(...arguments),this.visible=!1,this.az_visible=!1,this.sel_region=[],this.sel_az=[],this.area_list=[],this.az_list=[],this.checkAll=!1,this.isIndeterminate=!1,this.az_checkAll=!1,this.az_isIndeterminate=!1,this.form_data=this.region_id}created(){this.FnGetRegionAz()}async FnGetRegionAz(){let e=await o["a"].get_region_az_list({customer_id:this.customerId});"Success"===e.code&&(this.area_list=e.data.map(e=>(e=Object.assign(e,{},{check:!1,isIndeterminate_group:!1}),e)),this.watch_regions(this.form_data.regions))}setRegionCheckState(e,t){let i=[];e.map(e=>{let a=[];e.region_list.map(e=>{this.form_data[t].includes(e.region_id)&&(a.push(e.region_id),"regions"===t&&i.push({region_group_id:e.region_id,region_group_name:e.region_name,region_list:Object(u["e"])(e.az_list,"az_name","az_id","region_name","region_id"),check:!1,isIndeterminate_group:!1}))});let s=a.length===e.region_list.length,r=0!==a.length&&a.length!==e.region_list.length;e.check=s,e.isIndeterminate_group=r}),"regions"===t&&(this.az_list=i);let a="az"===t?"az_checkAll":"checkAll",s="az"===t?"az_isIndeterminate":"isIndeterminate";this.judge(e,s,a)}watch_customerName(e){e.length>0&&this.FnGetRegionAz()}watch_az_len(e,t){this.watch_az(this.form_data.az)}watch_regions(e){0===e.length&&(this.form_data.az=[]),this.setRegionCheckState(this.area_list,"regions"),this.sel_region=this.trans(this.area_list,"regions"),this.get_area_id("region")}watch_az(e){this.setRegionCheckState(this.az_list,"az"),this.sel_az=this.trans(this.az_list,"az"),this.get_area_id("az")}judge(e,t,i){e.every(e=>e.check)?(this[t]=!1,this[i]=!0):e.every(e=>!e.isIndeterminate_group&&!e.check)?(this[t]=!1,this[i]=!1):(this[t]=!0,this[i]=!1)}get_area_id(e){let t=[];if(this.area_list.map(e=>{e.region_list.map(e=>{e.az_list.map(e=>{t.push(e.az_id)})})}),this.area_list.every(e=>!e.check&&!e.isIndeterminate_group))return{regions:this.getAllIds("area_list"),az:t};{let e=[];return this.area_list.map(t=>{t.region_list.map(t=>{if(this.form_data.regions.includes(t.region_id)){let i=t.az_list.map(e=>e.az_id),a=this.form_data.az.filter(e=>i.includes(e));e=0===a.length?[...e,...i]:[...e,...a]}})}),{regions:this.form_data.regions,az:e}}}getAllIds(e){let t=[];return this[e].map(e=>{e.region_list.map(e=>{t.push(e.region_id)})}),t}handleCheckAllChange(e,t){let i="az_list"===t?"az":"regions";this.form_data[i]=e?this.getAllIds(t):[]}handleCheckGroupChange(e,t,i){let a="az_list"===i?"az":"regions";this[i].map(i=>{if(i.region_group_id===t){let t=i.region_list.map(e=>e.region_id);this.form_data[a]=e?[...new Set([...this.form_data[a],...t])]:this.form_data[a].filter(e=>!t.includes(e))}})}trans(e,t){let i=[];return e.map(e=>{e.region_list.map(e=>{this.form_data[t].includes(e.region_id)&&i.push(e.region_name)})}),i}};Object(r["a"])([Object(n["c"])({default:()=>{}})],_.prototype,"region_id",void 0),Object(r["a"])([Object(n["c"])(String)],_.prototype,"customerId",void 0),Object(r["a"])([Object(n["c"])(String)],_.prototype,"customerName",void 0),Object(r["a"])([Object(n["f"])("customerName")],_.prototype,"watch_customerName",null),Object(r["a"])([Object(n["f"])("az_list.length")],_.prototype,"watch_az_len",null),Object(r["a"])([Object(n["f"])("form_data.regions")],_.prototype,"watch_regions",null),Object(r["a"])([Object(n["f"])("form_data.az")],_.prototype,"watch_az",null),Object(r["a"])([Object(n["b"])("get_area_id")],_.prototype,"get_area_id",null),_=Object(r["a"])([Object(n["a"])({})],_);var h=_,f=h,m=(i("dd19"),i("f8bf"),i("2877")),p=Object(m["a"])(f,c,d,!1,null,"d711fb06",null),g=p.exports,b=i("4780");let v=class extends n["e"]{constructor(){super(...arguments),this.form_data=1===this.list.length?{customer_id:this.list[0].customerID.length>6?this.list[0].customerID:"",customer_name:this.list[0].customer_name,area:this.list[0].regions?this.list[0].regions:[],az:this.list[0].az?this.list[0].az:[],cycle:0===this.list[0].silentPeriod?"86400":this.list[0].silentPeriod.toString(),address:this.list[0].callbackURL,start_time:""===this.list[0].effectStartTime?"00:00":this.list[0].effectStartTime,end_time:""===this.list[0].effectEndTime?"23:59":this.list[0].effectEndTime,notice_user:this.list[0].contactGroupIDs?this.list[0].contactGroupIDs:[]}:{customer_id:"",customer_name:"",area:[],az:[],cycle:"86400",address:"",start_time:"00:00",end_time:"23:59",notice_user:[]},this.area_list=[],this.az_list=[],this.contact_group_list=[],this.cycle_list=b["c"],this.region_az_id={regions:this.form_data.area,az:this.form_data.az},this.validate_customer=(e,t,i)=>t.length>6||0===t.length?i():i(new Error("请输入正确的客户ID"))}created(){this.getContactGroupList("")}valid(e){this.$nextTick(()=>{const t=this.$refs[e];t&&t.validate(async e=>{})})}changeGroup(e){e||this.getContactGroupList("")}async getContactGroupList(e=""){let t=await l["a"].get_contact_group_list({name:e});"Success"===t.code&&(this.contact_group_list=t.data.datas)}watch_customer_id(e){const t=this.$refs.form;t&&t.validateField(["customer_id"],t=>{t||""===e?this.form_data.customer_name="":this.get_customer_name()})}watch_notice_user(e){this.valid("form")}async get_customer_name(){const e=await o["a"].get_customer_name({customer_id:this.form_data.customer_id});"Success"==e.code&&(this.form_data={...this.form_data,customer_name:e.data.customer_name})}async get_area_list(){const e=await o["a"].get_region_az_list({customer_id:this.form_data.customer_id});"Success"==e.code&&(this.area_list=e.data)}get_area_id(e){this.form_data.area=e.regions,this.form_data.az=e.az}Watch_az_list(e,t){0===e&&t>0&&(this.region_az_id={regions:[],az:[]})}get_all_ids(e){let t=[];return e.map(e=>{e.region_list.map(e=>{t.push(e.region_id)})}),t}get_all_az_id(){let e=[];return this.area_list.map(t=>{t.region_list.map(t=>{t.az_list.map(t=>e.push(t.az_id))})}),e}confirm(){const{customer_id:e,area:t,az:i,cycle:a,address:s,start_time:r,end_time:n,notice_user:o,customer_name:c}=this.form_data,d=this.$refs.form;d.validate(async d=>{if(d){const d=[];this.list.map(l=>{let u={az:0===t.length?this.get_all_az_id():0===i.length?this.get_all_ids(this.az_list):i,callbackURL:s,contactGroupIDs:o,customerID:e,customerName:c,regions:0===t.length?this.get_all_ids(this.area_list):t,silentPeriod:parseInt(a),effectStartTime:r,effectEndTime:n,enable:this.enable,id:l.id,name:l.name};return d.push(u),l});let u=await l["a"].apply_strategy({data:d});"Success"===u.code&&(this.$message.success("应用策略任务下发成功！"),this.close("1"))}})}close(e){this.drawer_sync=!1}};Object(r["a"])([Object(n["d"])("drawer")],v.prototype,"drawer_sync",void 0),Object(r["a"])([Object(n["c"])({default:()=>{}})],v.prototype,"list",void 0),Object(r["a"])([Object(n["c"])(Boolean)],v.prototype,"enable",void 0),Object(r["a"])([Object(n["f"])("form_data.customer_id")],v.prototype,"watch_customer_id",null),Object(r["a"])([Object(n["f"])("form_data.notice_user")],v.prototype,"watch_notice_user",null),Object(r["a"])([Object(n["f"])("az_list.length",{immediate:!0})],v.prototype,"Watch_az_list",null),Object(r["a"])([Object(n["b"])("close")],v.prototype,"close",null),v=Object(r["a"])([Object(n["a"])({components:{Region:g}})],v);var y=v,w=y,z=(i("a2e0"),i("bbad"),Object(m["a"])(w,a,s,!1,null,null,null));t["a"]=z.exports},d51b:function(e,t,i){},d866:function(e,t,i){"use strict";var a=i("23e7"),s=i("c65b"),r=i("2266"),n=i("59ed"),o=i("825a"),l=i("46c4"),c=i("2a62"),d=i("f99f"),u=d("every",TypeError);a({target:"Iterator",proto:!0,real:!0,forced:u},{every:function(e){o(this);try{n(e)}catch(a){c(this,"throw",a)}if(u)return s(u,this,e);var t=l(this),i=0;return!r(t,(function(t,a){if(!e(t,i++))return a()}),{IS_RECORD:!0,INTERRUPTED:!0}).stopped}})},dad2:function(e,t,i){"use strict";var a=i("d066"),s=function(e){return{size:e,has:function(){return!1},keys:function(){return{next:function(){return{done:!0}}}}}},r=function(e){return{size:e,has:function(){return!0},keys:function(){throw new Error("e")}}};e.exports=function(e,t){var i=a("Set");try{(new i)[e](s(0));try{return(new i)[e](s(-1)),!1}catch(o){if(!t)return!0;try{return(new i)[e](r(-1/0)),!1}catch(l){var n=new i;return n.add(1),n.add(2),t(n[e](r(1/0)))}}}catch(l){return!1}}},dc19:function(e,t,i){"use strict";var a=i("cb27").has;e.exports=function(e){return a(e),e}},dd19:function(e,t,i){"use strict";i("d51b")},e07e:function(e,t,i){},e785:function(e,t,i){"use strict";var a=function(){var e=this,t=e._self._c;e._self._setupProxy;return t("el-dialog",{attrs:{title:"应用产品详情",visible:e.detail_visible,width:"600px","custom-class":"del","destroy-on-close":!0,"close-on-click-modal":!1},on:{"update:visible":function(t){e.detail_visible=t},close:e.cancel}},[t("el-table",{attrs:{data:e.list,border:""}},[t("el-table-column",{attrs:{prop:"name",label:"应用产品"}}),t("el-table-column",{attrs:{prop:"az",label:"应用地域及可用区"},scopedSlots:e._u([{key:"default",fn:function(i){return e._l(i.row.az,(function(i,a){return t("span",{key:a},[e._v(e._s(a)+e._s(e.get_az_len(a)===i.length?";":"-可用区"+i.join("、")))])}))}}])})],1)],1)},s=[],r=(i("14d9"),i("e9f5"),i("7d54"),i("ab43"),i("9ab4")),n=i("1b40"),o=i("9074");let l=class extends n["e"]{constructor(){super(...arguments),this.current=1,this.size=10,this.total=0,this.list=[],this.region_az_list=[]}created(){this.get_region_az()}async get_region_az(){let e=await o["a"].get_region_az_list({});if("Success"===e.code){this.region_az_list=e.data;const t=this.get_all_az();this.rows[0].instances.map(e=>{this.list.push({name:e.instance_name,az:t})})}}get_all_az(){let e={};return this.region_az_list.forEach(t=>{t.region_list.forEach(t=>{t.az_list.forEach(i=>{this.rows[0].az&&this.rows[0].az.includes(i.az_id)&&(e[t.region_name]=e[t.region_name]?[...e[t.region_name],i.az_name]:[i.az_name])})})}),e}get_az_len(e){let t=0;return this.region_az_list.forEach(i=>{i.region_list.forEach(i=>{i.region_name===e&&(t=i.az_list.length)})}),t}cancel(e){this.detail_visible=!1}};Object(r["a"])([Object(n["d"])("visible")],l.prototype,"detail_visible",void 0),Object(r["a"])([Object(n["c"])({default:()=>[]})],l.prototype,"rows",void 0),Object(r["a"])([Object(n["b"])("close")],l.prototype,"cancel",null),l=Object(r["a"])([Object(n["a"])({})],l);var c=l,d=c,u=(i("77ee"),i("1496"),i("2877")),_=Object(u["a"])(d,a,s,!1,null,"b469770a",null);t["a"]=_.exports},e8c0:function(e,t,i){"use strict";i.d(t,"a",(function(){return s}));var a=i("cf88");function s(e,t,i){i.preventDefault(),document.addEventListener("contextmenu",e=>{const t=e.target;if(t.closest(".el-table")){let t=document.querySelector("#menu");if(t){t.style.display="block";let i=t.offsetHeight,s=t.offsetWidth;console.log("menuHeight",i);let r=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,n=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,o=e.clientX,l=e.clientY,c=o,d=l;n<o+s&&(c=o-s),r<l+i&&(d=r-i),t.style.left=c-250+"px",t.style.top=d-50+"px",t.style.display="block",t.style.zIndex="1000",document.addEventListener("click",a["a"])}}}),document.addEventListener("contextmenu",a["a"])}},e9bc:function(e,t,i){"use strict";var a=i("dc19"),s=i("cb27").add,r=i("83b9e"),n=i("7f65"),o=i("5388");e.exports=function(e){var t=a(this),i=n(e).getIterator(),l=r(t);return o(i,(function(e){s(l,e)})),l}},f309:function(e,t,i){},f8bf:function(e,t,i){"use strict";i("3a50")}}]);
//# sourceMappingURL=chunk-48642742.1763535500878.js.map