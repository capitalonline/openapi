(window["webpackJsonp_AppSp"]=window["webpackJsonp_AppSp"]||[]).push([["chunk-0c4e56d2"],{1915:function(t,e,n){"use strict";n("debb")},"1a69":function(t,e,n){},"854c":function(t,e,n){"use strict";n("1a69")},c4f5:function(t,e,n){"use strict";n.r(e);var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("el-tabs",{on:{"tab-click":t.handleClick},model:{value:t.activeName,callback:function(e){t.activeName=e},expression:"activeName"}},[n("el-tab-pane",{attrs:{label:"报警联系人",name:"0"}}),n("el-tab-pane",{attrs:{label:"报警联系组",name:"1"}})],1),n("div",["1"===t.activeName?[n("GroupList")]:[n("List")]],2)],1)},i=[],s=n("d4ec"),c=n("bee2"),r=n("262e"),o=n("2caf"),l=n("9ab4"),u=n("1b40"),h=n("c811"),d=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("action-block",{attrs:{search_option:t.search},on:{"fn-search":t.fn_search},scopedSlots:t._u([{key:"default",fn:function(){return[n("el-button",{attrs:{type:"primary",disabled:!t.auth_list.includes("add_contact")},on:{click:t.add}},[t._v("新建联系人")])]},proxy:!0}])}),n("el-table",{ref:"contact_list",staticClass:"event-table",attrs:{data:t.list,border:"","row-class-name":t.rowStyle},on:{"selection-change":t.handleSelectionChange,"row-click":t.FnOperRow,"row-contextmenu":t.FnRightClick}},[n("el-table-column",{attrs:{type:"selection"}}),n("el-table-column",{attrs:{prop:"name",label:"姓名"}}),n("el-table-column",{attrs:{prop:"email",label:"邮箱"}}),n("el-table-column",{attrs:{prop:"phone",label:"电话号码"}}),n("el-table-column",{attrs:{prop:"groupName",label:"所属报警组"}})],1),n("el-pagination",{attrs:{"current-page":t.current,"page-sizes":[2,20,50,100],"page-size":t.size,layout:"total, sizes, prev, pager, next, jumper",total:t.total},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}}),t.user_visible?[n("AddContact",{attrs:{title:t.user_title,id:t.user_id,visible:t.user_visible},on:{close:t.close}})]:t._e(),t.group_visible?[n("AddToGroup",{attrs:{visible:t.group_visible,contact_rows:t.contact_rows},on:{close:t.close}})]:t._e(),t.del_visible?[n("common-dialog",{attrs:{visible:t.del_visible,title:"删除联系人",contact_rows:t.contact_rows},on:{"update:visible":function(e){t.del_visible=e},close:t.close}})]:t._e(),n("right-click",{attrs:{multi_rows:t.contact_rows,menus:t.menus,name:t.contact_rows.length>0?t.contact_rows[0].name:""},on:{"fn-click":t.handle}})],2)},p=[],_=n("ade3"),g=n("1da1"),b=(n("96cf"),n("ac1f"),n("841c"),n("d3b7"),n("d81d"),n("b0c0"),n("a15b"),n("b64b"),n("da87")),f=n("dfe3"),v=n("2966"),m=n("d085"),y=n("e8c0"),k=n("bd4d"),w=n("cf88"),C=function(t){Object(r["a"])(n,t);var e=Object(o["a"])(n);function n(){var t;return Object(s["a"])(this,n),t=e.apply(this,arguments),t.type_list=[{type:"name",label:"姓名"},{type:"email",label:"邮箱"},{type:"phone",label:"电话号码"}],t.search={type:{placeholder:"请输入后查询",list:t.type_list,type:"composite",width:340}},t.list=[],t.current=1,t.size=20,t.total=0,t.user_visible=!1,t.user_id="",t.user_title="新建联系人",t.group_visible=!1,t.del_visible=!1,t.contact_rows=[],t.search_data={},t.auth_list=[],t.menus=[{label:"编辑",value:"edit_contact",single:!0,disabled:!1},{label:"删除联系人",value:"delete_contact",disabled:!1},{label:"添加至报警联系组",value:"add_to_group",disabled:!1}],t}return Object(c["a"])(n,[{key:"created",value:function(){this.fn_search(),this.auth_list=this.$store.state.auth_info["alarm_contact"]}},{key:"FnOperRow",value:function(t){this.$refs.contact_list.toggleRowSelection(t)}},{key:"rowStyle",value:function(t){var e=t.row,n=this.contact_rows.some((function(t){return t.id===e.id}));if(n)return"rowStyle"}},{key:"FnRightClick",value:function(t,e,n){var a=this.contact_rows.some((function(e){return e.id===t.id}));a||this.$refs.contact_list.toggleRowSelection(t),Object(y["a"])(t,e,n)}},{key:"handle",value:function(t){t.label;var e=t.value;"edit_contact"===e?this.edit(this.contact_rows[0].id):"delete_contact"===e?this.contact_rows.length>=1?this.del({}):this.del(this.contact_rows[0]):this.addToWarnGroup(),Object(w["a"])()}},{key:"fn_search",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.current=1,this.search_data=t,this.getContactList()}},{key:"getContactList",value:function(){var t=Object(g["a"])(regeneratorRuntime.mark((function t(){var e;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,v["a"].get_contact_list(Object(_["a"])({page:this.current,pageSize:this.size},this.search_data.typesub?this.search_data.typesub:"name",this.search_data.type));case 2:e=t.sent,"Success"===e.code&&(this.list=e.data.datas,this.list.map((function(t){var e=t.groups.map((function(t){return t.name}));return t.groupName=e.join(","),t})),this.total=e.data.total||0);case 4:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"handleSizeChange",value:function(t){this.size=t,this.getContactList()}},{key:"handleCurrentChange",value:function(t){this.current=t,this.getContactList()}},{key:"handleSelectionChange",value:function(t){this.contact_rows=t}},{key:"add",value:function(){this.user_title="新建联系人",this.user_visible=!0}},{key:"edit",value:function(){var t=Object(g["a"])(regeneratorRuntime.mark((function t(e){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:this.user_id=e,this.user_title="编辑联系人",this.user_visible=!0;case 3:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}()},{key:"del",value:function(t){Object.keys(t).length>0&&(this.contact_rows=[t]),0!==this.contact_rows.length?this.del_visible=!0:this.$message.warning("请勾选联系人！")}},{key:"close",value:function(t){this.user_visible=!1,this.group_visible=!1,this.del_visible=!1,this.contact_rows=[],this.user_id="","1"===t&&this.getContactList();var e=this.$refs.contact_list;e.clearSelection()}},{key:"addToWarnGroup",value:function(){0!==this.contact_rows.length?this.group_visible=!0:this.$message.warning("请先勾选联系人！")}}]),n}(u["e"]);C=Object(l["a"])([Object(u["a"])({components:{RightClick:k["a"],ActionBlock:h["a"],AddContact:b["a"],AddToGroup:f["a"],CommonDialog:m["a"]}})],C);var x=C,j=x,O=n("2877"),S=Object(O["a"])(j,d,p,!1,null,null,null),z=S.exports,L=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("action-block",{attrs:{search_option:t.search},on:{"fn-search":t.fn_search},scopedSlots:t._u([{key:"default",fn:function(){return[n("el-button",{attrs:{type:"primary",disabled:!t.auth_list.includes("add_contact_group")},on:{click:t.add}},[t._v("新建联系人组")]),n("el-button",{attrs:{type:"primary",disabled:!t.auth_list.includes("delete_contact_group")},on:{click:t.del}},[t._v("删除联系人组")])]},proxy:!0}])}),n("el-collapse",{staticClass:"contact-group-box",attrs:{accordion:""}},t._l(t.group_list,(function(e){return n("el-collapse-item",{key:e.id},[n("template",{slot:"title"},[n("div",{staticClass:"collapse-header"},[n("el-checkbox",{on:{change:function(n){return t.sel_users(e.id,n)}},model:{value:e.check,callback:function(n){t.$set(e,"check",n)},expression:"item.check"}},[t._v(" "+t._s(e.name)+" ")]),n("el-button",{staticClass:"edit",attrs:{type:"text",disabled:!t.auth_list.includes("edit_contact_group")},on:{click:function(n){return n.stopPropagation(),t.edit(e.id)}}},[t._v(" 编辑 ")])],1)]),n("div",{staticClass:"table-box"},[n("el-table",{staticClass:"event-table",attrs:{data:e.members,border:"","max-height":"396"}},[n("el-table-column",{attrs:{prop:"name",label:"姓名"}}),n("el-table-column",{attrs:{prop:"email",label:"邮箱"}}),n("el-table-column",{attrs:{prop:"phone",label:"电话号码"}}),n("el-table-column",{attrs:{prop:"groups",label:"所属报警组"},scopedSlots:t._u([{key:"default",fn:function(e){return t._l(e.row.groups,(function(a,i){return n("span",{key:a.id},[t._v(" "+t._s(i===e.row.groups.length-1?a.name:a.name+",")+" ")])}))}}],null,!0)}),n("el-table-column",{attrs:{label:"操作"},scopedSlots:t._u([{key:"default",fn:function(a){return[n("el-button",{attrs:{type:"text",disabled:!t.auth_list.includes("remove_contact")},on:{click:function(n){return t.remove(a.row.id,e.id,e.name)}}},[t._v(" 移除 ")])]}}],null,!0)})],1)],1)],2)})),1),n("el-pagination",{attrs:{"current-page":t.current,"page-sizes":[2,20,50,100],"page-size":t.size,layout:"total, sizes, prev, pager, next, jumper",total:t.total},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}}),t.group_visible?[n("AddGroup",{attrs:{title:t.group_title,id:t.group_id,visible:t.group_visible},on:{"update:visible":function(e){t.group_visible=e},close:t.close_group}})]:t._e()],2)},R=[],$=(n("4de4"),n("6aac")),G=n("7afc"),A=function(t){Object(r["a"])(n,t);var e=Object(o["a"])(n);function n(){var t;return Object(s["a"])(this,n),t=e.apply(this,arguments),t.search={name:{placeholder:"请输入组名后查询"}},t.search_data={},t.list=[],t.current=1,t.size=20,t.total=0,t.group_list=[],t.group_title="新建联系人组",t.group_visible=!1,t.del_visible=!1,t.group_id="",t.group_rows=[],t.auth_list=[],t}return Object(c["a"])(n,[{key:"created",value:function(){this.fn_search(),this.auth_list=this.$store.state.auth_info["alarm_contact"]}},{key:"fn_search",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.search_data=t,this.current=1,this.getContactGroupList()}},{key:"getContactGroupList",value:function(){var t=Object(g["a"])(regeneratorRuntime.mark((function t(){var e;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,v["a"].get_contact_group_list({name:this.search_data.name,page:this.current,pageSize:this.size});case 2:e=t.sent,"Success"===e.code&&(this.group_list=e.data.datas.map((function(t){return t=Object.assign({},t,{check:!1}),t})),this.total=e.data.total||0);case 4:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"handleSizeChange",value:function(t){this.size=t,this.getContactGroupList()}},{key:"handleCurrentChange",value:function(t){this.current=t,this.getContactGroupList()}},{key:"handleSelectionChange",value:function(t){this.group_rows=t}},{key:"remove",value:function(){var t=Object(g["a"])(regeneratorRuntime.mark((function t(e,n,a){var i,s=this;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:i=this.group_list.filter((function(t){return t.id===n}))[0].members,this.$confirm("确定将此用户从".concat(a,"中移去吗， 是否继续?"),"联系人移除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(Object(g["a"])(regeneratorRuntime.mark((function t(){var c;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,v["a"].update_contact_group({id:n,name:a,contactIDs:i.map((function(t){if(t.id!==e)return t.id}))});case 2:c=t.sent,"Success"===c.code&&(s.$message.success("移除联系人任务下发成功！"),s.getContactGroupList());case 4:case"end":return t.stop()}}),t)})))).catch((function(){s.$message({type:"info",message:"已取消移除"})}));case 2:case"end":return t.stop()}}),t,this)})));function e(e,n,a){return t.apply(this,arguments)}return e}()},{key:"close_group",value:function(t){this.group_visible=!1,this.del_visible=!1,this.group_rows=[],this.group_id="","1"===t&&this.getContactGroupList()}},{key:"add",value:function(){this.group_title="新建联系人组",this.group_visible=!0}},{key:"edit",value:function(t){this.group_id=t,this.group_title="编辑联系人组",this.group_visible=!0}},{key:"sel_users",value:function(){}},{key:"del",value:function(){var t=this;if(this.group_rows=this.group_list.filter((function(t){return t.check})),0!==this.group_rows.length){var e=this.group_rows.map((function(t){return t.name})),n=this.group_rows.map((function(t){return t.id})),a=this.$createElement;this.$msgbox({title:"提示",message:a("p",null,[a("span",null,"确定删除 "),a("i",{style:"color: #455cc6"},"".concat(e.join(","))),a("span",null,"  吗, 是否继续?")]),showCancelButton:!0,confirmButtonText:"确定",cancelButtonText:"取消",iconClass:"el-icon-warning",customClass:"message-box"}).then(Object(g["a"])(regeneratorRuntime.mark((function e(){var a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,v["a"].delete_contact_group({ids:n});case 2:a=e.sent,"Success"===a.code&&(t.$message.success("删除联系人组任务下发成功！"),t.getContactGroupList());case 4:case"end":return e.stop()}}),e)})))).catch((function(){t.$message({type:"info",message:"已取消删除"}),t.getContactGroupList()}))}else this.$message.warning("请先勾选联系人组!")}},{key:"addToWarnGroup",value:function(){}}]),n}(u["e"]);A=Object(l["a"])([Object(u["a"])({components:{ActionBlock:h["a"],AddGroup:$["a"],CommonDel:G["a"]}})],A);var E=A,T=E,B=(n("854c"),n("1915"),Object(O["a"])(T,L,R,!1,null,"3eb4de1f",null)),N=B.exports,W=function(t){Object(r["a"])(n,t);var e=Object(o["a"])(n);function n(){var t;return Object(s["a"])(this,n),t=e.apply(this,arguments),t.activeName="0",t}return Object(c["a"])(n,[{key:"handleClick",value:function(){}}]),n}(u["e"]);W=Object(l["a"])([Object(u["a"])({components:{ActionBlock:h["a"],List:z,GroupList:N}})],W);var H=W,D=H,F=Object(O["a"])(D,a,i,!1,null,null,null);e["default"]=F.exports},debb:function(t,e,n){},e8c0:function(t,e,n){"use strict";n.d(e,"a",(function(){return i}));var a=n("cf88");function i(t,e,n){n.preventDefault(),document.addEventListener("contextmenu",(function(t){var e=t.target;if(e.closest(".el-table")){var n=document.querySelector("#menu");if(n){n.style.display="block";var i=n.offsetHeight,s=n.offsetWidth;console.log("menuHeight",i);var c=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,r=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,o=t.clientX,l=t.clientY,u=o,h=l;r<o+s&&(u=o-s),c<l+i&&(h=c-i),n.style.left=u-250+"px",n.style.top=h-50+"px",n.style.display="block",n.style.zIndex="1000",document.addEventListener("click",a["a"])}}})),document.addEventListener("contextmenu",a["a"])}}}]);
//# sourceMappingURL=chunk-0c4e56d2.1747715207673.js.map