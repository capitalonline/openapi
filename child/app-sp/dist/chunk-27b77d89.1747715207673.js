(window["webpackJsonp_AppSp"]=window["webpackJsonp_AppSp"]||[]).push([["chunk-27b77d89"],{"1c50":function(t,e,n){"use strict";var a=n("81a9");e["a"]={get_maintask_list:function(t){return Object(a["a"])({method:"GET",url:"/api/v1/maintask/configuration",params:t})},add_maintask:function(t){return Object(a["a"])({method:"POST",url:"/api/v1/maintask/configuration",data:t})},update_maitask:function(t){return Object(a["a"])({method:"PUT",url:"/api/v1/maintask/configuration",data:t})},delete_maintask:function(t){return Object(a["a"])({method:"DELETE",url:"/api/v1/maintask/configuration",params:t})},get_maintask_detail:function(t){return Object(a["a"])({method:"GET",url:"/api/v1/maintask/configuration/detail",params:t})}}},"25cd":function(t,e,n){},6264:function(t,e,n){"use strict";n.r(e);var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("action-block",{attrs:{search_option:t.search_con,create_btn:"新建主任务配置",disabled:!1},on:{"fn-search":t.FnGetList,"fn-create":t.FnShowCreate}}),n("el-table",{ref:"table",attrs:{data:t.task_list,border:"","row-class-name":t.rowStyle},on:{"row-click":t.FnOperRow,"row-contextmenu":t.FnRightClick,"selection-change":t.handleSelectionChange}},[n("el-table-column",{attrs:{type:"selection"}}),n("el-table-column",{attrs:{prop:"id",label:"ID"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("el-button",{attrs:{type:"text"},on:{click:function(n){return t.FnDetail(e.row.id)}}},[t._v(t._s(e.row.id))])]}}])}),n("el-table-column",{attrs:{prop:"maintask_name",label:"名称"}}),n("el-table-column",{attrs:{prop:"priority",label:"优先级"}}),n("el-table-column",{attrs:{prop:"retry",label:"重试次数"}}),n("el-table-column",{attrs:{prop:"timeout",label:"超时时间"}}),n("el-table-column",{attrs:{prop:"callback_url",label:"回退地址"}}),n("el-table-column",{attrs:{prop:"is_valid",label:"is_valid"}})],1),n("el-pagination",{attrs:{"current-page":t.page_info.page_index,"page-sizes":t.page_info.page_sizes,"page-size":t.page_info.page_size,layout:"total, sizes, prev, pager, next, jumper",total:t.page_info.total},on:{"size-change":function(e){return t.FnGetList()},"current-change":function(e){return t.FnGetList()},"update:currentPage":function(e){return t.$set(t.page_info,"page_index",e)},"update:current-page":function(e){return t.$set(t.page_info,"page_index",e)},"update:pageSize":function(e){return t.$set(t.page_info,"page_size",e)},"update:page-size":function(e){return t.$set(t.page_info,"page_size",e)}}}),n("el-dialog",{attrs:{title:t.dialog_title,visible:t.create_dialog,width:"50%"},on:{"update:visible":function(e){t.create_dialog=e},close:t.FnClose}},[n("div",[n("label-block",{attrs:{label:"主任务名称"},scopedSlots:t._u([{key:"default",fn:function(){return[n("el-input",{attrs:{type:"text"},model:{value:t.main_config.main_name,callback:function(e){t.$set(t.main_config,"main_name",e)},expression:"main_config.main_name"}})]},proxy:!0}])}),n("label-block",{attrs:{label:"主任务优先级"},scopedSlots:t._u([{key:"default",fn:function(){return[n("el-input-number",{attrs:{min:1,max:10},model:{value:t.main_config.priority,callback:function(e){t.$set(t.main_config,"priority",e)},expression:"main_config.priority"}})]},proxy:!0}])}),n("label-block",{attrs:{label:"主任务重试次数"},scopedSlots:t._u([{key:"default",fn:function(){return[n("el-input-number",{attrs:{min:1,max:10},model:{value:t.main_config.retry,callback:function(e){t.$set(t.main_config,"retry",e)},expression:"main_config.retry"}}),t._v(" 次 ")]},proxy:!0}])}),n("label-block",{attrs:{label:"主任务超时时间"},scopedSlots:t._u([{key:"default",fn:function(){return[n("el-input-number",{attrs:{min:1,max:600},model:{value:t.main_config.timeout,callback:function(e){t.$set(t.main_config,"timeout",e)},expression:"main_config.timeout"}}),t._v(" 秒 ")]},proxy:!0}])}),n("label-block",{attrs:{label:"主任务回退地址"},scopedSlots:t._u([{key:"default",fn:function(){return[n("el-input",{attrs:{type:"text"},model:{value:t.main_config.callback_url,callback:function(e){t.$set(t.main_config,"callback_url",e)},expression:"main_config.callback_url"}})]},proxy:!0}])}),t.default_id?n("label-block",{staticClass:"switch-box",attrs:{label:"有效"},scopedSlots:t._u([{key:"default",fn:function(){return[n("el-switch",{attrs:{"active-color":"#455cc6","inactive-color":"#ccc"},model:{value:t.main_config.is_valid,callback:function(e){t.$set(t.main_config,"is_valid",e)},expression:"main_config.is_valid"}})]},proxy:!0}],null,!1,1067134834)}):t._e(),n("label-block",{attrs:{label:"子任务配置"},scopedSlots:t._u([{key:"default",fn:function(){return[n("dragger-task",{attrs:{sub_task:t.sub_task_list,rel_task:t.default_sub_task},on:{"fn-rel-task":t.FnGetRelTask}})]},proxy:!0}])})],1),n("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{attrs:{type:"primary"},on:{click:t.FnConfirm}},[t._v("确 定")]),n("el-button",{on:{click:t.FnClose}},[t._v("取 消")])],1)]),1===t.multi_rows.length?n("right-click",{attrs:{multi_rows:t.multi_rows,menus:t.menus,name:t.multi_rows.length>0?t.multi_rows[0].maintask_name:""},on:{"fn-click":t.infoClick}}):t._e()],1)},i=[],s=n("1da1"),r=n("d4ec"),o=n("bee2"),c=n("262e"),l=n("2caf"),u=(n("96cf"),n("d3b7"),n("d81d"),n("e9c4"),n("a9e3"),n("b0c0"),n("9ab4")),_=n("1b40"),m=n("98c9"),f=n("b508"),d=n("c811"),p=n("1c50"),g=n("bcc9"),h=n("e8c0"),b=n("cf88"),k=n("bd4d"),v=function(t){Object(c["a"])(n,t);var e=Object(l["a"])(n);function n(){var t;return Object(r["a"])(this,n),t=e.apply(this,arguments),t.search_con={id:{placeholder:"请输入任务ID"},maintask_name:{placeholder:"请输入任务名称"}},t.create_dialog=!1,t.dialog_title="",t.task_list=[],t.operate_auth=[],t.default_id="",t.default_sub_task=[],t.main_config={main_name:"",main_type:"",priority:1,retry:1,timeout:60,callback_url:"",sub_task:[],is_valid:!0},t.sub_task_list=[],t.page_info={page_sizes:[20,50,100],page_size:20,page_index:1,total:0},t.multi_rows=[],t.menus=[{label:"编辑",value:"edit",single:!0,disabled:!1},{label:"删除",value:"delete",single:!0,disabled:!1}],t}return Object(o["a"])(n,[{key:"infoClick",value:function(t){t.label;var e=t.value;"edit"===e?this.FnShowUpdate(this.multi_rows[0]):this.FnShowDel(this.multi_rows[0].id,this.multi_rows[0].maintask_name),Object(b["a"])()}},{key:"handleSelectionChange",value:function(t){this.multi_rows=t}},{key:"FnOperRow",value:function(t){this.$refs.table.toggleRowSelection(t)}},{key:"rowStyle",value:function(t){var e=t.row,n=this.multi_rows.some((function(t){return t.id===e.id}));if(n)return"rowStyle"}},{key:"FnRightClick",value:function(t,e,n){console.log(n);var a=this.multi_rows.some((function(e){return e.id===t.id}));a||this.$refs.table.toggleRowSelection(t),Object(h["a"])(t,e,n)}},{key:"FnShowCreate",value:function(){this.create_dialog=!0,this.dialog_title="新建主任务配置",this.FnGetSubList()}},{key:"FnShowUpdate",value:function(){var t=Object(s["a"])(regeneratorRuntime.mark((function t(e){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return this.create_dialog=!0,this.dialog_title="更新主任务配置",t.next=4,this.FnGetSubList();case 4:this.default_id=e.id,this.main_config.main_name=e.maintask_name,this.main_config.retry=e.retry,this.main_config.priority=e.priority,this.main_config.timeout=e.timeout,this.main_config.callback_url=e.callback_url,this.main_config.is_valid=Boolean(e.is_valid),this.default_sub_task=JSON.parse(e.subtask_flow).map((function(t){return t.map((function(t){return t.subtask_index_id}))}));case 12:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}()},{key:"FnClose",value:function(){this.create_dialog=!1,this.main_config.main_name="",this.main_config.main_type="",this.main_config.retry=1,this.main_config.priority=1,this.main_config.timeout=60,this.main_config.callback_url="",this.main_config.sub_task=[],this.main_config.is_valid=!0,this.sub_task_list=[],this.default_id="",this.default_sub_task=[]}},{key:"FnGetList",value:function(){var t=Object(s["a"])(regeneratorRuntime.mark((function t(){var e,n,a,i=arguments;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e=i.length>0&&void 0!==i[0]?i[0]:{},n={},e.id&&(n.id=e.id),e.maintask_type&&(n.maintask_type=e.maintask_type),e.maintask_name&&(n.maintask_name=e.maintask_name),n.page_number=this.page_info.page_index,n.page_size=this.page_info.page_size,t.next=9,p["a"].get_maintask_list(n);case 9:a=t.sent,"Success"===a.code&&(this.task_list=a.data.maintask_info,this.page_info.total=a.data.total);case 11:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"FnGetSubList",value:function(){var t=Object(s["a"])(regeneratorRuntime.mark((function t(){var e;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,g["a"].get_subtask_list();case 2:e=t.sent,"Success"===e.code&&(this.sub_task_list=e.data.subtask_info);case 4:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"FnGetRelTask",value:function(t){this.main_config.sub_task=t.map((function(t){return t.map((function(t){return{subtask_index_id:t}}))}))}},{key:"FnConfirm",value:function(){var t={maintask_name:this.main_config.main_name,priority:this.main_config.priority,retry:this.main_config.retry,timeout:this.main_config.timeout,callback_url:this.main_config.callback_url,subtask_flow:JSON.stringify(this.main_config.sub_task),is_valid:Number(this.main_config.is_valid)};this.default_id?this.FnUpdate(t):this.FnCreate(t)}},{key:"FnCreate",value:function(){var t=Object(s["a"])(regeneratorRuntime.mark((function t(e){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,p["a"].add_maintask(e);case 2:n=t.sent,"Success"===n.code&&(this.FnClose(),this.$message.success(n.msg||"成功新建主任务配置！"),this.FnGetList());case 4:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}()},{key:"FnUpdate",value:function(){var t=Object(s["a"])(regeneratorRuntime.mark((function t(e){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,p["a"].update_maitask(Object.assign({},e,{id:this.default_id}));case 2:n=t.sent,"Success"===n.code&&(this.FnClose(),this.$message.success(n.msg||"成功更新主任务配置！"),this.FnGetList());case 4:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}()},{key:"FnShowDel",value:function(t,e){var n=this;this.$confirm("确认删除主任务配置 -- ".concat(e),"删除提示",{cancelButtonText:"取消",confirmButtonText:"确定",type:"warning"}).then((function(){n.default_id=t,n.FnDel()})).catch()}},{key:"FnDel",value:function(){var t=Object(s["a"])(regeneratorRuntime.mark((function t(){var e;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,p["a"].delete_maintask({id:this.default_id});case 2:e=t.sent,"Success"===e.code&&(this.$message.success(e.msg||"成功删除主项目配置！"),this.FnGetList());case 4:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"FnDetail",value:function(t){this.$router.push("/mainTaskDetail/".concat(t))}},{key:"created",value:function(){this.operate_auth=this.$store.state.auth_info[this.$route.name],this.FnGetList()}}]),n}(_["e"]);v=Object(u["a"])([Object(_["a"])({components:{LabelBlock:m["a"],draggerTask:f["a"],actionBlock:d["a"],RightClick:k["a"]}})],v);var y=v,w=y,x=(n("6c9c"),n("2877")),F=Object(x["a"])(w,a,i,!1,null,"011caab9",null);e["default"]=F.exports},"6c9c":function(t,e,n){"use strict";n("25cd")},e8c0:function(t,e,n){"use strict";n.d(e,"a",(function(){return i}));var a=n("cf88");function i(t,e,n){n.preventDefault(),document.addEventListener("contextmenu",(function(t){var e=t.target;if(e.closest(".el-table")){var n=document.querySelector("#menu");if(n){n.style.display="block";var i=n.offsetHeight,s=n.offsetWidth;console.log("menuHeight",i);var r=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,o=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,c=t.clientX,l=t.clientY,u=c,_=l;o<c+s&&(u=c-s),r<l+i&&(_=r-i),n.style.left=u-250+"px",n.style.top=_-50+"px",n.style.display="block",n.style.zIndex="1000",document.addEventListener("click",a["a"])}}})),document.addEventListener("contextmenu",a["a"])}}}]);
//# sourceMappingURL=chunk-27b77d89.1747715207673.js.map