(window["webpackJsonp_AppSp"]=window["webpackJsonp_AppSp"]||[]).push([["chunk-3c7a51ba","chunk-2a1afeac","chunk-61b53adf","chunk-4579c86e"],{"0003":function(t,e,s){"use strict";var i=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",[e("el-alert",{attrs:{type:"warning",closable:!1},scopedSlots:t._u([{key:"title",fn:function(){return[e("p",[t._v("支持自定义填写恢复后新IP，若原IP未被占用则可以使用原IP；")]),e("p",[t._v("若未自定义填写恢复后新IP，则默认随机生成新可用IP；")]),e("p",[t._v("为避免自定义IP成功可用率较低，建议使用随机生成的新IP。")])]},proxy:!0}])}),e("el-table",{attrs:{data:t.multiple_selection,border:""}},[e("el-table-column",{attrs:{prop:"ecs_id",label:"云服务器ID"}}),e("el-table-column",{attrs:{prop:"ecs_name",label:"云服务器名称"}}),e("el-table-column",{attrs:{label:"原IP（最近使用）"},scopedSlots:t._u([{key:"default",fn:function(s){return[t.ip_usage[s.row.ecs_id]?e("div",[t._v(" "+t._s(t.ip_usage[s.row.ecs_id].ip_address)+" "),t.ip_usage[s.row.ecs_id].is_used?e("span",{staticClass:"destroy"},[t._v("（已占用）")]):t._e()]):t._e()]}}])}),e("el-table-column",{attrs:{label:"恢复后新IP"},scopedSlots:t._u([{key:"default",fn:function(s){return[e("el-input",{attrs:{placeholder:"请输入自定义IP"},model:{value:t.new_ip_address[s.row.ecs_id],callback:function(e){t.$set(t.new_ip_address,s.row.ecs_id,e)},expression:"new_ip_address[scope.row.ecs_id]"}})]}}])})],1)],1)},a=[],o=(s("14d9"),s("e9f5"),s("7d54"),s("ab43"),s("9ab4")),l=s("1b40"),r=s("e527");let n=class extends l["e"]{constructor(){super(...arguments),this.ip_usage={},this.ip_available_list={},this.new_ip_address={}}async FnGetIpUsage(){let t={customer_id:this.customer_id,ecs_ids:this.multiple_selection.map(t=>t.ecs_id)};this.ip_usage={};let e=await r["a"].get_usage_ip(t);"Success"===e.code&&(e.data.forEach(t=>{this.ip_usage[t.ecs_id]={ip_address:t.ip_address,is_used:t.is_used}}),this.$set(this.ip_usage))}async FnRecover(){let t=Object.values(this.new_ip_address),e=[];for(let a in this.new_ip_address){let t=this.new_ip_address[a];if(this.ip_usage[a].is_used&&this.ip_usage[a].ip_address===t)return void this.$message.warning("恢复后新IP已被占用！");(e.indexOf(t)<0||!t)&&e.push(t)}if(t.length>e.length)return void this.$message.warning("恢复后新IP重复！");let s={customer_id:this.customer_id,is_gpu:this.is_gpu,ecs_list:this.multiple_selection.map(t=>({ecs_id:t.ecs_id,ip_address:this.new_ip_address[t.ecs_id]}))};const i=await r["a"].recover_instance(s);"Success"==i.code&&(this.$message.success(i.msg||"成功下发 恢 复 任务！"),this.Fnclose())}Fnclose(){}created(){this.FnGetIpUsage()}};Object(o["a"])([Object(l["c"])({default:""})],n.prototype,"customer_id",void 0),Object(o["a"])([Object(l["c"])({default:[]})],n.prototype,"multiple_selection",void 0),Object(o["a"])([Object(l["c"])({default:0})],n.prototype,"is_gpu",void 0),Object(o["a"])([Object(l["b"])("fn-close")],n.prototype,"Fnclose",null),n=Object(o["a"])([l["a"]],n);var c=n,_=c,d=s("2877"),u=Object(d["a"])(_,i,a,!1,null,null,null);e["a"]=u.exports},"018b":function(t,e,s){"use strict";s.r(e);var i=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",{staticClass:"app-container"},[e("div",[e("action-block",{attrs:{search_option:t.search_option,type:"physical"},on:{"fn-search":t.fn_search}}),e("div",{staticClass:"icon m-bottom10"},[e("el-dropdown",{staticClass:"aliFont",on:{command:t.infoClick}},[e("el-button",{attrs:{type:"text"}},[e("svg-icon-font",{attrs:{iconName:"icon-gengduo"}})],1),e("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},t._l(t.rows_operate_btns,(function(s){return e("el-dropdown-item",{key:s.value,attrs:{command:s}},[t._v(t._s(s.label))])})),1)],1),e("el-tooltip",{attrs:{content:"自定义列表项",placement:"bottom",effect:"light"}},[e("el-button",{attrs:{type:"text"},on:{click:t.FnCustom}},[e("i",{staticClass:"el-icon-s-tools"})])],1),e("el-tooltip",{attrs:{content:"刷新",placement:"bottom",effect:"light"}},[e("el-button",{attrs:{type:"text"},on:{click:t.refresh}},[e("svg-icon",{staticClass:"refresh",attrs:{icon:"refresh"}})],1)],1),e("el-tooltip",{attrs:{content:"导出",placement:"bottom",effect:"light"}},[e("el-button",{attrs:{type:"text"},on:{click:t.down}},[e("svg-icon",{staticClass:"export",attrs:{icon:"export"}})],1)],1)],1)],1),e("el-table",{ref:"table",attrs:{data:t.list,border:"",height:"100%","row-class-name":t.rowStyle},on:{"selection-change":t.handleSelectionChange,"sort-change":t.FnSortChange,"filter-change":t.filterAttribute,"row-click":t.FnOperRow,"row-contextmenu":t.FnRightClick}},[e("el-table-column",{attrs:{type:"selection"}}),t._l(t.custom_host,(function(s){return e("el-table-column",{key:s.prop,attrs:{"filter-multiple":!s.column_key&&null,prop:s.prop,"column-key":s.column_key?s.column_key:null,filters:s.column_key?s.list:null,sortable:s.sortable?s.sortable:null,width:s.width?s.width:null,type:s.type,label:s.label,"show-overflow-tooltip":s.overflow,"min-width":s.minWidth},scopedSlots:t._u(["cpu_rate"===s.prop?{key:"default",fn:function(t){return[e("el-progress",{attrs:{"stroke-width":14,color:"#455cc6",percentage:Math.round(t.row.cpu_rate)}})]}}:"ram_rate"===s.prop?{key:"default",fn:function(t){return[e("el-progress",{attrs:{"stroke-width":14,color:"#455cc6",percentage:Math.round(t.row.ram_rate)}})]}}:"gpu_rage"===s.prop?{key:"default",fn:function(t){return[e("el-progress",{attrs:{"stroke-width":14,color:"#455cc6",percentage:Math.round(t.row.gpu_rate)}})]}}:"host_name"===s.prop?{key:"default",fn:function(s){return[e("span",[t._v(t._s(s.row.host_name))]),e("br"),t._l(s.row.label,(function(s,i){return e("el-tag",{key:i,staticClass:"m-right5",attrs:{size:"mini"}},[t._v(t._s(s))])}))]}}:"is_prepare_host"===s.prop?{key:"default",fn:function(s){return[e("span",[t._v(t._s(s.row.is_prepare_host?"是":"否"))])]}}:null],null,!0)})}))],2),e("el-pagination",{attrs:{"current-page":t.page_info.current,"page-sizes":[20,50,100],"page-size":t.page_info.size,layout:"total, sizes, prev, pager, next, jumper",total:t.page_info.total},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}}),t.visible&&!["physical_detail","upload","migrate","record","resource","update_attribute","business_test","remark","set_label","service","rollback"].includes(t.oper_type)?[e("Operate",{attrs:{title:t.oper_label,rows:t.multi_rows,oper_type:t.oper_type,visible:t.visible},on:{"update:visible":function(e){t.visible=e},close:t.close}})]:t._e(),t.visible&&"upload"===t.oper_type?[e("upload-file",{attrs:{visible:t.visible},on:{"update:visible":function(e){t.visible=e},close:t.close}})]:t._e(),t.visible&&"migrate"===t.oper_type?[e("Migrate",{attrs:{visible:t.visible,rows:t.multi_rows},on:{"update:visible":function(e){t.visible=e},close:t.close}})]:t._e(),t.visible&&"record"===t.oper_type?[e("Record",{attrs:{visible:t.visible,type:"physical",record_id:t.multi_rows[0].host_id},on:{"update:visible":function(e){t.visible=e},close:t.close}})]:t._e(),t.visible&&["resource","service","rollback"].includes(t.oper_type)?[e("Resource",{attrs:{visible:t.visible,rows:t.multi_rows,title:t.oper_label,oper_type:t.oper_type},on:{"update:visible":function(e){t.visible=e},close:t.close}})]:t._e(),t.visible&&"business_test"===t.oper_type?[e("business-test",{attrs:{visible:t.visible,az_info:t.az_info},on:{"update:visible":function(e){t.visible=e}}})]:t._e(),t.visible&&"remark"===t.oper_type?[e("remark",{attrs:{visible:t.visible,rows:t.multi_rows[0]},on:{"update:visible":function(e){t.visible=e},close:t.close}})]:t._e(),t.visible&&"set_label"===t.oper_type?[e("set_label",{attrs:{visible:t.visible,rows:t.multi_rows[0]},on:{"update:visible":function(e){t.visible=e},close:t.close}})]:t._e(),e("custom-list-item",{attrs:{visible:t.show_custom,all_item:t.all_item,all_column_item:t.all_column_item,type:"pod_host",newView:!0},on:{"update:visible":function(e){t.show_custom=e},"fn-custom":t.get_custom_columns}}),e("right-click",{attrs:{multi_rows:t.multi_rows,menus:t.menus,name:t.multi_rows.length>0?t.multi_rows[0].host_name:"",error_msg:t.error_msg},on:{"fn-click":t.infoClick}})],2)},a=[],o=(s("14d9"),s("e9f5"),s("d866"),s("910d"),s("7d54"),s("ab43"),s("a732"),s("9ab4")),l=s("1b40"),r=s("c811"),n=s("3673"),c=s("bfc6"),_=s("af7d"),d=s("8ce4"),u=s("bd4d"),p=s("da8b"),h=s("e8c0"),m=s("cf88"),b=s("3f8d"),f=s("14a9"),g=s("343a"),v=s("74b1"),y=s("786f"),k=s("a881"),O=s("cf80"),w=s("edc2"),j=s("c1df"),C=s.n(j),x=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",[e("el-dialog",{attrs:{title:"标签设置",visible:t.visibleSync,width:"800px","destroy-on-close":!0,"close-on-click-modal":!1},on:{"update:visible":function(e){t.visibleSync=e}}},[e("div",{staticClass:"text-align: center;"},[e("div",{staticStyle:{"text-align":"center"}},[e("div",{staticClass:"el-transfer",staticStyle:{"text-align":"left",display:"inline-block"}},[e("div",{staticClass:"el-transfer-panel"},[e("p",{staticClass:"el-transfer-panel__header"},[e("el-checkbox",{attrs:{indeterminate:t.isIndeterminate},on:{change:t.checkall},model:{value:t.checkAll,callback:function(e){t.checkAll=e},expression:"checkAll"}},[t._v("标签 "),e("span",[t._v(" "+t._s(t.num(t.source_data))+"/"+t._s(t.source_data.length)+" ")])])],1),e("div",{staticClass:"el-transfer-panel__body is-with-footer"},[e("div",[e("el-input",{attrs:{placeholder:"请输入标签内容",maxlength:"4"},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.addLabel()}},model:{value:t.inputLabel,callback:function(e){t.inputLabel=e},expression:"inputLabel"}})],1),e("div",{staticClass:"el-transfer-panel__list check-box"},[t._l(t.source_data,(function(s,i){return e("div",{key:i},[e("el-checkbox",{staticClass:"el-checkbox el-transfer-panel__item",attrs:{value:"item.check"},on:{change:function(e){return t.curcheck()}},model:{value:s.check,callback:function(e){t.$set(s,"check",e)},expression:"item.check"}},[e("span",[t._v(t._s(s.label_name))])])],1)})),0===t.source_data.length?e("div",{staticStyle:{"text-align":"center"}},[t._v("暂无数据")]):t._e()],2)]),e("p",{staticClass:"el-transfer-panel__footer"},[e("el-button",{staticStyle:{width:"100%"},attrs:{type:"primary",plain:""},on:{click:t.deleteLabel}},[t._v("删除")])],1)])]),e("div",{staticClass:"el-transfer__buttons"},[e("el-button",{attrs:{type:"primary",icon:"el-icon-arrow-left",disabled:0===t.num(t.target_data)},on:{click:t.toleft}}),e("el-button",{attrs:{type:"primary",icon:"el-icon-arrow-right",disabled:0===t.num(t.source_data)},on:{click:t.toright}})],1),e("div",{staticClass:"el-transfer",staticStyle:{"text-align":"left",display:"inline-block"}},[e("div",{staticClass:"el-transfer-panel"},[e("p",{staticClass:"el-transfer-panel__header"},[e("el-checkbox",{attrs:{indeterminate:t.target_isIndeterminate},on:{change:t.checkall1},model:{value:t.checkAll1,callback:function(e){t.checkAll1=e},expression:"checkAll1"}},[t._v("已选择 "),e("span",[t._v(" "+t._s(t.num(t.target_data))+"/"+t._s(t.target_data.length)+" ")])])],1),e("div",{staticClass:"el-transfer-panel__body"},[e("div",{staticClass:"el-transfer-panel__list check-box"},[t._l(t.target_data,(function(s,i){return e("div",{key:i},[e("el-checkbox",{staticClass:"el-checkbox el-transfer-panel__item",attrs:{value:"item.check"},on:{change:function(e){return t.curcheck1()}},model:{value:s.check,callback:function(e){t.$set(s,"check",e)},expression:"item.check"}},[e("span",[t._v(t._s(s.label_name))])])],1)})),0===t.target_data.length?e("div",{staticStyle:{"text-align":"center"}},[t._v("暂无数据")]):t._e()],2)])])])])]),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{attrs:{type:"primary"},on:{click:t.confirm}},[t._v("确认")]),e("el-button",{on:{click:function(e){t.visibleSync=!1}}},[t._v("取消")])],1)])],1)},S=[];let z=class extends l["e"]{constructor(){super(...arguments),this.target_data=[],this.source_data=[],this.inputLabel="",this.checkAll=!1,this.checkAll1=!1,this.isIndeterminate=!1,this.target_isIndeterminate=!1}addLabel(){if(this.source_data.length>=30)return;const t=this.inputLabel.trim();if(t){const e=[...this.source_data,...this.target_data];if(e.some(e=>e.label_name===t))return void this.$message.warning("标签已存在");this.source_data.unshift({label_name:t,check:!1}),this.inputLabel=""}}checkall(){this.source_data.forEach(t=>t.check=this.checkAll),this.isIndeterminate=!1}checkall1(){this.target_data.forEach(t=>t.check=this.checkAll1),this.target_isIndeterminate=!1}get num(){return t=>t.filter(t=>t.check).length}curcheck(){let t=this.num(this.source_data);this.checkAll=this.source_data.every(t=>t.check),this.isIndeterminate=t>0&&t<this.source_data.length}curcheck1(){let t=this.num(this.target_data);this.checkAll1=this.target_data.every(t=>t.check),this.target_isIndeterminate=t>0&&t<this.target_data.length}deleteLabel(){this.source_data=this.source_data.filter(t=>!t.check)}toright(){if(3===this.target_data.length||this.num(this.source_data)+this.target_data.length>3)return void this.$message.warning("最多只能选择3个标签");let t=this.source_data.filter(t=>1==t.check);this.target_data=[...this.target_data,...t.map(t=>({...t,check:!1}))],this.source_data=this.source_data.filter(t=>!t.check)}toleft(){let t=this.target_data.filter(t=>1==t.check);this.source_data=[...this.source_data,...t.map(t=>({...t,check:!1}))],this.target_data=this.target_data.filter(t=>!t.check)}created(){this.get_host_label(),this.rows.label.length>0&&(this.target_data=this.rows.label.map(t=>({label_name:t,check:!1})))}async get_host_label(){let t=await p["a"].get_label_list({host_id:this.rows.host_id});"Success"===t.code&&(this.source_data=t.data.label_list.map(t=>({label_name:t.label_name,check:!1})))}async confirm(){let t=[...this.source_data,...this.target_data].map(t=>t.label_name),e=await p["a"].add_host_label({host_id:this.rows.host_id,host_label_list:this.target_data.map(t=>t.label_name),all_label_list:t});"Success"===e.code?(this.$message.success(e.message),this.back("1")):this.back("0")}back(t){this.visibleSync=!1}watchcheck(t){0===this.num(t)?(this.checkAll=!1,this.isIndeterminate=!1):this.num(t)===t.length?(this.checkAll=!0,this.isIndeterminate=!1):(this.checkAll=!1,this.isIndeterminate=this.num(t)>0&&this.num(t)<t.length)}watchcheck1(t){0===this.num(t)?(this.checkAll1=!1,this.target_isIndeterminate=!1):this.num(t)===t.length?(this.checkAll1=!0,this.target_isIndeterminate=!1):(this.checkAll1=!1,this.target_isIndeterminate=this.num(t)>0&&this.num(t)<t.length)}};Object(o["a"])([Object(l["d"])("visible")],z.prototype,"visibleSync",void 0),Object(o["a"])([Object(l["c"])({default:()=>({})})],z.prototype,"rows",void 0),Object(o["a"])([Object(l["b"])("close")],z.prototype,"back",null),Object(o["a"])([Object(l["f"])("source_data")],z.prototype,"watchcheck",null),Object(o["a"])([Object(l["f"])("target_data")],z.prototype,"watchcheck1",null),z=Object(o["a"])([Object(l["a"])({})],z);var F=z,$=F,T=(s("ca1f"),s("2877")),P=Object(T["a"])($,x,S,!1,null,"5f57a928",null),I=P.exports,D=s("1477");let E=class extends l["e"]{constructor(){super(...arguments),this.list=[],this.all_column_item=[],this.multi_rows=[],this.search_data={},this.az_info={},this.visible=!1,this.oper_type="",this.oper_label="",this.power_list=[],this.filter_data={},this.machine_list=[],this.power_status="",this.machine_status="",this.filter_info={},this.sort_prop_name="",this.sort_order=void 0,this.page_info={current:1,size:20,total:0},this.all_item=[],this.custom_host=[],this.show_custom=!1,this.rows_operate_btns=[{label:"导入",value:"upload"},{label:"服务更新",value:"service"},{label:"回滚",value:"rollback"}],this.is_pare_host=[{text:"是",value:"1"},{text:"否",value:"0"}],this.search_option={out_band_address:{placeholder:"请输入带外IP"},host_ip:{placeholder:"请输入管理网IP"},host_name:{placeholder:"请输入主机名称"},host_id:{placeholder:"请输入主机ID"},vm_id:{placeholder:"请输入虚拟机ID"},cpu:{placeholder:"请输入CPU型号"},gpu_model:{placeholder:"请输入显卡型号"},nic:{placeholder:"请输入网卡型号"},room:{placeholder:"请选择机房",list:[]},host_rack:{placeholder:"请输入机柜编号"},bare_metal_id:{placeholder:"请输入物理机产品ID"},bare_metal_name:{placeholder:"请输入物理机产品名称"},label:{placeholder:"请选择标签",list:[]},create_time:{placeholder:["开始时间","结束时间"],type:"datetimerange",width:"360",clearable:!0,dis_day:31,defaultTime:[]}},this.switch_power=[{label:"开机",value:"start_up_host",disabled:!1},{label:"关机",value:"shutdown_host",disabled:!1},{label:"重启",value:"restart_host",disabled:!1}],this.lock_machine=[{label:"锁定机器",value:"lock",disabled:!1},{label:"解锁机器",value:"unlock",disabled:!1}],this.crash_list=[{label:"数据清理同步",value:"data_clear",disabled:!1},{label:"宕机恢复",value:"down_recover",disabled:!1}],this.maintenance_host=[{label:"设置维护",value:"maintenance",disabled:!1},{label:"完成维护",value:"finish",disabled:!1}],this.sign_host=[{label:"调度标记",value:"schedule",disabled:!1},{label:"迁移标记",value:"migrate_flag",disabled:!1}],this.error_msg={start_up_host:"已选主机需为在线或离线状态",shutdown_host:"已选主机需为在线或离线状态且无虚拟机运行",restart_host:"已选主机需为在线或离线状态",finish:"已选主机需为在线维护中或离线维护中",shelves:"已选主机上不能有虚拟机运行",disperse:"已选主机需为在线状态",migrate:"已选主机需为在线状态",unlock:"已选主机需为锁定状态",data_clear:"机器状态需为待清理状态",down_recover:"机器状态需为待恢复状态!",remove_cluster:"已选主机需为维护中状态",unstore_exception:"已选主机需为存储异常状态",set_prepar_host:"已选主机需为在线状态且为资源池",set_resource_pools:"已选主机需为在线状态且为备机"}}get menus(){const t=[{label:"迁移",value:"migrate",single:!0,disabled:!1},{label:"操作记录",value:"record",single:!0,disabled:!1},{label:"分配资源",value:"resource",single:!0,disabled:!1},{label:"编辑备注",value:"remark",single:!0,disabled:!1},{label:"开关机",value:"start_or_shutdown",list:this.switch_power,disabled:!1},{label:"机器锁定",value:"lock_machine",disabled:!1,list:this.lock_machine},{label:"更换集群",value:"change_cluster",disabled:!1},{label:"移出集群",value:"remove_cluster",disabled:!1},{label:"机器维护",value:"maintenance",disabled:!1,list:this.maintenance_host},{label:"宕机处理",value:"crash",disabled:!1,list:this.crash_list},{label:"设备标记",value:"sign",disabled:!1,list:this.sign_host},{label:"底层同步",value:"under_sync",disabled:!1},{label:"驱散",value:"disperse",disabled:!1},{label:"欺骗器管理",value:"cheat",disabled:!1},{label:"业务测试",value:"business_test",disabled:!1},{label:"完成验证",value:"finish_validate",disabled:!1},{label:"解除存储异常",value:"unstore_exception",disabled:!1},{label:"服务更新",value:"service",disabled:!1},{label:"回滚",value:"rollback",disabled:!1},{label:"标签设置",value:"set_label",single:!0}];return this.multi_rows.length>0&&(this.multi_rows[0].is_prepare_host?t.push({label:"设为资源池",value:"set_resource_pools",disabled:!1}):t.push({label:"设为备机",value:"set_prepar_host",disabled:!1})),t}watch_multi(){this.handleMenus()}created(){this.get_room_list(),this.get_field(),this.get_pod_host_list(),this.get_status_list(),this.get_label_list()}async get_label_list(){this.search_option.label.list=[];let t=await p["a"].get_all_host_label({});"Success"===t.code&&t.data.all_host_label_list.forEach(t=>{this.search_option.label.list.push({label:t.label_name,type:t.label_name})})}async get_room_list(){let t=await D["a"].get_room_list({});"Success"===t.code&&t.data.machine_room.forEach(t=>{this.search_option.room.list.push({label:t,type:t})})}fn_search(t={}){this.search_data={...t},this.page_info.current=1,this.judgeColumns(),this.get_pod_host_list()}close(t){"set_label"===this.oper_type&&this.get_label_list(),"1"===t&&this.get_pod_host_list(),this.visible=!1,this.oper_type="",this.oper_label="",this.multi_rows=[];const e=this.$refs.table;e.clearSelection()}handleMenus(){for(const t of this.menus)if(t.list)for(const e of t.list)e.disabled=this.handle(e.label,e.value);else t.disabled=this.handle(t.label,t.value)}handle(t,e){if("finish_validate"===e)return!this.multi_rows.every(t=>["init_error","init","offline"].includes(t.machine_status))&&(this.error_msg["finish_validate"]="物理机需为初始化状态或验证失败状态",!0);if("remove_cluster"===e&&this.multi_rows.every(t=>"0-0"===t.cluster_id))return!0;if(["upload","resource","update_attribute","business_test","schedule","migrate_flag","cheat","under_sync"].includes(e))return"business_test"===e&&0===this.list.length&&(this.error_msg["business_test"]="当前无宿主机可进行业务测试!",!0);if("set_prepar_host"===e||"set_resource_pools"===e){const t=this.multi_rows.some(t=>t.is_prepare_host),e=this.multi_rows.some(t=>!t.is_prepare_host);return t&&e}if(!this.judge(e))return!0;if("disperse"===e){let t=this.multi_rows.filter(t=>"GPU"===t.host_purpose),e=t.every(t=>t.ecs_list.every(t=>t.is_gpu&&"已关机"===t.status||!t.is_gpu));if(!e)return this.error_msg["disperse"]="GPU物理机中的GPU云主机需为关机状态!",!1}}judge(t){const e=Object(b["c"])(t);let s=this.multi_rows.every(t=>{let s=0===e.power.length||e.power.includes(t.power_status),i=0===e.host.length||e.host.includes(t.machine_status),a=!e.vm||e.vm===t.ecs_count+1;return s&&i&&a});return s}infoClick(t){const{label:e,value:s}=t;t.list||t.disabled||("business_test"===s&&(this.az_info={az_id:this.$store.state.az_id,az_name:this.$store.state.az_list.az_name}),this.oper_type=s,this.oper_label=e,this.visible=!0,Object(m["a"])())}watch_az(t){t&&this.refresh()}refresh(){this.get_pod_host_list()}FnOperRow(t){this.$refs.table.toggleRowSelection(t)}rowStyle({row:t}){const e=this.multi_rows.some(e=>e.host_id===t.host_id);if(e)return"rowStyle"}FnRightClick(t,e,s){const i=this.multi_rows.some(e=>e.host_id===t.host_id);i||this.$refs.table.toggleRowSelection(t),Object(h["a"])(t,e,s)}async get_field(){let t=await p["a"].get_pod_host_field();if("Success"===t.code){let e=["field_name","show_name"],s=["prop","label"],i=[];this.all_item=t.data.map(t=>(i=[...i,...t.filed],t)),this.all_column_item=Object(d["b"])(i,s,e),this.get_custom_columns(this.$store.state.pod.host_list),this.FnDoLayout()}}get_custom_columns(t){0!==t.length&&(this.custom_host=this.all_column_item.filter(e=>t.includes(e.label)),this.custom_host.map(t=>(["cpu_model","gpu_model","bare_metal_name","power_status_name","machine_status_name","is_prepare_host"].includes(t.prop)||(t=Object.assign(t,{},{sortable:"custom"})),["host_id","bare_metal_name","cpu_model"].includes(t.prop)&&(t=Object.assign(t,{},{width:"240px",overflow:!0})),["host_name","gpu_model"].includes(t.prop)&&(t=Object.assign(t,{},{width:"150px",overflow:!0})),["host_ip","out_band_address","gpu_count","ecs_count","cpu_rate","ram_rate","gpu_rage","machine_status_name","power_status_name"].includes(t.prop)&&(t=Object.assign(t,{},{minWidth:"120px"})),"power_status_name"===t.prop&&(t=Object.assign(t,{},{column_key:"power_status",list:this.power_list})),"machine_status_name"===t.prop&&(t=Object.assign(t,{},{column_key:"machine_status",list:this.machine_list})),"is_prepare_host"===t.prop&&(t=Object.assign(t,{},{column_key:"is_prepare_host",list:this.is_pare_host})),t)),this.FnDoLayout())}FnDoLayout(){this.$nextTick(()=>{this.$refs.table.doLayout()})}async get_status_list(){let t=await p["a"].get_status_list({});if("Success"===t.code){for(let e in t.data.power_status)this.power_list.push({text:t.data.power_status[e],value:e});for(let e in t.data.machine_status)this.machine_list.push({text:t.data.machine_status[e],value:e})}}FnCustom(){this.show_custom=!0}async down(){const{room:t,host_name:e,vm_id:s,out_band_address:i,host_ip:a,host_id:o,gpu_model:l,host_rack:r,sort_host_ip:n,create_time:c,cpu:_,nic:d,bare_metal_name:u,bare_metal_id:p,label:h}=this.search_data;let m={machine_room_name:t,host_name:e,vm_id:s,out_band_address:i,host_ip:a,host_id:o,gpu_model:l,host_rack:r,sort_host_ip:n,cpu:_,nic:d,bare_metal_name:u,bare_metal_id:p,label:h,start_time:c&&c[0]?C()(c[0]).format("YYYY-MM-DD HH:mm:ss"):void 0,end_time:c&&c[1]?C()(c[1]).format("YYYY-MM-DD HH:mm:ss"):void 0,...this.filter_info,field_names:JSON.stringify(this.custom_host.map(t=>t.prop))};"pod_host"===this.$route.name&&(m["pod_id"]=this.$route.params.id),"cluster_host"===this.$route.name&&(m["cluster_id"]=this.$route.params.id);let b="";for(let g in m)m[g]&&(b+=`${g}=${m[g]}&`);let f=""===b?"":"?"+b.slice(0,b.length-1);window.location.href="/ecs_business/v1/host/host_list_download/"+f}async get_pod_host_list(){if(!this.$store.state.az_id)return;const{room:t,host_name:e,vm_id:s,out_band_address:i,host_ip:a,host_id:o,gpu_model:l,host_rack:r,create_time:n,cpu:c,nic:_,bare_metal_name:d,bare_metal_id:u,vgpu_segment_type:h,host_info:m,label:b}=this.search_data;let f={host_name:e,vm_id:s,out_band_address:i,host_ip:a,host_id:o,gpu_model:l,host_rack:r,cpu:c,nic:_,bare_metal_name:d,bare_metal_id:u,host_info:m,label:b,machine_room_name:t,vgpu_segment_type:h?h[0]:void 0,start_time:n&&n[0]?C()(n[0]).format("YYYY-MM-DD HH:mm:ss"):void 0,end_time:n&&n[1]?C()(n[1]).format("YYYY-MM-DD HH:mm:ss"):void 0,page_index:this.page_info.current,page_size:this.page_info.size,az_id:this.$store.state.az_id,[this.sort_prop_name]:this.sort_order,...this.filter_info};"pod_host"===this.$route.name&&(f["pod_id"]=this.$route.params.id),"cluster_host"===this.$route.name&&(f["cluster_id"]=this.$route.params.id);let g=await p["a"].get_pod_host_list(f);"Success"===g.code&&(this.list=g.data.result,this.page_info.total=g.data.page_info.count)}judgeColumns(){this.filter_info={};for(let t in this.filter_data)this.filter_info[t]=this.filter_data[t][0]}filterAttribute(t){this.filter_data={...this.filter_data,...t},this.judgeColumns(),this.get_pod_host_list()}handleSelectionChange(t){this.multi_rows=t}FnSortChange(t){let e={};this.all_item.forEach(t=>{t.filed.forEach(t=>{e[t.field_name]="sort_"+t.field_name})}),this.sort_prop_name=e[t.prop],this.sort_order="ascending"===t.order?"0":"descending"===t.order?"1":void 0,this.get_pod_host_list()}handleSizeChange(t){this.page_info.size=t,this.get_pod_host_list()}handleCurrentChange(t){this.page_info.current=t,this.get_pod_host_list()}};Object(o["a"])([Object(l["f"])("multi_rows",{immediate:!0,deep:!0})],E.prototype,"watch_multi",null),Object(o["a"])([Object(l["f"])("$store.state.az_id")],E.prototype,"watch_az",null),E=Object(o["a"])([Object(l["a"])({components:{Set_label:I,RightClick:u["a"],SearchFrom:c["a"],SvgIcon:n["a"],CustomListItem:_["a"],Operate:f["a"],UploadFile:g["a"],Migrate:v["a"],Record:y["a"],Resource:k["a"],BusinessTest:O["a"],Remark:w["a"],ActionBlock:r["a"]}})],E);var G=E,L=G,R=(s("6345"),Object(T["a"])(L,i,a,!1,null,"7730da4e",null));e["default"]=R.exports},"028b":function(t,e,s){},"039b":function(t,e,s){"use strict";var i=s("81a9"),a=s("bff7");e["a"]={get_snapshot_list(t){return Object(i["a"])(Object(a["b"])("GET","/snapshot/snapshot_list/",t))},get_snapshot_chains_list(t){return Object(i["a"])(Object(a["b"])("GET","/snapshot/snapshot_chains_list/",t))},chains_detail(t){return Object(i["a"])(Object(a["b"])("GET","/snapshot/snapshot_chains_detail/",t))},record(t){return Object(i["a"])(Object(a["b"])("GET","/snapshot/history_record/",t))},get_monitor_id(t){return Object(i["a"])(Object(a["b"])("GET","/snapshot/snapshot_disk_ids/",t))},get_snapshot_info(t){return Object(i["a"])(Object(a["i"])("POST","/snapshot/snapshot_use_monitor",t))}}},"08fe":function(t,e,s){},"0da7":function(t,e,s){},"0f8f":function(t,e,s){"use strict";s("2ce8")},"0faa":function(t,e,s){"use strict";s.r(e);var i=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",{staticClass:"info"},[t._m(0),e("div",{staticClass:"item"},t._l(t.base_info,(function(s,i){return e("div",{key:i},[e("span",{staticClass:"m-right20"},[t._v(t._s(s.label))]),e("span",[t._v(t._s(s.value))])])})),0),e("div",{staticClass:"progress"},t._l(t.progress_info,(function(s,i){return e("div",{key:i,staticClass:"bar"},[e("div",{staticClass:"flex-between m-bottom5"},[e("span",[t._v(t._s(s.label))])]),e("el-progress",{attrs:{"stroke-width":16,color:"#455cc6",percentage:Math.round(s.percentage)}}),e("div",{staticClass:"flex-between m-top5"},[e("span",[t._v("已用："+t._s(s.used+"/"+s.total))]),e("span",[t._v("可用："+t._s(s.available))])])],1)})),0)])},a=[function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",{staticClass:"icon"},[e("i",{staticClass:"iconfont icon-xinxi",staticStyle:{"font-size":"100px"}})])}],o=s("9ab4"),l=s("1b40"),r=s("3673"),n=s("da8b");let c=class extends l["e"]{constructor(){super(...arguments),this.base_info={cluster_count:{label:"集群",value:"10"},host_count:{label:"主机",value:"20"},ecs_count:{label:"虚拟机",value:"100"}},this.progress_info={cpu:{label:"CPU",used:"200GHz",available:"",total:"4THz",percentage:0},memory:{label:"内存",used:"0",available:"",total:"0TB",percentage:0},gpu:{label:"GPU",used:"0块",available:"",total:"100块",breakdown:"20块",percentage:0},storage:{label:"存储",used:"0TB",available:"",total:"0TB",percentage:0}},this.detail_info={}}created(){this.get_pod_outline()}watch_az(t){t&&this.get_pod_outline()}async get_pod_outline(){if(!this.$store.state.az_id)return;let t=await n["a"].get_pod_outline({az_id:this.$store.state.az_id,pod_id:this.$route.params.id});if("Success"===t.code){this.detail_info=t.data;for(let t in this.base_info)this.base_info[t].value=this.detail_info[t];this.progress_info.cpu={...this.progress_info.cpu,used:this.detail_info.cpu_statistic.used+"核",total:this.detail_info.cpu_statistic.total+"核",available:this.detail_info.cpu_statistic.available+"核",percentage:100*this.detail_info.cpu_statistic.rate},this.progress_info.memory={...this.progress_info.memory,used:this.detail_info.ram_statistic.used+"TB",total:this.detail_info.ram_statistic.total+"TB",available:this.detail_info.ram_statistic.available+"TB",percentage:100*this.detail_info.ram_statistic.rate},this.progress_info.gpu={...this.progress_info.gpu,used:this.detail_info.gpu_statistic.used+"个",total:this.detail_info.gpu_statistic.total+"个",available:this.detail_info.gpu_statistic.available+"个",percentage:100*this.detail_info.gpu_statistic.rate,breakdown:this.detail_info.gpu_statistic.fault+"块"},this.progress_info.storage={...this.progress_info.storage,used:this.detail_info.storage_statistic.used+"TB",total:this.detail_info.storage_statistic.total+"TB",available:this.detail_info.storage_statistic.available+"TB",percentage:100*this.detail_info.storage_statistic.rate}}}};Object(o["a"])([Object(l["c"])({default:""})],c.prototype,"cluster_id",void 0),Object(o["a"])([Object(l["f"])("$store.state.az_id")],c.prototype,"watch_az",null),c=Object(o["a"])([Object(l["a"])({components:{SvgIcon:r["a"]}})],c);var _=c,d=_,u=(s("a176"),s("2877")),p=Object(u["a"])(d,i,a,!1,null,"0461030c",null);e["default"]=p.exports},"13d5":function(t,e,s){"use strict";var i=s("23e7"),a=s("d58f").left,o=s("a640"),l=s("1212"),r=s("9adc"),n=!r&&l>79&&l<83,c=n||!o("reduce");i({target:"Array",proto:!0,forced:c},{reduce:function(t){var e=arguments.length;return a(this,t,e,e>1?arguments[1]:void 0)}})},1477:function(t,e,s){"use strict";var i=s("81a9"),a=s("bff7");e["a"]={get_host_list(t){return Object(i["a"])(Object(a["d"])("POST","/host/get_host_list/",t))},get_room_list(t){return Object(i["a"])(Object(a["d"])("GET","/host/machine_room_list/",t))},get_status_list(t){return Object(i["a"])(Object(a["d"])("GET","/host/host_status_list/",t))},external_management(t){return Object(i["a"])(Object(a["d"])("GET","/host/external_management/",t))},migrate(t){return Object(i["a"])(Object(a["d"])("POST","/host/migration_operation/",t))},disperse(t){return Object(i["a"])(Object(a["d"])("POST","/host/disperse_operation/",t))},record(t){return Object(i["a"])(Object(a["d"])("POST","/host/host_operation_record/",t))},recommended_host(t){return Object(i["a"])(Object(a["d"])("POST","/host/recommended_host/",t))},host_maintenance(t){return Object(i["a"])(Object(a["d"])("POST","/host/host_maintenance/",t))},finish_maintenance(t){return Object(i["a"])(Object(a["d"])("POST","/host/host_finish_maintenance/",t))},shelves(t){return Object(i["a"])(Object(a["d"])("POST","/host/host_off_shelves/",t))},get_detail_overview(t){return Object(i["a"])(Object(a["d"])("GET","/host/host_main_details/",t))},get_detail_storage(t){return Object(i["a"])(Object(a["d"])("GET","/host/host_disk/",t))},down(t){return Object(i["a"])(Object(a["d"])("GET","/host/host_list_download/",t))},host_operate(t){return Object(i["a"])(Object(a["d"])("POST","/host/operate/",t))},host_import(t){return Object(i["a"])(Object(a["d"])("POST","/host/import/",t))},get_host_attribution(t){return Object(i["a"])(Object(a["d"])("GET","/host/get_host_attribution/",t))},set_host_attribution(t){return Object(i["a"])(Object(a["d"])("POST","/host/set_host_attribution/",t))},get_host_type(t){return Object(i["a"])(Object(a["d"])("GET","/host/get_host_config/",t))},update_attribute(t){return Object(i["a"])(Object(a["d"])("POST","/host/set_host_config/",t))},getCustomerList(t){return Object(i["a"])(Object(a["d"])("POST","/host/get_customer_list/",t))},getFamilyList(t){return Object(i["a"])(Object(a["d"])("POST","/host/get_family_list/",t))},finish_validate(t){return Object(i["a"])(Object(a["d"])("POST","/host/verification_finish/",t))},get_host_recycle_department(t){return Object(i["a"])(Object(a["d"])("GET","/host/get_host_recycle_department/",t))},get_host_list_field(t){return Object(i["a"])(Object(a["d"])("GET","/host/get_host_list_field/",t))},get_task_list(t){return Object(i["a"])(Object(a["d"])("GET","/host/business_test_task/",t))},create_test_task(t){return Object(i["a"])(Object(a["d"])("POST","/host/create_test_task/",t))},get_host_filter_item(t){return Object(i["a"])(Object(a["d"])("POST","/host/get_host_filter_item/",t))},set_remark(t){return Object(i["a"])(Object(a["d"])("POST","/host/set_host_remark/",t))},set_flag(t){return Object(i["a"])(Object(a["d"])("POST","/host/set_host_tag/",t))},update_ecs_info(t){return Object(i["a"])(Object(a["d"])("POST","/ecs/update_ecs_info/",t))},crash_clear(t){return Object(i["a"])(Object(a["b"])("POST","/host/crash_clear/",t))},crash_recover(t){return Object(i["a"])(Object(a["b"])("POST","/host/crash_recover/",t))},set_lock(t){return Object(i["a"])(Object(a["d"])("POST","/host/host_lock/",t))},set_unlock(t){return Object(i["a"])(Object(a["d"])("POST","/host/host_unlock/",t))},set_maintenance(t){return Object(i["a"])(Object(a["d"])("POST","/host/host_maintenance/",t))},get_maintenance_record(t){return Object(i["a"])(Object(a["d"])("GET","/host/host_maintenance_record/",t))},get_lock_record(t){return Object(i["a"])(Object(a["d"])("GET","/host/host_lock_record/",t))},recover_storage_error(t){return Object(i["a"])(Object(a["d"])("POST","/host/recover_storage_error/",t))},agent_update(t){return Object(i["a"])(Object(a["d"])("POST","/host/handle_host_agent_update/",t))},agent_rollback(t){return Object(i["a"])(Object(a["d"])("POST","/host/handle_host_agent_rollback/",t))},set_prepare_host(t){return Object(i["a"])(Object(a["d"])("POST","/host/set_prepare_host/",t))},get_ovs_version(t){return Object(i["a"])(Object(a["d"])("GET","/host/ovs_version_list/",t))},update_host_power_status(t){return Object(i["a"])(Object(a["d"])("POST","/host/update_host_power_status/",t))},update_ecs_status(t){return Object(i["a"])(Object(a["d"])("POST","/host/update_host_ecs_status/",t))}}},"14a9":function(t,e,s){"use strict";var i=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",[e("el-dialog",{attrs:{title:t.title,visible:t.visible_sync,width:"760px","destroy-on-close":!0,"close-on-click-modal":!1},on:{"update:visible":function(e){t.visible_sync=e},close:t.back}},[e("div",["restart_host"===t.oper_type?e("el-alert",{attrs:{title:"操作重启请检查是否有虚机运行，若有，请谨慎操作！",type:"warning",center:"",closable:!1}}):t._e(),["lock","maintenance"].includes(t.oper_type)?t._e():e("el-alert",{attrs:{title:t.alert_title,type:"warning",center:"",closable:!1}}),["lock","maintenance"].includes(t.oper_type)?e("el-alert",{attrs:{title:"lock"===t.oper_type?"请确认将下述机器置为锁定状态，置为锁定状态后，无法在此机器上开出云主机":"请确认将下述机器置为维护状态，置为维护状态后，机器将屏蔽告警和任务下发等功能",type:"warning",center:"",closable:!1}}):t._e(),e("el-table",{attrs:{data:t.list,border:"","max-height":"253"}},[e("el-table-column",{attrs:{prop:"host_name",label:"主机名",width:"150"}}),["lock","maintenance"].includes(t.oper_type)?e("el-table-column",{attrs:{prop:"out_band_address",label:"宿主机带外"}}):t._e(),"finish_validate"===t.oper_type?e("el-table-column",{attrs:{prop:"az_name",label:"区域"}}):t._e(),[...t.status_list,...t.flag_list].includes(t.title)?t._e():e("el-table-column",{attrs:{prop:"machine_status_name",label:"主机状态"}}),["lock"].includes(t.oper_type)?e("el-table-column",{attrs:{prop:"ecs_count",label:"虚拟机数量",width:"150"}}):t._e(),["lock","maintenance"].includes(t.oper_type)?t._e():e("el-table-column",{attrs:{prop:"power_status_name",label:"电源状态"}}),["schedule","migrate_flag","cheat"].includes(t.oper_type)?e("el-table-column",{attrs:{prop:"machine_status_name",label:"机器状态"}}):t._e(),"finish_validate"===t.oper_type?e("el-table-column",{attrs:{prop:"host_purpose",label:"主机用途"}}):t._e(),["finish_validate","shelves"].includes(t.oper_type)?e("el-table-column",{attrs:{prop:"host_source",label:"主机来源"}}):t._e(),["schedule"].includes(t.oper_type)?e("el-table-column",{attrs:{prop:"scheduled_display",label:"允许调度"}}):t._e(),["migrate_flag"].includes(t.oper_type)?e("el-table-column",{attrs:{prop:"migrated_display",label:"允许迁移"}}):t._e(),["cheat"].includes(t.oper_type)?e("el-table-column",{attrs:{prop:"dummy_display",label:"欺骗器"}}):t._e(),["change_cluster"].includes(t.oper_type)?e("el-table-column",{attrs:{prop:"cluster_name",label:"当前集群"}}):t._e(),["maintenance"].includes(t.oper_type)?e("el-table-column",{attrs:{prop:"maintenance",label:"维护原因"},scopedSlots:t._u([{key:"default",fn:function(s){return[e("el-input",{attrs:{type:"textarea",placeholder:"请输入维护原因",maxlength:"50","show-word-limit":""},model:{value:s.row.maintenanceReason,callback:function(e){t.$set(s.row,"maintenanceReason",e)},expression:"scope.row.maintenanceReason"}}),e("div",{directives:[{name:"show",rawName:"v-show",value:!s.row.maintenanceReason,expression:"!scope.row.maintenanceReason"}],staticClass:"error_message"},[t._v("请输入维护原因")])]}}],null,!1,3682531027)}):t._e(),["lock"].includes(t.oper_type)?e("el-table-column",{attrs:{prop:"lock",label:"锁定原因"},scopedSlots:t._u([{key:"default",fn:function(s){return[e("el-input",{attrs:{type:"textarea",placeholder:"请输入锁定原因",maxlength:"50","show-word-limit":""},model:{value:s.row.lockReason,callback:function(e){t.$set(s.row,"lockReason",e)},expression:"scope.row.lockReason"}}),e("div",{directives:[{name:"show",rawName:"v-show",value:!s.row.lockReason,expression:"!scope.row.lockReason"}],staticClass:"error_message"},[t._v("请输入锁定原因")])]}}],null,!1,2858309765)}):t._e()],1),t.notSelectVmList.length>0?e("div",{staticClass:"m-top10"},[e("span",{staticClass:"tip_message"},[t._v("仅支持对状态为“锁定中”且无虚拟机运行的宿主机进行“设置维护”操作，有"+t._s(t.notSelectVmList.length)+"台宿主机不满足要求")])]):t._e(),["shelves","finish_validate","schedule","migrate_flag","cheat","change_cluster"].includes(t.oper_type)?e("el-form",{ref:"form",staticClass:"m-top20",attrs:{model:t.form_data,"label-width":"100px","label-position":"left"}},["finish_validate"===t.oper_type?e("el-form-item",{attrs:{prop:"valid",label:"验证结果:",rules:[{required:!0,message:"请选择验证结果",trigger:"blur"}]}},[e("el-radio-group",{model:{value:t.form_data.valid,callback:function(e){t.$set(t.form_data,"valid",e)},expression:"form_data.valid"}},[e("el-radio",{attrs:{label:"1"}},[t._v("成功")]),e("el-radio",{attrs:{label:"0"}},[t._v("失败")])],1)],1):t._e(),["schedule","migrate_flag","cheat"].includes(t.oper_type)?e("el-form-item",{attrs:{prop:"isFlag",label:t.labelObj[t.oper_type]}},[e("el-radio-group",{model:{value:t.form_data.isSet,callback:function(e){t.$set(t.form_data,"isSet",e)},expression:"form_data.isSet"}},[e("el-radio",{attrs:{label:"1"}},[t._v(t._s(t.valueObj[t.oper_type][0]))]),e("el-radio",{attrs:{label:"0"}},[t._v(t._s(t.valueObj[t.oper_type][1]))])],1)],1):t._e(),["schedule","migrate_flag","cheat"].includes(t.oper_type)||"finish_validate"===t.oper_type&&"0"===t.form_data.valid?e("el-form-item",{attrs:{prop:"reason",label:"说明:"}},[e("el-input",{attrs:{type:"textarea","show-word-limit":"",maxlength:["schedule","migrate_flag","cheat"].includes(t.oper_type)?128:256},model:{value:t.form_data.reason,callback:function(e){t.$set(t.form_data,"reason",e)},expression:"form_data.reason"}})],1):t._e(),["schedule","migrate_flag","cheat","change_cluster"].includes(t.oper_type)?t._e():e("el-form-item",{attrs:{prop:"recycleId",label:"finish_validate"===t.oper_type?"通知对象：":"回收部门：",rules:[{required:!0,message:"请选择"+("finish_validate"===t.oper_type?"通知对象":"回收部门"),trigger:"blur"}]}},[e("el-select",{model:{value:t.form_data.recycleId,callback:function(e){t.$set(t.form_data,"recycleId",e)},expression:"form_data.recycleId"}},t._l(t.recycle_list,(function(t){return e("el-option",{key:t.department_en,attrs:{label:t.department_name,value:t.department_name}})})),1)],1),"change_cluster"===t.oper_type?e("el-form-item",{attrs:{prop:"reason",label:"选择集群:"}},[e("el-select",{attrs:{placeholder:"请选择要加入的集群"},model:{value:t.form_data.toCluster,callback:function(e){t.$set(t.form_data,"toCluster",e)},expression:"form_data.toCluster"}},t._l(t.cluster_list,(function(t){return e("el-option",{key:t.cluster_id,attrs:{value:t.cluster_id,label:t.cluster_name}})})),1)],1):t._e()],1):t._e()],1),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{attrs:{type:"primary",disabled:0===t.list.length},on:{click:t.confirm}},[t._v("确认")]),e("el-button",{on:{click:function(e){return t.back("0")}}},[t._v("取消")])],1)])],1)},a=[],o=(s("14d9"),s("e9f5"),s("7d54"),s("ab43"),s("a732"),s("9ab4")),l=s("1b40"),r=s("c811"),n=s("1477"),c=s("da8b"),_=s("3fa7"),d=s("6285");let u=class extends l["e"]{constructor(){super(...arguments),this.alert_title=`是否确定对以下${this.rows.length}台物理机执行${this.title}操作？`,this.status_list=["开机","关机","重启"],this.flag_list=["调度标记","迁移标记","欺骗器管理"],this.valid=1,this.isFlag=1,this.selectVmList=[],this.notSelectVmList=[],this.list=[],this.cluster_list=[],this.labelObj={schedule:"是否允许调度",migrate_flag:"是否允许迁移",cheat:"欺骗器"},this.op_typ_list={schedule:"set_host_scheduled",migrate_flag:"set_host_migrated",cheat:"set_host_dummy"},this.op_typ_req={schedule:"scheduled",migrate_flag:"migrated",cheat:"dummy"},this.valueObj={schedule:["是","否"],migrate_flag:["是","否"],cheat:["有","无"]},this.recycle_list=[],this.form_data={valid:"",recycleId:"",reason:"",isSet:"cheat"===this.oper_type?"0":"1",toCluster:""},this.operate_info={start_up_host:"host_operate",shutdown_host:"host_operate",restart_host:"host_operate",online_maintenance:"host_maintenance",offline_maintenance:"host_maintenance",finish:"finish_maintenance",shelves:"shelves",disperse:"disperse",finish_validate:"finish_validate",schedule:"set_flag",migrate_flag:"set_flag",cheat:"set_flag",under_sync:"update_ecs_info",data_clear:"crash_clear",down_recover:"crash_recover",lock:"set_lock",unlock:"set_unlock",maintenance:"set_maintenance",change_cluster:"add_cluster",unstore_exception:"recover_storage_error",set_prepar_host:"set_prepare_host",set_resource_pools:"set_prepare_host"}}created(){["shelves","finish_validate"].includes(this.oper_type)&&this.get_host_recycle_department(),"change_cluster"===this.oper_type&&this.getClusterList(),"maintenance"===this.oper_type?(this.rows.forEach(t=>{"lock"===t.machine_status&&0===t.ecs_count?this.selectVmList.push(t):this.notSelectVmList.push(t)}),this.list=this.selectVmList.map(t=>({...t,maintenanceReason:""}))):"lock"===this.oper_type?this.list=this.rows.map(t=>({...t,lockReason:""})):(this.list=[],this.list=[...this.list,...this.rows])}async getClusterList(){let t=Object(d["a"])(this.$route.params.id),e={page_index:1,page_size:1e3,az_id:this.$store.state.az_id,pod_id:"pod_host"===this.$route.name?this.$route.params.id:t},s=await c["a"].get_pod_cluster_list(e);"Success"===s.code&&(this.cluster_list=s.data.result)}async get_host_recycle_department(){let t=await n["a"].get_host_recycle_department({});"Success"===t.code&&(this.recycle_list=t.data)}async confirm(){if(console.log(this.rows[0].host_id,"-------",this.oper_type),["shelves","finish_validate"].includes(this.oper_type)){let t=!0,e=this.$refs.form;if(e.validate(e=>{e||(t=!1)}),!t)return!1}if("maintenance"===this.oper_type){let t=this.list.some(t=>!t.maintenanceReason);if(t)return!1}if("lock"===this.oper_type){let t=this.list.some(t=>!t.lockReason);if(t)return!1}const t=this.list.map(t=>({host_id:t.host_id,reason:t.maintenanceReason})),e=this.list.map(t=>({host_id:t.host_id,reason:t.lockReason})),s=this.list.map(t=>({host_id:t.host_id,cluster_id:this.form_data.toCluster})),i=this.list.map(t=>({host_id:t.host_id,cluster_id:"0-0"})),a="set_prepar_host"===this.oper_type?"prepare_host":"resource_pool";let o=this.status_list.includes(this.title)?{op_type:this.oper_type,host_ids:this.rows.map(t=>t.host_id)}:["schedule","migrate_flag","cheat"].includes(this.oper_type)?{host_ids:this.rows.map(t=>t.host_id),[this.op_typ_req[this.oper_type]]:Number(this.form_data.isSet),description:this.form_data.reason,op_type:this.op_typ_list[this.oper_type]}:["online_maintenance","offline_maintenance"].includes(this.oper_type)?{maintenance_type:this.oper_type,host_ids:this.rows.map(t=>t.host_id)}:"finish_validate"===this.oper_type?{host_ids:this.rows.map(t=>t.host_id),status:"1"===this.form_data.valid?"READY":"INIT_ERROR",noticer:this.form_data.recycleId,reason:"0"===this.form_data.valid?this.form_data.reason:void 0}:"shelves"===this.oper_type?{host_ids:this.rows.map(t=>t.host_id),department_name:this.form_data.recycleId}:"under_sync"===this.oper_type?{pod_id:this.$store.state.pod_id,host_ecs:{}}:"maintenance"===this.oper_type?{maintenance_detail:t,host_ids:this.list.map(t=>t.host_id)}:"lock"===this.oper_type?{lock_detail:e,host_ids:this.list.map(t=>t.host_id)}:"change_cluster"===this.oper_type?{param:s}:"remove_cluster"===this.oper_type?{param:i,is_move_out:"1"}:"set_prepar_host"===this.oper_type||"set_resource_pools"===this.oper_type?{host_id:this.rows[0].host_id,set_type:a}:{host_ids:this.rows.map(t=>t.host_id)};if("under_sync"===this.oper_type)for(let r of this.rows)o.host_ecs[r.host_id]=[],r.ecs_list.length>0&&r.ecs_list.map(t=>{o.host_ecs[r.host_id].push(t.ecs_id)});let l={};if(l="change_cluster"!==this.oper_type&&"remove_cluster"!==this.oper_type?await n["a"][this.operate_info[this.oper_type]]({...o}):await c["a"].add_cluster({...o}),"Success"===l.code)if(["finish_validate","disperse","under_sync","set_prepar_host","set_resource_pools"].includes(this.oper_type))this.$message.success(l.message),this.back("1");else if(["data_clear","down_recover","change_cluster","remove_cluster"].includes(this.oper_type)){if(l.data.fail_host_list.length>0)return this.$message.warning(l.message+"。"+l.data.error_msg),void this.back("0");this.$message.success(l.message),this.back("1"),["change_cluster","remove_cluster"].includes(this.oper_type)&&_["a"].$emit("getTreeData",!1)}else if(l.data.fail_host_list.length>0){if("maintenance"!==this.oper_type)return this.$message.warning(l.message+l.data.fail_msg),void this.back("0");{let t="";for(let e in l.data.fail_msg_group_by_host)t+=l.data.fail_msg_group_by_host[e]+"\n";this.$message.error(t),this.back("0")}}else this.$message.success(l.message),this.back("1");else this.back("0")}back(t){this.visible_sync=!1}};Object(o["a"])([Object(l["d"])("visible")],u.prototype,"visible_sync",void 0),Object(o["a"])([Object(l["c"])({default:()=>[]})],u.prototype,"rows",void 0),Object(o["a"])([Object(l["c"])(String)],u.prototype,"title",void 0),Object(o["a"])([Object(l["c"])(String)],u.prototype,"oper_type",void 0),Object(o["a"])([Object(l["b"])("close")],u.prototype,"back",null),u=Object(o["a"])([Object(l["a"])({components:{ActionBlock:r["a"]}})],u);var p=u,h=p,m=s("2877"),b=Object(m["a"])(h,i,a,!1,null,null,null);e["a"]=b.exports},"1ac7":function(t,e,s){"use strict";s("7c69")},"1b7c":function(t,e,s){"use strict";var i=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("el-tooltip",{attrs:{content:t.content,placement:t.placement,effect:t.effect,"popper-class":"tooltip-class"},scopedSlots:t._u([{key:"content",fn:function(){return[t._t("content")]},proxy:!0}],null,!0)},[e("el-button",{attrs:{type:"text"}},[e("svg-icon",{attrs:{icon:"info",viewBox:"0 0 18 18"}})],1)],1)},a=[],o=s("9ab4"),l=s("1b40"),r=s("3673");let n=class extends l["e"]{};Object(o["a"])([Object(l["c"])({default:""})],n.prototype,"content",void 0),Object(o["a"])([Object(l["c"])({default:"right"})],n.prototype,"placement",void 0),Object(o["a"])([Object(l["c"])({default:"light"})],n.prototype,"effect",void 0),n=Object(o["a"])([Object(l["a"])({components:{svgIcon:r["a"]}})],n);var c=n,_=c,d=(s("74c5"),s("2877")),u=Object(d["a"])(_,i,a,!1,null,null,null);e["a"]=u.exports},"1c98":function(t,e,s){"use strict";var i=s("81a9"),a=s("bff7");e["a"]={create(t){return Object(i["a"])(Object(a["b"])("POST","/ebs/create_disk/",t))},get_disk_type(t){return Object(i["a"])(Object(a["b"])("GET","/ebs/disk_info/",t))},get_price(t){return Object(i["a"])(Object(a["b"])("POST","/ecs/get_price/",t))},get_capacity_price(t){return Object(i["a"])(Object(a["b"])("POST","/ebs/get_ebs_price/",t))},get_disk_limit(t){return Object(i["a"])(Object(a["b"])("POST","/ebs/get_disk_limit/",t))},get_disk_detail(t){return Object(i["a"])(Object(a["b"])("GET","/ebs/get_disk_detail/",t))},getDiskRules(t){return Object(i["a"])(Object(a["b"])("POST","/ebs/disk_rules/",t))}}},"1e5a":function(t,e,s){"use strict";var i=s("23e7"),a=s("9961"),o=s("5320"),l=s("dad2"),r=!l("symmetricDifference")||!o("symmetricDifference");i({target:"Set",proto:!0,real:!0,forced:r},{symmetricDifference:a})},"1e70":function(t,e,s){"use strict";var i=s("23e7"),a=s("a5f7"),o=s("d039"),l=s("dad2"),r=!l("difference",(function(t){return 0===t.size})),n=r||o((function(){var t={size:1,has:function(){return!0},keys:function(){var t=0;return{next:function(){var s=t++>1;return e.has(1)&&e.clear(),{done:s,value:2}}}}},e=new Set([1,2,3,4]);return 3!==e.difference(t).size}));i({target:"Set",proto:!0,real:!0,forced:n},{difference:a})},"1f00":function(t,e,s){"use strict";var i=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("el-dialog",{attrs:{title:"制作公共镜像",visible:t.visible_sync,width:"500px","destroy-on-close":!0,"close-on-click-modal":!1},on:{"update:visible":function(e){t.visible_sync=e}}},[e("el-form",{ref:"form_ecs",attrs:{model:t.form_data,"label-position":"left","label-width":"100px","label-suffix":":"}},[e("el-form-item",{staticClass:"content",attrs:{label:"实例名称/ID"}},[e("span",[t._v(t._s(t.form_data.ecs))])]),e("el-form-item",{staticClass:"content",attrs:{label:"客户名称/ID"}},[e("span",[t._v(t._s(t.form_data.customer))])]),e("el-form-item",{staticClass:"content",attrs:{label:"可用区"}},[e("span",[t._v(t._s(t.form_data.az))])]),e("el-form-item",{staticClass:"content",attrs:{label:"实例规格"}},[e("span",[t._v(t._s(t.form_data.spec))])]),e("el-form-item",{staticClass:"content",attrs:{label:"系统盘"}},[e("span",[t._v(t._s(t.form_data.system_disk))])]),e("el-form-item",{staticClass:"content",attrs:{label:"镜像"}},[e("span",[t._v(t._s(t.form_data.mirror))])]),e("el-form-item",{attrs:{label:"镜像名称",prop:"name",rules:[{required:!0,message:"请输入镜像名称",trigger:"blur"}]}},[e("el-input",{model:{value:t.form_data.name,callback:function(e){t.$set(t.form_data,"name",e)},expression:" form_data.name"}})],1),e("el-form-item",{staticClass:"test",attrs:{label:"测试账户ID",prop:"test_id",rules:[{required:!0,trigger:"blur",validator:t.validate_account}]}},[e("div",{staticClass:"test"},[e("customer-input",{on:{FnCustomer:t.FnCustomer}})],1),e("el-tooltip",{attrs:{content:"请选择测试账户ID，待镜像制作完成进行测试",placement:"right",effect:"light"}},[e("el-button",{staticClass:"m-left10",attrs:{type:"text"}},[e("svg-icon",{attrs:{icon:"info"}})],1)],1)],1)],1),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{attrs:{type:"primary"},on:{click:t.confirm}},[t._v("确 定")]),e("el-button",{on:{click:t.cancel}},[t._v("取 消")])],1)],1)},a=[],o=(s("d9e2"),s("9ab4")),l=s("1b40"),r=s("3673"),n=s("e527"),c=s("bad9");let _=class extends l["e"]{constructor(){super(...arguments),this.form_data={ecs:`${this.ecs_info.ecs_name} / ${this.ecs_info.ecs_id}`,customer:`${this.ecs_info.customer_name} / ${this.ecs_info.customer_id}`,az:this.ecs_info.az_name,spec:this.ecs_info.is_gpu?`${this.ecs_info.cpu_size}vCPU${this.ecs_info.ram_size}GiB  ${this.ecs_info.gpu_size}*${this.ecs_info.gpu_show_type}`:`${this.ecs_info.cpu_size}vCPU${this.ecs_info.ram_size}GiB`,system_disk:this.new?`${this.ecs_info.disk_info.system.system_disk_type} ${this.ecs_info.disk_info.system.disk_size}GB`:`${this.ecs_info.system_disk_type} ${this.ecs_info.system_disk_size}GB`,mirror:this.ecs_info.os_name,name:"",test_id:""}}FnCustomer(t){this.form_data.test_id=t}validate_account(t,e,s){return 0===e.length?s(new Error("请选择测试账户ID")):s()}async confirm(){let t=this.$refs.form_ecs;t.validate(async t=>{if(t){let t=await n["a"].add_common_mirror({display_name:this.form_data.name,az_id:this.ecs_info.az_id,ecs_id:this.ecs_info.ecs_id,customer_id:this.ecs_info.customer_id,customer_ids:this.form_data.test_id});"Success"===t.code&&this.$message.success(t.message),this.visible_sync=!1}})}cancel(){this.visible_sync=!1}};Object(o["a"])([Object(l["d"])("visible")],_.prototype,"visible_sync",void 0),Object(o["a"])([Object(l["c"])({default:()=>{}})],_.prototype,"ecs_info",void 0),Object(o["a"])([Object(l["c"])({default:!1})],_.prototype,"new",void 0),_=Object(o["a"])([Object(l["a"])({components:{SvgIcon:r["a"],CustomerInput:c["a"]}})],_);var d=_,u=d,p=(s("f6ea"),s("2877")),h=Object(p["a"])(u,i,a,!1,null,"22e3d05c",null);e["a"]=h.exports},2025:function(t,e,s){},2443:function(t,e,s){"use strict";s("549f")},"268f":function(t,e,s){"use strict";var i=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",[e("el-dialog",{attrs:{title:"操作记录",visible:t.visible,width:"60%","destroy-on-close":!0,"close-on-click-modal":!1},on:{"update:visible":function(e){t.visible=e},close:t.back}},[e("div",[e("el-dialog",{attrs:{title:"响应信息",visible:t.res_visible,width:"60%","destroy-on-close":!0,"append-to-body":"","custom-class":"response-data"},on:{"update:visible":function(e){t.res_visible=e},close:t.clost_res}},[e("div",[t._v(t._s(t.response))])])],1),e("div",[e("action-block",{attrs:{search_option:["physical","message"].includes(t.type)?{...t.search}:t.search},on:{"fn-search":t.fn_search}}),["physical","message"].includes(t.type)?e("div",{staticClass:"icon m-bottom10"},[e("el-tooltip",{attrs:{content:"刷新",placement:"bottom",effect:"light"}},[e("el-button",{attrs:{type:"text"},on:{click:t.getOperateRecordList}},[e("svg-icon",{staticClass:"refresh",attrs:{icon:"refresh"}})],1)],1)],1):t._e(),e("el-table",{staticClass:"record-table",attrs:{data:t.record_list,border:""}},[e("el-table-column",{attrs:{prop:"oper_time",label:"操作时间"},scopedSlots:t._u([{key:"default",fn:function(s){return[e("span",[t._v(t._s(s.row.oper_time?t.moment(s.row.oper_time).format("YYYY-MM-DD HH:mm:ss"):""))])]}}])}),e("el-table-column",{attrs:{prop:"oper_type_display",label:"操作内容"}}),e("el-table-column",{attrs:{prop:"status_display",label:"状态"}}),["message","physical"].includes(t.type)?e("el-table-column",{attrs:{prop:"response",label:"响应信息"},scopedSlots:t._u([{key:"default",fn:function(s){return[s.row.response?e("el-button",{attrs:{type:"text"},on:{click:function(e){return t.view(s.row.response)}}},[t._v("查看")]):e("span",[t._v("-")])]}}])}):e("el-table-column",{attrs:{prop:"response",label:"响应信息"},scopedSlots:t._u([{key:"default",fn:function(s){return[s.row.result?e("el-button",{attrs:{type:"text"},on:{click:function(e){return t.view(s.row.result)}}},[t._v("查看")]):e("span",[t._v("-")])]}}],null,!1,79404134)}),e("el-table-column",{attrs:{prop:"finish_time",label:"完成时间"},scopedSlots:t._u([{key:"default",fn:function(s){return[e("span",[t._v(t._s(s.row.finish_time?t.moment(s.row.finish_time).format("YYYY-MM-DD HH:mm:ss"):""))])]}}])}),e("el-table-column",{attrs:{prop:"oper_user",label:"nas"===t.type?"操作用户":"用户名"}}),["physical","message"].includes(t.type)?t._e():e("el-table-column",{attrs:{prop:"flag_display",label:"操作标识"}})],1),e("el-pagination",{attrs:{"current-page":t.current,"page-sizes":[20,50,100],"page-size":t.size,layout:"total, sizes, prev, pager, next, jumper",total:t.total},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}}),e("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{attrs:{type:"primary"},on:{click:t.back}},[t._v("返回")])],1)],1)])],1)},a=[],o=s("9ab4"),l=s("1b40"),r=s("c811"),n=s("d772"),c=s("1477"),_=s("e4d0"),d=s("039b"),u=s("fc43"),p=s("c1df"),h=s.n(p),m=s("8ce4"),b=s("3673");let f=class extends l["e"]{constructor(){super(...arguments),this.state_list=[{type:"",label:"全部"},{type:"doing",label:"执行中"},{type:"success",label:"成功"},{type:"failed",label:"失败"}],this.search={state:{list:this.state_list,placeholder:"请选择状态"},content:{placeholder:"请输入操作内容"}},this.record_list=[],this.current=1,this.size=20,this.total=0,this.search_data={},this.moment=h.a,this.response="",this.res_visible=!1}created(){this.fn_search()}fn_search(t={}){this.current=1,this.search_data=t,this.getOperateRecordList()}async getOperateRecordList(){let t;const{search_data:e}=this;let s="physical"!==this.type?{task_type:e.content,cloud_id:this.record_id}:{content:e.content,cloud_id:this.record_id,cloud_type:"host"},i={status:e.state||"",page_size:this.size,page_index:this.current,...s};if(t="physical"===this.type?await c["a"].record({...i}):"message"===this.type?await _["a"].get_pub_operate_record({os_id:this.record_id,status:e.state||"",content_type:e.content,page_size:this.size,page_index:this.current}):"snapshot"===this.type?await d["a"].record({cloud_id:this.record_id,cloud_type:"snapshot",status:e.state||"",task_type:e.content,page_size:this.size,page_index:this.current}):"nas"===this.type?await u["a"].get_nas_record({...i}):await n["a"].get_operate_record_list({cloud_type:this.type?this.type:"ecs",...i}),"Success"===t.code){var a,o;if(["physical","message"].includes(this.type)){let e=["create_time","content","status_name","response","update_time","op_user"],s=["oper_time","oper_type_display","status_display","response","finish_time","oper_user"];this.record_list=Object(m["b"])(t.data.operation_list,s,e)}else{var l;this.record_list=(null===(l=t.data)||void 0===l?void 0:l.history_record)||[]}this.total=(null===(a=t.data)||void 0===a||null===(o=a.page_info)||void 0===o?void 0:o.count)||0}}handleSizeChange(t){this.size=t,this.getOperateRecordList()}handleCurrentChange(t){this.current=t,this.getOperateRecordList()}view(t){this.response=t,this.res_visible=!0}clost_res(){this.res_visible=!1,this.response=""}back(){}};Object(o["a"])([Object(l["c"])(Boolean)],f.prototype,"visible",void 0),Object(o["a"])([Object(l["c"])(String)],f.prototype,"record_id",void 0),Object(o["a"])([Object(l["c"])(String)],f.prototype,"type",void 0),Object(o["a"])([Object(l["b"])("close")],f.prototype,"back",null),f=Object(o["a"])([Object(l["a"])({components:{ActionBlock:r["a"],SvgIcon:b["a"]}})],f);var g=f,v=g,y=(s("f813"),s("2877")),k=Object(y["a"])(v,i,a,!1,null,null,null);e["a"]=k.exports},"29ab":function(t,e,s){"use strict";var i=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("el-form",{ref:"resetForm",staticClass:"pwd-form",attrs:{model:t.data,"label-position":"left","label-width":"120px",rules:t.rules,"inline-message":!0}},[e("el-form-item",{attrs:{label:"镜像"}},[e("el-radio-group",{model:{value:t.default_os_template_type.os_template_type,callback:function(e){t.$set(t.default_os_template_type,"os_template_type",e)},expression:"default_os_template_type.os_template_type"}},t._l(t.os_list,(function(s,i){return e("el-radio-button",{key:i,attrs:{label:i}},[t._v(" "+t._s(s.name)+" ")])})),1)],1),e("div",{staticClass:"inline-form"},[e("el-form-item",{staticClass:"m-right20",attrs:{prop:"default_os_type"}},[e("el-select",{model:{value:t.data.default_os_type,callback:function(e){t.$set(t.data,"default_os_type",e)},expression:"data.default_os_type"}},t._l(t.default_os_template_type.os_types,(function(t){return e("el-option",{key:t,attrs:{value:t,label:t}})})),1)],1),e("el-form-item",{attrs:{prop:"default_os_version"}},[e("el-select",{attrs:{"value-key":"os_id"},on:{change:t.FnEmit},model:{value:t.data.default_os_version,callback:function(e){t.$set(t.data,"default_os_version",e)},expression:"data.default_os_version"}},t._l(t.default_os_version_list,(function(t){return e("el-option",{key:t.os_id,attrs:{value:t,label:t.name}})})),1)],1)],1)],1)},a=[],o=(s("d9e2"),s("e9f5"),s("910d"),s("f665"),s("9ab4")),l=s("1b40"),r=s("9074");let n=class extends l["e"]{constructor(){super(...arguments),this.os_list={},this.default_os_template_type={os_template_type:"",os_types:[],os_versions:{}},this.default_os_version_list=[],this.data={default_os_type:"",default_os_version:{os_id:"",os_type:"",username:"",disk_size:0}},this.FnCheckOs=(t,e,s)=>{e.os_id||s(new Error("请选择镜像")),s()},this.rules={default_os_type:[{required:!0,trigger:"change",message:" "}],default_os_version:[{required:!0,validator:this.FnCheckOs,trigger:"change"}]}}async FnGetOsList(){if(!this.az_id)return;let t=await r["a"].get_os_list({customer_id:this.customer_id,az_id:this.az_id});"Success"==t.code&&(this.os_list=t.data,this.FnHandleInitData())}FnHandleInitData(){this.default_os_type&&(this.default_os_template_type.os_template_type=this.default_os_type),this.default_os_template_type.os_template_type===Object.keys(this.os_list)[0]?this.FnChangeOsTemType(this.default_os_template_type.os_template_type):this.default_os_template_type.os_template_type=Object.keys(this.os_list)[0]}FnHandleOsList(t){if(!t||0===t.length)return[];let e=t.filter(t=>t.support_type.includes("gpu")&&t.support_type.includes("cpu")?t:this.is_gpu?t.support_type.includes("gpu")&&t.support_gpu_driver==this.support_gpu_driver:t.support_type.includes("cpu")&&t.support_gpu_driver==this.support_gpu_driver);return e}FnEmit(){return{os_id:this.data.default_os_version.os_id,os_type:this.data.default_os_version.os_type,username:this.data.default_os_version.username,disk_size:this.data.default_os_version.disk_size,os_label:this.default_os_version_list.find(t=>t.os_id===this.data.default_os_version.os_id).name}}FnSubmit(){let t=!1;return this.$refs["resetForm"].validate(e=>{t=e}),{flag:t,os_info:this.FnEmit()}}FnResetForm(){this.FnHandleInitData()}created(){this.FnGetOsList()}FnChangeOsTemType(t){this.default_os_type?"windows"===this.default_os_type.toLowerCase()?this.default_os_template_type.os_types=this.os_list[t].os_types.filter(t=>t===this.default_os_type):this.default_os_template_type.os_types=this.os_list[t].os_types.filter(t=>"windows"!=t.toLowerCase()):this.default_os_template_type.os_types=this.os_list[t].os_types,this.default_os_template_type.os_versions=this.os_list[t].os_versions,this.data.default_os_type!==this.default_os_template_type.os_types[0]?this.data.default_os_type=this.default_os_template_type.os_types[0]:this.FnChangeOsType(this.data.default_os_type)}FnChangeOsType(t){this.default_os_version_list=this.FnHandleOsList(this.default_os_template_type.os_versions[t]),this.default_os_version_list.length>0?this.data.default_os_version=this.default_os_version_list[0]:this.data.default_os_version={os_id:"",os_type:"",username:"",disk_size:0},this.FnEmit()}FnChangeAz(t,e){this.FnGetOsList()}FnChangeCustomer(t,e){this.FnGetOsList()}FnChangeGpuDriver(t){this.FnChangeOsType(this.data.default_os_type)}FnChangeGpu(t){this.FnChangeOsType(this.data.default_os_type)}};Object(o["a"])([Object(l["c"])({default:""})],n.prototype,"az_id",void 0),Object(o["a"])([Object(l["c"])({default:""})],n.prototype,"customer_id",void 0),Object(o["a"])([Object(l["c"])({default:0})],n.prototype,"is_gpu",void 0),Object(o["a"])([Object(l["c"])({default:""})],n.prototype,"support_gpu_driver",void 0),Object(o["a"])([Object(l["c"])({default:""})],n.prototype,"default_os_type",void 0),Object(o["a"])([Object(l["b"])("fn-os")],n.prototype,"FnEmit",null),Object(o["a"])([Object(l["f"])("default_os_template_type.os_template_type")],n.prototype,"FnChangeOsTemType",null),Object(o["a"])([Object(l["f"])("data.default_os_type")],n.prototype,"FnChangeOsType",null),Object(o["a"])([Object(l["f"])("az_id")],n.prototype,"FnChangeAz",null),Object(o["a"])([Object(l["f"])("customer_id")],n.prototype,"FnChangeCustomer",null),Object(o["a"])([Object(l["f"])("support_gpu_driver")],n.prototype,"FnChangeGpuDriver",null),Object(o["a"])([Object(l["f"])("is_gpu")],n.prototype,"FnChangeGpu",null),n=Object(o["a"])([l["a"]],n);var c=n,_=c,d=(s("ed02"),s("2877")),u=Object(d["a"])(_,i,a,!1,null,"cdbbdb54",null);e["a"]=u.exports},"2ce8":function(t,e,s){},"2dc0":function(t,e,s){},"2f23":function(t,e,s){},"2f52":function(t,e,s){},"2f5d":function(t,e,s){},"343a":function(t,e,s){"use strict";var i=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",[e("el-dialog",{attrs:{title:"数据批量导入",visible:t.visible_sync,width:"600px","destroy-on-close":!0,"custom-class":"upload","close-on-click-modal":!1},on:{"update:visible":function(e){t.visible_sync=e},close:t.back}},[e("div",{staticClass:"upload"},[e("div",{staticClass:"m-bottom10"},[t._v("请选择需要导入的可用区")]),e("el-select",{attrs:{filterable:"","filter-method":t.getPodList,placeholder:"请选择"},on:{"visible-change":t.change_pod},model:{value:t.az,callback:function(e){t.az=e},expression:"az"}},t._l(t.az_list,(function(s){return e("el-option",{key:s.pod_id,attrs:{label:`${s.az_name} ( ${s.pod_name} ) `,value:s.pod_id}},[t._v(t._s(s.az_name)+" ("+t._s(s.pod_name)+")")])})),1),0===t.az.length?e("span",{staticClass:"error_message m-left10"},[t._v("请选择可用区")]):t._e(),e("div",{staticClass:"flex-between m-top10 m-bottom20 down"},[e("span",[t._v("请选择需要上传的文件")]),e("a",{staticClass:"clickble",on:{click:t.down}},[t._v("下载导入模板")])]),e("el-upload",{ref:"upload",staticClass:"upload-demo",attrs:{action:"/ecs_business/v1/host/import_host/?pod_id="+t.az,"before-upload":t.before_upload,"file-list":t.fileList,accept:".xls,.xlsx",name:"host_template","auto-upload":!1,"on-success":t.FnSuccess,headers:{"Access-Token":t.$store.state.token}}},[e("el-button",{attrs:{size:"small",type:"primary"}},[t._v("选择文件")])],1)],1),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{attrs:{type:"primary"},on:{click:t.confirm}},[t._v("确认")]),e("el-button",{on:{click:function(e){return t.back("0")}}},[t._v("取消")])],1)])],1)},a=[],o=(s("e9f5"),s("910d"),s("9ab4")),l=s("1b40"),r=s("c839");let n=class extends l["e"]{constructor(){super(...arguments),this.fileList=[],this.az_list=[],this.az=""}created(){this.getPodList()}change_pod(t){t||this.getPodList()}async getPodList(t=""){let e=await r["a"].get_pod_list({page_index:1,page_size:20,search_info:t});"Success"===e.code&&(this.az_list=e.data.pod_list.filter(t=>t.status))}before_upload(t){}FnSuccess(t,e,s){if("Success"===t.code){if(t.data.fail_host_list.length>0)return this.$message.warning("物理机导入任务下发失败！"),void this.back("1");this.$message.success("物理机导入任务下发成功！"),this.back("1")}else this.$message.error(JSON.stringify(t.message)),this.back("0")}down(){window.location.href="/ecs_business/v1/host/download_template/"}async confirm(){if(!this.az)return;const t=this.$refs.upload;t.submit()}back(t){this.visible_sync=!1}};Object(o["a"])([Object(l["d"])("visible")],n.prototype,"visible_sync",void 0),Object(o["a"])([Object(l["b"])("close")],n.prototype,"back",null),n=Object(o["a"])([Object(l["a"])({})],n);var c=n,_=c,d=(s("68f0"),s("2877")),u=Object(d["a"])(_,i,a,!1,null,null,null);e["a"]=u.exports},"384f":function(t,e,s){"use strict";var i=s("e330"),a=s("5388"),o=s("cb27"),l=o.Set,r=o.proto,n=i(r.forEach),c=i(r.keys),_=c(new l).next;t.exports=function(t,e,s){return s?a({iterator:c(t),next:_},e):n(t,e)}},3874:function(t,e,s){"use strict";var i=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("el-form",{ref:"resetForm",staticClass:"spec-form",attrs:{model:t.data,"label-position":"left"}},[e("div",{staticClass:"inline-form"},[e("el-form-item",{staticClass:"m-right20"},[e("el-select",{attrs:{placeholder:"全部vCPU",clearable:""},model:{value:t.default_cpu_size,callback:function(e){t.default_cpu_size=e},expression:"default_cpu_size"}},t._l(t.cpu_ram_size_list,(function(s,i){return e("el-option",{key:i+"cpu",attrs:{value:String(i)}},[t._v(t._s(i)+" vCPU")])})),1)],1),e("el-form-item",[e("el-select",{attrs:{placeholder:"全部内存",clearable:""},model:{value:t.default_ram_size,callback:function(e){t.default_ram_size=e},expression:"default_ram_size"}},t._l(t.ram_size_list,(function(s,i){return e("el-option",{key:s+i+"ram",attrs:{value:String(s)}},[t._v(t._s(s)+" GiB")])})),1)],1)],1),e("el-form-item",{attrs:{prop:""}},[e("span",[t._v("分类： ")]),e("el-radio-group",{model:{value:t.data.category_id,callback:function(e){t.$set(t.data,"category_id",e)},expression:"data.category_id"}},t._l(t.category_list,(function(s){return e("el-radio-button",{key:s.category_id,attrs:{label:s.category_id}},[t._v(t._s(s.name))])})),1)],1),e("el-form-item",{staticClass:"table-form"},[e("div",{staticClass:"table-box"},[e("el-table",{attrs:{data:t.family_list,border:"","max-height":"300px"}},[e("el-table-column",{attrs:{label:"选择",width:"60"},scopedSlots:t._u([{key:"default",fn:function(s){return[e("el-radio",{attrs:{label:s.row.id},on:{change:function(e){return t.FnChangeSpec(s.row)}},model:{value:t.data.id,callback:function(e){t.$set(t.data,"id",e)},expression:"data.id"}},[t._v(" ")])]}}])}),e("el-table-column",{attrs:{prop:"ecs_family_name",label:"规格族"}}),e("el-table-column",{attrs:{prop:"cpu",label:"vCPU"}}),e("el-table-column",{attrs:{prop:"ram",label:"内存"}}),t.is_gpu?e("el-table-column",{attrs:{prop:"gpu",label:"GPU"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(e.row.gpu)+"*"+t._s(e.row.gpu_show_type)+" ")]}}],null,!1,3740856225)}):t._e(),e("el-table-column",{attrs:{prop:"cpu_name",label:"处理器型号",width:"200"}}),e("el-table-column",{attrs:{label:"参考价格"},scopedSlots:t._u([{key:"default",fn:function(s){return[e("span",[t._v(t._s(t.price_symbol+s.row.original_amount.toFixed(2)+"/"+t.priceSymble()))])]}}])})],1)],1)]),t.enable_change||"batch_update"!==t.type?t._e():e("el-form-item",[e("span",{staticClass:"error_message m-left8"},[t._v("所选规格资源不足，请重新选择")])]),e("el-form-item",{staticClass:"total-price"},[e("span",[t._v("差价为：")]),e("span",{staticClass:"num_message price"},[t._v(" "+t._s(this.difference_price?this.difference_price:"0.00"))])])],1)},a=[],o=(s("e9f5"),s("910d"),s("f665"),s("7d54"),s("ab43"),s("1e70"),s("79a4"),s("c1a1"),s("8b00"),s("a4e7"),s("1e5a"),s("72c3"),s("9ab4")),l=s("1b40"),r=s("9074"),n=s("8ce4");let c=class extends l["e"]{constructor(){super(...arguments),this.cpu_ram_size_list=[],this.all_ram_size_list=[],this.ram_size_list=[],this.default_cpu_size="",this.default_ram_size="",this.category_list=[],this.family_list=[],this.is_gpu=0,this.billing_info={},this.cpu_ram_gpu_price={},this.data={category_id:"",spec_id:"",id:""},this.price_unit="",this.prime_price=0,this.difference_price="",this.price_symbol="￥",this.ecs_list=[],this.row={},this.ecs_goods_info=[],this.ecs_billing_info={},this.price=0,this.category_id="",this.ecs_goods_id="",this.method="",this.enable_change=!0}priceSymble(){return"1"==this.method?"月":"天"}async FnGetAllCpuRam(){let t=await r["a"].get_all_cpu_ram();if("Success"==t.code){this.cpu_ram_size_list=t.data;let e=[];for(let t in this.cpu_ram_size_list)e=[...new Set([...e,...this.cpu_ram_size_list[t]])];this.all_ram_size_list=e.sort((t,e)=>t-e),this.ram_size_list=this.all_ram_size_list}}async FnGetCategoryList(){if(!this.az_id)return;this.family_list=[];let t=await r["a"].get_category_list({az_id:this.az_id,customer_id:this.customer_id,billing_method:this.billing_method,cpu:String(this.default_cpu_size),ram:String(this.default_ram_size)});"Success"==t.code&&(this.category_list="batch_update"===this.type?t.data.category_list.filter(t=>t.is_gpu==this.default_is_gpu):t.data.category_list,this.data.category_id===this.category_list[0].category_id?this.FnChangeCate(this.data.category_id):this.data.category_id=this.category_list[0].category_id)}async DifferencePrice(){let t=this.row,e=this.FnGetDefaultFamily(this.data.id);if(e){if(this.category_id=this.data.category_id,"1"===this.method&&this.category_id){const s=await r["a"].difference_price({ecs_info:t,ecs_list:this.ecs_list,billing_method:this.method,az_id:this.az_id,customer_id:this.ecs_list_info[0].customer_id,billing_info:this.billing_info[e.ecs_goods_id]});"Success"===s.code&&(this.difference_price=`${this.price_symbol}${Math.abs(s.data.change_price.toFixed(2))}/${this.price_unit}`)}}else this.difference_price=`${this.price_symbol}0.0/${this.price_unit}`}async FnGetFamilyList(){this.ecs_list=this.ecs_list_info.map(t=>({ecs_id:t.ecs_id,ecs_goods_id:t.ecs_goods_id,is_gpu:t.is_gpu,cpu_size:t.cpu_size,ram_size:t.ram_size,gpu_size:t.gpu_size,gpu_driver:t.support_gpu_driver,billing_method:t.billing_method,system_disk_feature:t.system_disk_feature,az_id:t.az_id,customer_id:t.customer_id})),this.method=this.ecs_list_info[0].billing_method;let t=await r["a"].get_ram_cpu_price_list({customer_id:this.customer_id,ecs_list:this.ecs_list,category_id:this.data.category_id,az_id:this.az_id});if("Success"===t.code){var e;if(this.prime_price=t.data.max_ecs_rule_price,this.family_list=t.data.ecs_goods_info,this.price_symbol=t.data.price_symbol,this.price_unit=t.data.price_unit,this.row=this.family_list[0],this.ecs_billing_info=t.data.billing_info,this.ecs_goods_info=t.data.ecs_goods_info||"",this.billing_info=Object(n["a"])(t.data.billing_info,!0),this.price=t.data.all_ecs_spec_price,this.data.id="",!this.data.id)this.data.id=null===(e=this.family_list[0])||void 0===e?void 0:e.id;if(this.FnEmit(),"0"===this.method){const e=Math.abs(this.ecs_list_info.length*(this.prime_price-this.family_list[0].trade_amount));this.difference_price=`${this.price_symbol}${t.data.ecs_goods_info.length>0?e.toFixed(2):0}/${this.price_unit}`}else this.DifferencePrice()}}async FnSpecLimit(){let t=await r["a"].change_configure_limit({ecs_list:this.ecs_list.map(t=>t.ecs_id),az_id:this.az_id,customer_id:this.customer_id,ecs_spec_info:this.FnGetDefaultFamily(this.data.id)});"Success"===t.code&&(this.enable_change=t.data.enable_change,this.$emit("enable-change",this.enable_change))}FnGetDefaultFamily(t){return this.family_list.find(e=>e.id===t)}async FnGetPrice(){const t={customer_id:this.customer_id,az_id:this.az_id,is_gpu:this.is_gpu,batch:1,billing_method:this.billing_method,ecs_info:{billing_info:this.billing_info,ecs_goods_info:this.family_list},number:1},e=await r["a"].get_price(t);"Success"===e.code&&e.data.ecs.forEach(t=>{this.$set(this.cpu_ram_gpu_price,t.spec_id,e.data.price_symbol+Number(t.price).toFixed(2)+"/"+e.data.price_unit)})}FnChangeSpec(t){this.row=t,this.category_id=this.data.category_id,this.ecs_goods_id=t.ecs_goods_id,"0"===this.method?this.difference_price=this.difference_price=`${this.price_symbol}${Math.abs(this.ecs_list_info.length*(this.prime_price-t.trade_amount)).toFixed(2)}/${this.price_unit}`:this.DifferencePrice(),this.FnSpecLimit()}FnEmit(){let t=this.FnGetDefaultFamily(this.data.id);return console.log("FnEmit",t),{ecs_goods_id:t.ecs_goods_id,ecs_goods_name:t.ecs_family_name,cpu:t.cpu,ram:t.ram,gpu:t.gpu,gpu_id:t.gpu_type_id,gpu_card_name:t.gpu_card_name,card_name:t.gpu_show_type,is_gpu:this.is_gpu,cpu_model:t.cpu_name,support_gpu_driver:t.support_gpu_driver,spec_family_id:t.spec_family_id,spec_id:t.spec_id,cpu_real_name:t.cpu_real_name,billing_info:this.billing_info,ecs_list:this.ecs_list}}FnSubmit(){let t=!1;return this.$refs["resetForm"].validate(e=>{t=e}),{flag:t,spec_info:this.FnEmit()}}created(){this.FnGetAllCpuRam()}FnChangeCpuSize(t){this.default_ram_size="",this.ram_size_list=t?this.cpu_ram_size_list[Number(t)]:this.all_ram_size_list,this.FnGetCategoryList()}FnChangeRamSize(t){this.FnGetCategoryList()}FnChangeCate(t){t&&(this.FnGetFamilyList().then(()=>{this.family_list.length>0&&this.FnSpecLimit()}),this.is_gpu=this.category_list.find(e=>e.category_id===t).is_gpu?1:0)}FnChangeAz(t,e){this.FnGetCategoryList()}FnChangeCustomer(t,e){this.FnGetCategoryList()}};Object(o["a"])([Object(l["c"])({default:""})],c.prototype,"az_id",void 0),Object(o["a"])([Object(l["c"])({default:""})],c.prototype,"customer_id",void 0),Object(o["a"])([Object(l["c"])({default:"0"})],c.prototype,"billing_method",void 0),Object(o["a"])([Object(l["c"])({default:""})],c.prototype,"type",void 0),Object(o["a"])([Object(l["c"])({default:0})],c.prototype,"default_is_gpu",void 0),Object(o["a"])([Object(l["c"])({default:()=>[]})],c.prototype,"ecs_list_info",void 0),Object(o["a"])([Object(l["b"])("fn-spec")],c.prototype,"FnEmit",null),Object(o["a"])([Object(l["f"])("default_cpu_size")],c.prototype,"FnChangeCpuSize",null),Object(o["a"])([Object(l["f"])("default_ram_size")],c.prototype,"FnChangeRamSize",null),Object(o["a"])([Object(l["f"])("data.category_id")],c.prototype,"FnChangeCate",null),Object(o["a"])([Object(l["f"])("az_id")],c.prototype,"FnChangeAz",null),Object(o["a"])([Object(l["f"])("customer_id",{immediate:!0})],c.prototype,"FnChangeCustomer",null),c=Object(o["a"])([l["a"]],c);var _=c,d=_,u=(s("76d7"),s("2877")),p=Object(u["a"])(d,i,a,!1,null,"3113994e",null);e["a"]=p.exports},"395e":function(t,e,s){"use strict";var i=s("dc19"),a=s("cb27").has,o=s("8e16"),l=s("7f65"),r=s("5388"),n=s("2a62");t.exports=function(t){var e=i(this),s=l(t);if(o(e)<s.size)return!1;var c=s.getIterator();return!1!==r(c,(function(t){if(!a(e,t))return n(c,"normal",!1)}))}},"3bc5":function(t,e,s){"use strict";s("aa9c")},"3f8d":function(t,e,s){"use strict";s.d(e,"b",(function(){return l})),s.d(e,"c",(function(){return r}));const i={building:"创建中",running:"运行中",restarting:"重启中",shutting_down:"关机中",shutdown:"已关机",starting_up:"开机中",deleting:"删除中",deleted:"已删除",destroying:"销毁中",destroy:"已销毁",updating:"更新中",error:"错误",recovering:"恢复中",failed:"创建失败"},a={start_up_ecs:{auth:["shutdown"],msg:"已选实例状态需为已关机！",label:"开 机"},shutdown_ecs:{auth:["running"],msg:"已选实例需为运行中！",label:"关 机"},restart_ecs:{auth:["running"],msg:"已选实例状态需为运行中！",label:"重 启"},delete_ecs:{auth:["running","shutdown","error"],msg:"已选实例状态需为已关机或运行中或错误！",label:"逻辑删除"},recover_ecs:{auth:["deleted"],msg:"已选实例状态需为已删除！",label:"恢 复"},destroy_ecs:{auth:["deleted","failed"],msg:"已选实例状态需为已删除或创建失败！",label:"销 毁"},update_spec:{auth:["shutdown"],msg:"已选实例状态需为已关机！",label:"更换实例规格"},update_system:{auth:["shutdown"],msg:"已选实例状态需为已关机！",label:"更换操作系统"},reset_pwd:{auth:["running"],msg:"已选实例状态需为运行中！",label:"更换密码"},open_bill:{auth:["running","shutdown"],msg:"已选实例状态需为运行中或已关机！",label:"开启计费"},net_set:{auth:["running"],msg:"已选实例状态需为运行中！",label:"网络设置"}},o={start_up_host:{power:["shutdown"],host:["offline","online","exception","maintenance"],msg:"已选主机需为在线、离线、异常或维护状态",label:"开机"},shutdown_host:{power:["running"],host:["maintenance"],vm:1,msg:"已选主机需为维护状态",msg2:"操作关机前，请确保物理机上无云主机运行",label:"关机"},restart_host:{power:["running"],host:["offline","online","maintenance"],msg:"已选主机需为在线、离线或维护状态",label:"重启"},online_maintenance:{power:[],host:["online","exception"],msg:"已选主机需为在线状态",label:"在线维护"},maintenance:{power:[],host:[],msg:"",label:"设置维护"},offline_maintenance:{power:[],host:["offline","online","exception"],vm:1,msg:"已选主机需为在线或离线状态且已选主机上不能有虚拟机运行",label:"离线维护"},finish:{power:[],host:["maintenance","online_maintenance","offline_maintenance"],msg:"已选主机需为维护中状态",label:"完成维护"},shelves:{power:[],host:[],vm:1,msg:"已选主机上不能有虚拟机运行",label:"下架"},disperse:{power:["running"],host:["online"],msg:"已选主机需为在线状态",label:"驱散"},out_of_band:{power:[],host:["offline","online"],msg:"已选主机需为在线或离线状态",label:"进入带外管理"},migrate:{power:["running"],host:["online","storage_error","crash"],msg:"已选主机需为在线、存储异常或宕机状态",label:"迁移"},lock:{power:[],host:[],msg:"",label:"锁定"},unlock:{power:[],host:["lock"],msg:"已选主机需为锁定状态",label:"解锁"},unstore_exception:{power:[],host:["storage_error"],msg:"已选主机需为存储异常状态",label:"解除存储异常"},service:{power:[],host:[],msg:"",label:"服务更新"},rollback:{power:[],host:[],label:"回滚"},physical_detail:{power:[],host:[],msg:"",label:"详情"},data_clear:{power:[],host:["crash_clear"],msg:"",label:"数据清理同步"},down_recover:{power:[],host:["crash_recover"],msg:"",label:"宕机恢复"},sign:{power:[],host:[],msg:"",label:"设备标记"},upload:{power:[],host:[],msg:"",label:"导入"},under_sync:{power:[],host:[],msg:"",label:"底层同步"},cheat:{power:[],host:[],msg:"",label:"欺骗器管理"},business_test:{power:[],host:[],msg:"",label:"业务测试"},record:{power:[],host:[],msg:"",label:"操作记录"},resource:{power:[],host:[],msg:"",label:"分配资源"},remark:{power:[],host:[],msg:"",label:"编辑备注"},add_cluster:{power:[],host:["online"],msg:"已选主机需为在线状态",label:"加入集群"},change_cluster:{power:[],host:[],msg:"",label:"更换集群"},remove_cluster:{power:[],host:["maintenance"],mag:"",label:"移出集群"},set_label:{power:[],host:[],msg:"",label:"添加标签"},set_prepar_host:{power:[],host:["online"],msg:"已选主机需为在线状态",label:"设为备机"},set_resource_pools:{power:[],host:["online"],msg:"",label:"设为资源池"}};e["a"]={getInsOperateAuth(t){return a[t]}};const l=t=>i[t],r=t=>o[t]},"41a3":function(t,e,s){"use strict";s("f097")},4364:function(t,e,s){"use strict";s.r(e);var i=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",{staticClass:"app-container"},[e("action-block",{attrs:{search_option:t.search_con,type:!0},on:{"fn-search":t.FnSearch}}),e("div",{staticClass:"icon m-bottom10"},[e("el-tooltip",{attrs:{content:"自定义列表项",placement:"bottom",effect:"light"}},[e("el-button",{attrs:{type:"text"},on:{click:t.FnCustom}},[e("i",{staticClass:"el-icon-s-tools"})])],1),e("el-tooltip",{attrs:{content:"刷新",placement:"bottom",effect:"light"}},[e("el-button",{attrs:{type:"text"},on:{click:t.refresh}},[e("svg-icon",{staticClass:"refresh",attrs:{icon:"refresh"}})],1)],1),e("el-tooltip",{attrs:{content:"导出",placement:"bottom",effect:"light"}},[e("el-button",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],attrs:{type:"text"},on:{click:t.FnExport}},[e("svg-icon",{staticClass:"export",attrs:{icon:"export"}})],1)],1)],1),e("div",{staticClass:"main-2"},[e("el-table",{ref:"table",attrs:{data:t.list,border:"",height:"100%","row-class-name":t.rowStyle},on:{"row-click":t.FnOperRow,"row-contextmenu":t.FnRightClick,"selection-change":t.handleSelectionChange,"sort-change":t.FnSortChange,"filter-change":t.handleFilterChange}},[e("el-table-column",{attrs:{type:"selection"}}),t._l(t.custom_host,(function(s){return e("el-table-column",{key:s.prop,attrs:{"filter-multiple":s.column_key?s.multiple:null,prop:s.prop,"column-key":s.column_key?s.column_key:null,filters:s.column_key?s.list:null,sortable:s.sortable?s.sortable:null,width:s.width?s.width:null,type:s.type,label:s.label,"show-overflow-tooltip":s.overflow},scopedSlots:t._u(["eip_info"===s.prop?{key:"default",fn:function(s){return[e("span",[t._v(t._s(s.row.eip_info[s.row.pub_net]?s.row.eip_info[s.row.pub_net].eip_ip:"-"))])]}}:"status_display"===s.prop?{key:"default",fn:function(s){return[e("div",{class:s.row.status},[t._v(t._s(s.row.status_display))]),s.row.no_charge_shutdown_ecs&&"shutdown"===s.row.status?e("div",{staticClass:"warning_message"},[t._v("关机不计费")]):t._e()]}}:"private_net"===s.prop?{key:"default",fn:function(s){return t._l(s.row.private_net.split(";"),(function(i){return e("div",{key:i},[e("span",[t._v(" "+t._s(s.row.eip_info[i]?i:"-")+" ")])])}))}}:"pub_net"===s.prop?{key:"default",fn:function(s){return[e("span",[t._v(t._s(s.row.pub_net?s.row.pub_net:"-"))])]}}:"product_source"===s.prop?{key:"default",fn:function(s){return t._l(t.product_list,(function(i){return e("span",[i.key===s.row.product_source?e("span",[t._v(" "+t._s(i.value)+" ")]):t._e()])}))}}:null],null,!0)})}))],2)],1),e("el-pagination",{attrs:{"current-page":t.page_info.current,"page-sizes":[20,50,100],"page-size":t.page_info.size,layout:"total, sizes, prev, pager, next, jumper",total:t.page_info.total},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}}),e("custom-list-item",{attrs:{visible:t.show_custom,all_item:t.all_item,all_column_item:t.all_column_item,type:"pod_vm",newView:!0},on:{"update:visible":function(e){t.show_custom=e},"fn-custom":t.get_custom_columns}}),t.record_visible?[e("Record",{attrs:{visible:t.record_visible,record_id:t.record_id},on:{close:t.closeRecord}})]:t._e(),t.detail_visible?[e("Detail",{attrs:{visible:t.detail_visible,detail_id:t.detail_id},on:{"close-detail":t.closeDetail}})]:t._e(),t.common_visible?[e("add-common",{attrs:{visible:t.common_visible,ecs_info:t.ecs_info,new:!0},on:{"update:visible":function(e){t.common_visible=e}}})]:t._e(),t.net_visible?[e("net-set",{attrs:{visible:t.net_visible,ecs_list:t.multiple_selection},on:{"update:visible":function(e){t.net_visible=e}}})]:t._e(),t.migrate_visible?[e("Migrate",{attrs:{visible:t.migrate_visible,ecs_list:t.multiple_selection},on:{"update:visible":function(e){t.migrate_visible=e}}})]:t._e(),t.rescue_visible?[e("rescue-mode",{attrs:{visible:t.rescue_visible,ecs_id:t.ecs_id,customer_id:t.customer_id},on:{"update:visible":function(e){t.rescue_visible=e}}})]:t._e(),e("operate",{attrs:{title:t.operate_title,visible:t.show_operate_dialog,oper_type:t.default_operate_type,multiple_selection:t.multiple_selection,customer_id:t.customer_id,az_id:t.az_id,is_gpu:t.is_gpu,origin_disk_size:t.origin_disk_size,multiple_selection_id:t.multiple_selection_id,system_disk_feature:t.system_disk_feature,spec_family_id:t.spec_family_id,os_type:t.os_type,support_gpu_driver:t.support_gpu_driver},on:{"update:visible":function(e){t.show_operate_dialog=e},close:t.close}}),e("right-click",{attrs:{multi_rows:t.multiple_selection,menus:t.menus,name:t.multiple_selection.length>0?t.multiple_selection[0].ecs_name:"",error_msg:t.error_msg},on:{"fn-click":t.infoClick}})],2)},a=[],o=(s("14d9"),s("e9f5"),s("d866"),s("910d"),s("7d54"),s("ab43"),s("a732"),s("88a7"),s("271a"),s("5494"),s("9ab4")),l=s("1b40"),r=s("3673"),n=s("bfc6"),c=s("af7d"),_=s("8ce4"),d=s("4d8e"),u=s("e8c0"),p=s("cf88"),h=s("bd4d"),m=s("268f"),b=s("76ff"),f=s("1f00"),g=s("e03a"),v=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("el-dialog",{attrs:{title:t.title,visible:t.show_operate_dialog,"close-on-click-modal":!1,width:"60%"},on:{"update:visible":function(e){t.show_operate_dialog=e},close:t.back}},["restore"===t.oper_type?[e("Recover",{ref:"recover",attrs:{multiple_selection:t.multiple_selection,customer_id:t.customer_id,is_gpu:t.is_gpu},on:{"fn-close":t.back}})]:e("div",[e("el-alert",{attrs:{title:`是否确定要对以下实例执行 ${t.title} 操作`,type:"warning",closable:!1,center:""}}),e("el-table",{staticClass:"operate-table",attrs:{data:t.multiple_selection,border:""}},[e("el-table-column",{attrs:{label:"客户名称/客户ID"},scopedSlots:t._u([{key:"default",fn:function(s){return[e("div",[t._v(t._s(s.row.customer_name))]),e("div",[t._v(t._s(s.row.customer_id))])]}}])}),e("el-table-column",{attrs:{label:"云服务器名称/云服务器ID"},scopedSlots:t._u([{key:"default",fn:function(s){return[e("div",[e("pre",[t._v(t._s(s.row.ecs_name))])]),e("div",[t._v(t._s(s.row.ecs_id))])]}}])}),e("el-table-column",{attrs:{label:"云服务器规格"},scopedSlots:t._u([{key:"default",fn:function(s){return[e("div",[t._v(" "+t._s(s.row.ecs_goods_name)+" "+t._s(s.row.cpu_size)+"vCPU "+t._s(s.row.ram_size)+"GiB "),t.is_gpu?e("span",[t._v(t._s(s.row.gpu_size)+"*"+t._s(s.row.card_name))]):t._e()])]}}])}),"update_system"===t.oper_type?e("el-table-column",{attrs:{label:"系统盘"},scopedSlots:t._u([{key:"default",fn:function(s){return[e("div",[t._v(" "+t._s(s.row.system_disk_type)+" "+t._s(s.row.system_disk_size)+"GB ")])]}}],null,!1,3861243780)}):t._e(),"update_system"===t.oper_type?e("el-table-column",{attrs:{label:"操作系统"},scopedSlots:t._u([{key:"default",fn:function(s){return[e("div",[t._v(t._s(s.row.os_name))])]}}],null,!1,3179532245)}):t._e(),e("el-table-column",{attrs:{prop:"status",label:"状态"},scopedSlots:t._u([{key:"default",fn:function(s){return[e("span",{class:s.row.status},[t._v(t._s(s.row.status_display))])]}}])}),e("el-table-column",{attrs:{prop:"gpu_card_status",label:"显卡状态"},scopedSlots:t._u([{key:"default",fn:function(s){return[e("span",{class:["正常"===s.row.gpu_card_status?"running":"已卸载"===s.row.gpu_card_status?"destroy":"关闭"===s.row.gpu_card_status?"error":""]},[t._v(t._s(s.row.gpu_card_status))])]}}])}),"open_bill"===t.oper_type?e("el-table-column",{attrs:{prop:"",label:"价格"},scopedSlots:t._u([{key:"default",fn:function(s){return[e("span",[t._v(t._s(t.ecs_list_price[s.row.ecs_id]))])]}}],null,!1,260281309)}):t._e()],1),e("div",{staticClass:"component-box"},["update_spec"===t.oper_type?[e("update-spec",{ref:"update_spec",attrs:{ecs_list_info:t.multiple_selection,customer_id:t.customer_id,az_id:t.az_id,type:"batch_update",default_is_gpu:t.is_gpu}})]:t._e(),"update_system"===t.oper_type?[e("update-os",{ref:"update_os",attrs:{customer_id:t.customer_id,az_id:t.az_id,is_gpu:t.is_gpu,default_os_type:t.os_type,support_gpu_driver:t.support_gpu_driver},on:{"fn-os":t.FnGetOsInfo}}),e("update-disk",{ref:"update_disk",attrs:{system_disk:!0,customer_id:t.customer_id,az_id:t.az_id,is_gpu:t.is_gpu,os_disk_size:Number(t.os_info.disk_size),origin_disk_size:t.origin_disk_size,spec_family_id:t.spec_family_id,disk_feature:t.system_disk_feature},on:{"fn-billing-info":t.FnGetDiskBillingInfo,"fn-system-disk":t.FnChangeSystem}}),e("reset-pwd",{ref:"reset_pwd",attrs:{customer_id:t.customer_id,az_id:t.az_id,username:t.os_info.username}})]:t._e(),"gpu_manage"===t.oper_type?e("div",[t._v(" 操作： "),e("el-radio-group",{model:{value:t.gpu_card_operate,callback:function(e){t.gpu_card_operate=e},expression:"gpu_card_operate"}},[e("el-radio",{attrs:{label:"ecs_attach_gpu_card",disabled:!t.multiple_selection[0].gpu_operate_list.includes("ecs_attach_gpu_card")}},[t._v("挂载显卡")]),e("el-radio",{attrs:{label:"ecs_detach_gpu_card",disabled:!t.multiple_selection[0].gpu_operate_list.includes("ecs_detach_gpu_card")}},[t._v("卸载显卡")]),e("el-radio",{attrs:{label:"ecs_change_fault_card",disabled:!t.multiple_selection[0].gpu_operate_list.includes("ecs_change_fault_card")}},[t._v("切换显卡 "),e("el-tooltip",{attrs:{content:"当云主机显卡关闭时，切换成正常可用的显卡。",placement:"right",effect:"light"}},[e("el-button",{attrs:{type:"text"}},[e("svg-icon",{attrs:{icon:"info",viewBox:"0 0 18 18"}})],1)],1)],1)],1)],1):t._e(),"reset_pwd"===t.oper_type?[e("reset-pwd",{ref:"reset_pwd",attrs:{label:"新密码",customer_id:t.customer_id,az_id:t.az_id}})]:t._e()],2),t.total_price&&"update_spec"!==t.oper_type?e("div",{staticClass:"text-right m-right20"},["update_system"===t.oper_type?e("span",[t._v("变更后需支付费用")]):e("span",[t._v("变更后总价：")]),e("span",{staticClass:"num_message"},[t._v(t._s(t.total_price))])]):t._e(),"shutdown_ecs"===t.oper_type?e("div",{staticClass:"text-center"},[t._v(" 关机方式： "),e("el-radio",{staticClass:"m-left20",attrs:{label:"shutdown_ecs"},model:{value:t.shutdown_ecs_type,callback:function(e){t.shutdown_ecs_type=e},expression:"shutdown_ecs_type"}},[t._v("正常关机")]),e("el-radio",{staticClass:"m-left20",attrs:{label:"compel_shutdown_ecs"},model:{value:t.shutdown_ecs_type,callback:function(e){t.shutdown_ecs_type=e},expression:"shutdown_ecs_type"}},[t._v("强制关机")]),e("mark-tip",{staticClass:"mark-tip",attrs:{content:"等同于断电处理，Windows操作系统可能会损坏，请谨慎选择"}})],1):t._e(),"restart_ecs"===t.oper_type?[e("div",{staticClass:"text-center"},[t._v(" 重启方式: "),e("el-radio",{staticClass:"m-left20",attrs:{label:"restart_ecs"},model:{value:t.restart_ecs_type,callback:function(e){t.restart_ecs_type=e},expression:"restart_ecs_type"}},[t._v("正常重启")]),e("el-radio",{staticClass:"m-left20",attrs:{label:"hard_restart_ecs"},model:{value:t.restart_ecs_type,callback:function(e){t.restart_ecs_type=e},expression:"restart_ecs_type"}},[t._v("硬重启")])],1),e("div",{staticClass:"warning_message"},[t._v("说明：若云主机故障，请选择“硬重启”，使云主机快速恢复正常。")])]:t._e()],2),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{attrs:{type:"primary"},on:{click:t.FnConfirm}},[t._v("确 定")]),e("el-button",{on:{click:t.back}},[t._v("取 消")])],1)],2)},y=[],k=s("0003"),O=s("3874"),w=s("29ab"),j=s("d4fd"),C=s("ed60"),x=s("1b7c");let S=class extends l["e"]{constructor(){super(...arguments),this.gpu_card_operate="",this.billing_method="0",this.shutdown_ecs_type="shutdown_ecs",this.restart_ecs_type="restart_ecs",this.os_info={},this.disk_billing_info={},this.total_price="",this.ecs_list_price={},this.page_info={page_sizes:[20,50,100],page_size:20,page_index:1,total:0}}back(t){this.show_operate_dialog=!1}async FnChangeSpec(t){if(""===this.billing_method)return;let e={customer_id:this.customer_id,az_id:this.az_id,billing_method:this.billing_method||"0",ecs_ids:this.multiple_selection_id,is_gpu:this.is_gpu,ecs_goods_info:{cpu:t.cpu,ram:t.ram,gpu:t.gpu},billing_info:t.billing_info[t.ecs_goods_id]};const s=await d["a"].change_config_price(e);"Success"===s.code&&(this.total_price=s.data.price_symbol+s.data.total_price.toFixed(2)+"/"+s.data.price_unit)}FnGetOsInfo(t){this.os_info=t}FnGetDiskBillingInfo(t){this.disk_billing_info=t}async FnChangeSystem(t){if(""===this.billing_method)return;let e={customer_id:this.customer_id,az_id:this.az_id,billing_method:this.billing_method||"0",is_gpu:this.is_gpu,ecs_ids:this.multiple_selection_id,ebs_goods_info:{},billing_info:this.disk_billing_info[t.ecs_goods_id]};"local"===this.system_disk_feature?(e.ebs_goods_info["local_disk-IOPS"]=t.iops,e.ebs_goods_info["local_disk-space"]=t.storage_space,e.ebs_goods_info["local_disk-throughput"]=t.handling_capacity):(e.ebs_goods_info["iops"]=t.iops,e.ebs_goods_info["storage_space"]=t.storage_space,e.ebs_goods_info["handling_capacity"]=t.handling_capacity);const s=await d["a"].change_system_price(e);"0"===this.billing_method?this.total_price=s.data.price_symbol+s.data.total_price.toFixed(2)+"/"+s.data.price_unit:this.total_price=s.data.price_symbol+s.data.total_price.toFixed(2)}FnConfirm(){if("restore"===this.oper_type)return void this.$refs.recover.FnRecover();const t={op_type:this.oper_type,customer_id:this.customer_id,az_id:this.az_id,ecs_ids:this.multiple_selection_id};["start_up_ecs","shutdown_ecs","restart_ecs"].indexOf(this.oper_type)>=0?this.FnPowerOperate(t):"delete_ecs"===this.oper_type?this.FnDelete(t):"destroy_ecs"===this.oper_type?this.FnDestroy(t):"reset_pwd"===this.oper_type?this.FnResetPwd(t):"update_spec"===this.oper_type?this.FnUpdateSpec(t):"update_system"===this.oper_type?this.FnUpdateSystem(t):"open_bill"===this.oper_type?this.FnOpenBill(Object.assign({billing_method:this.billing_method},t)):"gpu_manage"===this.oper_type&&this.mount_gpu_card()}async FnPowerOperate(t){"restart_ecs"===this.oper_type&&(t.op_type=this.restart_ecs_type),"shutdown_ecs"===this.oper_type&&(t.op_type=this.shutdown_ecs_type);const e=await d["a"].operate_instance(t);"Success"==e.code&&(this.$message.success(e.msg||`成功下发 ${this.title} 任务！`),this.FnClose())}async FnDelete(t){const e=await d["a"].delete_instance(Object.assign({is_gpu:this.is_gpu},t));"Success"==e.code&&(this.$message.success(e.msg||`成功下发 ${this.title} 任务！`),this.FnClose())}async FnDestroy(t){const e=await d["a"].destroy_instance(Object.assign({is_gpu:this.is_gpu},t));"Success"==e.code&&(this.$message.success(e.msg||`成功下发 ${this.title} 任务！`),this.page_info.page_index=1,this.FnClose())}async FnResetPwd(t){let e=this.$refs.reset_pwd.FnSubmit();if(e.flag){t.password=e.password;let s=await d["a"].reset_password(t);"Success"===s.code&&this.$message.success(s.msg||`成功下发 ${this.title} 任务！`),this.FnClose()}}async FnUpdateSpec(t){let e=this.$refs.update_spec.FnSubmit();if(e.flag){t.ecs_list=e.spec_info.ecs_list,t.billing_info=e.spec_info.billing_info[e.spec_info.ecs_goods_id],t.ecs_info={ecs_family_name:e.spec_info.ecs_goods_name,cpu:e.spec_info.cpu,gpu:e.spec_info.gpu,ram:e.spec_info.ram,spec_id:e.spec_info.spec_id,ecs_goods_id:e.spec_info.ecs_goods_id,spec_family_id:e.spec_info.spec_family_id,cpu_name:e.spec_info.cpu_model,gpu_card_name:e.spec_info.gpu_card_name,gpu_type_id:e.spec_info.gpu_id,cpu_real_name:e.spec_info.cpu_real_name};let s=await d["a"].update_spec(t);"Success"===s.code&&this.$message.success(s.msg||`成功下发 ${this.title} 任务！`),this.FnClose()}}async FnUpdateSystem(t){let e=this.$refs.update_os.FnSubmit(),s=this.$refs.update_disk.FnSubmit(),i=this.$refs.reset_pwd.FnSubmit();if(e.flag&&s.flag&&i.flag){var a;t.os_id=e.os_info.os_id,t.os_type=e.os_info.os_type,t.username=e.os_info.username,t.billing_method=this.billing_method,t.disk_info={system_disk:{ecs_goods_id:s.system_disk.ecs_goods_id,ebs_goods_id:s.system_disk.ecs_goods_id,gic_goods_id:null===(a=this.disk_billing_info[s.system_disk.ecs_goods_id])||void 0===a?void 0:a.gic_goods_id,goods_name:s.system_disk.disk_name,disk_feature:s.system_disk.disk_feature,disk_type:s.system_disk.disk_type,disk_size:s.system_disk.disk_size,storage_space:s.system_disk.disk_size,handling_capacity:s.system_disk.handling_capacity,iops:s.system_disk.iops,is_follow_delete:s.system_disk.is_follow_delete,origin_disk_size:this.origin_disk_size}},"local"===s.system_disk.disk_feature&&(t.disk_info.system_disk["local_disk-IOPS"]=t.disk_info.system_disk["iops"],t.disk_info.system_disk["local_disk-space"]=t.disk_info.system_disk["storage_space"],t.disk_info.system_disk["local_disk-throughput"]=t.disk_info.system_disk["handling_capacity"]),t.password=i.password,t.billing_info=this.disk_billing_info,t.is_gpu=this.is_gpu;let o=await d["a"].update_system(t);"Success"===o.code&&this.$message.success(o.msg||`成功下发 ${this.title} 任务！`),this.FnClose()}}async FnOpenBill(t){let e={resource_ids:t.ecs_ids,customer_id:t.customer_id,billing_method:t.billing_method||"0",resource_type:"ecs"};const s=await d["a"].start_charge(e);"Success"===s.code&&this.$message.success("成功开启计费！"),this.FnClose()}async mount_gpu_card(){if("ecs_detach_gpu_card"===this.gpu_card_operate&&"deleted"===this.multiple_selection[0].status)return void this.$message.warning("不支持对已删除的云服务器进行卸载显卡操作");let t=await d["a"].mount_gpu_card({ecs_id:this.multiple_selection[0].ecs_id,customer_id:this.multiple_selection[0].customer_id,event_type:this.gpu_card_operate});"Success"==t.code&&(this.$message.success(t.message),this.FnClose())}FnClose(){this.total_price="",this.gpu_card_operate="",this.back("1")}};Object(o["a"])([Object(l["d"])("visible")],S.prototype,"show_operate_dialog",void 0),Object(o["a"])([Object(l["c"])({default:()=>[]})],S.prototype,"multiple_selection",void 0),Object(o["a"])([Object(l["c"])(String)],S.prototype,"title",void 0),Object(o["a"])([Object(l["c"])(String)],S.prototype,"oper_type",void 0),Object(o["a"])([Object(l["c"])(String)],S.prototype,"customer_id",void 0),Object(o["a"])([Object(l["c"])(String)],S.prototype,"az_id",void 0),Object(o["a"])([Object(l["c"])(Number)],S.prototype,"is_gpu",void 0),Object(o["a"])([Object(l["c"])({default:()=>[]})],S.prototype,"multiple_selection_id",void 0),Object(o["a"])([Object(l["c"])({default:""})],S.prototype,"system_disk_feature",void 0),Object(o["a"])([Object(l["c"])(Number)],S.prototype,"origin_disk_size",void 0),Object(o["a"])([Object(l["c"])(String)],S.prototype,"spec_family_id",void 0),Object(o["a"])([Object(l["c"])(String)],S.prototype,"os_type",void 0),Object(o["a"])([Object(l["c"])(String)],S.prototype,"support_gpu_driver",void 0),Object(o["a"])([Object(l["b"])("close")],S.prototype,"back",null),S=Object(o["a"])([Object(l["a"])({components:{Recover:k["a"],updateSpec:O["a"],updateOs:w["a"],updateDisk:j["a"],resetPwd:C["a"],MarkTip:x["a"],SvgIcon:r["a"]}})],S);var z=S,F=z,$=(s("8451"),s("7426"),s("2877")),T=Object($["a"])(F,v,y,!1,null,"45d324eb",null),P=T.exports,I=s("3f8d"),D=s("c811"),E=s("c1df"),G=s.n(E),L=s("e527"),R=s("77d2"),N=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",[e("el-dialog",{attrs:{title:"迁移",visible:t.visible_sync,width:"830px","destroy-on-close":!0,"custom-class":"upload","close-on-click-modal":!1},on:{"update:visible":function(e){t.visible_sync=e}}},[e("el-alert",{attrs:{title:"是否确定要对以下实例执行迁移操作",type:"warning",closable:!1,center:""}}),e("el-table",{staticClass:"operate-table",attrs:{data:t.ecs_list,border:"","max-height":"400px"}},[e("el-table-column",{attrs:{prop:"customer_id",label:"客户ID"}}),e("el-table-column",{attrs:{prop:"customer_name",label:"客户名称"}}),e("el-table-column",{attrs:{prop:"ecs_id",label:"实例名称/实例ID"},scopedSlots:t._u([{key:"default",fn:function(s){return[e("div",[t._v(t._s(s.row.ecs_name)+" / ")]),t.useable_list.includes(s.row.ecs_id)?e("span",[t._v(t._s(s.row.ecs_id))]):e("el-tooltip",{attrs:{content:t.getMsg(s.row),effect:"light"}},[e("div",[t._v(t._s(s.row.ecs_id))])])]}}])}),e("el-table-column",{attrs:{prop:"status_display",label:"状态"}}),e("el-table-column",{attrs:{prop:"genre",label:"计算规格"}}),e("el-table-column",{attrs:{prop:"genre",label:"存储",width:"140px"},scopedSlots:t._u([{key:"default",fn:function(s){return[s.row.disk_info?e("div",[t._v("系统盘："+t._s(Object.keys(s.row.disk_info.system)[0])+" "+t._s(s.row.disk_info.system[Object.keys(s.row.disk_info.system)[0]])+t._s(s.row.disk_info.unit))]):t._e(),s.row.disk_info&&Object.keys(s.row.disk_info.data).length>0?e("div",{staticClass:"data-item"},[t._v(" 数据盘： "),t._l(s.row.disk_info.data,(function(i,a){return e("div",{key:a},[t._v(t._s(a)+" "+t._s(i)+t._s(s.row.disk_info.unit))])}))],2):t._e()]}}])})],1),e("div",{staticClass:"right"},[e("h4",[t._v("目的主机:")]),e("div",{staticClass:"m-bottom20"},[e("span",{staticClass:"m-right10"},[t._v("可用区:")]),e("span",[t._v(t._s(t.$store.state.az_list.az_name))])]),e("div",[t._v("物理机："),e("span",{staticClass:"prompt_message"},[t._v("（若不选择则随机迁移至合适的目的主机）")])]),t.recommend.length>0?e("div",{staticClass:"recommend"},t._l(t.recommend,(function(s){return e("div",{key:s.host_id,staticClass:"item",class:t.physical.includes(s.host_id)?"active":"",on:{click:function(e){return t.handle(s.host_id)}}},[t._v(" "+t._s(s.host_name)+" "),e("el-tooltip",{attrs:{content:s.cpu_usage?parseFloat(s.cpu_usage).toFixed(2)+"%":"0.00%",placement:"bottom",effect:"light"}},[e("div",{staticClass:"title"},[e("CustomIcon",{attrs:{hei:s.cpu_usage}}),e("div",[t._v("CPU")])],1)]),e("el-tooltip",{attrs:{content:s.memory_usage?parseFloat(s.memory_usage).toFixed(2)+"%":"0.00%",placement:"bottom",effect:"light"}},[e("div",{staticClass:"title"},[e("CustomIcon",{attrs:{hei:s.memory_usage}}),e("div",[t._v("内存")])],1)]),e("el-tooltip",{attrs:{content:s.local_storage_usage?parseFloat(s.local_storage_usage).toFixed(2)+"%":"0.00%",placement:"bottom",effect:"light"}},[e("div",{staticClass:"title"},[e("CustomIcon",{attrs:{hei:s.local_storage_usage}}),e("div",[t._v("本地存储")])],1)]),e("el-tooltip",{attrs:{content:`${s.used_gpu_num?s.used_gpu_num:0} / ${s.total_gpu_num?s.total_gpu_num:0}`,placement:"bottom",effect:"light"}},[e("div",{staticClass:"title"},[e("CustomIcon",{attrs:{hei:0===s.total_gpu_num?0:100*Number((s.used_gpu_num/s.total_gpu_num).toFixed(2))}}),e("div",[t._v("显卡")])],1)])],1)})),0):e("div",{staticClass:"error_message m-top10"},[t._v("无合适的物理机，无法迁移。")])]),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{attrs:{type:"primary",disabled:0===this.recommend.length},on:{click:t.confirm}},[t._v("确认")]),e("el-button",{on:{click:function(e){t.visible_sync=!1}}},[t._v("取消")])],1)],1)],1)},M=[],A=s("1477"),U=s("682f");let B=class extends l["e"]{constructor(){super(...arguments),this.recommend=[],this.physical=[],this.useable_list=[]}created(){this.get_recommended_host()}async get_recommended_host(t=""){this.$store.commit("SET_LOADING",!1);let e=await A["a"].recommended_host({host_id:this.ecs_list[0].host_id,host_name:this.ecs_list[0].host_name,ecs_ids:this.ecs_list.map(t=>t.ecs_id),is_gpu:this.ecs_list[0].is_gpu?"1":"0"});"Success"===e.code&&(this.recommend=e.data.data,0===this.ecs_list.length&&(this.physical=[]))}setUsableList(t){let e=t[0].ecs_list.filter(t=>["已关机","运行中"].includes(t.status)),s=[];e.map(t=>{t.is_gpu&&"已关机"===t.status&&!t.no_charge_shutdown_ecs?s.push(t.ecs_id):!t.is_gpu&&t.disk_info&&t.disk_info.system&&("local"!==Object.keys(t.disk_info.system)[0]?["已关机","运行中"].includes(t.status)&&s.push(t.ecs_id):"已关机"===t.status&&s.push(t.ecs_id))}),this.useable_list=s}getMsg(t){return t.is_gpu||t.disk_info&&"local"===Object.keys(t.disk_info.system)[0]?"仅支持关机迁移":"仅运行中和已关机状态下迁移"}handle(t){this.physical.includes(t)?this.physical=this.physical.filter(e=>e!==t):this.physical.push(t)}async confirm(){let t=await A["a"].migrate({ecs_ids:this.ecs_list.map(t=>t.ecs_id),start_host_id:this.ecs_list[0].host_id,end_host_ids:this.physical,is_gpu:this.ecs_list[0].is_gpu?"1":"0"});"Success"===t.code?(this.$message.success("物理机迁移任务下发成功！"),this.visible_sync=!1):this.visible_sync=!1}};Object(o["a"])([Object(l["d"])("visible")],B.prototype,"visible_sync",void 0),Object(o["a"])([Object(l["c"])({default:()=>[]})],B.prototype,"ecs_list",void 0),B=Object(o["a"])([Object(l["a"])({components:{CustomIcon:U["a"]}})],B);var Y=B,H=Y,V=Object($["a"])(H,N,M,!1,null,"a307000c",null),q=V.exports,W=s("6285"),J=s("81b2");let X=class extends l["e"]{constructor(){super(...arguments),this.list=[],this.all_column_item=[],this.multiple_selection=[],this.search_data={},this.sort_prop_name="",this.sort_order=void 0,this.ecs_status_list=[],this.search_reqData={},this.search_billing_method="all",this.search_op_source="",this.search_product_source="",this.search_ecs_goods_name=[],this.search_status=[],this.instance_list=[],this.customer_id="",this.az_id="",this.is_gpu=0,this.origin_disk_size=0,this.support_gpu_driver="",this.spec_family_id="",this.gpu_card_operate="",this.os_type="",this.billing_method="0",this.multiple_selection_id=[],this.operate_auth=[],this.show_operate_dialog=!1,this.operate_title="",this.default_operate_type="",this.shutdown_ecs_type="shutdown_ecs",this.restart_ecs_type="restart_ecs",this.record_visible=!1,this.record_id="",this.detail_visible=!1,this.detail_id="",this.net_visible=!1,this.migrate_visible=!1,this.product_source_list=[],this.product_server_id="",this.search_card_status_type="",this.search_product_status_type="",this.billing_method_relation={"":"不计费",0:"按需计费",1:"包年包月"},this.billing_method_list=[],this.ecs_goods_name_list=[],this.timer=null,this.os_info={},this.ecs_info={},this.common_visible=!1,this.disk_billing_info={},this.total_price="",this.ecs_list_price={},this.loading=!1,this.select_tag=[],this.isComponentDestroying=!1,this.ecs_id="",this.system_disk_feature="",this.rescue_visible=!1,this.page_info={current:1,size:20,total:0},this.gpu_status_list=[{text:"正常",value:"0"},{text:"卸载",value:"1"},{text:"关闭",value:"2"},{text:"非GPU无显卡",value:"3"}],this.product_list=[{key:"",value:"云主机"},{key:"gcw",value:"云桌面"},{key:"nas",value:"文件存储转发"},{key:"eks",value:"容器"},{key:"slb",value:"负载均衡"},{key:"paas",value:"数据库"},{key:"bm",value:"裸金属"}],this.search_con={ecs_id:{placeholder:"请输入云服务器ID"},ecs_name:{placeholder:"请输入云服务器名称"},customer_id:{placeholder:"请输入客户ID"},customer_name:{placeholder:"请输入客户名称"},os_info:{placeholder:"请输入操作系统ID/名称"},private_net:{placeholder:"请输入私网IP"},public_net:{placeholder:"请输入公网IP"},host_id:{placeholder:"请输入物理机ID"},host_name:{placeholder:"请输入物理机名称"},host_ip:{placeholder:"请输入物理机管理IP"},out_band_address:{placeholder:"请输入物理机带外IP"},create_time:{placeholder:["开始时间","结束时间"],type:"daterange",width:"360",clearable:!0,dis_day:1,defaultTime:[]}},this.all_item=[],this.custom_host=[],this.show_custom=!1,this.switch_power=[{label:"开机",value:"start_up_ecs",disabled:!1},{label:"关机",value:"shutdown_ecs",disabled:!1},{label:"重启",value:"restart_ecs",disabled:!1}],this.rescue_list=[{label:"进入救援模式",value:"rescue_mode",disabled:!1},{label:"退出救援模式",value:"exit_rescue_mode",disabled:!1}],this.menus=[{label:"详情",value:"instance_detail",single:!0,disabled:!1},{label:"开关机",value:"start_or_shutdown",list:this.switch_power,disabled:!1},{label:"操作记录",value:"instance_record",single:!0,disabled:!1},{label:"迁移",value:"migrate",disabled:!1},{label:"监控",value:"monitor",single:!0,disabled:!1},{label:"远程连接",value:"vnc",single:!0,disabled:!1},{label:"制作公共镜像",value:"add_common_mirror",single:!0,disabled:!1},{label:"显卡管理",value:"gpu_manage",single:!0,disabled:!1},{label:"逻辑删除",value:"delete_ecs",disabled:!1},{label:"销毁",value:"destroy_ecs",disabled:!1},{label:"恢复",value:"restore",disabled:!1},{label:"更换实例规格",value:"update_spec",disabled:!1},{label:"更换操作系统",value:"update_system",disabled:!1},{label:"重置密码",value:"reset_pwd",disabled:!1},{label:"网络设置",value:"net_set",disabled:!1},{label:"救援模式",value:"rescue",single:!0,list:this.rescue_list,disabled:!1},{label:"查看安全组",value:"security_group",single:!0,disabled:!1}],this.error_msg={vnc:"已选虚拟机状态需为运行中",add_common_mirror:"仅内部账号且状态为已关机的实例支持操作",gpu_manage:"仅支持对GPU型实例支持显卡管理",net_set:"实例需为运行中",migrate:"迁移虚拟机需全为关机或全为开机",security_group:"该虚拟机未配置安全组"}}watch_multi(){this.handleMenus()}watch_search(t){this.search_reqData=t?{ecs_id:this.$store.state.search_vm}:{},this.get_pod_ecs_list()}handleMenus(){for(const t of this.menus)if(t.list)for(const e of t.list)switch(e.value){case"rescue_mode":e.disabled=this.multiple_selection.every(t=>"shutdown"!==t.status);break;case"exit_rescue_mode":e.disabled=this.multiple_selection.every(t=>"rescue"!==t.status);break;default:e.disabled=!1}else switch(t.value){case"gpu_manage":t.disabled=!this.multiple_selection.every(t=>t.is_gpu)||!this.operate_auth.includes(t.value);break;case"vnc":t.disabled=this.multiple_selection.every(t=>"running"!==t.status)||!this.operate_auth.includes(t.value);break;case"add_common_mirror":t.disabled=this.multiple_selection.every(t=>"shutdown"!==t.status)||this.multiple_selection.every(t=>"内部"!==t.customer_type)||!this.operate_auth.includes(t.value);break;case"net_set":t.disabled=this.multiple_selection.every(t=>"running"!==t.status)||!this.operate_auth.includes(t.value);break;case"restore":t.disabled=!0;break;case"migrate":t.disabled=this.setUsableList();break;case"security_group":t.disabled=this.multiple_selection.every(t=>0===t.security_num);break;default:t.disabled=!1}}created(){this.FnGetCateGoryList(),this.get_source_type(),this.FnGetStatus(),this.get_field(),this.operate_auth=this.$store.state.auth_info["instance_list"],this.$store.state.search_vm?this.search_reqData={ecs_id:this.$store.state.search_vm}:this.search_reqData={}}setUsableList(){if(!this.multiple_selection||0===this.multiple_selection.length)return!1;const t=this.multiple_selection.every(t=>"运行中"===t.status_display),e=this.multiple_selection.every(t=>"已关机"===t.status_display),s=this.multiple_selection.every(t=>!0===t.is_gpu);if(t||e)return!1;if(e)if(s){const t=this.multiple_selection.every(t=>t.no_charge_shutdown_ecs);if(t)return!1}else{const t=this.multiple_selection[0].disk_info;if(t&&"local"===t.system)return!1}else if(t){const t=this.multiple_selection[0].disk_info;if(t&&"local"!==t.system&&!s)return!1}return!0}FnSearch(t={}){this.FnClearTimer(),this.search_reqData={ecs_id:t.ecs_id,ecs_name:t.ecs_name,customer_id:t.customer_id,customer_name:t.customer_name,os_info:t.os_info,private_net:t.private_net,public_net:t.public_net,host_id:t.host_id,host_name:t.host_name,host_ip:t.host_ip,out_band_address:t.out_band_address,start_time:t.create_time&&t.create_time[0]?G()(t.create_time[0]).format("YYYY-MM-DD"):void 0,end_time:t.create_time&&t.create_time[1]?G()(t.create_time[1]).format("YYYY-MM-DD"):void 0},this.page_info.page_index=1,this.get_pod_ecs_list()}infoClick(t){const{label:e,value:s}=t;if(!t.list&&!t.disabled){if("instance_record"===s)this.record_id=this.ecs_id,this.record_visible=!0;else if("instance_detail"===s)this.detail_id=this.ecs_id,this.detail_visible=!0;else if("add_common_mirror"===s)this.ecs_info=this.multiple_selection[0],this.common_visible=!0;else if("vnc"===s)this.FnToVnc(this.ecs_id);else if("gpu_manage"===s)this.operateGpu();else if("migrate"===s){let t=this.multiple_selection[0].host_id;if(this.multiple_selection.some(e=>e.host_id!==t))return this.$message.warning("请选择同一宿主机的实例"),void Object(p["a"])();this.migrate_visible=!0}else"monitor"===s?this.$router.push({path:"/vm_monitor/"+this.multiple_selection[0].ecs_id}):"rescue_mode"===s?this.FnToRescue():"exit_rescue_mode"===s&&this.FnExitRescue();if("security_group"===s&&this.$router.push({name:"security_group",query:{ecs_id:this.multiple_selection[0].ecs_id}}),["start_up_ecs","shutdown_ecs","restart_ecs","delete_ecs","restore","destroy_ecs","update_spec","update_system","reset_pwd","net_set"].includes(s)){const e=I["a"].getInsOperateAuth(s);if(["reset_pwd","update_spec","update_system","open_bill","net_set"].indexOf(s)>=0){if(!this.FnJudegCustomerAz(e,s))return;if("open_bill"===t.value&&(this.FnGetEcsPrice(),Object(p["a"])()),"net_set"===t.value)return this.net_visible=!0,void Object(p["a"])()}else if(!this.FnJudgeCustomer(e,s))return;this.operate_title=e.label,this.show_operate_dialog=!0,this.default_operate_type=s,this.FnClearTimer()}Object(p["a"])()}}FnToRescue(){this.ecs_id=this.multiple_selection[0].ecs_id,this.customer_id=this.multiple_selection[0].customer_id,this.rescue_visible=!0}FnExitRescue(){const t=this.multiple_selection[0];this.$confirm("是否退出救援模式？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{let e=await d["a"].exit_rescue({customer_id:t.customer_id,ecs_id:t.ecs_id});"Success"===e.code&&(this.$message.success(e.message),this.get_pod_ecs_list())}).catch(()=>{this.$message({type:"info",message:"已取消退出救援模式"})})}async operateGpu(){let{ecs_id:t}=this.multiple_selection[0];const e=await d["a"].update_gpu_status({ecs_id:t});"Success"===e.code&&this.FnGetGraphics(t)}async FnGetGraphics(t){let e={page_index:this.page_info.current,page_size:this.page_info.size,is_op:!0,az_id:this.$store.state.az_id,[this.sort_prop_name]:this.sort_order};"pod_vm"===this.$route.name?e["pod_id"]=this.$route.params.id:"cluster_vm"===this.$route.name?e["pod_id"]=Object(W["a"])(this.$route.params.id):"host_vm"===this.$route.name&&(e["pod_id"]=Object(W["b"])(this.$route.params.id)),e["ecs_id"]=t;const s=await L["a"].get_instance_list(e);"Success"==s.code&&(this.multiple_selection=s.data.ecs_list,this.show_operate_dialog=!0,this.operate_title="显卡管理",this.default_operate_type="gpu_manage",this.FnClearTimer())}async FnToVnc(t){let e=await d["a"].get_vnc_url({ecs_id:t});if("Success"===e.code){let s=e.data.vnc_info.split("/vnc_lite.html"),i=`${s[0]}/vnc_lite.html?op-token=${this.$store.state.token}?path=/?id=${t}`;window.open(i)}}close(t){this.get_pod_ecs_list(),this.show_operate_dialog=!1,this.default_operate_type="",this.operate_title="",this.multiple_selection=[];const e=this.$refs.table;e.clearSelection()}FnJudgeCustomer(t,e){this.customer_id="";let s=!0;this.multiple_selection_id=[];for(let i=0;i<this.multiple_selection.length;i++){let a=this.multiple_selection[i];if(this.multiple_selection_id.push(a.ecs_id),0===i&&(this.customer_id=a.customer_id,this.is_gpu=Number(a.is_gpu)),a.customer_id!==this.customer_id){this.$message.warning("只允许对同一客户的实例进行批量操作！"),s=!1;break}if(["recover_ecs"].indexOf(e)>=0&&a.is_gpu!=this.is_gpu){this.$message.warning(`只允许对同一类型实例进行批量${t.label}操作！`),s=!1;break}if(t.auth.indexOf(a.status)<0){this.$message.warning(t.msg),s=!1;break}}return s}FnJudegCustomerAz(t,e){this.customer_id="",this.az_id="",this.billing_method="0",this.origin_disk_size=0,this.support_gpu_driver="",this.spec_family_id="",this.system_disk_feature="",this.os_type="";let s=!0;this.multiple_selection_id=[];for(let i=0;i<this.multiple_selection.length;i++){let a=this.multiple_selection[i];if(this.multiple_selection_id.push(a.ecs_id),0===i&&(this.customer_id=a.customer_id,this.az_id=a.az_id,this.billing_method=a.billing_method,this.is_gpu=Number(a.is_gpu),this.support_gpu_driver=a.support_gpu_driver,this.spec_family_id=a.spec_family_id,this.os_type=a.os_type,this.system_disk_feature=a.system_disk_feature),a.customer_id!==this.customer_id||a.az_id!==this.az_id){this.$message.warning("只允许对同一客户的同一可用区下实例进行批量操作！"),s=!1;break}if(["update_spec","update_system"].indexOf(e)>=0&&(a.is_gpu!=this.is_gpu||a.billing_method!==this.billing_method)){this.$message.warning(`只允许对同一类型同一计费方式实例进行批量${t.label}操作！`),s=!1;break}if("open_bill"===e&&a.is_charge){this.$message.warning("只允许对未开启计费的实例开启计费！"),s=!1;break}if("update_system"===e&&a.support_gpu_driver!=this.support_gpu_driver){this.$message.warning(`只允许对同一驱动类型实例进行批量${t.label}操作！`),s=!1;break}if("update_system"===e&&a.spec_family_id!=this.spec_family_id){this.$message.warning(`只允许对同一规格族实例进行批量${t.label}操作！`),s=!1;break}if("update_system"===e&&a.os_type!=this.os_type){this.$message.warning("Windows和linux系统不可以互换重装！"),s=!1;break}if("update_spec"===e&&this.is_gpu){this.$message.warning(`不允许对GPU实例${t.label}操作！`),s=!1;break}if(["update_spec","update_system"].includes(e)&&a.no_charge_shutdown_ecs){this.$message.warning(`不允许对关机不计费的实例${t.label}操作！`),s=!1;break}if(t.auth.indexOf(a.status)<0){this.$message.warning(t.msg),s=!1;break}this.origin_disk_size=Math.max(this.origin_disk_size,a.system_disk_size)}return s}async FnGetEcsPrice(){this.ecs_list_price={};const t=await d["a"].each_resource_price({customer_id:this.customer_id,az_id:this.az_id,billing_method:"0",resource_ids:this.multiple_selection_id,resource_type:"ecs"});if("Success"===t.code)for(let e in t.data.total_price)this.$set(this.ecs_list_price,e,t.data.price_symbol+t.data.total_price[e].toFixed(2)+"/"+t.data.price_unit)}FnSetTimer(){this.timer&&this.FnClearTimer(),this.timer=setTimeout(()=>{this.get_pod_ecs_list(!1)},5e3)}FnClearTimer(){this.timer&&clearTimeout(this.timer)}watch_az(t){t&&this.refresh()}refresh(){this.get_pod_ecs_list()}async FnExport(){this.loading=!0;let t=this.search_ecs_goods_name.map(t=>t.toString()),e=Object.assign({billing_method:""==this.search_billing_method?"no":this.search_billing_method,op_source:this.search_op_source,spec_family_ids:t,product_source:this.search_product_source},this.search_reqData);"pod_vm"===this.$route.name?e["pod_id"]=this.$route.params.id:"cluster_vm"===this.$route.name?e["cluster_id"]=this.$route.params.id:"host_vm"===this.$route.name&&(e["host_id"]=this.$route.params.id);const s=await L["a"].export_list(e);if(s){this.loading=!1;let t=new Blob([s],{type:"application/octet-stream"}),e=new FileReader,i="云服务器-"+R["a"].get("pod_name")+"-"+G()(new Date).format("YYYYMMDD");e.readAsText(t,"utf-8"),e.onload=()=>{let e=document.createElement("a");e.href=window.URL.createObjectURL(t),e.download=i+".xlsx",e.click(),window.URL.revokeObjectURL(e.href)}}}async get_source_type(){let t=await d["a"].get_product_source();"Success"===t.code&&t.data.map(t=>{this.product_source_list.push({text:t.value,value:t.value})})}async FnGetCateGoryList(){const t=await d["a"].get_family_data();if("Success"===t.code)for(let e of t.data.spec_family_list)this.ecs_goods_name_list.push({value:e.spec_family_id,text:e.name})}async get_field(){let t=await d["a"].get_pod_ecs_field();if("Success"===t.code){let e=["field_name","show_name"],s=["prop","label"],i=[];this.all_item=t.data.map(t=>(i=[...i,...t.filed],t)),this.all_column_item=Object(_["b"])(i,s,e),this.get_custom_columns(this.$store.state.pod.vm_host),this.get_custom_columns(this.$store.state.pod.vm_host)}}get_custom_columns(t){0!==t.length&&(this.custom_host=this.all_column_item.filter(e=>t.includes(e.label)),this.custom_host.map(t=>(["gpu_card_status","status_display","ecs_goods_name","product_source"].includes(t.prop)||(t=Object.assign(t,{},{sortable:"custom"})),["ecs_id","ecs_name","host_name","create_time","update_time","gpu_card_status"].includes(t.prop)&&(t=Object.assign(t,{},{width:"150px",overflow:!0})),["gpu_card_status","eip_info","private_net","customer_id","customer_name","status_display","ecs_goods_name","pub_net","product_source"].includes(t.prop)&&(t=Object.assign(t,{},{width:"120px",overflow:!0})),"status_display"===t.prop&&(t=Object.assign(t,{},{column_key:"status",list:this.ecs_status_list,multiple:!0})),"gpu_card_status"===t.prop&&(t=Object.assign(t,{},{column_key:"card_status_type",list:this.gpu_status_list,multiple:!1})),"ecs_goods_name"===t.prop&&(t=Object.assign(t,{},{column_key:"ecs_goods_name",list:this.ecs_goods_name_list,multiple:!0})),"product_source"===t.prop&&(t=Object.assign(t,{},{column_key:"product_source",list:this.product_source_list,multiple:!1})),t)),this.FnDoLayout())}async FnGetStatus(){const t=await d["a"].get_vm_status_list();if("Success"===t.code){this.ecs_status_list=[];for(let e in t.data)"destroy_ecs"!==e&&this.ecs_status_list.push({text:t.data[e],value:e});this.get_pod_ecs_list()}}handleFilterChange(t){this.FnClearTimer(),setTimeout(()=>{t.status&&(this.search_status=t.status),t.card_status_type&&(this.search_card_status_type=t.card_status_type[0]),t.ecs_goods_name&&(this.search_ecs_goods_name=t.ecs_goods_name),t.product_source&&(this.search_product_source=t.product_source[0]),this.get_pod_ecs_list()},500)}FnCustom(){this.show_custom=!0}async get_pod_ecs_list(t=!0){if(!this.$store.state.az_id)return;this.multiple_selection_id=[],t||(this.$store.commit("SET_LOADING",!1),this.multiple_selection_id=this.multiple_selection.map(t=>t.ecs_id));let e={page_index:this.page_info.current,page_size:this.page_info.size,is_op:!0,az_id:this.$store.state.az_id,[this.sort_prop_name]:this.sort_order,...this.search_reqData};"pod_vm"===this.$route.name?e["pod_id"]=this.$route.params.id:"cluster_vm"===this.$route.name?e["cluster_id"]=this.$route.params.id:"host_vm"===this.$route.name&&(e["host_id"]=this.$route.params.id),this.search_status.length>0&&(e["status"]=this.search_status.join(",")),this.search_card_status_type&&(e["card_status_type"]=this.search_card_status_type),this.search_ecs_goods_name.length>0&&(e["spec_family_ids"]=this.search_ecs_goods_name.join(",")),this.search_product_source&&(e["product_source"]=this.search_product_source);let s=await d["a"].get_pod_ecs_list(e);"Success"===s.code&&(this.list=s.data.result,this.page_info.total=s.data.page_info.count)}FnRightClick(t,e,s){const i=this.multiple_selection.some(e=>e.ecs_id===t.ecs_id);i||this.$refs.table.toggleRowSelection(t),this.ecs_id=t.ecs_id,Object(u["a"])(t,e,s)}FnOperRow(t){this.$refs.table.toggleRowSelection(t)}rowStyle({row:t}){const e=this.multiple_selection.some(e=>e.ecs_id===t.ecs_id);if(e)return"rowStyle"}FnDoLayout(){this.$nextTick(()=>{this.$refs.table.doLayout()})}closeRecord(){this.record_visible=!1}closeDetail(){this.detail_visible=!1}handleSelectionChange(t){this.multiple_selection=t}FnSortChange(t){this.FnClearTimer();let e={};this.all_item.forEach(t=>{t.filed.forEach(t=>{e[t.field_name]="sort_"+t.field_name})}),this.sort_prop_name=e[t.prop],this.sort_order="ascending"===t.order?"0":"descending"===t.order?"1":void 0,this.get_pod_ecs_list()}handleSizeChange(t){this.FnClearTimer(),this.page_info.size=t,this.get_pod_ecs_list()}handleCurrentChange(t){this.FnClearTimer(),this.page_info.current=t,this.get_pod_ecs_list()}};Object(o["a"])([Object(l["f"])("multiple_selection",{immediate:!0,deep:!0})],X.prototype,"watch_multi",null),Object(o["a"])([Object(l["f"])("$store.state.search_vm")],X.prototype,"watch_search",null),Object(o["a"])([Object(l["f"])("$store.state.az_id")],X.prototype,"watch_az",null),X=Object(o["a"])([Object(l["a"])({components:{Migrate:q,Operate:P,SearchFrom:n["a"],SvgIcon:r["a"],CustomListItem:c["a"],RightClick:h["a"],Record:m["a"],Detail:b["a"],AddCommon:f["a"],netSet:g["a"],actionBlock:D["a"],RescueMode:J["a"]}})],X);var Z=X,K=Z,Q=(s("41a3"),Object($["a"])(K,i,a,!1,null,"5a219a02",null));e["default"]=Q.exports},4875:function(t,e,s){"use strict";var i=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("el-input-number",{attrs:{disabled:t.disable,step:t.size_info.disk_step,min:t.size_info.disk_min,max:t.size_info.disk_max},on:{blur:t.FnChange,change:t.FnChange},model:{value:t.size_info.size,callback:function(e){t.$set(t.size_info,"size",e)},expression:"size_info.size"}})},a=[],o=s("9ab4"),l=s("1b40");let r=class extends l["e"]{constructor(){super(...arguments),this.size_info={...this.info,size:NaN}}watch_info(t){this.size_info={...this.size_info,...this.info},console.log("info",this.size_info),this.FnChange()}async FnChange(){let t=0;if(this.size_info.size){console.log("bbb",this.size_info.disk_max,this.size_info.size);let e=Math.min(this.size_info.disk_max,this.size_info.size)-this.size_info.disk_min;e=e>0?e:0;let s=Math.floor(e/this.size_info.disk_step);t=s*this.size_info.disk_step+this.size_info.disk_min,console.log("size",s,t)}else console.log("aaa"),t=this.size_info.disk_min;this.$nextTick(()=>{this.size_info.size=t,this.returnValue()})}returnValue(){return this.size_info}};Object(o["a"])([Object(l["c"])({default:!1})],r.prototype,"disable",void 0),Object(o["a"])([Object(l["c"])({default:()=>({disk_step:1,disk_min:1,disk_max:1})})],r.prototype,"info",void 0),Object(o["a"])([Object(l["f"])("info",{deep:!0,immediate:!0})],r.prototype,"watch_info",null),Object(o["a"])([Object(l["b"])("func")],r.prototype,"returnValue",null),r=Object(o["a"])([Object(l["a"])({})],r);var n=r,c=n,_=s("2877"),d=Object(_["a"])(c,i,a,!1,null,null,null);e["a"]=d.exports},"4a88":function(t,e,s){},"4d8e":function(t,e,s){"use strict";var i=s("81a9"),a=s("bff7");e["a"]={get_pod_ecs_field(){return Object(i["a"])(Object(a["b"])("GET","/pod/get_pod_ecs_field/"))},get_vm_status_list(){return Object(i["a"])(Object(a["b"])("GET","/ecs/ecs_status_list/"))},get_vnc_url(t){return Object(i["a"])(Object(a["b"])("GET","/ecs/vnc_info/",t))},update_gpu_status(t){return Object(i["a"])(Object(a["b"])("POST","/ecs/update_gpu_status/",t))},each_resource_price(t){return Object(i["a"])(Object(a["b"])("POST","/ecs/each_resource_price/",t))},get_pod_ecs_list(t){return Object(i["a"])(Object(a["b"])("GET","/pod/get_pod_ecs_list/",t))},change_config_price(t){return Object(i["a"])(Object(a["b"])("POST","/ecs/change_config_price/",t))},change_system_price(t){return Object(i["a"])(Object(a["b"])("POST","/ecs/change_system_price/",t))},operate_instance(t){return Object(i["a"])(Object(a["b"])("POST","/ecs/operate/",t))},delete_instance(t){return Object(i["a"])(Object(a["b"])("POST","/ecs/delete/",t))},destroy_instance(t){return Object(i["a"])(Object(a["b"])("POST","/ecs/destroy/",t))},reset_password(t){return Object(i["a"])(Object(a["b"])("POST","/ecs/ecs_reset_password/",t))},update_spec(t){return Object(i["a"])(Object(a["b"])("POST","/ecs/ecs_change_configure/",t))},update_system(t){return Object(i["a"])(Object(a["b"])("POST","/ecs/ecs_change_system/",t))},start_charge(t){return Object(i["a"])(Object(a["b"])("POST","/resource/start_charge/",t))},mount_gpu_card(t){return Object(i["a"])(Object(a["b"])("POST","/ecs/instance_gpu_card/",t))},get_family_data(){return Object(i["a"])(Object(a["b"])("GET","/ecs/get_family_data/"))},get_product_source(){return Object(i["a"])(Object(a["b"])("GET","/ecs/get_product_source/"))},enter_rescue(t){return Object(i["a"])(Object(a["b"])("POST","/ecs/enter_rescue/",t))},exit_rescue(t){return Object(i["a"])(Object(a["b"])("POST","/ecs/exit_rescue/",t))},get_security_info(t){return Object(i["a"])(Object(a["b"])("GET","/ecs/security_info/",t))}}},5320:function(t,e,s){"use strict";t.exports=function(t){try{var e=new Set,s={size:0,has:function(){return!0},keys:function(){return Object.defineProperty({},"next",{get:function(){return e.clear(),e.add(4),function(){return{done:!0}}}})}},i=e[t](s);return 1===i.size&&4===i.values().next().value}catch(a){return!1}}},5388:function(t,e,s){"use strict";var i=s("c65b");t.exports=function(t,e,s){var a,o,l=s?t:t.iterator,r=t.next;while(!(a=i(r,l)).done)if(o=e(a.value),void 0!==o)return o}},"549f":function(t,e,s){},"5ef2":function(t,e,s){},6035:function(t,e,s){},6285:function(t,e,s){"use strict";s.d(e,"a",(function(){return a})),s.d(e,"b",(function(){return o}));var i=s("0613");function a(t){for(let e of i["a"].state.tree_list)for(let s of e.children)if(s.cluster_id===t)return e.pod_id;return null}function o(t){for(let e of i["a"].state.tree_list)for(let s of e.children||[])for(let i of s.children||[])if(i.host_id===t)return e.pod_id;return null}},"62df":function(t,e,s){},6345:function(t,e,s){"use strict";s("5ef2")},"64cf":function(t,e,s){},"67fa":function(t,e,s){"use strict";s("6035")},"682f":function(t,e,s){"use strict";var i=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",{staticClass:"total"},[e("div",{staticClass:"used",style:{height:t.hei&&0!==t.hei?t.hei+"%":0,background:t.hei>=0&&t.hei<50?"#67c23a":t.hei<80?"yellow":"red"}})])},a=[],o=s("9ab4"),l=s("1b40");let r=class extends l["e"]{};Object(o["a"])([Object(l["c"])(Number)],r.prototype,"hei",void 0),r=Object(o["a"])([Object(l["a"])({})],r);var n=r,c=n,_=(s("8a6c"),s("2877")),d=Object(_["a"])(c,i,a,!1,null,"43aeadcd",null);e["a"]=d.exports},"68df":function(t,e,s){"use strict";var i=s("dc19"),a=s("8e16"),o=s("384f"),l=s("7f65");t.exports=function(t){var e=i(this),s=l(t);return!(a(e)>s.size)&&!1!==o(e,(function(t){if(!s.includes(t))return!1}),!0)}},"68f0":function(t,e,s){"use strict";s("9e55")},"6e78":function(t,e,s){"use strict";s("2f5d")},"6f3a":function(t,e,s){"use strict";s("8966")},"6f4fd":function(t,e,s){"use strict";s("7d2a")},"72c3":function(t,e,s){"use strict";var i=s("23e7"),a=s("e9bc"),o=s("5320"),l=s("dad2"),r=!l("union")||!o("union");i({target:"Set",proto:!0,real:!0,forced:r},{union:a})},7426:function(t,e,s){"use strict";s("08fe")},"74b1":function(t,e,s){"use strict";var i=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",[e("el-dialog",{attrs:{title:"迁移",visible:t.visible_sync,width:"1180px","destroy-on-close":!0,"custom-class":"upload","close-on-click-modal":!1},on:{"update:visible":function(e){t.visible_sync=e},close:t.back}},[e("div",{staticClass:"migrate"},[e("div",{staticClass:"left"},[e("div",{staticClass:"m-bottom10"},[e("el-checkbox",{attrs:{indeterminate:t.isIndeterminate,disabled:0===t.useable_list.length},on:{change:t.handleCheckAllChange},model:{value:t.checked,callback:function(e){t.checked=e},expression:"checked"}}),t._v(" "+t._s(t.rows[0].host_name)+"("),e("span",{staticClass:"num_message"},[t._v(t._s(t.selected.length))]),t._v("/"+t._s(t.list.length)+") "),e("span",{staticClass:"warning_message"},[t._v("(若是GPU型云主机，建议单选虚拟机)")]),e("el-button",{attrs:{type:"text"},on:{click:t.getHostList}},[e("svg-icon",{attrs:{icon:"refresh"}})],1)],1),e("el-table",{ref:"table",attrs:{data:t.list,border:"","max-height":"500"},on:{"selection-change":t.handleSelectionChange}},[e("el-table-column",{attrs:{type:"selection",selectable:t.checkSelectable}}),e("el-table-column",{attrs:{prop:"customer_id",label:"客户ID"}}),e("el-table-column",{attrs:{prop:"customer_name",label:"客户名称"}}),e("el-table-column",{attrs:{prop:"ecs_id",label:"实例名称/实例ID"},scopedSlots:t._u([{key:"default",fn:function(s){return[e("div",[t._v(t._s(s.row.name)+" / ")]),t.useable_list.includes(s.row.ecs_id)?e("span",[t._v(t._s(s.row.ecs_id))]):e("el-tooltip",{attrs:{content:t.getMsg(s.row),effect:"light"}},[e("div",[t._v(t._s(s.row.ecs_id))])])]}}])}),e("el-table-column",{attrs:{prop:"status",label:"状态"}}),e("el-table-column",{attrs:{prop:"genre",label:"计算规格"}}),e("el-table-column",{attrs:{prop:"genre",label:"存储",width:"130px"},scopedSlots:t._u([{key:"default",fn:function(s){return[s.row.disk_info?e("div",[t._v("系统盘："+t._s(Object.keys(s.row.disk_info.system)[0])+" "+t._s(s.row.disk_info.system[Object.keys(s.row.disk_info.system)[0]])+t._s(s.row.disk_info.unit))]):t._e(),s.row.disk_info&&Object.keys(s.row.disk_info.data).length>0?e("div",{staticClass:"data-item"},[t._v(" 数据盘： "),t._l(s.row.disk_info.data,(function(i,a){return e("div",{key:a},[t._v(t._s(a)+" "+t._s(i)+t._s(s.row.disk_info.unit))])}))],2):t._e()]}}])})],1),0===t.selected.length?e("div",{staticClass:"error_message m-top10"},[t._v("请选择虚拟机")]):t._e()],1),e("div",{staticClass:"center"},[e("div",[t._v("迁移至")]),e("div",[t._v("------------\x3e")])]),e("div",{staticClass:"right"},[e("h4",[t._v("目的主机:")]),e("div",{staticClass:"m-bottom20"},[e("span",{staticClass:"m-right10"},[t._v("可用区:")]),e("span",[t._v(t._s(t.rows[0].az_name))])]),e("div",[t._v("物理机："),e("span",{staticClass:"prompt_message"},[t._v("（若不选择则随机迁移至合适的目的主机）")])]),t.recommend.length>0?e("div",{staticClass:"recommend"},t._l(t.recommend,(function(s){return e("div",{key:s.host_id,staticClass:"item",class:t.physical.includes(s.host_id)?"active":"",on:{click:function(e){return t.handle(s.host_id)}}},[t._v(" "+t._s(s.host_name)+" "),e("el-tooltip",{attrs:{content:s.cpu_usage?parseFloat(s.cpu_usage).toFixed(2)+"%":"0.00%",placement:"bottom",effect:"light"}},[e("div",{staticClass:"title"},[e("CustomIcon",{attrs:{hei:s.cpu_usage}}),e("div",[t._v("CPU")])],1)]),e("el-tooltip",{attrs:{content:s.memory_usage?parseFloat(s.memory_usage).toFixed(2)+"%":"0.00%",placement:"bottom",effect:"light"}},[e("div",{staticClass:"title"},[e("CustomIcon",{attrs:{hei:s.memory_usage}}),e("div",[t._v("内存")])],1)]),e("el-tooltip",{attrs:{content:s.local_storage_usage?parseFloat(s.local_storage_usage).toFixed(2)+"%":"0.00%",placement:"bottom",effect:"light"}},[e("div",{staticClass:"title"},[e("CustomIcon",{attrs:{hei:s.local_storage_usage}}),e("div",[t._v("本地存储")])],1)]),e("el-tooltip",{attrs:{content:`${s.used_gpu_num?s.used_gpu_num:0} / ${s.total_gpu_num?s.total_gpu_num:0}`,placement:"bottom",effect:"light"}},[e("div",{staticClass:"title"},[e("CustomIcon",{attrs:{hei:0===s.total_gpu_num?0:100*Number((s.used_gpu_num/s.total_gpu_num).toFixed(2))}}),e("div",[t._v("显卡")])],1)])],1)})),0):e("div",{staticClass:"error_message m-top10"},[t._v("无合适的物理机，无法迁移。可选择单台虚机再次尝试")])])]),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{attrs:{type:"primary",disabled:0===this.recommend.length},on:{click:t.confirm}},[t._v("确认")]),e("el-button",{on:{click:function(e){return t.back("0")}}},[t._v("取消")])],1)])],1)},a=[],o=(s("14d9"),s("e9f5"),s("910d"),s("ab43"),s("a732"),s("1e70"),s("79a4"),s("c1a1"),s("8b00"),s("a4e7"),s("1e5a"),s("72c3"),s("9ab4")),l=s("1b40"),r=s("1477"),n=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",{staticClass:"total"},[e("div",{staticClass:"used",style:{height:t.hei&&0!==t.hei?t.hei+"%":0,background:t.hei>=0&&t.hei<50?"#67c23a":t.hei<80?"yellow":"red"}})])},c=[];let _=class extends l["e"]{};Object(o["a"])([Object(l["c"])(Number)],_.prototype,"hei",void 0),_=Object(o["a"])([Object(l["a"])({})],_);var d=_,u=d,p=(s("9b6c"),s("2877")),h=Object(p["a"])(u,n,c,!1,null,"7a62b7c8",null),m=h.exports,b=s("3673");let f=class extends l["e"]{constructor(){super(...arguments),this.list=this.rows[0].ecs_list,this.selected=[],this.checked=!1,this.isIndeterminate=!1,this.physical=[],this.physical_list=[],this.recommend=[],this.useable_list=[]}created(){this.get_recommended_host(),this.setUsableList(this.rows),this.list=this.rows[0].ecs_list}setUsableList(t){let e=t[0].ecs_list.filter(t=>["已关机","运行中"].includes(t.status)),s=[];e.map(t=>{t.is_gpu&&"已关机"===t.status&&!t.no_charge_shutdown_ecs?s.push(t.ecs_id):!t.is_gpu&&t.disk_info&&t.disk_info.system&&("local"!==Object.keys(t.disk_info.system)[0]?["已关机","运行中"].includes(t.status)&&s.push(t.ecs_id):"已关机"===t.status&&s.push(t.ecs_id))}),this.useable_list=s}async getHostList(){let t=await r["a"].get_host_list({host_name:this.rows[0].host_name});"Success"===t.code&&(this.list=t.data.host_list[0].ecs_list,this.setUsableList(t.data.host_list))}getMsg(t){return t.is_gpu||t.disk_info&&"local"===Object.keys(t.disk_info.system)[0]?"仅支持关机迁移":"仅运行中和已关机状态下迁移"}checkSelectable(t,e){return!!this.useable_list.includes(t.ecs_id)}judge(){let t=this.physical_list.filter(t=>"CPU"===t.host_purpose),e=t.map(t=>t.host_id),s=[...new Set([...e,...this.physical])].length;this.selected.some(t=>t.is_gpu)&&s<[...e,...this.physical].length&&(this.$message.warning("GPU云主机不能被迁移到非GPU物理机上"),this.physical=[])}async get_recommended_host(t=""){this.$store.commit("SET_LOADING",!1);let e=await r["a"].recommended_host({host_id:this.rows[0].host_id,host_name:t,ecs_ids:this.selected.map(t=>t.ecs_id),is_gpu:"GPU"===this.rows[0].host_purpose?"1":"0",gpu_card_name:this.rows[0].gpu_real_name});"Success"===e.code&&(this.recommend=e.data.data,0===this.selected.length&&(this.physical=[]))}handleCheckAllChange(t){const e=this.$refs.table;t?e.toggleAllSelection():e.clearSelection(),this.isIndeterminate=!1}handleSelectionChange(t){this.selected=t,this.get_recommended_host(),this.checked=t.length===this.list.length,this.isIndeterminate=t.length>0&&t.length<this.list.length}handle(t){this.physical.includes(t)?this.physical=this.physical.filter(e=>e!==t):this.physical.push(t)}async confirm(){if(0===this.selected.length)return;let t=await r["a"].migrate({ecs_ids:this.selected.map(t=>t.ecs_id),start_host_id:this.rows[0].host_id,end_host_ids:this.physical,is_gpu:"GPU"===this.rows[0].host_purpose?"1":"0"});"Success"===t.code?(this.$message.success("物理机迁移任务下发成功！"),this.back("1")):this.back("0")}back(t){this.visible_sync=!1}};Object(o["a"])([Object(l["d"])("visible")],f.prototype,"visible_sync",void 0),Object(o["a"])([Object(l["c"])({default:()=>[]})],f.prototype,"rows",void 0),Object(o["a"])([Object(l["b"])("close")],f.prototype,"back",null),f=Object(o["a"])([Object(l["a"])({components:{CustomIcon:m,svgIcon:b["a"]}})],f);var g=f,v=g,y=(s("67fa"),s("1ac7"),Object(p["a"])(v,i,a,!1,null,null,null));e["a"]=y.exports},"74c5":function(t,e,s){"use strict";s("2dc0")},7568:function(t,e,s){"use strict";s("2f23")},"76d7":function(t,e,s){"use strict";s("836c")},"76ff":function(t,e,s){"use strict";var i=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",[e("el-dialog",{attrs:{title:"配置详情",visible:t.visible,width:"60%","destroy-on-close":!0},on:{"update:visible":function(e){t.visible=e},close:t.back}},[e("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}]},[e("el-row",{attrs:{gutter:20}},[e("el-col",{attrs:{span:10}},[e("span",{staticClass:"label"},[t._v("云服务器ID:")]),e("span",[t._v(t._s(t.detail&&t.detail.ecs_id))])]),e("el-col",{attrs:{span:10}},[e("span",{staticClass:"label"},[t._v("地域:")]),e("span",[t._v(t._s(t.detail&&t.detail.region_name))])])],1),e("el-row",{attrs:{gutter:20}},[e("el-col",{staticClass:"name-row",attrs:{span:10}},[e("span",{staticClass:"label"},[t._v("云服务器名称:")]),e("span",[e("pre",[t._v(t._s(t.detail&&t.detail.ecs_name))])])]),e("el-col",{attrs:{span:10}},[e("span",{staticClass:"label"},[t._v("可用区:")]),e("span",[t._v(t._s(t.detail&&t.detail.az_name))])])],1),e("el-row",{attrs:{gutter:20}},[e("el-col",{attrs:{span:10}},[e("span",{staticClass:"label"},[t._v("状态:")]),e("span",[t._v(t._s(t.detail&&t.detail.status_display))])])],1),e("div",{staticClass:"title"},[t._v("计算规格")]),e("el-row",{attrs:{gutter:20}},[t.detail&&t.detail.ecs_rule&&t.detail.ecs_rule.conf_name?e("el-col",{attrs:{span:20}},[e("span",{staticClass:"label"},[t._v(t._s(t.detail&&t.detail.ecs_rule&&t.detail.ecs_rule.conf_name)+":")]),e("span",[t._v(t._s(t.detail&&t.detail.ecs_rule&&t.detail.ecs_rule.name))]),t.detail&&t.detail.ecs_rule&&t.detail.ecs_rule.cpu_num?e("span",[t._v("   "+t._s(t.detail&&t.detail.ecs_rule&&t.detail.ecs_rule.cpu_num)+"vCPU "),e("span",[t._v(t._s(t.detail&&t.detail.ecs_rule&&t.detail.ecs_rule.ram)+"GiB")]),t.detail&&t.detail.is_gpu?e("span",[t._v(t._s(t.detail&&t.detail.ecs_rule&&t.detail.ecs_rule.gpu)+"*"+t._s(t.detail&&t.detail.card_name))]):t._e()]):t._e()]):t._e()],1),e("div",{staticClass:"title"},[t._v("操作系统")]),e("div",{staticClass:"content"},[t._v(t._s(t.detail&&t.detail.os_info&&t.detail.os_info.name))]),e("div",{staticClass:"title"},[t._v("存储")]),e("div",{staticClass:"content"},[e("span",{staticClass:"label"},[t._v("系统盘：")]),t.detail&&t.detail.disk&&t.detail.disk.system_disk_conf?e("span",{staticClass:"data-disk"},[t._v(t._s(t.detail&&t.detail.disk&&t.detail.disk.system_disk_conf&&t.detail.disk.system_disk_conf.disk_name))]):t._e(),t.detail&&t.detail.disk&&t.detail.disk.system_disk_conf&&t.detail.disk.system_disk_conf.size?e("span",{staticClass:"data-disk-unit"},[t._v(t._s(t.detail&&t.detail.disk&&t.detail.disk.system_disk_conf&&t.detail.disk.system_disk_conf.size)+t._s(t.detail&&t.detail.disk&&t.detail.disk.system_disk_conf&&t.detail.disk.system_disk_conf.unit))]):t._e(),t.detail&&t.detail.disk&&t.detail.disk.system_disk_conf&&t.detail.disk.system_disk_conf.id?e("span",{staticClass:"id_name"},[t._v("("+t._s(t.detail&&t.detail.disk&&t.detail.disk.system_disk_conf&&t.detail.disk.system_disk_conf.id)+" / "+t._s(t.detail&&t.detail.disk&&t.detail.disk.system_disk_conf&&t.detail.disk.system_disk_conf.name)+")")]):t._e()]),e("div",{staticClass:"content data_disk"},[e("span",{staticClass:"label"},[t._v("数据盘：")]),t.detail&&t.detail.disk&&t.detail.disk.data_disk_conf?e("div",{staticClass:"disk_content"},t._l(t.detail.disk.data_disk_conf,(function(s){return e("div",{key:s.id},[e("span",{staticClass:"data-disk"},[t._v(t._s(s.disk_name))]),e("span",{staticClass:"data-disk-unit"},[t._v(t._s(s.size)+t._s(s.unit))]),e("span",{staticClass:"id_name"},[t._v("("+t._s(s.id)+" / "+t._s(s.name)+")")]),e("span",[t._v(t._s(s.is_follow_delete?"随实例删除":"不随实例删除"))])])})),0):t._e()]),e("div",{staticClass:"title"},[t._v("网络")]),e("div",{staticClass:"content"},[e("span",{staticClass:"label"},[t._v("VPC:")]),t.detail&&t.detail.pipe&&t.detail.pipe.vpc_id?e("span",[t._v(t._s(t.detail&&t.detail.pipe&&t.detail.pipe.vpc_id)+" / "+t._s(t.detail&&t.detail.pipe&&t.detail.pipe.vpc_name))]):t._e()]),e("div",{staticClass:"content"},[e("span",{staticClass:"label"},[t._v("子网:")]),t.detail&&t.detail.pipe&&t.detail.pipe.subnet_id?e("span",[t._v(t._s(t.detail&&t.detail.pipe&&t.detail.pipe.subnet_id)+" / "+t._s(t.detail&&t.detail.pipe&&t.detail.pipe.subnet_name))]):t._e()]),e("div",{staticClass:"content display-flex"},[e("span",{staticClass:"label"},[t._v("私网IP：")]),t.detail&&t.detail.pipe?e("span",[t.detail.pipe.private_net?[t._v(t._s(t.detail.pipe.private_net)+" （主）")]:t._e(),e("br"),t.detail.pipe.pub_net?[t._v(" "+t._s(t.detail.pipe.pub_net)+" "),t.detail.pipe.eip_info[t.detail.pipe.pub_net]&&t.detail.pipe.eip_info[t.detail.pipe.pub_net].conf_name?[t._v(" （"+t._s(t.detail.pipe.eip_info[t.detail.pipe.pub_net].conf_name)+"） ")]:t._e(),e("br")]:t._e(),t._l(t.detail.pipe.virtual_net,(function(s){return e("span",{key:s},[t._v(" "+t._s(s)+" "),t.detail.pipe.eip_info[s]&&t.detail.pipe.eip_info[s].conf_name?[t._v(" （"+t._s(t.detail.pipe.eip_info[s].conf_name)+"） ")]:t._e(),e("br")],2)}))],2):t._e()]),e("div",{staticClass:"content display-flex"},[e("span",{staticClass:"label"},[t._v("公网IP：")]),t.detail&&t.detail.pipe?e("span",[t.detail.pipe.pub_net&&t.detail.pipe.eip_info[t.detail.pipe.pub_net]&&t.detail.pipe.eip_info[t.detail.pipe.pub_net].eip_ip?[t._v(" "+t._s(t.detail.pipe.eip_info[t.detail.pipe.pub_net].eip_ip)+" （"+t._s(t.detail.pipe.eip_info[t.detail.pipe.pub_net].conf_name)+"） "),e("br")]:t._e(),t._l(t.detail.pipe.virtual_net,(function(s){return e("span",{key:s},[t.detail.pipe.eip_info[s]&&t.detail.pipe.eip_info[s].conf_name?[t._v(" "+t._s(s.eip_ip)+" （"+t._s(t.detail.pipe.eip_info[s].conf_name)+"） ")]:t._e(),e("br")],2)}))],2):t._e()]),e("div",{staticClass:"divider"}),e("div",{staticClass:"content"},[e("span",{staticClass:"label"},[t._v("所属机房:")]),e("span",[t._v(t._s(t.detail&&t.detail.engine_room))])]),e("div",{staticClass:"content"},[e("span",{staticClass:"label"},[t._v("所属节点:")]),e("span",[t._v(t._s(t.detail&&t.detail.host_name))])]),e("div",{staticClass:"content"},[e("span",{staticClass:"label"},[t._v("所属物理机:")]),t.detail&&t.detail.host_id?e("span",[t._v(t._s(t.detail&&t.detail.host_id)+"   "),t.detail&&t.detail.host_status?e("span",[t._v("( "+t._s(t.detail&&t.detail.host_status)+" )")]):t._e()]):t._e()]),e("div",{staticClass:"content"},[e("span",{staticClass:"label"},[t._v("处理器型号:")]),e("span",[t._v(t._s(t.detail&&t.detail.cpu_type))])]),e("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{attrs:{type:"primary"},on:{click:t.back}},[t._v("返回")])],1)],1)])],1)},a=[],o=s("9ab4"),l=s("1b40"),r=s("d772");let n=class extends l["e"]{constructor(){super(...arguments),this.detail=null,this.loading=!1}async getDetail(){let t=await r["a"].get_detail({ecs_id:this.detail_id});"Success"===t.code?(this.loading=!1,this.detail=t.data):this.loading=!1}back(){}created(){this.getDetail()}};Object(o["a"])([Object(l["c"])(Boolean)],n.prototype,"visible",void 0),Object(o["a"])([Object(l["c"])(String)],n.prototype,"detail_id",void 0),Object(o["a"])([Object(l["b"])("close-detail")],n.prototype,"back",null),n=Object(o["a"])([l["a"]],n);var c=n,_=c,d=(s("88bb"),s("2877")),u=Object(d["a"])(_,i,a,!1,null,"33b12e64",null);e["a"]=u.exports},7864:function(t,e,s){},"786f":function(t,e,s){"use strict";var i=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",[e("el-dialog",{attrs:{title:"操作记录",visible:t.visible,width:"60%","destroy-on-close":!0,"close-on-click-modal":!1},on:{"update:visible":function(e){t.visible=e},close:t.back}},[e("div",[e("el-dialog",{attrs:{title:"响应信息",visible:t.res_visible,width:"60%","destroy-on-close":!0,"append-to-body":"","custom-class":"response-data"},on:{"update:visible":function(e){t.res_visible=e},close:t.clost_res}},[e("div",[t._v(t._s(t.response))])])],1),e("div",[e("action-block",{attrs:{search_option:["physical","message"].includes(t.type)?{...t.search}:t.search},on:{"fn-search":t.fn_search}}),["physical","message"].includes(t.type)?e("div",{staticClass:"icon m-bottom10"},[e("el-tooltip",{attrs:{content:"刷新",placement:"bottom",effect:"light"}},[e("el-button",{attrs:{type:"text"},on:{click:t.getOperateRecordList}},[e("svg-icon",{staticClass:"refresh",attrs:{icon:"refresh"}})],1)],1)],1):t._e(),e("el-table",{staticClass:"record-table",attrs:{data:t.record_list,border:""}},[e("el-table-column",{attrs:{prop:"oper_time",label:"操作时间"},scopedSlots:t._u([{key:"default",fn:function(s){return[e("span",[t._v(t._s(s.row.oper_time?t.moment(s.row.oper_time).format("YYYY-MM-DD HH:mm:ss"):""))])]}}])}),e("el-table-column",{attrs:{prop:"oper_type_display",label:"操作内容"}}),e("el-table-column",{attrs:{prop:"status_display",label:"状态"}}),["message","physical"].includes(t.type)?e("el-table-column",{attrs:{prop:"response",label:"响应信息"},scopedSlots:t._u([{key:"default",fn:function(s){return[s.row.response?e("el-button",{attrs:{type:"text"},on:{click:function(e){return t.view(s.row.response)}}},[t._v("查看")]):e("span",[t._v("-")])]}}])}):e("el-table-column",{attrs:{prop:"response",label:"响应信息"},scopedSlots:t._u([{key:"default",fn:function(s){return[s.row.result?e("el-button",{attrs:{type:"text"},on:{click:function(e){return t.view(s.row.result)}}},[t._v("查看")]):e("span",[t._v("-")])]}}],null,!1,79404134)}),e("el-table-column",{attrs:{prop:"finish_time",label:"完成时间"},scopedSlots:t._u([{key:"default",fn:function(s){return[e("span",[t._v(t._s(s.row.finish_time?t.moment(s.row.finish_time).format("YYYY-MM-DD HH:mm:ss"):""))])]}}])}),e("el-table-column",{attrs:{prop:"oper_user",label:"nas"===t.type?"操作用户":"用户名"}}),["physical","message"].includes(t.type)?t._e():e("el-table-column",{attrs:{prop:"flag_display",label:"操作标识"}})],1),e("el-pagination",{attrs:{"current-page":t.current,"page-sizes":[20,50,100],"page-size":t.size,layout:"total, sizes, prev, pager, next, jumper",total:t.total},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}}),e("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{attrs:{type:"primary"},on:{click:t.back}},[t._v("返回")])],1)],1)])],1)},a=[],o=s("9ab4"),l=s("1b40"),r=s("c811"),n=s("d772"),c=s("1477"),_=s("e4d0"),d=s("039b"),u=s("fc43"),p=s("c1df"),h=s.n(p),m=s("8ce4"),b=s("3673");let f=class extends l["e"]{constructor(){super(...arguments),this.state_list=[{type:"",label:"全部"},{type:"doing",label:"执行中"},{type:"success",label:"成功"},{type:"failed",label:"失败"}],this.search={state:{list:this.state_list,placeholder:"请选择状态"},content:{placeholder:"请输入操作内容"}},this.record_list=[],this.current=1,this.size=20,this.total=0,this.search_data={},this.moment=h.a,this.response="",this.res_visible=!1}created(){this.fn_search()}fn_search(t={}){this.current=1,this.search_data=t,this.getOperateRecordList()}async getOperateRecordList(){let t;const{search_data:e}=this;let s="physical"!==this.type?{task_type:e.content,cloud_id:this.record_id}:{content:e.content,cloud_id:this.record_id,cloud_type:"host"},i={status:e.state||"",page_size:this.size,page_index:this.current,...s};if(t="physical"===this.type?await c["a"].record({...i}):"message"===this.type?await _["a"].get_pub_operate_record({os_id:this.record_id,status:e.state||"",content_type:e.content,page_size:this.size,page_index:this.current}):"snapshot"===this.type?await d["a"].record({cloud_id:this.record_id,cloud_type:"snapshot",status:e.state||"",task_type:e.content,page_size:this.size,page_index:this.current}):"nas"===this.type?await u["a"].get_nas_record({...i}):await n["a"].get_operate_record_list({cloud_type:this.type?this.type:"ecs",...i}),"Success"===t.code){var a,o;if(["physical","message"].includes(this.type)){let e=["create_time","content","status_name","response","update_time","op_user"],s=["oper_time","oper_type_display","status_display","response","finish_time","oper_user"];this.record_list=Object(m["b"])(t.data.operation_list,s,e)}else{var l;this.record_list=(null===(l=t.data)||void 0===l?void 0:l.history_record)||[]}this.total=(null===(a=t.data)||void 0===a||null===(o=a.page_info)||void 0===o?void 0:o.count)||0}}handleSizeChange(t){this.size=t,this.getOperateRecordList()}handleCurrentChange(t){this.current=t,this.getOperateRecordList()}view(t){this.response=t,this.res_visible=!0}clost_res(){this.res_visible=!1,this.response=""}back(){}};Object(o["a"])([Object(l["c"])(Boolean)],f.prototype,"visible",void 0),Object(o["a"])([Object(l["c"])(String)],f.prototype,"record_id",void 0),Object(o["a"])([Object(l["c"])(String)],f.prototype,"type",void 0),Object(o["a"])([Object(l["b"])("close")],f.prototype,"back",null),f=Object(o["a"])([Object(l["a"])({components:{ActionBlock:r["a"],SvgIcon:b["a"]}})],f);var g=f,v=g,y=(s("9380"),s("2877")),k=Object(y["a"])(v,i,a,!1,null,null,null);e["a"]=k.exports},"79a4":function(t,e,s){"use strict";var i=s("23e7"),a=s("d039"),o=s("953b"),l=s("dad2"),r=!l("intersection",(function(t){return 2===t.size&&t.has(1)&&t.has(2)}))||a((function(){return"3,2"!==String(Array.from(new Set([1,2,3]).intersection(new Set([3,2]))))}));i({target:"Set",proto:!0,real:!0,forced:r},{intersection:o})},"7c69":function(t,e,s){},"7d2a":function(t,e,s){},"7f65":function(t,e,s){"use strict";var i=s("59ed"),a=s("825a"),o=s("c65b"),l=s("5926"),r=s("46c4"),n="Invalid size",c=RangeError,_=TypeError,d=Math.max,u=function(t,e){this.set=t,this.size=d(e,0),this.has=i(t.has),this.keys=i(t.keys)};u.prototype={getIterator:function(){return r(a(o(this.keys,this.set)))},includes:function(t){return o(this.has,this.set,t)}},t.exports=function(t){a(t);var e=+t.size;if(e!==e)throw new _(n);var s=l(e);if(s<0)throw new c(n);return new u(t,s)}},"81b2":function(t,e,s){"use strict";var i=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",[e("el-dialog",{attrs:{title:"进入救援模式",visible:t.visibleSync,width:"700px","destroy-on-close":!0},on:{"update:visible":function(e){t.visibleSync=e}}},[e("div",{staticClass:"tip_box"},[e("div",[t._v("1. 进入救援模式需要在实例关机状态下进行，建议主动关机，强制关机可能会造成数据丢失或文件损坏")]),e("div",[t._v("2. Linux系统的实例默认使用Ubuntu22.04的引导文件，Windows系统默认使用Windows 10的引导文件")]),e("div",[t._v("3. 处于救援模式的实例不能执行开关机操作")]),e("div",[t._v("4. 退出救援模式后，实例恢复到进入救援模式之前的状态。")])]),e("div",[e("el-form",{ref:"form",staticClass:"m-top10",attrs:{model:t.os_data,"label-width":"100px","label-position":"left"}},[e("el-form-item",{attrs:{label:"镜像:"}},[e("el-select",{staticClass:"m-r-12",on:{change:t.changeOsType},model:{value:t.os_data.os_type,callback:function(e){t.$set(t.os_data,"os_type",e)},expression:"os_data.os_type"}},t._l(t.image_type,(function(t){return e("el-option",{key:t,attrs:{value:t}})})),1),e("el-select",{staticClass:"m-left10",on:{change:t.changeOsType},model:{value:t.os_data.os_id,callback:function(e){t.$set(t.os_data,"os_id",e)},expression:"os_data.os_id"}},t._l(t.image_type_list,(function(t){return e("el-option",{key:t.os_id,attrs:{value:t.os_id,label:t.display_name}})})),1)],1)],1)],1),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{attrs:{type:"danger"},on:{click:t.confirm}},[t._v("进入救援模式")]),e("el-button",{attrs:{type:"default"},on:{click:function(e){t.visibleSync=!1}}},[t._v("取消")])],1)])],1)},a=[],o=(s("e9f5"),s("910d"),s("9ab4")),l=s("1b40"),r=s("e527");let n=class extends l["e"]{constructor(){super(...arguments),this.os_data={os_type:"",os_id:""},this.image_type=[],this.image_list=[],this.image_type_list=[]}created(){this.FnGetImage()}async FnGetImage(){let t=await r["a"].get_rescue_image_list({pod_id:this.$store.state.pod_id,ecs_id:this.ecs_id});"Success"===t.code&&(this.image_type=t.data.image_types,this.image_list=t.data.image_list,this.os_data.os_type=this.image_type[0],this.FnInitImageList())}changeOsType(){this.FnInitImageList()}FnInitImageList(){this.image_type_list=this.image_list.filter(t=>t.os_type===this.os_data.os_type),this.os_data.os_id=this.image_type_list[0].os_id}async confirm(){let t={customer_id:this.customer_id,ecs_id:this.ecs_id,os_id:this.os_data.os_id},e=await r["a"].enter_rescue(t);"Success"===e.code&&(this.$message.success(e.message),this.visibleSync=!1)}};Object(o["a"])([Object(l["d"])("visible")],n.prototype,"visibleSync",void 0),Object(o["a"])([Object(l["c"])(String)],n.prototype,"ecs_id",void 0),Object(o["a"])([Object(l["c"])(String)],n.prototype,"customer_id",void 0),n=Object(o["a"])([l["a"]],n);var c=n,_=c,d=(s("acc5"),s("2877")),u=Object(d["a"])(_,i,a,!1,null,"c2059ba4",null);e["a"]=u.exports},"82ea":function(t,e,s){"use strict";s("2025")},"832c":function(t,e,s){},"836c":function(t,e,s){},"83b9e":function(t,e,s){"use strict";var i=s("cb27"),a=s("384f"),o=i.Set,l=i.add;t.exports=function(t){var e=new o;return a(t,(function(t){l(e,t)})),e}},8451:function(t,e,s){"use strict";s("0da7")},8558:function(t,e,s){"use strict";var i=s("cfe9"),a=s("b5db"),o=s("c6b6"),l=function(t){return a.slice(0,t.length)===t};t.exports=function(){return l("Bun/")?"BUN":l("Cloudflare-Workers")?"CLOUDFLARE":l("Deno/")?"DENO":l("Node.js/")?"NODE":i.Bun&&"string"==typeof Bun.version?"BUN":i.Deno&&"object"==typeof Deno.version?"DENO":"process"===o(i.process)?"NODE":i.window&&i.document?"BROWSER":"REST"}()},"88bb":function(t,e,s){"use strict";s("d9aa")},8966:function(t,e,s){},"8a6c":function(t,e,s){"use strict";s("baed")},"8b00":function(t,e,s){"use strict";var i=s("23e7"),a=s("68df"),o=s("dad2"),l=!o("isSubsetOf",(function(t){return t}));i({target:"Set",proto:!0,real:!0,forced:l},{isSubsetOf:a})},"8bcb":function(t,e,s){"use strict";function i(t,e=NaN){let s=e?(e-Number(t.disk_min))/Number(t.disk_step):0,i=Number(t.min_iops)+Number(t.iops_step)*s>t.max_iops?t.max_iops:Number(t.min_iops)+Number(t.iops_step)*s,a=Number(t.min_throughput)+Number(t.throughput_step)*s>t.max_throughput?t.max_throughput:Number(t.min_throughput)+Number(t.throughput_step)*s;return{iops_show:i+" "+t.iops_unit,throughput_show:a+" "+t.throughput_unit,iops:i,throughput:a}}s.d(e,"a",(function(){return i}))},"8ce4":function(t,e,s){"use strict";s.d(e,"e",(function(){return i})),s.d(e,"b",(function(){return a})),s.d(e,"a",(function(){return o})),s.d(e,"c",(function(){return l})),s.d(e,"d",(function(){return r}));s("14d9"),s("e9f5"),s("ab43");function i(t,e,s,i,a){let o=[];return t.map(t=>{o.push({[i]:t[e],[a]:t[s]})}),o}function a(t,e,s,i={}){let a=[];return t.map(t=>{let o={};e.map((e,i)=>{o[e]=t[s[i]]}),a.push({...o,...i})}),a}function o(t,e=!1){let s={};for(let i in t){const{billing_scheme_id:a,billing_cycle_id:o,billing_items:l,gic_goods_id:r}=t[i];let n={};for(let t in l){let s={attr_id:l[t].attr_id,name:l[t].name},i={id:l[t].id,key:t};n[t]=e?{...s,...i}:i}s[i]={billing_scheme_id:a,billing_cycle_id:o,billing_items:n,gic_goods_id:e?r:void 0}}return s}function l(t,e){return t.map(t=>t[e])}function r(t){let e="";for(let s in t)t[s]&&(e+=`${s}=${t[s]}&`);return""===e?"":"?"+e.slice(0,e.length-1)}},"8e16":function(t,e,s){"use strict";var i=s("7282"),a=s("cb27");t.exports=i(a.proto,"size","get")||function(t){return t.size}},"8ee3":function(t,e,s){},"8f0f":function(t,e,s){},"8ff0":function(t,e,s){},9074:function(t,e,s){"use strict";var i=s("81a9"),a=s("bff7");e["a"]={get_customer_name(t){return Object(i["a"])(Object(a["b"])("POST","/ecs/get_customer_name/",t))},get_region_az_list(t){return Object(i["a"])(Object(a["b"])("POST","/ecs/region_az_info/",t))},get_net_list(t){return Object(i["a"])(Object(a["b"])("POST","/ecs/net_info/",t))},get_all_cpu_ram(){return Object(i["a"])(Object(a["b"])("GET","/ecs/ram_cpu_list/"))},get_category_list(t){return Object(i["a"])(Object(a["b"])("GET","/ecs/ecs_category_list/",t))},ecs_family_info(t){return Object(i["a"])(Object(a["b"])("GET","/ecs/ecs_family_info/",t))},get_os_list(t){return Object(i["a"])(Object(a["b"])("POST","/img/image_info/",t))},get_price(t){return Object(i["a"])(Object(a["b"])("POST","/ecs/get_price/",t))},create_instance(t){return Object(i["a"])(Object(a["b"])("POST","/ecs/create_ecs/",t))},get_ecs_limit(t){return Object(i["a"])(Object(a["b"])("POST","/ecs/get_ecs_limit/",t))},get_ram_cpu_price_list(t){return Object(i["a"])(Object(a["b"])("POST","/ecs/ecs_spec_attach_price/",t))},difference_price(t){return Object(i["a"])(Object(a["b"])("POST","/ecs/ecs_difference_price/",t))},change_configure_limit(t){return Object(i["a"])(Object(a["b"])("POST","/ecs/change_configure_limit/",t))}}},9380:function(t,e,s){"use strict";s("8f0f")},9409:function(t,e,s){},9485:function(t,e,s){"use strict";var i=s("23e7"),a=s("2266"),o=s("59ed"),l=s("825a"),r=s("46c4"),n=s("2a62"),c=s("f99f"),_=s("2ba4"),d=s("d039"),u=TypeError,p=d((function(){[].keys().reduce((function(){}),void 0)})),h=!p&&c("reduce",u);i({target:"Iterator",proto:!0,real:!0,forced:p||h},{reduce:function(t){l(this);try{o(t)}catch(d){n(this,"throw",d)}var e=arguments.length<2,s=e?void 0:arguments[1];if(h)return _(h,this,e?[t]:[t,s]);var i=r(this),c=0;if(a(i,(function(i){e?(e=!1,s=i):s=t(s,i,c),c++}),{IS_RECORD:!0}),e)throw new u("Reduce of empty iterator with no initial value");return s}})},"953b":function(t,e,s){"use strict";var i=s("dc19"),a=s("cb27"),o=s("8e16"),l=s("7f65"),r=s("384f"),n=s("5388"),c=a.Set,_=a.add,d=a.has;t.exports=function(t){var e=i(this),s=l(t),a=new c;return o(e)>s.size?n(s.getIterator(),(function(t){d(e,t)&&_(a,t)})):r(e,(function(t){s.includes(t)&&_(a,t)})),a}},9961:function(t,e,s){"use strict";var i=s("dc19"),a=s("cb27"),o=s("83b9e"),l=s("7f65"),r=s("5388"),n=a.add,c=a.has,_=a.remove;t.exports=function(t){var e=i(this),s=l(t).getIterator(),a=o(e);return r(s,(function(t){c(e,t)?_(a,t):n(a,t)})),a}},"9adc":function(t,e,s){"use strict";var i=s("8558");t.exports="NODE"===i},"9b6c":function(t,e,s){"use strict";s("7864")},"9e55":function(t,e,s){},a05b:function(t,e,s){"use strict";var i=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",[e("el-dialog",{attrs:{title:"添加计算节点",visible:t.visible_sync,width:"760px","destroy-on-close":!0,"close-on-click-modal":!1},on:{"update:visible":function(e){t.visible_sync=e},close:t.back}},[e("action-block",{attrs:{search_option:t.search},on:{"fn-search":t.fn_search}}),e("el-table",{attrs:{data:t.list,"max-height":"400px"},on:{"selection-change":t.handleSelectionChange,"sort-change":t.FnSortChange,"filter-change":t.filterAttribute}},[e("el-table-column",{attrs:{type:"selection"}}),e("el-table-column",{attrs:{label:"主机名称",prop:"host_name",sortable:"custom"}}),e("el-table-column",{attrs:{label:"管理网IP",prop:"host_ip"}}),e("el-table-column",{attrs:{label:"CPU型号",prop:"cpu_model",filters:t.cpu_list,"filter-multiple":!1,"column-key":"cpu_model"}}),e("el-table-column",{attrs:{label:"GPU型号",prop:"gpu_model"}}),e("el-table-column",{attrs:{label:"块存储集群",prop:"storage_cluster_name"}}),e("el-table-column",{attrs:{label:"存储类型",prop:"storage_type"},scopedSlots:t._u([{key:"default",fn:function(s){return[e("span",[t._v(t._s("local"===s.row.storage_type?"本地盘":"云盘"))])]}}])})],1),e("div",{staticClass:"footer"},[e("div",{staticClass:"m-top10"},[t._v("共"+t._s(t.page_info.total)+"条/已选择"+t._s(t.multiple_selection.length)+"条")]),e("el-pagination",{attrs:{"current-page":t.page_info.current,"page-sizes":[20,50,100],"page-size":t.page_info.size,layout:"sizes, prev, pager, next, jumper",total:t.page_info.total},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}})],1),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{attrs:{type:"primary"},on:{click:t.confirm}},[t._v("确认")]),e("el-button",{on:{click:function(e){return t.back("0")}}},[t._v("取消")])],1)],1)],1)},a=[],o=(s("e9f5"),s("ab43"),s("9ab4")),l=s("1b40"),r=s("6285"),n=s("da8b"),c=s("3fa7"),_=s("c811");let d=class extends l["e"]{constructor(){super(...arguments),this.search_data={},this.list=[],this.filter_data={},this.multiple_selection=[],this.filter_dict={},this.cpu_list=[],this.search={host_info:{placeholder:"输入主机名称/管理网IP搜索"}},this.sort_host_name="",this.page_info={current:1,size:20,total:0}}watch_visible(t){t?this.get_host_list():this.search_data=""}fn_search(t={}){this.page_info.current=1,this.search_data={...t,...this.filter_data},this.get_host_list()}async confirm(){const t=this.multiple_selection.map(t=>({host_id:t.host_id,cluster_id:this.cluster_id}));let e=await n["a"].add_cluster({param:t});"Success"===e.code?(""==e.data.error_msg?this.$message.success(e.message):this.$message.warning(e.data.error_msg),this.back("1"),c["a"].$emit("getTreeData",!1)):this.back("0")}async get_host_list(){if(!this.$store.state.az_id)return;const{search_data:t}=this;let e=Object(r["a"])(this.$route.params.id),s={page_index:this.page_info.current,page_size:this.page_info.size,az_id:this.$store.state.az_id,pod_id:"pod_cluster"===this.$route.name?this.$route.params.id:e,is_unassigned_cluster:2,host_info:t.host_info||"",cpu_type_id:JSON.stringify(this.info.cpu_type_id),gpu_type_id:this.info.gpu_type_id,storage_cluster_id:this.info.storage_cluster_id,cpu:t.cpu_model?t.cpu_model[0]:void 0,sort_host_name:this.sort_host_name},i=await n["a"].get_pod_host_list(s);"Success"===i.code&&(this.list=i.data.result,this.page_info.total=i.data.page_info.count,this.filter_dict=i.data.filter_dict,this.cpu_list=this.filter_dict.cpu_dict.map(t=>({text:t,value:t})))}handleSizeChange(t){this.page_info.size=t,this.get_host_list()}handleCurrentChange(t){this.page_info.current=t,this.get_host_list()}handleSelectionChange(t){this.multiple_selection=t}FnSortChange(t){this.sort_host_name=void 0,this.sort_host_name="descending"===t.order?"1":"ascending"===t.order?"0":void 0,this.get_host_list()}filterAttribute(t){this.filter_data={...this.filter_data,...t},this.fn_search()}back(t){this.multiple_selection=[],this.visible_sync=!1}};Object(o["a"])([Object(l["d"])("visible")],d.prototype,"visible_sync",void 0),Object(o["a"])([Object(l["c"])({default:""})],d.prototype,"cluster_id",void 0),Object(o["a"])([Object(l["c"])({default:()=>{}})],d.prototype,"info",void 0),Object(o["a"])([Object(l["f"])("visible")],d.prototype,"watch_visible",null),Object(o["a"])([Object(l["b"])("close")],d.prototype,"back",null),d=Object(o["a"])([Object(l["a"])({components:{ActionBlock:_["a"]}})],d);var u=d,p=u,h=(s("dcd7"),s("2877")),m=Object(h["a"])(p,i,a,!1,null,"ac635e1a",null);e["a"]=m.exports},a176:function(t,e,s){"use strict";s("4a88")},a4e7:function(t,e,s){"use strict";var i=s("23e7"),a=s("395e"),o=s("dad2"),l=!o("isSupersetOf",(function(t){return!t}));i({target:"Set",proto:!0,real:!0,forced:l},{isSupersetOf:a})},a5f7:function(t,e,s){"use strict";var i=s("dc19"),a=s("cb27"),o=s("83b9e"),l=s("8e16"),r=s("7f65"),n=s("384f"),c=s("5388"),_=a.has,d=a.remove;t.exports=function(t){var e=i(this),s=r(t),a=o(e);return l(e)<=s.size?n(e,(function(t){s.includes(t)&&d(a,t)})):c(s.getIterator(),(function(t){_(a,t)&&d(a,t)})),a}},a640:function(t,e,s){"use strict";var i=s("d039");t.exports=function(t,e){var s=[][t];return!!s&&i((function(){s.call(null,e||function(){return 1},1)}))}},a732:function(t,e,s){"use strict";var i=s("23e7"),a=s("c65b"),o=s("2266"),l=s("59ed"),r=s("825a"),n=s("46c4"),c=s("2a62"),_=s("f99f"),d=_("some",TypeError);i({target:"Iterator",proto:!0,real:!0,forced:d},{some:function(t){r(this);try{l(t)}catch(i){c(this,"throw",i)}if(d)return a(d,this,t);var e=n(this),s=0;return o(e,(function(e,i){if(t(e,s++))return i()}),{IS_RECORD:!0,INTERRUPTED:!0}).stopped}})},a881:function(t,e,s){"use strict";var i=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",[e("el-dialog",{attrs:{title:t.title,visible:t.visible_sync,width:"760px","destroy-on-close":!0,"close-on-click-modal":!1},on:{"update:visible":function(e){t.visible_sync=e},close:t.back}},[e("div",[0!==t.rows.length?e("el-alert",{attrs:{title:t.alert_title,type:"warning",center:"",closable:!1}}):t._e(),0!==t.rows.length?e("el-table",{attrs:{data:t.rows,border:"","max-height":"253"}},[e("el-table-column",{attrs:{prop:"host_name",label:"主机名",width:"150"}}),e("el-table-column",{attrs:{label:"节点"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(t.$store.state.az_list.az_name)+" ")]}}],null,!1,3791243258)}),e("el-table-column",{attrs:{prop:"machine_status_name",label:"机器状态"}}),e("el-table-column",{attrs:{prop:"host_purpose",label:"主机用途"}}),e("el-table-column",{attrs:{prop:"host_attribution_name",label:"主机归属"}})],1):t._e(),["resource"].includes(t.oper_type)?e("div",{staticClass:"ecs-belong m-top20"},[e("span",{staticClass:"m-right20"},[t._v("设置主机归属：")]),e("el-select",{attrs:{placeholder:"请选择"},model:{value:t.ecs_id,callback:function(e){t.ecs_id=e},expression:"ecs_id"}},t._l(t.ecs_list,(function(t){return e("el-option",{key:t.host_attribution_id,attrs:{label:t.name,value:t.host_attribution_id}})})),1)],1):e("el-form",{ref:"form",staticClass:"m-top20",attrs:{model:t.form_data,"label-width":"100px","label-position":"left"}},[["service"].includes(t.oper_type)?e("el-form-item",{attrs:{prop:"tag",label:"tag:",rules:[{required:!0,message:"请输入tag",trigger:"blur"}]}},[e("el-input",{attrs:{maxlength:64},model:{value:t.form_data.tag,callback:function(e){t.$set(t.form_data,"tag",e)},expression:"form_data.tag"}})],1):t._e(),0===t.rows.length?e("el-form-item",{attrs:{prop:"az_id",label:"节点:",rules:[{required:!0,message:"请选择节点",trigger:"blur"}]}},[e("el-select",{staticStyle:{width:"100%"},model:{value:t.form_data.az_id,callback:function(e){t.$set(t.form_data,"az_id",e)},expression:"form_data.az_id"}},t._l(t.az_list,(function(t){return e("el-option",{key:t.az_id,attrs:{value:t.az_id,label:t.az_name}})})),1)],1):t._e(),e("el-form-item",{attrs:{prop:"serviceType",label:"服务类型:",rules:[{required:!0,message:"请选择服务类型",trigger:"blur"}]}},[e("el-radio-group",{model:{value:t.form_data.serviceType,callback:function(e){t.$set(t.form_data,"serviceType",e)},expression:"form_data.serviceType"}},[e("el-radio",{attrs:{label:"cds-os-agent"}},[t._v("agent")]),e("el-radio",{attrs:{label:"monitor-instance",disabled:""}},[t._v("monitor-instance")]),e("el-radio",{attrs:{label:"monitor-host",disabled:""}},[t._v("monitor-host")])],1)],1)],1)],1),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{attrs:{type:"primary"},on:{click:t.confirm}},[t._v("确认")]),e("el-button",{on:{click:function(e){return t.back("0")}}},[t._v("取消")])],1)])],1)},a=[],o=(s("14d9"),s("e9f5"),s("7d54"),s("ab43"),s("9ab4")),l=s("1b40"),r=s("c811"),n=s("1477"),c=s("9074");let _=class extends l["e"]{constructor(){super(...arguments),this.alert_title=`是否确定对以下${this.rows.length}台物理机执行${this.title}操作？`,this.ecs_list=[],this.ecs_id="",this.az_list=[],this.form_data={tag:"",az_id:"",serviceType:"cds-os-agent"}}created(){"resource"===this.oper_type?this.get_host_attribution():this.get_az_list()}async get_az_list(){this.az_list=[];let t=await c["a"].get_region_az_list({need_open_az:"1"});"Success"===t.code&&(t.data.forEach(t=>{t.region_list.forEach(t=>{this.az_list.push(...t.az_list)})}),this.form_data.az_id=this.az_list[0].az_id)}async get_host_attribution(){let t=await n["a"].get_host_attribution({});"Success"===t.code&&(this.ecs_list=t.data.host_attribution_list,this.ecs_id=this.ecs_list[0].host_attribution_id)}async confirm(){let t,e=!0;if("resource"===this.oper_type)t=await n["a"].set_host_attribution({host_ids:this.rows.map(t=>t.host_id),host_attribution_id:this.ecs_id});else{let s=this.$refs.form;if(s.validate(t=>{t||(e=!1)}),!e)return!1;const i={az_id:0===this.rows.length?this.form_data.az_id:this.rows[0].az_id,host_ids:this.rows.map(t=>t.host_id),server_name:this.form_data.serviceType,is_node_update:0===this.rows.length?"1":void 0};t="service"===this.oper_type?await n["a"].agent_update({...i,server_tag:this.form_data.tag}):await n["a"].agent_rollback(i)}"Success"===t.code?"resource"===this.oper_type&&t.data.fail_host_list.length>0?(this.$message.warning(t.message),this.back("1")):(this.$message.success(t.message),this.back("1")):this.back("0")}back(t){this.visible_sync=!1}};Object(o["a"])([Object(l["d"])("visible")],_.prototype,"visible_sync",void 0),Object(o["a"])([Object(l["c"])({default:()=>[]})],_.prototype,"rows",void 0),Object(o["a"])([Object(l["c"])(String)],_.prototype,"title",void 0),Object(o["a"])([Object(l["c"])(String)],_.prototype,"oper_type",void 0),Object(o["a"])([Object(l["b"])("close")],_.prototype,"back",null),_=Object(o["a"])([Object(l["a"])({components:{ActionBlock:r["a"]}})],_);var d=_,u=d,p=(s("3bc5"),s("2877")),h=Object(p["a"])(u,i,a,!1,null,null,null);e["a"]=h.exports},aa9c:function(t,e,s){},acc5:function(t,e,s){"use strict";s("8ff0")},ae34:function(t,e,s){"use strict";s("2f52")},af7d:function(t,e,s){"use strict";var i=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("el-dialog",{attrs:{visible:t.visible,title:"自定义列表项","show-close":!1,"close-on-click-modal":!1},on:{"update:visible":function(e){t.visible=e}}},[e("div",{staticClass:"m-bottom10"},[t._v("清除缓存或者更换浏览器，自定义列表失效"),e("span",{staticClass:"warning_message m-left10"},[t._v("(最少选择5项，最多选择25项)")])]),e("div",{staticClass:"item"},[t._l(t.all_item,(function(s){return[e("div",{staticClass:"label"},[t._v(t._s(s.name))]),e("div",{class:[t.newView?"checkbox-box2":"checkbox-box"]},[e("el-checkbox-group",{model:{value:t.select_item,callback:function(e){t.select_item=e},expression:"select_item"}},t._l(s.filed,(function(t){return e("el-checkbox",{key:t.show_name,attrs:{label:t.show_name,disabled:"主机名"===t.show_name}})})),1)],1)]}))],2),e("span",[t._v("已选择："),e("span",{staticClass:"num_message"},[t._v(t._s(t.select_item.length))])]),e("span",{attrs:{slot:"footer"},slot:"footer"},[e("el-button",{attrs:{type:"primary"},on:{click:t.FnConfirm}},[t._v("确 定")]),e("el-button",{on:{click:t.FnClose}},[t._v("取 消")])],1)])},a=[],o=(s("e9f5"),s("ab43"),s("9ab4")),l=s("1b40");let r=class extends l["e"]{constructor(){super(...arguments),this.select_item=[],this.typeObj={host:{func:"SET_CUSTOM_HOST",value:"custom_host"},nas:{func:"SET_NAS_HOST",value:"nas_host"},cluster:{func:"SET_CLUSTER_HOST",value:"pod"},pod_host:{func:"SET_HOST_LIST",value:"pod"},pod_vm:{func:"SET_VM_HOST",value:"pod"}}}created(){"cluster"===this.type?this.FnHandleSelectItem(this.$store.state[this.typeObj[this.type].value].cluster_host):"pod_host"===this.type?this.FnHandleSelectItem(this.$store.state[this.typeObj[this.type].value].host_list):"pod_vm"===this.type?this.FnHandleSelectItem(this.$store.state[this.typeObj[this.type].value].vm_host):this.FnHandleSelectItem(this.$store.state[this.typeObj[this.type].value])}FnHandleSelectItem(t){t.length>0?this.select_item=[...t]:this.select_item=this.all_column_item.slice(0,25).map(t=>t.label),this.FnEmit()}FnConfirm(){this.select_item.length<5||this.select_item.length>25?this.$message.warning("自定义列表项最少为5项，最多为25项"):(this.$store.commit(this.typeObj[this.type].func,this.select_item),this.FnEmit(),this.FnClose())}FnClose(){this.$emit("update:visible",!1)}FnEmit(){return this.select_item}};Object(o["a"])([Object(l["c"])({default:!1})],r.prototype,"visible",void 0),Object(o["a"])([Object(l["c"])({default:"host"})],r.prototype,"type",void 0),Object(o["a"])([Object(l["c"])({default:()=>[]})],r.prototype,"all_column_item",void 0),Object(o["a"])([Object(l["c"])({default:()=>[]})],r.prototype,"all_item",void 0),Object(o["a"])([Object(l["c"])({default:!1})],r.prototype,"newView",void 0),Object(o["a"])([Object(l["b"])("fn-custom")],r.prototype,"FnEmit",null),r=Object(o["a"])([l["a"]],r);var n=r,c=n,_=(s("ea55"),s("2877")),d=Object(_["a"])(c,i,a,!1,null,"b2dbf330",null);e["a"]=d.exports},b4bc:function(t,e,s){"use strict";var i=s("dc19"),a=s("cb27").has,o=s("8e16"),l=s("7f65"),r=s("384f"),n=s("5388"),c=s("2a62");t.exports=function(t){var e=i(this),s=l(t);if(o(e)<=s.size)return!1!==r(e,(function(t){if(s.includes(t))return!1}),!0);var _=s.getIterator();return!1!==n(_,(function(t){if(a(e,t))return c(_,"normal",!1)}))}},bad9:function(t,e,s){"use strict";var i=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",{staticClass:"customer"},[e("el-select",{attrs:{multiple:"",placeholder:"输入关键字可进行搜索",filterable:"",remote:"","remote-method":t.getCustomerList},on:{"visible-change":t.changeCustomer},model:{value:t.customer_id,callback:function(e){t.customer_id=e},expression:"customer_id"}},t._l(t.customerList,(function(s){return e("el-option",{key:s.id,attrs:{value:s.id,label:`${s.id}(${s.name})`}},[t._v(t._s(`${s.id}(${s.name})`))])})),1)],1)},a=[],o=(s("e9f5"),s("ab43"),s("9ab4")),l=s("1b40"),r=s("1477");let n=class extends l["e"]{constructor(){super(...arguments),this.customer_id=[],this.customerList=[],this.flag=!0}created(){this.customerList=[...this.list],this.customer_id=this.customers,this.getDefaultCustomerList()}changeCustomer(t){t&&(this.customerList=[])}async getDefaultCustomerList(){if(this.list.length>0)return;let t=await r["a"].getCustomerList({host_ids:this.rows.map(t=>t.host_id),customer_ids:Array.isArray(this.customer_id)?this.customer_id:[]});"Success"==t.code&&(this.customerList=t.data.customer_list)}async getCustomerList(t="",e=!1){if(!t&&!e)return;let s=await r["a"].getCustomerList({host_ids:this.rows.map(t=>t.host_id),customer_id:t});"Success"==s.code&&(this.customerList=s.data.customer_list)}watch_customer_id(){this.FnCustomer()}FnCustomer(){return this.customer_id}};Object(o["a"])([Object(l["c"])({default:()=>[]})],n.prototype,"customers",void 0),Object(o["a"])([Object(l["c"])({default:()=>[]})],n.prototype,"rows",void 0),Object(o["a"])([Object(l["c"])({default:()=>[]})],n.prototype,"list",void 0),Object(o["a"])([Object(l["f"])("customer_id",{immediate:!0,deep:!0})],n.prototype,"watch_customer_id",null),Object(o["a"])([Object(l["b"])("FnCustomer")],n.prototype,"FnCustomer",null),n=Object(o["a"])([Object(l["a"])({})],n);var c=n,_=c,d=(s("fb2b"),s("2877")),u=Object(d["a"])(_,i,a,!1,null,null,null);e["a"]=u.exports},baed:function(t,e,s){},bd33:function(t,e,s){"use strict";s.r(e);var i=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",{staticClass:"tabBox"},[e("div",{staticClass:"currentInfo"},[t._v(" "+t._s(t.$store.state.display)+" ")]),e("el-tabs",{on:{"tab-click":t.handleClick},model:{value:t.active_tab,callback:function(e){t.active_tab=e},expression:"active_tab"}},t._l(t.tab_list,(function(t,s){return e("el-tab-pane",{key:s,attrs:{label:t,name:s}})})),1),e("router-view")],1)},a=[],o=(s("14d9"),s("9ab4")),l=s("1b40"),r=s("d5aa"),n=s("0faa"),c=s("4364"),_=s("018b");let d=class extends l["e"]{constructor(){super(...arguments),this.active_tab="",this.pod_id=this.$route.params.id,this.tab_list={pod_info:"概要",pod_cluster:"集群",pod_host:"主机",pod_vm:"虚拟机"}}handleClick(t,e){this.$route.name!==t.name&&this.$router.push({name:t.name,params:{id:this.pod_id}})}created(){this.active_tab=this.$route.name}};d=Object(o["a"])([Object(l["a"])({components:{ClusterList:r["default"],Info:n["default"],VmList:c["default"],HostList:_["default"]}})],d);var u=d,p=u,h=(s("6f4fd"),s("2877")),m=Object(h["a"])(p,i,a,!1,null,null,null);e["default"]=m.exports},bfc6:function(t,e,s){"use strict";var i=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",[e("div",{staticClass:"icon m-bottom10"},[e("el-tooltip",{attrs:{content:"自定义列表项",placement:"bottom",effect:"light"}},[e("el-button",{attrs:{type:"text"}},[e("i",{staticClass:"el-icon-s-tools"})])],1),e("el-tooltip",{attrs:{content:"刷新",placement:"bottom",effect:"light"}},[e("el-button",{attrs:{type:"text"}},[e("svg-icon",{staticClass:"refresh",attrs:{icon:"refresh"}})],1)],1),e("el-tooltip",{attrs:{content:"导出",placement:"bottom",effect:"light"}},[e("el-button",{attrs:{type:"text"}},[e("svg-icon",{staticClass:"export",attrs:{icon:"export"}})],1)],1)],1)])},a=[],o=s("9ab4"),l=s("1b40");let r=class extends l["e"]{};r=Object(o["a"])([Object(l["a"])({components:{}})],r);var n=r,c=n,_=(s("ae34"),s("2877")),d=Object(_["a"])(c,i,a,!1,null,"1fe47d89",null);e["a"]=d.exports},c1a1:function(t,e,s){"use strict";var i=s("23e7"),a=s("b4bc"),o=s("dad2"),l=!o("isDisjointFrom",(function(t){return!t}));i({target:"Set",proto:!0,real:!0,forced:l},{isDisjointFrom:a})},c839:function(t,e,s){"use strict";var i=s("81a9"),a=s("bff7");e["a"]={get_pod_list(t){return Object(i["a"])(Object(a["b"])("GET","/pod/get_pod_list/",t))},get_az_info(t){return Object(i["a"])(Object(a["b"])("GET","/pod/get_pod_info/",t))},create_pod(t){return Object(i["a"])(Object(a["b"])("POST","/pod/create_pod/",t))},update_pod(t){return Object(i["a"])(Object(a["b"])("POST","/pod/update_pod/",t))},get_pod_history(t){return Object(i["a"])(Object(a["b"])("GET","/pod/get_pod_history/",t))}}},ca1f:function(t,e,s){"use strict";s("f1ec")},cb27:function(t,e,s){"use strict";var i=s("e330"),a=Set.prototype;t.exports={Set:Set,add:i(a.add),has:i(a.has),remove:i(a["delete"]),proto:a}},cf80:function(t,e,s){"use strict";s("14d9");var i=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("el-dialog",{attrs:{title:"业务测试",visible:t.visible_sync,width:"1000px","destroy-on-close":!0,"close-on-click-modal":!1},on:{"update:visible":function(e){t.visible_sync=e},close:t.cancel}},[e("div",{staticClass:"m-left10"},[e("el-button",{staticClass:"m-bottom10",attrs:{type:"primary",disabled:t.selectedTasks.length===t.selectable.length},on:{click:t.add}},[t._v("新增测试任务")]),e("div",{staticClass:"m-bottom20"},[t._v("将对"),e("span",{staticClass:"m-left10 num_message m-right10"},[t._v(t._s(t.az_info.az_name))]),t._v("未通过业务测试的物理机进行业务测试，已通过业务测试的物理机不会再次进行以下测试。业务测试完成情况可在"),e("span",{staticClass:"clickble m-left10 m-right10",on:{click:function(e){return t.$router.push("/message")}}},[t._v("消息通知")]),t._v("进行查看")]),e("div",{staticClass:"m-bottom10"},[e("circle-icon",{attrs:{num:1}}),t._v(t._s(t.first.description?t.first.description:""))],1),t._l(t.selectedTasks,(function(s,i){return e("div",{key:i,staticClass:"m-bottom10"},[e("circle-icon",{attrs:{num:i+2}}),e("el-select",{attrs:{placeholder:"请选择测试任务列表"},on:{change:function(e){return t.changeTask(e,i)}},model:{value:s.task_id,callback:function(e){t.$set(s,"task_id",e)},expression:"item.task_id"}},t._l(t.selectable,(function(t){return e("el-option",{key:t.maintask_name,attrs:{value:t.maintask_name,label:t.display_name,disabled:s.disList.includes(t.maintask_name)}})})),1),s.task_id?e("span",{staticClass:"m-left10"},[t._v("该任务需设置参数，请点击"),e("el-button",{attrs:{type:"text"},on:{click:t.setParams}},[t._v("设置参数")])],1):t._e(),e("el-button",{staticClass:"m-left10",attrs:{type:"text"},on:{click:function(e){return t.del(i)}}},[t._v("删除")])],1)})),e("div",{staticClass:"m-bottom10"},[e("circle-icon",{attrs:{num:t.selectedTasks.length+2}}),t._v(t._s(t.second.description?t.second.description:""))],1),e("div",{staticClass:"m-bottom10"},[e("circle-icon",{attrs:{num:t.selectedTasks.length+3}}),t._v(t._s(t.third.description?t.third.description:""))],1)],2),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{attrs:{type:"primary"},on:{click:t.confirm}},[t._v("确 定")]),e("el-button",{on:{click:t.cancel}},[t._v("取 消")])],1)])},a=[],o=(s("e9f5"),s("910d"),s("ab43"),s("9ab4")),l=s("1b40"),r=s("3673"),n=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",{staticClass:"circle"},[t._v(t._s(t.num))])},c=[];let _=class extends l["e"]{};Object(o["a"])([Object(l["c"])()],_.prototype,"num",void 0),_=Object(o["a"])([Object(l["a"])({})],_);var d=_,u=d,p=(s("e1c5"),s("2877")),h=Object(p["a"])(u,n,c,!1,null,"a2f85430",null),m=h.exports,b=s("1477");let f=class extends l["e"]{constructor(){super(...arguments),this.taskList=[],this.selectedTasks=[],this.task="",this.selectable=[],this.first={},this.second={},this.third={}}created(){this.get_task_list()}async get_task_list(){let t=await b["a"].get_task_list({});"Success"===t.code&&(this.taskList=[...t.data.task_list],this.taskList.map(t=>(["CreateEcsGpuInstanceForTestPipeline","DeleteEcsGpuInstanceForTestPipeline","UpdateHostForTestPipeline"].includes(t.maintask_name)||this.selectable.push(t),"CreateEcsGpuInstanceForTestPipeline"===t.maintask_name&&(this.first=t),"DeleteEcsGpuInstanceForTestPipeline"===t.maintask_name&&(this.second=t),"UpdateHostForTestPipeline"===t.maintask_name&&(this.third=t),t)))}set_disList(){let t=this.selectedTasks.map(t=>t.task_id);this.selectedTasks.map(e=>(e.disList=t.filter(t=>t!==e.maintask_name),e))}add(){this.selectedTasks.length!==this.selectable.length&&(this.selectedTasks.push({task_id:"",params:{},disList:[]}),this.set_disList())}changeTask(t,e){this.set_disList()}del(t){let e=[];this.selectedTasks.map((s,i)=>(i!==t&&e.push(s),s)),this.selectedTasks=e,this.set_disList()}setParams(){}async confirm(){let t=[{...this.first}];this.selectedTasks.map(e=>(t.push({maintask_name:e.task_id,dep_params:e.params}),e)),t.push(this.second),t.push(this.third);let e=await b["a"].create_test_task({az_id:this.az_info.az_id,task_list:t});"Success"===e.code&&this.$message.success(e.message),this.visible_sync=!1}cancel(){this.visible_sync=!1}};Object(o["a"])([Object(l["d"])("visible")],f.prototype,"visible_sync",void 0),Object(o["a"])([Object(l["c"])({default:()=>({az_id:"",az_name:""})})],f.prototype,"az_info",void 0),f=Object(o["a"])([Object(l["a"])({components:{SvgIcon:r["a"],CircleIcon:m}})],f);var g=f,v=g,y=(s("2443"),Object(p["a"])(v,i,a,!1,null,"eb9ffe1e",null));e["a"]=y.exports},d4fd:function(t,e,s){"use strict";s("e9f5"),s("a732");var i=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("el-form",{ref:"resetForm",staticClass:"pwd-form",attrs:{model:t.data,"label-position":"left","label-width":"120px"}},[t.system_disk?e("div",{staticClass:"inline-form"},[e("el-form-item",{staticClass:"m-right20",attrs:{label:"系统盘",prop:"system_disk"}},[e("el-select",{attrs:{"value-key":"ecs_goods_id"},on:{change:t.FnChangeSystemType},model:{value:t.data.default_system_info,callback:function(e){t.$set(t.data,"default_system_info",e)},expression:"data.default_system_info"}},t._l(t.system_disk_info,(function(t){return e("el-option",{key:t.ecs_goods_id,attrs:{value:t,label:t.disk_name}})})),1)],1),e("el-form-item",[e("el-input-number",{attrs:{min:Number(t.data.system_disk_min),max:t.systemDiskMax,step:t.data.default_system_info?Number(t.data.default_system_info.disk_step):0},on:{blur:t.FnChangeSystemSize,change:t.FnChangeSystemSize},model:{value:t.data.system_size,callback:function(e){t.$set(t.data,"system_size",e)},expression:"data.system_size"}}),t._v(" "+t._s(t.data.default_system_info?t.data.default_system_info.disk_unit:"GB")+" ")],1)],1):t._e(),t.data_disk&&t.data_disk_info.length>0?[t._l(t.data_disk_list,(function(s,i){return e("div",{key:i},[e("div",{staticClass:"inline-form"},[e("el-form-item",{staticClass:"short-select",attrs:{label:0===i?"数据盘":""}},[e("i",{staticClass:"el-icon-remove-outline delete-icon",on:{click:function(e){return t.FnDelDataDisk(i)}}}),e("el-select",{staticClass:"m-right20",attrs:{"value-key":"ecs_goods_id"},on:{change:t.FnDataEmit},model:{value:s.default_disk_info,callback:function(e){t.$set(s,"default_disk_info",e)},expression:"disk.default_disk_info"}},t._l(t.data_disk_info,(function(s){return e("el-option",{key:s.ecs_goods_id,attrs:{value:s,label:s.disk_name,disabled:!t.FnSelectedDiskIds.includes(s.ecs_goods_id)}})})),1)],1),e("el-form-item",[e("input-number",{attrs:{info:t.data_disk_info?s.default_disk_info:null},on:{func:t.FnChangeDataSize}}),t._v(" "+t._s(t.data.default_system_info?s.default_disk_info.disk_unit:"GB")+" ")],1),e("el-form-item",[e("el-input-number",{staticClass:"m-left10 m-right10",attrs:{min:s.min,max:t.getEveryMaxNum(s),step:1},on:{blur:function(e){return t.FnCheckDataNum(s)},change:function(e){return t.FnChangeDataNum(s)}},model:{value:s.num,callback:function(e){t.$set(s,"num",e)},expression:"disk.num"}})],1),e("el-form-item",[e("el-checkbox",{on:{change:t.FnDataEmit},model:{value:s.del,callback:function(e){t.$set(s,"del",e)},expression:"disk.del"}},[t._v("随实例删除")])],1)],1),"local"!==s.default_disk_info.disk_feature?e("div",{staticClass:"prompt_message data-prompt"},[t._v(" 当前区域已购买 "),e("span",{staticClass:"num_message"},[t._v(t._s(s.default_disk_info.disk_feature)+" "+t._s(t.getResetInfo(s).used)+" "+t._s(s.default_disk_info.disk_unit))]),t._v(" ，还可以购买的容量额度为："),e("span",{class:[t.getResetInfo(s).reset>=0?"num_message":"error_message"]},[t._v(t._s(Math.max(t.getResetInfo(s).reset,0))+" "+t._s(s.default_disk_info.disk_unit))])]):t._e()])})),e("el-form-item",{attrs:{label:0===t.data_disk_list.length?"数据盘":""}},[e("div",{staticClass:"disk-btn"},[e("el-button",{attrs:{type:"text",disabled:t.data_disk_list.some(t=>16===t.num)||Object.keys(t.showResetVolume).length===t.data_disk_list.length},on:{click:t.FnAddDataDisk}},[e("i",{staticClass:"el-icon-circle-plus"}),t._v(" 添加数据盘")]),e("div",{staticClass:"prompt_message"},[t._v("您已选择 "),e("span",{staticClass:"num_message"},[t._v(t._s(t.FnGetDiskNum))]),t._v(" 块盘， 还可以添加 "),e("span",{staticClass:"num_message"},[t._v(t._s(t.FnGetSurplus))]),t._v(" 块盘")])],1)])]:t._e()],2)},a=[],o=(s("14d9"),s("13d5"),s("910d"),s("ab43"),s("9485"),s("9ab4")),l=s("1b40"),r=s("1c98"),n=s("8bcb"),c=s("8ce4"),_=s("4875");let d=class extends l["e"]{constructor(){super(...arguments),this.all_disk_info={system_disk:[],data_disk:[]},this.system_disk_info=[],this.data_disk_info=[],this.data_disk_list=[],this.showResetVolume={},this.data={default_system_info:{ecs_goods_id:"",disk_name:"",disk_unit:"",disk_feature:"",disk_type:"",disk_min:0,disk_max:500,disk_step:10,min_iops:0,max_iops:0,min_throughput:0,throughput_step:0,throughput_unit:"",max_throughput:0,iops_step:0,iops_unit:""},system_disk_min:0,system_size:0}}async FnGetDiskInfo(){if(!this.az_id)return;const t=await r["a"].get_disk_type({az_id:this.az_id,customer_id:this.customer_id,billing_method:this.billing_method,spec_family_id:this.spec_family_id});"Success"==t.code&&(this.all_disk_info={system_disk:t.data.system_disk,data_disk:t.data.data_disk},this.FnBillingInfo(Object(c["a"])(t.data.billing_info,!0)),this.FnFilterDisk())}async getDiskLimit(){if("local"===this.data.default_system_info.disk_feature)return;let t=await r["a"].get_disk_limit({customer_id:this.customer_id,az_id:this.az_id,feature:this.data_disk_info.map(t=>t.disk_feature)});if("Success"===t.code){this.showResetVolume={};for(let e in t.data)this.showResetVolume[e]=t.data[e].rest_volume;this.FnSysEmit()}}FnFilterDisk(){this.system_disk_info=this.all_disk_info.system_disk.filter(t=>t.disk_feature===this.disk_feature),this.data_disk_info=this.all_disk_info.data_disk,this.data.default_system_info=this.system_disk_info[0],this.data.default_system_info?(this.FnChangeSystemType(),this.getDiskLimit()):(this.data.default_system_info=null,this.data_disk_info=[],this.FnSysEmit(),this.$message.error("该产品规格无可用的存储类型，请联系管理员"))}FnChangeSystemType(){this.data_disk_list=[],"local"===this.data.default_system_info.disk_feature?this.data_disk_info=this.all_disk_info.data_disk.filter(t=>"local"===t.disk_feature):this.data_disk_info=this.all_disk_info.data_disk.filter(t=>"local"!==t.disk_feature),this.data.system_size=this.FnSystemMinSize(),this.FnSysEmit()}get FnGetDiskNum(){return this.data_disk_list.length>0?this.data_disk_list.reduce((t,e={num:0})=>t+e.num,0):0}get FnGetSurplus(){this.data_disk_list.length;let t=0===this.data_disk_list.length?16:0;return this.data_disk_list.map(e=>{t+=Math.floor((this.showResetVolume[e.default_disk_info.disk_feature]-e.disk_size*e.num)/e.disk_size)}),Math.min(16-this.FnGetDiskNum,t)}getEveryMaxNum(t){let e=this.data.default_system_info.disk_feature===t.default_disk_info.disk_feature?this.data.system_size:0,s=Math.floor(Math.max(this.showResetVolume[t.default_disk_info.disk_feature]-t.disk_size*t.num-e,0)/t.disk_size);return s>16-this.FnGetDiskNum?16-this.FnGetDiskNum+t.num:s+t.num}get FnGetSystemIops(){return Object(n["a"])(this.data.default_system_info,this.data.system_size)}getResetInfo(t){let e=this.data.default_system_info.disk_feature===t.default_disk_info.disk_feature?this.data.system_size:0,s=t.disk_size*t.num+e,i=this.showResetVolume[t.default_disk_info.disk_feature]?this.showResetVolume[t.default_disk_info.disk_feature]-s:t.default_disk_info.disk_max;return{reset:i,used:s}}get FnSelectedDiskIds(){let t=this.data_disk_info.filter(t=>!this.data_disk_list.some(e=>e.default_disk_info.ecs_goods_id===t.ecs_goods_id));return t.map(t=>t.ecs_goods_id)}FnAddDataDisk(){let t=this.data_disk_info.filter(t=>!this.data_disk_list.some(e=>e.default_disk_info.ecs_goods_id===t.ecs_goods_id));if(0===t.length)return;let e={default_disk_info:{disk_min:0,disk_max:0,disk_step:0,disk_unit:"G",disk_name:""},disk_size:0,num:1,min:1,del:!0};e.default_disk_info={...t[0],disk_max:this.showResetVolume[t[0].disk_feature]?Math.min(t[0].disk_max,this.showResetVolume[t[0].disk_feature]):t[0].disk_max}||{},e.default_disk_info.disk_name&&(e.disk_size=e.default_disk_info.disk_min,this.FnGetDataIops(e),this.data_disk_list.push(e),this.FnDataEmit())}FnDelDataDisk(t){this.data_disk_list.splice(t,1),this.FnDataEmit()}FnGetDataIops(t){let e=Object(n["a"])(t.default_disk_info,t.disk_size);t.iops=e.iops,t.iops_show=e.iops_show,t.handling_capacity=e.throughput,t.throughput_show=e.throughput_show,t.storage_space=t.disk_size}get systemDiskMax(){let t=this.system_disk_info.filter(t=>t.disk_feature===this.data.default_system_info.disk_feature),e=0;return e=0===this.system_disk_info.length?0:0!==Object.keys(this.showResetVolume).length&&this.showResetVolume[t[0].disk_feature]?Math.min(t[0].disk_max,this.showResetVolume[t[0].disk_feature]):t[0].disk_max,e}FnCheckSystemSize(){this.data.system_size||(this.data.system_size=this.data.system_disk_min,this.FnSysEmit())}FnChangeSystemSize(){if(this.data.system_size){let t=Math.min(this.systemDiskMax,this.data.system_size),e=Math.floor((t-this.data.system_disk_min)/this.data.default_system_info.disk_step);this.data.system_size=e*this.data.default_system_info.disk_step+this.data.system_disk_min}else this.data.system_size=this.data.system_disk_min;this.FnSysEmit()}FnSysEmit(){var t,e,s,i,a;return{ecs_goods_id:(null===(t=this.data.default_system_info)||void 0===t?void 0:t.ecs_goods_id)||"",disk_name:(null===(e=this.data.default_system_info)||void 0===e?void 0:e.disk_name)||"",disk_feature:(null===(s=this.data.default_system_info)||void 0===s?void 0:s.disk_feature)||"",disk_type:(null===(i=this.data.default_system_info)||void 0===i?void 0:i.disk_type)||"",disk_size:this.data.default_system_info?this.data.system_size:0,disk_unit:(null===(a=this.data.default_system_info)||void 0===a?void 0:a.disk_unit)||"",iops:this.data.default_system_info?this.FnGetSystemIops.iops:0,handling_capacity:this.data.default_system_info?this.FnGetSystemIops.throughput:0,storage_space:this.data.default_system_info?this.data.system_size:0,is_follow_delete:1}}FnChangeDataSize(t){let e={};this.data_disk_list.map(s=>{if(s.default_disk_info.disk_feature===t.disk_feature)return s.disk_size=t.size,s.disk_size*s.num>s.default_disk_info.disk_max&&(s.num=1),e=s,s}),this.FnGetDataIops(e),this.FnDataEmit()}FnCheckDataNum(t){t.num||(t.num=t.min,this.FnDataEmit())}FnChangeDataNum(t){t.num&&this.FnDataEmit()}FnDataEmit(){return this.data_disk_list}FnBillingInfo(t){return t}FnSubmit(){let t=!1;return this.$refs["resetForm"].validate(e=>{t=e}),{flag:t,system_disk:this.FnSysEmit()}}FnResetForm(t){this.$refs["resetForm"].resetFields(),this.data.default_system_info=this.system_disk_info[0]}FnSystemMinSize(){return this.data.system_disk_min=Math.max(Number(this.data.default_system_info.disk_min),this.os_disk_size,this.origin_disk_size),this.data.system_disk_min}created(){this.az_id&&this.FnGetDiskInfo()}FnChangeAz(t,e){e!==this.az_id&&this.FnGetDiskInfo()}FnChangeFamily(t){t&&(this.data_disk_list=[],this.FnGetDiskInfo())}FnChangeOs(t){let e=this.FnSystemMinSize();e!==this.data.system_size&&this.data.system_size&&(this.data.system_size=e,this.FnSysEmit())}};Object(o["a"])([Object(l["c"])({default:""})],d.prototype,"az_id",void 0),Object(o["a"])([Object(l["c"])({default:""})],d.prototype,"customer_id",void 0),Object(o["a"])([Object(l["c"])({default:"0"})],d.prototype,"billing_method",void 0),Object(o["a"])([Object(l["c"])({default:!1})],d.prototype,"system_disk",void 0),Object(o["a"])([Object(l["c"])({default:!1})],d.prototype,"data_disk",void 0),Object(o["a"])([Object(l["c"])({default:0})],d.prototype,"os_disk_size",void 0),Object(o["a"])([Object(l["c"])({default:0})],d.prototype,"origin_disk_size",void 0),Object(o["a"])([Object(l["c"])({default:""})],d.prototype,"spec_family_id",void 0),Object(o["a"])([Object(l["c"])({default:0})],d.prototype,"is_gpu",void 0),Object(o["a"])([Object(l["c"])({default:""})],d.prototype,"disk_feature",void 0),Object(o["a"])([Object(l["b"])("fn-system-disk")],d.prototype,"FnSysEmit",null),Object(o["a"])([Object(l["b"])("fn-data-disk")],d.prototype,"FnDataEmit",null),Object(o["a"])([Object(l["b"])("fn-billing-info")],d.prototype,"FnBillingInfo",null),Object(o["a"])([Object(l["f"])("az_id")],d.prototype,"FnChangeAz",null),Object(o["a"])([Object(l["f"])("spec_family_id")],d.prototype,"FnChangeFamily",null),Object(o["a"])([Object(l["f"])("os_disk_size")],d.prototype,"FnChangeOs",null),d=Object(o["a"])([Object(l["a"])({components:{InputNumber:_["a"]}})],d);var u=d,p=u,h=(s("0f8f"),s("2877")),m=Object(h["a"])(p,i,a,!1,null,"38c10e3c",null);e["a"]=m.exports},d58f:function(t,e,s){"use strict";var i=s("59ed"),a=s("7b0b"),o=s("44ad"),l=s("07fa"),r=TypeError,n="Reduce of empty array with no initial value",c=function(t){return function(e,s,c,_){var d=a(e),u=o(d),p=l(d);if(i(s),0===p&&c<2)throw new r(n);var h=t?p-1:0,m=t?-1:1;if(c<2)while(1){if(h in u){_=u[h],h+=m;break}if(h+=m,t?h<0:p<=h)throw new r(n)}for(;t?h>=0:p>h;h+=m)h in u&&(_=s(_,u[h],h,d));return _}};t.exports={left:c(!1),right:c(!0)}},d5aa:function(t,e,s){"use strict";s.r(e);var i=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",{staticClass:"app-container"},[e("div",{staticClass:"search-box"},[e("div",{staticClass:"icon m-bottom10"},[e("el-dropdown",{staticClass:"aliFont",on:{command:t.handleOperate}},[e("el-button",{attrs:{type:"text"}},[e("svg-icon-font",{attrs:{iconName:"icon-gengduo"}})],1),e("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},t._l(t.rows_operate_btns,(function(s){return e("el-dropdown-item",{key:s.value,attrs:{command:{label:s.value}}},[t._v(t._s(s.label))])})),1)],1),e("el-tooltip",{attrs:{content:"自定义列表项",placement:"bottom",effect:"light"}},[e("el-button",{attrs:{type:"text"},on:{click:t.FnCustom}},[e("i",{staticClass:"el-icon-s-tools"})])],1),e("el-tooltip",{attrs:{content:"刷新",placement:"bottom",effect:"light"}},[e("el-button",{attrs:{type:"text"},on:{click:t.refresh}},[e("svg-icon",{staticClass:"refresh",attrs:{icon:"refresh"}})],1)],1)],1)]),e("el-table",{ref:"table",attrs:{data:t.list,border:"",height:"100%","row-class-name":t.rowStyle},on:{"row-contextmenu":t.FnRightClick,"row-click":t.FnOperRow,"selection-change":t.handleSelectionChange,"sort-change":t.FnSortChange}},[e("el-table-column",{attrs:{type:"selection"}}),t._l(t.custom_host,(function(s){return e("el-table-column",{key:s.prop,attrs:{"filter-multiple":!s.column_key&&null,prop:s.prop,"column-key":s.column_key?s.column_key:null,filters:s.column_key?s.list:null,sortable:s.sortable?s.sortable:null,width:s.width?s.width:null,type:s.type,label:s.label,"show-overflow-tooltip":s.overflow,"min-width":s.minWidth},scopedSlots:t._u(["cpu_rate"===s.prop?{key:"default",fn:function(t){return[e("el-progress",{attrs:{"stroke-width":14,color:"#455cc6",percentage:Math.round(100*t.row.cpu_rate)}})]}}:"ram_rate"===s.prop?{key:"default",fn:function(t){return[e("el-progress",{attrs:{"stroke-width":14,color:"#455cc6",percentage:Math.round(100*t.row.ram_rate)}})]}}:"gpu_rate"===s.prop?{key:"default",fn:function(t){return[e("el-progress",{attrs:{"stroke-width":14,color:"#455cc6",percentage:Math.round(100*t.row.gpu_rate)}})]}}:"storage_rate"===s.prop?{key:"default",fn:function(t){return[e("el-progress",{attrs:{"stroke-width":14,color:"#455cc6",percentage:Math.round(100*t.row.storage_rate)}})]}}:"cpu_model"===s.prop?{key:"default",fn:function(s){return[s.row.cpu_model.length>0?e("el-tooltip",{attrs:{effect:"dark"}},[e("div",{attrs:{slot:"content"},slot:"content"},t._l(s.row.cpu_model,(function(s,i){return e("div",{key:i},[t._v(t._s(s))])})),0),e("div",{staticClass:"tooltip-cell"},[t._v(t._s(s.row.cpu_model[0]))])]):e("div")]}}:"available_prepare_host_count"===s.prop?{key:"default",fn:function(s){return[e("span",{style:{color:s.row.available_prepare_host_count!==s.row.prepare_host_total?"red":""}},[t._v(" "+t._s(s.row.available_prepare_host_count+"/"+s.row.prepare_host_total)+" ")])]}}:null],null,!0)})}))],2),e("el-pagination",{attrs:{"current-page":t.page_info.current,"page-sizes":[20,50,100],"page-size":t.page_info.size,layout:"total, sizes, prev, pager, next, jumper",total:t.page_info.total},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}}),e("custom-list-item",{attrs:{visible:t.show_custom,all_item:t.all_item,all_column_item:t.all_column_item,type:"cluster",newView:!0},on:{"update:visible":function(e){t.show_custom=e},"fn-custom":t.get_custom_columns}}),e("right-click",{attrs:{multi_rows:t.multi_rows,menus:t.menus,name:t.multi_rows.length>0?t.multi_rows[0].cluster_name:"",error_msg:t.error_msg},on:{"fn-click":t.infoClick}}),e("create-cluster",{attrs:{visible:t.visible,oper_info:t.multi_rows,isCreate:t.isCreate},on:{"update:visible":function(e){t.visible=e}}}),e("add-host",{attrs:{visible:t.add_host_visible,cluster_id:t.multi_rows.length>0?t.multi_rows[0].cluster_id:"",info:t.multi_rows[0]},on:{"update:visible":function(e){t.add_host_visible=e}}}),e("el-dialog",{attrs:{visible:t.prepare_host_visible,title:"设置集群备机数量",width:"500px"},on:{"update:visible":function(e){t.prepare_host_visible=e}}},[e("el-form",{ref:"form",attrs:{model:t.form,"label-width":"100px","label-position":"left"}},[e("el-form-item",{attrs:{label:"备机数量",prop:"standby_num",rules:[{required:!0,message:"请输入备机数量",trigger:"blur"},{type:"number",min:0,max:2,message:"备机数量必须在0到2之间",trigger:"blur"}]}},[e("el-input",{attrs:{label:"备机数量",placeholder:"请输入备机数量"},model:{value:t.form.standby_num,callback:function(e){t.$set(t.form,"standby_num",t._n(e))},expression:"form.standby_num"}})],1)],1),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{attrs:{type:"primary"},on:{click:t.confirm}},[t._v("确认")]),e("el-button",{on:{click:t.cancel}},[t._v("取消")])],1)],1)],1)},a=[],o=(s("e9f5"),s("d866"),s("910d"),s("7d54"),s("ab43"),s("a732"),s("9ab4")),l=s("1b40"),r=s("3673"),n=s("bfc6"),c=s("af7d"),_=s("8ce4"),d=s("da8b"),u=s("e8c0"),p=s("cf88"),h=s("bd4d"),m=s("58d1"),b=s("3fa7"),f=s("a05b");let g=class extends l["e"]{constructor(){super(...arguments),this.list=[],this.all_column_item=[],this.multi_rows=[],this.search_data={},this.isCreate=!1,this.visible=!1,this.add_host_visible=!1,this.prepare_host_visible=!1,this.form={standby_num:""},this.rows_operate_btns=[{label:"新建集群",value:"create_cluster"}],this.menus=[{label:"添加计算节点",value:"add_host",single:!0,disable:!1},{label:"编辑集群",value:"edit_cluster",single:!0,disabled:!1},{label:"删除集群",value:"delete_cluster",disabled:!1},{label:"设置集群备机数量",value:"prepare_host_count",disabled:!1}],this.error_msg={delete_cluster:"仅支持无物理机的cluster进行删除"},this.sort_prop_name="",this.sort_order=void 0,this.page_info={current:1,size:20,total:0},this.all_item=[],this.custom_host=[],this.show_custom=!1}watch_visible(t){t||(this.multi_rows=[],this.get_pod_cluster_list())}watch_multi(){this.handleMenus()}created(){this.get_field(),this.get_pod_cluster_list()}watch_az(t){t&&this.refresh()}handleMenus(){this.menus.forEach(t=>{t.disabled=this.judge(t.value)})}judge(t){let e=!1;switch(t){case"delete_cluster":e=!this.multi_rows.every(t=>0===t.host_count);break;case"add_vm":break;case"edit_cluster":break}return e}handleOperate(t){this.isCreate=!0,this.visible=!0}infoClick(t){if(!t.disabled){if("edit_cluster"===t.value)this.isCreate=!1,this.visible=!0;else if("delete_cluster"===t.value){let t=this.multi_rows.map(t=>t.cluster_name);this.$confirm(`是否确认删除集群：${t}?`,"删除集群",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{let t=this.multi_rows.map(t=>t.cluster_id),e=await d["a"].delete_cluster({cluster_id:t});"Success"===e.code&&(this.$message.success(e.message),this.refresh(),b["a"].$emit("getTreeData",!1))}).catch(()=>{this.$message({type:"info",message:"已取消删除"})})}else"add_host"===t.value?this.add_host_visible=!0:"prepare_host_count"===t.value&&(this.prepare_host_visible=!0);t.list||Object(p["a"])()}}refresh(){this.get_pod_cluster_list()}FnRightClick(t,e,s){const i=this.multi_rows.some(e=>e.cluster_id===t.cluster_id);i||this.$refs.table.toggleRowSelection(t),Object(u["a"])(t,e,s)}FnOperRow(t){this.$refs.table.toggleRowSelection(t)}rowStyle({row:t}){const e=this.multi_rows.some(e=>e.cluster_id===t.cluster_id);if(e)return"rowStyle"}async get_field(){let t=await d["a"].get_cluster_field();if("Success"===t.code){let e=["field_name","show_name"],s=["prop","label"],i=[];this.all_item=t.data.map(t=>(i=[...i,...t.filed],t)),this.all_column_item=Object(_["b"])(i,s,e),this.get_custom_columns(this.$store.state.pod.cluster_host),this.FnDoLayout()}}get_custom_columns(t){0!==t.length&&(this.custom_host=this.all_column_item.filter(e=>t.includes(e.label)),this.custom_host.map(t=>(["cpu_model","gpu_model","available_prepare_host_count"].includes(t.prop)||(t=Object.assign(t,{},{sortable:"custom"})),["cluster_id","cpu_model","gpu_model"].includes(t.prop)&&(t=Object.assign(t,{},{minWidth:"240px",overflow:!0})),["cpu_model"].includes(t.prop)&&(t=Object.assign(t,{},{width:"180"})),["storage_cluster_name","cluster_name","cpu_rate","ram_rate","gpu_rate","storage_rate","host_count","ecs_count","gpu_count","storage_count"].includes(t.prop)&&(t=Object.assign(t,{},{width:"120px"})),t)),this.FnDoLayout())}FnDoLayout(){this.$nextTick(()=>{this.$refs.table.doLayout()})}FnCustom(){this.show_custom=!0}async get_pod_cluster_list(){if(!this.$store.state.az_id)return;let t={page_index:this.page_info.current,page_size:this.page_info.size,az_id:this.$store.state.az_id,pod_id:this.$route.params.id,[this.sort_prop_name]:this.sort_order},e=await d["a"].get_pod_cluster_list(t);"Success"===e.code&&(this.list=e.data.result,this.page_info.total=e.data.page_info.count)}handleSelectionChange(t){this.multi_rows=t}FnSortChange(t){let e={};this.all_item.forEach(t=>{t.filed.forEach(t=>{e[t.field_name]="sort_"+t.field_name})}),this.sort_prop_name=e[t.prop],this.sort_order="ascending"===t.order?"0":"descending"===t.order?"1":void 0,this.get_pod_cluster_list()}handleSizeChange(t){this.page_info.size=t,this.get_pod_cluster_list()}handleCurrentChange(t){this.page_info.current=t,this.get_pod_cluster_list()}confirm(){const t=this.$refs.form;t.validate(async t=>{if(t){let t=await d["a"].set_cluster_prepare_host({cluster_id:this.multi_rows[0].cluster_id,prepare_host_count:this.form.standby_num});"Success"===t.code&&(this.$message.success(t.message),this.prepare_host_visible=!1,this.get_pod_cluster_list())}})}cancel(){const t=this.$refs.form;t.resetFields(),this.prepare_host_visible=!1}};Object(o["a"])([Object(l["f"])("visible")],g.prototype,"watch_visible",null),Object(o["a"])([Object(l["f"])("multi_rows",{immediate:!0,deep:!0})],g.prototype,"watch_multi",null),Object(o["a"])([Object(l["f"])("$store.state.az_id")],g.prototype,"watch_az",null),g=Object(o["a"])([Object(l["a"])({components:{AddHost:f["a"],CreateCluster:m["a"],SearchFrom:n["a"],SvgIcon:r["a"],CustomListItem:c["a"],RightClick:h["a"]}})],g);var v=g,y=v,k=(s("82ea"),s("7568"),s("2877")),O=Object(k["a"])(y,i,a,!1,null,"6be13bcc",null);e["default"]=O.exports},d772:function(t,e,s){"use strict";var i=s("81a9"),a=s("bff7");e["a"]={get_operate_record_list(t){return Object(i["a"])(Object(a["b"])("GET","/ecs/history_record/",t))},get_detail(t){return Object(i["a"])(Object(a["b"])("GET","/ecs/get_ecs_detail/",t))}}},d866:function(t,e,s){"use strict";var i=s("23e7"),a=s("c65b"),o=s("2266"),l=s("59ed"),r=s("825a"),n=s("46c4"),c=s("2a62"),_=s("f99f"),d=_("every",TypeError);i({target:"Iterator",proto:!0,real:!0,forced:d},{every:function(t){r(this);try{l(t)}catch(i){c(this,"throw",i)}if(d)return a(d,this,t);var e=n(this),s=0;return!o(e,(function(e,i){if(!t(e,s++))return i()}),{IS_RECORD:!0,INTERRUPTED:!0}).stopped}})},d9aa:function(t,e,s){},dad2:function(t,e,s){"use strict";var i=s("d066"),a=function(t){return{size:t,has:function(){return!1},keys:function(){return{next:function(){return{done:!0}}}}}},o=function(t){return{size:t,has:function(){return!0},keys:function(){throw new Error("e")}}};t.exports=function(t,e){var s=i("Set");try{(new s)[t](a(0));try{return(new s)[t](a(-1)),!1}catch(r){if(!e)return!0;try{return(new s)[t](o(-1/0)),!1}catch(n){var l=new s;return l.add(1),l.add(2),e(l[t](o(1/0)))}}}catch(n){return!1}}},dc19:function(t,e,s){"use strict";var i=s("cb27").has;t.exports=function(t){return i(t),t}},dcd7:function(t,e,s){"use strict";s("64cf")},e03a:function(t,e,s){"use strict";var i=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",[e("el-dialog",{attrs:{title:"网络设置",visible:t.visibleSync,width:"60%","destroy-on-close":!0},on:{"update:visible":function(e){t.visibleSync=e}}},[e("el-alert",{attrs:{title:"注：若批量选中实例，将以填写的私有IP地址为起始IP地址，依次配置至各实例中。",type:"warning",closable:!1,center:""}}),e("el-table",{attrs:{data:t.list}},[e("el-table-column",{attrs:{prop:"vlan",label:"VLAN"},scopedSlots:t._u([{key:"default",fn:function(s){return[e("el-input",{attrs:{oninput:"value = value.replace(/^(0+)|[^\\d]+/g,'')"},model:{value:s.row.vlan_id,callback:function(e){t.$set(s.row,"vlan_id",e)},expression:"scope.row.vlan_id"}}),e("div",{directives:[{name:"show",rawName:"v-show",value:!t.judge("vlan",s.row.vlan_id),expression:"!judge('vlan',scope.row.vlan_id)"}],staticClass:"error_message"},[t._v("vlan需为大于0的数字")])]}}])}),e("el-table-column",{attrs:{prop:"ip",label:"IP地址"},scopedSlots:t._u([{key:"default",fn:function(s){return[e("el-input",{model:{value:s.row.ip_address,callback:function(e){t.$set(s.row,"ip_address",e)},expression:"scope.row.ip_address"}}),e("div",{directives:[{name:"show",rawName:"v-show",value:!t.judge("ip",s.row.ip_address),expression:"!judge('ip',scope.row.ip_address)"}],staticClass:"error_message"},[t._v("ip地址格式不正确")])]}}])}),e("el-table-column",{attrs:{prop:"subnet",label:"子网掩码"},scopedSlots:t._u([{key:"default",fn:function(s){return[e("el-input",{attrs:{oninput:"value = value.replace(/^(0+)|[^\\d]+/g,'')"},model:{value:s.row.mask,callback:function(e){t.$set(s.row,"mask",e)},expression:"scope.row.mask"}}),e("div",{directives:[{name:"show",rawName:"v-show",value:!t.judge("subnet",s.row.mask),expression:"!judge('subnet',scope.row.mask)"}],staticClass:"error_message"},[t._v("子网掩码范围为1-32")])]}}])}),e("el-table-column",{attrs:{prop:"operate",label:""},scopedSlots:t._u([{key:"default",fn:function(s){return[e("i",{staticClass:"el-icon-remove-outline delete-icon",on:{click:function(e){return t.del(s.$index)}}})]}}])})],1),e("div",{staticClass:"m-top10"},[e("el-button",{attrs:{type:"text",disabled:5===t.list.length},on:{click:t.add}},[e("i",{staticClass:"el-icon-circle-plus"}),t._v(" 添加网卡")])],1),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{attrs:{type:"primary"},on:{click:t.confirm}},[t._v("确定")]),e("el-button",{attrs:{type:"default"},on:{click:function(e){t.visibleSync=!1}}},[t._v("取消")])],1)],1)],1)},a=[],o=(s("14d9"),s("e9f5"),s("910d"),s("ab43"),s("9ab4")),l=s("1b40"),r=s("e527");let n=class extends l["e"]{constructor(){super(...arguments),this.list=[],this.dnsObj={main:"",slave:""}}created(){1===this.ecs_list.length?this.ecs_list[0].base_nic_info.length>0&&this.ecs_list[0].base_nic_info.map(t=>(this.list.push({netcard_id:t.netcard_id,vlan_id:t.vlan_id,ip_address:t.ip_address,mask:t.mask}),t)):this.list=[{netcard_id:"",vlan_id:"",ip_address:"",mask:""}]}async get_default_dns(){let t=await r["a"].get_default_dns({ecs_ids:this.ecs_list.map(t=>t.ecs_id)});"Success"===t.code&&(this.dnsObj=t.data,this.ecs_list.length>1&&(this.list[0].mainDns=this.dnsObj.main,this.list[0].dns=this.dnsObj.slave))}add(){this.list.length>=5||this.list.push({netcard_id:"",vlan_id:"",ip_address:"",mask:""})}judge(t,e){if("vlan"===t)return Number(e)>0;if("ip"===t){let t=/^((2[0-4]\d|25[0-5]|[01]?\d\d?)\.){3}(2[0-4]\d|25[0-5]|[01]?\d\d?)$/;return e&&t.test(e)}return Number(e)>0&&Number(e)<=32}del(t){this.list=this.list.filter((e,s)=>s!==t)}async confirm(){let t={vlan_id:"vlan",ip_address:"ip",mask:"subnet"};for(let i in this.list)for(let e in this.list[i])if("netcard_id"!==e&&!this.judge(t[e],this.list[i][e]))return;let e=[];this.list.map(t=>{const{vlan_id:s,ip_address:i,mask:a,mainDns:o,dns:l,netcard_id:r}=t;e.push({netcard_id:r,vlan_id:Number(s),ip_address:i,mask:Number(a),gateway:"",dns:[]})});let s=await r["a"].set_net({ecs_ids:this.ecs_list.map(t=>t.ecs_id),base_nic_info:e});"Success"===s.code&&this.$message.success(s.message),this.visibleSync=!1}};Object(o["a"])([Object(l["d"])("visible")],n.prototype,"visibleSync",void 0),Object(o["a"])([Object(l["c"])({default:()=>[]})],n.prototype,"ecs_list",void 0),n=Object(o["a"])([l["a"]],n);var c=n,_=c,d=(s("6e78"),s("2877")),u=Object(d["a"])(_,i,a,!1,null,"0d4251ae",null);e["a"]=u.exports},e1c5:function(t,e,s){"use strict";s("832c")},e4d0:function(t,e,s){"use strict";var i=s("81a9"),a=s("bff7");e["a"]={get_pub_mirror_list(t){return Object(i["a"])(Object(a["b"])("GET","/img/get_pub_image_list/",t))},check_name(t){return Object(i["a"])(Object(a["b"])("POST","/img/name_check/",t))},get_mirror_type(t){return Object(i["a"])(Object(a["b"])("GET","/img/image_type/",t))},get_model_image_type(t){return Object(i["a"])(Object(a["b"])("GET","/img/model_image_type/",t))},add_pub_mirror(t){return Object(i["a"])(Object(a["b"])("GET","/img/create_pub_image/",t))},edit_pub_mirror(t){return Object(i["a"])(Object(a["b"])("POST","/img/edit_image/",t))},change_status(t){return Object(i["a"])(Object(a["b"])("POST","/img/alter_image/",t))},del_pub_mirror_az(t){return Object(i["a"])(Object(a["b"])("POST","/img/delete_pub_image/",t))},del_pub_mirror(t){return Object(i["a"])(Object(a["b"])("POST","/img/batch_delete_pub_image/",t))},get_pub_operate_record(t){return Object(i["a"])(Object(a["b"])("POST","/img/pub_image_operation_list/",t))},get_pub_sync_detail(t){return Object(i["a"])(Object(a["b"])("POST","/img/pub_image_info/",t))},sync_mirror(t){return Object(i["a"])(Object(a["b"])("POST","/img/sync_pub_image/",t))},get_private_mirror_list(t){return Object(i["a"])(Object(a["b"])("GET","/img/get_private_image_list/",t))},get_status_list(t){return Object(i["a"])(Object(a["b"])("GET","/img/get_image_status_list/",t))},get_available_az(t){return Object(i["a"])(Object(a["b"])("POST","/img/get_available_az/",t))},get_disk_list(t){return Object(i["a"])(Object(a["b"])("GET","/img/backend_type/",t))},get_product_source(){return Object(i["a"])(Object(a["b"])("GET","/ecs/get_product_source/"))}}},e527:function(t,e,s){"use strict";var i=s("81a9"),a=s("bff7"),o=s("4328"),l=s.n(o);e["a"]={get_instance_list(t){return Object(i["a"])(Object(a["b"])("POST","/ecs/ecs_list/",t))},operate_instance(t){return Object(i["a"])(Object(a["b"])("POST","/ecs/operate/",t))},delete_instance(t){return Object(i["a"])(Object(a["b"])("POST","/ecs/delete/",t))},recover_instance(t){return Object(i["a"])(Object(a["b"])("POST","/ecs/recover/",t))},destroy_instance(t){return Object(i["a"])(Object(a["b"])("POST","/ecs/destroy/",t))},get_status_list(){return Object(i["a"])(Object(a["b"])("GET","/ecs/ecs_status_list/"))},get_family_data(){return Object(i["a"])(Object(a["b"])("GET","/ecs/get_family_data/"))},reset_password(t){return Object(i["a"])(Object(a["b"])("POST","/ecs/ecs_reset_password/",t))},update_spec(t){return Object(i["a"])(Object(a["b"])("POST","/ecs/ecs_change_configure/",t))},update_system(t){return Object(i["a"])(Object(a["b"])("POST","/ecs/ecs_change_system/",t))},get_usage_ip(t){return Object(i["a"])(Object(a["b"])("GET","/ecs/get_deleted_ecs_ip/",t))},get_vnc_url(t){return Object(i["a"])(Object(a["b"])("GET","/ecs/vnc_info/",t))},start_charge(t){return Object(i["a"])(Object(a["b"])("POST","/resource/start_charge/",t))},change_config_price(t){return Object(i["a"])(Object(a["b"])("POST","/ecs/change_config_price/",t))},change_system_price(t){return Object(i["a"])(Object(a["b"])("POST","/ecs/change_system_price/",t))},each_resource_price(t){return Object(i["a"])(Object(a["b"])("POST","/ecs/each_resource_price/",t))},add_common_mirror(t){return Object(i["a"])(Object(a["b"])("POST","/img/create_pub_image_by_ecs/",t))},set_net(t){return Object(i["a"])(Object(a["b"])("POST","/ecs/ecs_set_base_nic/",t))},get_default_dns(t){return Object(i["a"])(Object(a["b"])("POST","/ecs/az_default_dns/",t))},mount_gpu_card(t){return Object(i["a"])(Object(a["b"])("POST","/ecs/instance_gpu_card/",t))},update_gpu_status(t){return Object(i["a"])(Object(a["b"])("POST","/ecs/update_gpu_status/",t))},export_list(t){return Object(i["a"])({method:"GET",url:"/ecs_business/v1/ecs/ecs_list_download/",params:t,paramsSerializer:t=>l.a.stringify(t),responseType:"blob"})},get_tag_list(){return Object(i["a"])(Object(a["b"])("GET","/ecs/get_tag_list/"))},get_rescue_image_list(t){return Object(i["a"])(Object(a["b"])("GET","/ecs/get_rescue_image_list/",t))},enter_rescue(t){return Object(i["a"])(Object(a["b"])("POST","/ecs/enter_rescue/",t))},exit_rescue(t){return Object(i["a"])(Object(a["b"])("POST","/ecs/exit_rescue/",t))}}},e867:function(t,e,s){},e8c0:function(t,e,s){"use strict";s.d(e,"a",(function(){return a}));var i=s("cf88");function a(t,e,s){s.preventDefault(),document.addEventListener("contextmenu",t=>{const e=t.target;if(e.closest(".el-table")){let e=document.querySelector("#menu");if(e){e.style.display="block";let s=e.offsetHeight,a=e.offsetWidth;console.log("menuHeight",s);let o=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,l=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,r=t.clientX,n=t.clientY,c=r,_=n;l<r+a&&(c=r-a),o<n+s&&(_=o-s),e.style.left=c-250+"px",e.style.top=_-50+"px",e.style.display="block",e.style.zIndex="1000",document.addEventListener("click",i["a"])}}}),document.addEventListener("contextmenu",i["a"])}},e9bc:function(t,e,s){"use strict";var i=s("dc19"),a=s("cb27").add,o=s("83b9e"),l=s("7f65"),r=s("5388");t.exports=function(t){var e=i(this),s=l(t).getIterator(),n=o(e);return r(s,(function(t){a(n,t)})),n}},ea55:function(t,e,s){"use strict";s("e867")},ed02:function(t,e,s){"use strict";s("028b")},ed60:function(t,e,s){"use strict";var i=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("el-form",{ref:"resetForm",staticClass:"pwd-form",attrs:{model:t.data,rules:t.rules,"label-position":"left","label-width":"120px"}},[e("el-form-item",{attrs:{label:"用户名"}},[t._v(" "+t._s(t.username)+" ")]),e("el-form-item",{attrs:{label:t.label,prop:"password"}},[e("div",{staticClass:"long-input"},[e("el-input",{attrs:{type:"password","show-password":""},model:{value:t.data.password,callback:function(e){t.$set(t.data,"password",e)},expression:"data.password"}})],1),e("div",{staticClass:"prompt_message"},[t._v(" 8-30个字符，且同时包含三项（大写字母、小写字母、数字、()`~!@#$%^&*-+=_|{}[]:;,.?/中的特殊字符）")])]),e("el-form-item",{attrs:{label:"确认密码",prop:"confirm_password"}},[e("div",{staticClass:"long-input"},[e("el-input",{attrs:{type:"password","show-password":""},model:{value:t.data.confirm_password,callback:function(e){t.$set(t.data,"confirm_password",e)},expression:"data.confirm_password"}})],1)])],1)},a=[],o=(s("d9e2"),s("9ab4")),l=s("1b40");function r(t){let e=/[A-Z]+/,s=/\d+/,i=/[a-z]+/,a=/[~`·！!@#￥$%……^&*()（）——+=【】[\]{}|、\\：:;；"”“’''<>《》,，。.?？/].*/,o=0,l=!0,r="";return e.test(t)&&o++,s.test(t)&&o++,i.test(t)&&o++,a.test(t)&&o++,(t.length<8||t.length>30)&&(r="长度应为8-30位之间",l=!1),o<3&&(r="需要包含大小写字母、数字、特殊符号中的任意三项",l=!1),{flag:l,msg:r}}let n=class extends l["e"]{constructor(){super(...arguments),this.data={password:"",confirm_password:""},this.FnCheckPwd=(t,e,s)=>{let i=r(e);i.flag||s(new Error(i.msg)),s()},this.FnCheckConfirmPwd=(t,e,s)=>{""===e?s(new Error("请输入确认密码")):e!==this.data.password&&s(new Error("两次密码输入不一致")),s()},this.rules={password:[{required:!0,validator:this.FnCheckPwd,trigger:"blur"}],confirm_password:[{required:!0,validator:this.FnCheckConfirmPwd,trigger:"blur"}]}}FnSubmit(){let t=!1;return this.$refs["resetForm"].validate(e=>{t=e}),{flag:t,password:this.data.password}}FnResetForm(){this.$refs["resetForm"].resetFields()}};Object(o["a"])([Object(l["c"])({default:"root/administrator"})],n.prototype,"username",void 0),Object(o["a"])([Object(l["c"])({default:"密码"})],n.prototype,"label",void 0),n=Object(o["a"])([l["a"]],n);var c=n,_=c,d=(s("6f3a"),s("2877")),u=Object(d["a"])(_,i,a,!1,null,"61a0d7cc",null);e["a"]=u.exports},ed66:function(t,e,s){"use strict";s("f282")},edc2:function(t,e,s){"use strict";var i=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("el-dialog",{attrs:{title:"编辑备注-"+t.rows.host_name,visible:t.visible_sync,width:"400px","destroy-on-close":!0,"close-on-click-modal":!1},on:{"update:visible":function(e){t.visible_sync=e}}},[e("el-input",{attrs:{type:"textarea",maxlength:"128","show-word-limit":"",rows:"5"},model:{value:t.value,callback:function(e){t.value=e},expression:"value"}}),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{attrs:{type:"primary"},on:{click:t.confirm}},[t._v("确认")]),e("el-button",{on:{click:function(e){t.visible_sync=!1}}},[t._v("取消")])],1)],1)},a=[],o=s("9ab4"),l=s("1b40"),r=s("1477");let n=class extends l["e"]{constructor(){super(...arguments),this.value=this.rows.remark}created(){}async confirm(){let t=await r["a"].set_remark({host_ids:[this.rows.host_id],remark:this.value});"Success"===t.code?(this.$message.success(t.message),this.back("1")):this.back("0")}back(t){this.visible_sync=!1}};Object(o["a"])([Object(l["d"])("visible")],n.prototype,"visible_sync",void 0),Object(o["a"])([Object(l["c"])({default:()=>({host_name:"",remark:""})})],n.prototype,"rows",void 0),Object(o["a"])([Object(l["b"])("close")],n.prototype,"back",null),n=Object(o["a"])([Object(l["a"])({})],n);var c=n,_=c,d=(s("ed66"),s("2877")),u=Object(d["a"])(_,i,a,!1,null,"1d3ae641",null);e["a"]=u.exports},f097:function(t,e,s){},f1ec:function(t,e,s){},f282:function(t,e,s){},f665:function(t,e,s){"use strict";var i=s("23e7"),a=s("c65b"),o=s("2266"),l=s("59ed"),r=s("825a"),n=s("46c4"),c=s("2a62"),_=s("f99f"),d=_("find",TypeError);i({target:"Iterator",proto:!0,real:!0,forced:d},{find:function(t){r(this);try{l(t)}catch(i){c(this,"throw",i)}if(d)return a(d,this,t);var e=n(this),s=0;return o(e,(function(e,i){if(t(e,s++))return i(e)}),{IS_RECORD:!0,INTERRUPTED:!0}).result}})},f6ea:function(t,e,s){"use strict";s("62df")},f813:function(t,e,s){"use strict";s("9409")},fb2b:function(t,e,s){"use strict";s("8ee3")}}]);