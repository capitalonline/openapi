(window["webpackJsonp_AppSp"]=window["webpackJsonp_AppSp"]||[]).push([["chunk-5a48f371"],{"0794":function(s,i,e){"use strict";e.r(i);var t=function(){var s=this,i=s._self._c;s._self._setupProxy;return i("div",[i("back-header",{attrs:{title:"创建云服务器",back_url:"/instance"}}),i("div",{staticClass:"create-box"},[i("div",{staticClass:"left-box"},[i("el-card",[i("label-block",{attrs:{label:"客户ID",is_required:!0}},[i("div",{staticClass:"input-msg-box"},[i("div",{staticClass:"input-box"},[i("el-input",{model:{value:s.customer_id_input,callback:function(i){s.customer_id_input=i},expression:"customer_id_input"}})],1),i("div",{directives:[{name:"show",rawName:"v-show",value:s.error_msg.customer_id.show,expression:"error_msg.customer_id.show"}],staticClass:"error_message"},[s._v(s._s(s.error_msg.customer_id.msg))])])]),i("label-block",{attrs:{label:"客户名称"}},[s._v(" "+s._s(s.customer_name)+" ")]),i("label-block",{attrs:{label:"是否计费"}},[i("el-switch",{model:{value:s.is_billing,callback:function(i){s.is_billing=i},expression:"is_billing"}})],1)],1),i("el-card",[i("label-block",{attrs:{label:"可用区",is_required:!0}},[i("div",{staticClass:"region-box"},[i("Area",{staticClass:"m-right20",attrs:{list:s.region_list,area:s.default_region.region_id},on:{get_area_id:s.FnGetRegionId}}),i("el-select",{attrs:{"value-key":"az_id"},model:{value:s.default_az,callback:function(i){s.default_az=i},expression:"default_az"}},s._l(s.default_region.az_list,(function(s){return i("el-option",{key:s.az_id,attrs:{value:s,label:s.az_name}})})),1)],1)])],1),i("el-card",[i("label-block",{attrs:{label:"网络",is_required:!0}},[i("el-select",{attrs:{"value-key":"vpc_id"},model:{value:s.default_vpc,callback:function(i){s.default_vpc=i},expression:"default_vpc"}},s._l(s.vpc_list,(function(s){return i("el-option",{key:s.vpc_id,attrs:{value:s,label:s.vpc_name}})})),1),s.error_msg.vpc_id.show?i("span",{staticClass:"error_message m-left10"},[s._v(s._s(s.error_msg.vpc_id.msg))]):s._e(),i("el-select",{staticClass:"m-left20 m-right10",attrs:{"value-key":"subnet_id"},model:{value:s.default_subnet,callback:function(i){s.default_subnet=i},expression:"default_subnet"}},s._l(s.default_vpc.subnet_list,(function(s){return i("el-option",{key:s.subnet_id,attrs:{value:s,label:s.subnet_name}})})),1),s.error_msg.subnet_id.show?i("span",{staticClass:"error_message m-right10"},[s._v(s._s(s.error_msg.subnet_id.msg))]):s._e(),i("span",{staticClass:"prompt_message"},[s._v(" 可用IP数量 "),i("span",{staticClass:"num_message"},[s._v(s._s(s.default_subnet.ip_not_used))]),s._v(" 个")])],1)],1),i("el-card",[i("label-block",{attrs:{label:"计算规格"}},[i("update-spec",{attrs:{az_id:s.default_az.az_id,customer_id:s.customer_id,billing_method:s.billing_method},on:{"fn-spec":s.FnGetSpec}})],1)],1),i("el-card",[i("update-os",{attrs:{az_id:s.default_az.az_id,is_gpu:s.ecs_spec_info.is_gpu,customer_id:s.customer_id,support_gpu_driver:s.ecs_spec_info.support_gpu_driver},on:{"fn-os":s.FnGetOs}})],1),i("el-card",{staticClass:"disk-box"},[i("update-disk",{ref:"update-disk",attrs:{az_id:s.default_az.az_id,customer_id:s.customer_id,system_disk:!0,data_disk:!0,is_gpu:s.ecs_spec_info.is_gpu,os_disk_size:s.os_info.disk_size,spec_family_id:s.ecs_spec_info.spec_family_id,billing_method:s.billing_method},on:{"fn-system-disk":s.FnGetSystemDisk,"fn-data-disk":s.FnGetDataDisk,"fn-billing-info":s.FnGetDiskBillingInfo}})],1),i("el-card",[i("label-block",{attrs:{label:"购买数量"}},[i("el-input-number",{attrs:{min:s.num_info.min,max:s.num_info.max},on:{blur:s.FnCheckNum,change:s.FnGetPrice},model:{value:s.num_info.num,callback:function(i){s.$set(s.num_info,"num",i)},expression:"num_info.num"}}),i("span",{staticClass:"prompt_message m-left10",class:{error_message:s.num_info.num>s.num_info.max}},[s._v(" 一次最多可创建"),i("span",{staticClass:"num_message"},[s._v(" "+s._s(s.num_info.max)+" ")]),s._v("台实例 ")]),i("el-button",{attrs:{type:"text"},on:{click:s.FnGetLimitNum}},[i("svg-icon",{staticClass:"refresh",attrs:{icon:"refresh"}})],1)],1)],1),i("el-card",[i("label-block",{attrs:{label:"名称"}},[i("div",{staticClass:"input-msg-box"},[i("div",{staticClass:"input-box"},[i("el-input",{on:{blur:s.FnCheckEcsName},model:{value:s.ecs_name_info.ecs_name,callback:function(i){s.$set(s.ecs_name_info,"ecs_name",i)},expression:"ecs_name_info.ecs_name"}})],1),i("div",{directives:[{name:"show",rawName:"v-show",value:s.error_msg.ecs_name.show,expression:"error_msg.ecs_name.show"}],staticClass:"error_message"},[s._v(s._s(s.error_msg.ecs_name.msg))])]),i("div",{staticClass:"prompt_message"},[s._v(" 2-60个字符，可包含大小写字母、中文、数字、点号、下划线、半角冒号、连字符、英文括号等常用字符")])]),i("update-pwd",{ref:"update_pwd",attrs:{username:s.os_info.username}})],1)],1),i("div",{staticClass:"right-box"},[i("el-card",{staticClass:"fixed-top"},[i("div",{attrs:{slot:"header"},slot:"header"},[s._v(" 当前配置信息 ")]),i("div",{staticClass:"right-row"},[i("div",[s._v("可用区")]),i("div",{staticClass:"right-text"},[s._v(s._s(s.default_region.region_name)+" | "+s._s(s.default_az.az_name))])]),i("div",{staticClass:"right-row"},[i("div",[s._v("网络")]),i("div",{staticClass:"right-text"},[s._v(s._s(s.default_vpc.vpc_name)+" | "+s._s(s.default_subnet.subnet_name))])]),i("div",{staticClass:"right-row"},[i("div",[s._v("计算规格")]),i("div",{staticClass:"right-text"},[s._v(s._s(s.ecs_spec_info.ecs_goods_name)+" | "+s._s(s.ecs_spec_info.cpu)+"vCPU | "+s._s(s.ecs_spec_info.ram)+"GiB "),s.ecs_spec_info.is_gpu?i("span",[s._v("| "+s._s(s.ecs_spec_info.gpu)+"*"+s._s(s.ecs_spec_info.card_name))]):s._e()])]),i("div",{staticClass:"right-row"},[i("div",[s._v("镜像")]),i("div",{staticClass:"right-text"},[s._v(s._s(s.os_info.os_label))])]),i("div",{staticClass:"right-row"},[i("div",[s._v("系统盘("+s._s(s.system_info.disk_name)+")")]),i("div",{staticClass:"right-text"},[s._v(s._s(s.system_info.disk_size)+s._s(s.system_info.disk_unit))])]),i("div",{staticClass:"right-row"},[i("div"),i("div",{staticClass:"num_message"},[s._v(s._s(s.system_disk_price))])]),s._l(s.total_data_disk,(function(e,t){return i("div",{key:t,staticClass:"right-row"},[i("div",[s._v("数据盘("+s._s(e.label)+")")]),i("div",{staticClass:"right-text"},[s._v(s._s(e.size)+s._s(e.unit))])])})),Object.keys(s.total_data_disk).length>0?i("div",{staticClass:"right-row"},[i("div"),i("div",{staticClass:"num_message"},[s._v(s._s(s.data_disk_price))])]):s._e(),i("div",{staticClass:"right-row"},[i("div",[s._v("购买数量")]),i("div",{staticClass:"right-text"},[s._v(s._s(s.QTY))])])],2),i("el-card",{staticClass:"confirm-card"},[s.is_billing?i("div",{staticClass:"row"},[i("div",[s._v("总价")]),i("div",{staticClass:"num_message"},[s._v(s._s(s.total_price))])]):s._e(),i("el-button",{staticClass:"create-btn",attrs:{type:"primary",disabled:s.allVoulumns},on:{click:s.FnConfirmCreate}},[s._v("创 建")])],1)],1)]),i("confirm-box",{attrs:{visible:s.confirm_create_visible},on:{"update:visible":function(i){s.confirm_create_visible=i},"fn-create":s.FnCreate}})],1)},_=[],a=(e("14d9"),e("13d5"),e("e9f5"),e("7d54"),e("9485"),e("a732"),e("9ab4")),o=e("1b40"),n=e("98c9"),d=e("ed46"),c=e("38a7"),l=e("3874"),r=e("29ab"),u=e("d4fd"),m=e("ed60"),f=e("c550"),h=e("3673"),p=e("9074");function g(s){let i=!0,e="";return s&&(s.length<2||s.length>60)&&(e="长度应为2-60位之间",i=!1),{flag:i,msg:e}}let b=class extends o["e"]{constructor(){super(...arguments),this.customer_id="",this.customer_id_input="",this.customer_name="",this.is_billing=!0,this.billing_method="0",this.region_list=[],this.default_region={region_id:"",region_name:"",az_list:[]},this.default_az={az_id:"",az_name:""},this.vpc_list=[],this.default_vpc={vpc_id:"",vpc_segment_id:"",vpc_segment_address:"",subnet_list:[]},this.default_subnet={subnet_id:"",vlan_id:"",ip_address:"",mask:"",ip_type:"",ip_not_used:0},this.ecs_spec_info={},this.os_info={},this.system_info={},this.data_disk_list=[],this.data_disks=[],this.total_data_disk={},this.disk_billing_info={},this.QTY=1,this.num_info={num:1,min:1,max:1},this.system_disk_price="0.00",this.data_disk_price="0.00",this.total_price="0.00",this.error_msg={customer_id:{show:!1,msg:"请输入正确的customer_id"},vpc_id:{show:!1,msg:"无可用VPC"},subnet_id:{show:!1,msg:"无可用子网"},ecs_name:{show:!1,msg:"请输入正确的实例名称"}},this.ecs_name_info={ecs_name:"",password:"",confirm_password:""},this.confirm_create_visible=!1}async FnGetCustomerName(){const s=await p["a"].get_customer_name({customer_id:this.customer_id_input});"Success"===s.code&&(this.customer_id=s.data.customer_id,this.customer_name=s.data.customer_name,this.error_msg.customer_id.show=!1,this.FnGetRegionAzList())}async FnGetRegionAzList(){const s=await p["a"].get_region_az_list({customer_id:this.customer_id,employee_no:this.$store.state.employee_no,user_name:this.$store.state.login_name});"Success"===s.code&&(this.region_list=s.data)}FnGetRegionId(s){for(const i of this.region_list)for(const e of i.region_list)if(e.region_id===s){this.default_region=e;break}this.default_az=this.default_region.az_list[0]||{az_id:"",az_name:""}}async FnGetNetList(){const s=await p["a"].get_net_list({az_id:this.default_az.az_id,region_id:this.default_region.region_id,customer_id:this.customer_id});"Success"===s.code&&(this.vpc_list=s.data.vpc_list,this.vpc_list.length>0?(this.default_vpc=this.vpc_list[0],this.error_msg.vpc_id.show=!1):(this.default_vpc={vpc_id:"",vpc_segment_id:"",vpc_segment_address:"",subnet_list:[]},this.default_vpc.subnet_list=[],this.error_msg.vpc_id.show=!0))}FnCheckEcsName(){const s=g(this.ecs_name_info.ecs_name);return this.error_msg.ecs_name.show=!s.flag,this.error_msg.ecs_name.msg=s.msg,this.error_msg.ecs_name.show}FnGetSpec(s){this.ecs_spec_info.is_gpu===s.is_gpu?(this.ecs_spec_info=s,this.FnGetLimitNum()):this.ecs_spec_info=s}FnGetOs(s){this.os_info={os_id:s.os_id,os_type:s.os_type,username:s.username,disk_size:Number(s.disk_size),os_label:s.os_label}}get allVoulumns(){let s=this.$refs["update-disk"];return this.QTY=(this.data_disks.length>0?this.data_disks.reduce((s,i)=>s+i.num,0):0)+1,this.data_disks.length>0&&this.data_disks.some(i=>s.getResetInfo(i).reset<0)}FnGetSystemDisk(s){this.system_info=s,this.FnGetLimitNum()}FnGetDataDisk(s){this.data_disks=s,this.data_disk_list=[],this.total_data_disk={},s.forEach(s=>{const i={ebs_goods_id:s.default_disk_info.ecs_goods_id,goods_name:s.default_disk_info.disk_name,disk_feature:s.default_disk_info.disk_feature,disk_type:s.default_disk_info.disk_type,disk_size:s.disk_size,ebs_number:1,is_follow_delete:Number(s.del)};"local"!==i.disk_feature?(i["storage_space"]=s.disk_size,i["iops"]=s.iops,i["handling_capacity"]=s.handling_capacity,i["gic_goods_id"]=this.disk_billing_info[s.default_disk_info.ecs_goods_id].gic_goods_id):(i.ebs_goods_id=this.ecs_spec_info.ecs_goods_id,i.is_follow_delete=1,i["local_disk-space"]=s.disk_size,i["local_disk-IOPS"]=s.iops,i["local_disk-throughput"]=s.handling_capacity,i["gic_goods_id"]=this.ecs_spec_info.billing_info[i.ebs_goods_id].gic_goods_id);for(let t=0;t<s.num;t++)this.data_disk_list.push(i);const e=s.disk_size*s.num;this.total_data_disk[i.disk_feature]?this.total_data_disk[i.disk_feature].size+=e:this.total_data_disk[i.disk_feature]={label:i.goods_name,size:e,unit:s.default_disk_info.disk_unit}}),this.FnGetLimitNum(),this.FnGetPrice("disk")}FnGetDiskBillingInfo(s){this.disk_billing_info=s}async FnGetLimitNum(){if(!this.ecs_spec_info.spec_family_id||!this.ecs_spec_info.spec_id)return;const s=await p["a"].get_ecs_limit({customer_id:this.customer_id,az_id:this.default_az.az_id,spec_family_id:this.ecs_spec_info.spec_family_id,spec_id:this.ecs_spec_info.spec_id,disk_info:{system_disk:{disk_feature:this.system_info.disk_feature,disk_type:this.system_info.disk_type,disk_size:this.system_info.disk_size},data_disks:this.data_disk_list}});"Success"===s.code&&(this.num_info.max=s.data.max_num)}FnCheckNum(){this.num_info.num||(this.num_info.num=this.num_info.min)}async FnGetPrice(s){var i;if(!this.ecs_spec_info.ecs_goods_id)return;if(!this.system_info.disk_feature)return;const e={customer_id:this.customer_id,region_id:this.default_region.region_id,az_id:this.default_az.az_id,is_gpu:this.ecs_spec_info.is_gpu,batch:0,billing_method:this.billing_method,ecs_info:{billing_info:this.ecs_spec_info.billing_info,ecs_goods_info:[{ecs_goods_id:this.ecs_spec_info.ecs_goods_id,cpu:this.ecs_spec_info.cpu,ram:this.ecs_spec_info.ram,gpu:this.ecs_spec_info.gpu,gic_goods_id:this.ecs_spec_info.billing_info[this.ecs_spec_info.ecs_goods_id].gic_goods_id}]},disk_info:{system_disk:{ebs_goods_id:this.system_info.ecs_goods_id,gic_goods_id:null===(i=this.disk_billing_info[this.system_info.ecs_goods_id])||void 0===i?void 0:i.gic_goods_id,goods_name:this.system_info.disk_name,disk_feature:this.system_info.disk_feature,disk_type:this.system_info.disk_type,disk_size:this.system_info.disk_size,is_follow_delete:this.system_info.is_follow_delete,storage_space:this.system_info.storage_space,iops:this.system_info.iops,handling_capacity:this.system_info.handling_capacity,ebs_number:1},data_disk:this.data_disk_list,billing_info:this.disk_billing_info},number:this.num_info.num?this.num_info.num:1};"local"===this.system_info.disk_feature&&(e.disk_info.system_disk.ebs_goods_id=this.ecs_spec_info.ecs_goods_id,e.disk_info.billing_info[this.ecs_spec_info.ecs_goods_id]=this.ecs_spec_info.billing_info[this.ecs_spec_info.ecs_goods_id],e.disk_info.system_disk.gic_goods_id=e.disk_info.billing_info[this.ecs_spec_info.ecs_goods_id].gic_goods_id,e.disk_info.system_disk["local_disk-IOPS"]=this.system_info.iops,e.disk_info.system_disk["local_disk-space"]=this.system_info.storage_space,e.disk_info.system_disk["local_disk-throughput"]=this.system_info.handling_capacity);const t=await p["a"].get_price(e);if("Success"===t.code){var _;let{price_symbol:s,price_unit:i}=t.data,e=0;(null===(_=t.data.disk.data_disk)||void 0===_?void 0:_.length)>0&&(e=t.data.disk.data_disk.reduce((s,i)=>s+i.price,0)),this.data_disk_price=s+e.toFixed(2)+"/"+i,this.system_disk_price=s+t.data.disk.system_disk.price.toFixed(2)+"/"+i,this.total_price=s+t.data.total_price.toFixed(2)+"/"+i}}FnConfirmCreate(){if(!this.customer_id)return void(this.error_msg.customer_id.show=!0);if(this.FnCheckEcsName())return;if(!this.default_subnet.subnet_id)return void(this.error_msg.subnet_id.show=!0);if(this.default_subnet.ip_not_used<this.num_info.num)return void this.$message.warning("所选网络可用IP数量不足！");if(this.num_info.num>this.num_info.max)return;const s=this.$refs.update_pwd.FnSubmit();s.flag&&(this.ecs_name_info.password=s.password,this.confirm_create_visible=!0)}async FnCreate(){var s;const i={customer_id:this.customer_id,region_id:this.default_region.region_id,az_id:this.default_az.az_id,is_gpu:this.ecs_spec_info.is_gpu,cpu_model:this.ecs_spec_info.cpu_model,gpu_id:this.ecs_spec_info.gpu_id,net_info:{vpc_id:this.default_vpc.vpc_id,vpc_segment_id:this.default_vpc.vpc_segment_id,vpc_segment_address:this.default_vpc.vpc_segment_address,subnet_info:[{subnet_id:this.default_subnet.subnet_id,vlan_id:this.default_subnet.vlan_id,mask:this.default_subnet.mask,ip_type:this.default_subnet.ip_type}]},ecs_spec_info:{ecs_goods_id:this.ecs_spec_info.ecs_goods_id,ecs_type:this.ecs_spec_info.ecs_type,ecs_family_name:this.ecs_spec_info.ecs_family_name,cpu:this.ecs_spec_info.cpu,ram:this.ecs_spec_info.ram,gpu:this.ecs_spec_info.gpu,billing_info:this.is_billing?this.ecs_spec_info.billing_info[this.ecs_spec_info.ecs_goods_id]:{},gic_goods_id:this.ecs_spec_info.billing_info[this.ecs_spec_info.ecs_goods_id].gic_goods_id},os_id:this.os_info.os_id,os_type:this.os_info.os_type,disk_info:{system_disk:{ebs_goods_id:this.system_info.ecs_goods_id,gic_goods_id:null===(s=this.disk_billing_info[this.system_info.ecs_goods_id])||void 0===s?void 0:s.gic_goods_id,goods_name:this.system_info.disk_name,disk_feature:this.system_info.disk_feature,disk_type:this.system_info.disk_type,disk_size:this.system_info.disk_size,is_follow_delete:this.system_info.is_follow_delete,storage_space:this.system_info.storage_space,iops:this.system_info.iops,handling_capacity:this.system_info.handling_capacity},data_disks:this.data_disk_list,billing_info:this.is_billing?this.disk_billing_info:{}},num:this.num_info.num?this.num_info.num:1,ecs_name:this.ecs_name_info.ecs_name.trim(),username:this.os_info.username||"root",password:this.ecs_name_info.password};"local"===this.system_info.disk_feature&&(i.disk_info.system_disk.ebs_goods_id=this.ecs_spec_info.ecs_goods_id,i.disk_info.system_disk.gic_goods_id=this.ecs_spec_info.billing_info[this.ecs_spec_info.ecs_goods_id].gic_goods_id,i.disk_info.billing_info[this.ecs_spec_info.ecs_goods_id]=this.ecs_spec_info.billing_info[this.ecs_spec_info.ecs_goods_id],i.disk_info.system_disk["local_disk-IOPS"]=this.system_info.iops,i.disk_info.system_disk["local_disk-space"]=this.system_info.storage_space,i.disk_info.system_disk["local_disk-throughput"]=this.system_info.handling_capacity);const e=await p["a"].create_instance(i);"Success"===e.code&&(this.$message.success(e.msg||"成功下发 创 建 任务！"),this.$router.push("/instance"))}FnChangeCustomerId(s){s.length>6?this.FnGetCustomerName():this.error_msg.customer_id.show=!0}FnChangeAz(s){s&&(this.default_vpc.vpc_id="",this.default_vpc.subnet_list=[],this.FnGetNetList())}FnChangeVpc(s){this.default_vpc.subnet_list.length>0?(this.default_subnet=this.default_vpc.subnet_list[0],this.error_msg.subnet_id.show=!1):(this.default_subnet={subnet_id:"",vlan_id:"",ip_address:"",mask:"",ip_type:"",ip_not_used:0},this.error_msg.subnet_id.show=!0)}};Object(a["a"])([Object(o["f"])("customer_id_input")],b.prototype,"FnChangeCustomerId",null),Object(a["a"])([Object(o["f"])("default_az.az_id")],b.prototype,"FnChangeAz",null),Object(a["a"])([Object(o["f"])("default_vpc.vpc_id")],b.prototype,"FnChangeVpc",null),b=Object(a["a"])([Object(o["a"])({components:{LabelBlock:n["a"],BackHeader:d["a"],Area:c["a"],updateSpec:l["a"],updateOs:r["a"],updateDisk:u["a"],updatePwd:m["a"],confirmBox:f["a"],SvgIcon:h["a"]}})],b);var k=b,v=k,y=(e("46f3"),e("2877")),C=Object(y["a"])(v,t,_,!1,null,"60c56c3e",null);i["default"]=C.exports},"46f3":function(s,i,e){"use strict";e("fb8b")},"98c9":function(s,i,e){"use strict";var t=function(){var s=this,i=s._self._c;s._self._setupProxy;return i("div",{staticClass:"box"},[i("div",{staticClass:"left-label",class:{"is-required":s.is_required}},[s._v(s._s(s.label))]),i("div",{staticClass:"right-content"},[s._t("default")],2)])},_=[],a=e("9ab4"),o=e("1b40");let n=class extends o["e"]{};Object(a["a"])([Object(o["c"])({default:""})],n.prototype,"label",void 0),Object(a["a"])([Object(o["c"])({default:!1})],n.prototype,"is_required",void 0),n=Object(a["a"])([Object(o["a"])({})],n);var d=n,c=d,l=(e("ca9f"),e("2877")),r=Object(l["a"])(c,t,_,!1,null,"3b58a324",null);i["a"]=r.exports},ca9f:function(s,i,e){"use strict";e("da48")},da48:function(s,i,e){},fb8b:function(s,i,e){}}]);
//# sourceMappingURL=chunk-5a48f371.1764224471686.js.map